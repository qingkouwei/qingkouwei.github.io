<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>è€å¸æœºç§èœ</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://wodekouwei.com/"/>
  <updated>2017-09-30T03:55:42.000Z</updated>
  <id>http://wodekouwei.com/</id>
  
  <author>
    <name>è½»å£å‘³</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>tips-shell-language</title>
    <link href="http://wodekouwei.com/2017/09/30/tips-shell-language/"/>
    <id>http://wodekouwei.com/2017/09/30/tips-shell-language/</id>
    <published>2017-09-30T03:54:47.000Z</published>
    <updated>2017-09-30T03:55:42.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼"><a href="#å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼" class="headerlink" title="å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼"></a>å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">##########################################################</div><div class="line">#ä¿®æ”¹è¡¨TBL_BAT_TASK_CTLçš„USE_FLAGå­—æ®µï¼Œå¯åŠ¨æˆ–åœæ­¢è´·è®°å¡é”€å¡çš„æ‰¹å¤„ç†</div><div class="line">#useageï¼šæ‰§è¡Œè„šæœ¬æ—¶åŠ -nå‚æ•°å°±æ˜¯å…³é—­æ‰¹å¤„ç†</div><div class="line">#    æ‰§è¡Œè„šæœ¬æ—¶åŠ -yå‚æ•°å°±æ˜¯æ‰“å¼€æ‰¹å¤„ç†</div><div class="line">##########################################################</div><div class="line"></div><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">if test &quot;$1&quot; = &quot;-n&quot;</div><div class="line">then</div><div class="line">    db2 connect to $DBLINK</div><div class="line">    db2 &quot;update TBL_BAT_TASK_CTL set USE_FLAG=&apos;N&apos; where BAT_ID=&apos;0024&apos; or BAT_ID=&apos;0025&apos;&quot;</div><div class="line">    db2 terminate</div><div class="line">#   exit 0</div><div class="line">fi</div><div class="line"></div><div class="line">if test &quot;$1&quot; = &quot;-y&quot;</div><div class="line">then</div><div class="line">    db2 connect to $DBLINK</div><div class="line">    db2 &quot;update TBL_BAT_TASK_CTL set USE_FLAG=&apos;Y&apos; where BAT_ID=&apos;0024&apos; or BAT_ID=&apos;0025&apos;&quot;</div><div class="line">    db2 terminate</div><div class="line">fi</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼&quot;&gt;&lt;a href=&quot;#å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼&quot; class=&quot;headerlink&quot; title=&quot;å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼&quot;&gt;&lt;/a&gt;å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼&lt;/h4&gt;&lt;figure class=&quot;hi
    
    </summary>
    
      <category term="language" scheme="http://wodekouwei.com/categories/language/"/>
    
    
      <category term="tips" scheme="http://wodekouwei.com/tags/tips/"/>
    
      <category term="language" scheme="http://wodekouwei.com/tags/language/"/>
    
      <category term="shell" scheme="http://wodekouwei.com/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>opencvæ ¸å¿ƒç±»å‹</title>
    <link href="http://wodekouwei.com/2017/09/29/opencv-core/"/>
    <id>http://wodekouwei.com/2017/09/29/opencv-core/</id>
    <published>2017-09-29T10:09:42.000Z</published>
    <updated>2017-09-30T02:53:07.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="mat"><a href="#mat" class="headerlink" title="mat"></a>mat</h3><h4 id="åˆ›å»ºå’Œæ¸…ç†matç©ºé—´"><a href="#åˆ›å»ºå’Œæ¸…ç†matç©ºé—´" class="headerlink" title="åˆ›å»ºå’Œæ¸…ç†matç©ºé—´"></a>åˆ›å»ºå’Œæ¸…ç†matç©ºé—´</h4><ul>
<li>Mat mat(3000, 4000, CV_8UC3);//3000è¡Œ,4000åˆ—æ•°ç»„,æ•°ç»„é‡Œå­˜æ”¾3ä¸ªunsigned charç±»å‹çš„æ•°æ®</li>
<li>mat.create(rows, cols, CV_8UC1);//è¡Œæ•°,åˆ—æ•°</li>
<li>releaseæˆ–è€…ææ„:å¼•ç”¨è®¡æ•°ä¸º1æ—¶é‡Šæ”¾</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;mat&quot;&gt;&lt;a href=&quot;#mat&quot; class=&quot;headerlink&quot; title=&quot;mat&quot;&gt;&lt;/a&gt;mat&lt;/h3&gt;&lt;h4 id=&quot;åˆ›å»ºå’Œæ¸…ç†matç©ºé—´&quot;&gt;&lt;a href=&quot;#åˆ›å»ºå’Œæ¸…ç†matç©ºé—´&quot; class=&quot;headerlink&quot; title=&quot;åˆ›
    
    </summary>
    
      <category term="opencv" scheme="http://wodekouwei.com/categories/opencv/"/>
    
    
      <category term="opencv" scheme="http://wodekouwei.com/tags/opencv/"/>
    
  </entry>
  
  <entry>
    <title>opencvå¼€å‘ç¯å¢ƒæ­å»º</title>
    <link href="http://wodekouwei.com/2017/09/29/opencv-env/"/>
    <id>http://wodekouwei.com/2017/09/29/opencv-env/</id>
    <published>2017-09-29T09:50:52.000Z</published>
    <updated>2017-09-29T10:09:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»githubä¸‹è½½opencvæœ€æ–°æºç <a href="https://github.com/opencv/opencv,ç›®å‰æœ€æ–°æ˜¯`5e93c8202363a13fc72df30f8c14069c5ab66e42`" target="_blank" rel="external">https://github.com/opencv/opencv,ç›®å‰æœ€æ–°æ˜¯`5e93c8202363a13fc72df30f8c14069c5ab66e42`</a>.</p>
<h3 id="Ubuntuç¯å¢ƒä¸‹ç¼–è¯‘"><a href="#Ubuntuç¯å¢ƒä¸‹ç¼–è¯‘" class="headerlink" title="Ubuntuç¯å¢ƒä¸‹ç¼–è¯‘"></a>Ubuntuç¯å¢ƒä¸‹ç¼–è¯‘</h3><p>å®‰è£…ä¾èµ–åº“:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install build-essential</div><div class="line"></div><div class="line">sudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev</div><div class="line"></div><div class="line">sudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev</div><div class="line"></div><div class="line">git clone https://github.com/opencv/opencv.git</div><div class="line"></div><div class="line">sudo apt-get install cmake-gui</div></pre></td></tr></table></figure></p>
<h3 id="Macç¯å¢ƒä¸‹ç¼–è¯‘"><a href="#Macç¯å¢ƒä¸‹ç¼–è¯‘" class="headerlink" title="Macç¯å¢ƒä¸‹ç¼–è¯‘"></a>Macç¯å¢ƒä¸‹ç¼–è¯‘</h3><p>è¿›å…¥æºç è·¯å¾„,æ–°å»ºä¸€ä¸ªreleaseçš„æ–‡ä»¶å¤¹,å¹¶è¿›å…¥,æ‰§è¡Œ:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cmake -G &quot;Unix Makefiles&quot; ..</div><div class="line">make</div><div class="line">sudo make install</div></pre></td></tr></table></figure></p>
<p>ç¼–è¯‘å®Œæˆåä¼šåœ¨releaseç”Ÿæˆlibç›®å½•,libä¸‹å­˜æ”¾æ‰€æœ‰ç¼–è¯‘æˆçš„åŠ¨æ€åº“,å¯èƒ½ä¸ubuntuä¸‹ç¼–è¯‘ç»“æœä¸åŒ,ubuntuä¸‹ç¼–è¯‘åªç”Ÿæˆ<code>libopencv_world.so</code>ä¸€ä¸ªåŠ¨æ€åº“,è€Œmacä¸‹ä¼šç”Ÿæˆ<code>opencv_core opencv_highgui opencv_imgproc opencv_ml opencv_objdetect opencv_photo opencv_video opencv_dnn opencv_imgcodecs opencv_shape</code>ç­‰å¤šä¸ªåŠ¨æ€åº“.æ‰§è¡Œ<code>make install</code>åä¼šå°†å¤´æ–‡ä»¶æ‹·è´åˆ°<code>/usr/local/include/</code>ä¸‹,å°†åŠ¨æ€åº“æ‹·è´åˆ°<code>/usr/local/lib/</code>ä¸‹,å°†jaråŒ…ç­‰å…¶ä»–æ–‡ä»¶æ‹·è´åˆ°<code>/usr/local/share/OpenCV/</code>ä¸‹,makefileè„šæœ¬åŠ å…¥åŠ¨æ€é“¾æ¥åº“:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">testopencv:main.cpp</div><div class="line">	g++ $+ -o $@ -lopencv_core -lopencv_highgui -lopencv_imgproc -lopencv_ml -lopencv_objdetect -lopencv_photo -lopencv_video -lopencv_dnn -lopencv_imgcodecs -lopencv_shape</div></pre></td></tr></table></figure></p>
<p><code>main.cpp</code>ä¸‹è¾“å…¥ä¸‹é¢æµ‹è¯•ä»£ç :
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#include &lt;opencv2/core.hpp&gt;</div><div class="line">#include &lt;opencv2/imgcodecs.hpp&gt;</div><div class="line">#include &lt;opencv2/highgui.hpp&gt;</div><div class="line">using namespace cv;</div><div class="line">int main(int argc, char *argv[])</div><div class="line">&#123;</div><div class="line">	Mat image = imread(&quot;1.png&quot;);</div><div class="line">	namedWindow(&quot;img&quot;);</div><div class="line">	imshow(&quot;img&quot;, image);</div><div class="line">	waitKey(0);</div><div class="line">	return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ç”Ÿæˆçš„æ‰§è¡Œæ–‡ä»¶åŒç›®å½•ä¸‹æ”¾å…¥åå­—ä¸º<code>1.png</code>çš„å›¾ç‰‡.</p>
<h4 id="é…ç½®QTç¯å¢ƒ"><a href="#é…ç½®QTç¯å¢ƒ" class="headerlink" title="é…ç½®QTç¯å¢ƒ"></a>é…ç½®QTç¯å¢ƒ</h4><p>åœ¨æ–°å»ºçš„QTå·¥ç¨‹ä¸­çš„.proæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ä»£ç :
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">INCLUDEPATH += /usr/local/include</div><div class="line">INCLUDEPATH += /usr/local/include/opencv</div><div class="line">INCLUDEPATH += /usr/local/include/opencv2</div><div class="line">LIBS += -L/usr/local/lib \</div><div class="line"> -lopencv_core \</div><div class="line"> -lopencv_highgui \</div><div class="line"> -lopencv_imgproc \</div></pre></td></tr></table></figure></p>
<p>å®Œæˆä»¥ä¸Šæ­¥éª¤åæŒ‰ç†åº”è¯¥æ˜¯èƒ½æˆåŠŸçš„ï¼Œä½†æ˜¯è¿è¡Œæ—¶å‘ç°ä¼šå‡ºç°å¦‚ä¸‹çš„é”™è¯¯ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dyld: Symbol not found: __cg_jpeg_resync_to_restart</div><div class="line">Referenced from: /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO</div><div class="line">Expected in: /usr/local/lib/libjpeg.8.dylib</div><div class="line">in /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO</div></pre></td></tr></table></figure></p>
<p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜,åœ¨é¡¹ç›®-è¿è¡Œé…ç½®ä¸­,å¢åŠ å˜é‡<code>DYLD_LIBRARY_PATH</code>å€¼ä¸º<code>/Application/QT5.7.0/5.7/clang_64/lib:/usr/local/lib</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»githubä¸‹è½½opencvæœ€æ–°æºç &lt;a href=&quot;https://github.com/opencv/opencv,ç›®å‰æœ€æ–°æ˜¯`5e93c8202363a13fc72df30f8c14069c5ab66e42`&quot; target=&quot;_blank&quot; rel=&quot;exter
    
    </summary>
    
      <category term="opencv" scheme="http://wodekouwei.com/categories/opencv/"/>
    
    
      <category term="opencv" scheme="http://wodekouwei.com/tags/opencv/"/>
    
  </entry>
  
  <entry>
    <title>tips-android</title>
    <link href="http://wodekouwei.com/2017/09/27/tips-android/"/>
    <id>http://wodekouwei.com/2017/09/27/tips-android/</id>
    <published>2017-09-27T02:41:33.000Z</published>
    <updated>2017-09-27T02:44:01.000Z</updated>
    
    <content type="html"><![CDATA[<h6 id="1-ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§"><a href="#1-ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§" class="headerlink" title="1.ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§"></a>1.ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§</h6><p>å›¾ç‰‡åŠ è½½æ¡†æ¶Glideå°±å¯ä»¥åšåˆ°è·å–æœ¬åœ°è§†é¢‘çš„ç¼©ç•¥å›¾(ä¸èƒ½è·å–ç½‘ç»œè§†é¢‘æ–‡ä»¶):
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String filePath = &quot;/storage/emulated/0/Pictures/example_video.mp4&quot;;</div><div class="line">Glide  </div><div class="line">    .with( context )</div><div class="line">    .load( Uri.fromFile( new File( filePath ) ) )</div><div class="line">    .into( imageViewGifAsBitmap );</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;h6 id=&quot;1-ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§&quot;&gt;&lt;a href=&quot;#1-ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§&quot; class=&quot;headerlink&quot; title=&quot;1.ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§&quot;&gt;&lt;/a&gt;1.ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§&lt;/h6&gt;&lt;p&gt;å›¾ç‰‡åŠ è½½æ¡†æ¶Glideå°±å¯ä»¥åšåˆ°è·å–
    
    </summary>
    
      <category term="Android" scheme="http://wodekouwei.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://wodekouwei.com/tags/Android/"/>
    
      <category term="tips" scheme="http://wodekouwei.com/tags/tips/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºQT QAudioOutput pushæ¨¡å¼é—®é¢˜</title>
    <link href="http://wodekouwei.com/2017/09/13/tips-qt-audiooutput/"/>
    <id>http://wodekouwei.com/2017/09/13/tips-qt-audiooutput/</id>
    <published>2017-09-13T03:52:14.000Z</published>
    <updated>2017-09-13T04:08:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨MACä¸ŠåŸºäºQTå’Œffmpegå®ç°æœ€ç®€å•æ’­æ”¾å™¨,åœ¨å®Œæˆå£°éŸ³æ’­æ”¾æ¨¡å—åå¯¼è‡´æ— æ³•æ­£å¸¸æ’­æ”¾,QAudioOutput startåstateä»æ˜¯idel,å°†QAudioOutput bufferå†™æ»¡åå°±ä¸èƒ½ç»§ç»­å†™æ•°æ®äº†,å¯¼è‡´æ’­æ”¾è¢«å¡æ­».</p>
<p>QAudioOutputåˆ›å»ºä»£ç :
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">QAudioFormat fmt;</div><div class="line">fmt.setSampleRate(this-&gt;sampleRate);</div><div class="line">fmt.setSampleSize(this-&gt;sampleSize);</div><div class="line">fmt.setChannelCount(this-&gt;channel);</div><div class="line">fmt.setCodec(&quot;audio/pcm&quot;);</div><div class="line">fmt.setByteOrder(QAudioFormat::LittleEndian);</div><div class="line">fmt.setSampleType(QAudioFormat::UnSignedInt);</div><div class="line">QAudioDeviceInfo info = QAudioDeviceInfo::defaultOutputDevice();</div><div class="line">printf(&quot;deviceName:%s\n&quot;,qPrintable(info.deviceName()));</div><div class="line">if (!info.isFormatSupported(fmt)) &#123;</div><div class="line">    printf(&quot;default format not supported try to use nearest\n&quot;);</div><div class="line">    fmt = info.nearestFormat(fmt);</div><div class="line">&#125;</div><div class="line">output = new QAudioOutput(fmt);</div><div class="line">//connect(output, SIGNAL(stateChanged(QAudio::State)), this, SLOT(handleStateChanged(QAudio::State)));</div><div class="line">io = output-&gt;start();</div><div class="line">printf(&quot;io:%p\n&quot;, io);</div><div class="line">//printf(&quot;state:%s&quot;,output-&gt;state());</div><div class="line">QAudio::State stat = output-&gt;state();</div></pre></td></tr></table></figure></p>
<p>åœ¨stackoverflow <a href="https://stackoverflow.com/questions/15651407/qt-qaudiooutput-push-mode" target="_blank" rel="external">Qt QAudioOutput push mode</a>çœ‹åˆ°åˆ«äººçš„é—®é¢˜å’Œè§£é‡Š,å‘ç°æ˜¯setSampleTypeå¼•èµ·çš„,ä»£ç åœ¨windowä¸Šå¯ä»¥æ­£å¸¸è·‘,åªæ˜¯åœ¨macä¸Šå¤±è´¥.</p>
<h5 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h5><p>Iâ€™ve got a question about using QAudioOutput to directly write samples at a specific sample rate to the sound output device. Iâ€™m writing an emulator that emualates sound chips on a per-frame basis, and then gets a buffer containing a frameâ€™s worth of audio samples, which I would like to write to the audio output. Currently, to test my audio output routine, I allocate a huge (5 minute) buffer to put random numbers into, like so:</p>
<p>Header:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">uint16_t *audio_outputBuffer;</div><div class="line">uint32_t audio_bytesRemainingToRead;</div><div class="line">QAudioOutput *audio_outputStream;</div><div class="line">QIODevice *audio_outputDevice;</div></pre></td></tr></table></figure></p>
<p>Implementation:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">audio_outputBuffer = (uint16_t *) malloc((96000 * 4) * 300);</div><div class="line">int i = 0;</div><div class="line"></div><div class="line">uint16_t *tempAudioBuffer = audio_outputBuffer;</div><div class="line">for(i = 0; i &lt; ((96000 * 4) * 150); i++) &#123;</div><div class="line">    *tempAudioBuffer = (uint16_t) rand() &amp; 0xFFFF;</div><div class="line">    tempAudioBuffer++;</div><div class="line">&#125;</div><div class="line"></div><div class="line">audio_bytesRemainingToRead = (96000 * 4) * 300;</div></pre></td></tr></table></figure></p>
<p>Next, I set up my audio device with some basic parameters:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// Set up the format</div><div class="line">QAudioFormat format;</div><div class="line">format.setFrequency(96000); // Usually this is specified through an UI option</div><div class="line">format.setChannels(2);</div><div class="line">format.setSampleSize(16);</div><div class="line">format.setCodec(&quot;audio/pcm&quot;);</div><div class="line">format.setByteOrder(QAudioFormat::LittleEndian);</div><div class="line">format.setSampleType(QAudioFormat::UnSignedInt);</div><div class="line"></div><div class="line">// There&apos;s code here to notify the user of inability to match the format and choose an action, which is omitted for clarity</div><div class="line"></div><div class="line">// Create audio output stream, set up signals</div><div class="line">audio_outputStream = new QAudioOutput(format, this);</div><div class="line"></div><div class="line">connect(audio_outputStream, SIGNAL(stateChanged(QAudio::State)), this, SLOT(audio_stateChanged(QAudio::State)));</div><div class="line"></div><div class="line">audio_outputDevice = audio_outputStream-&gt;start();</div></pre></td></tr></table></figure></p>
<p>Then, in my timer tick routine, which is called by a QTimer at 60 FPS, I do the following code to write a â€˜chunkâ€™ of audio data to the QAudioOutputâ€™s buffer:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">if(audio_outputDevice-&gt;isOpen() &amp;&amp; audio_outputStream-&gt;state() != QAudio::StoppedState) &#123;</div><div class="line">    qint64 bytesOfAudioWrittenToDevice = audio_outputDevice-&gt;write((char *) audio_outputBuffer, audio_outputStream-&gt;periodSize());</div><div class="line">    audio_bytesRemainingToRead -= bytesOfAudioWrittenToDevice;</div><div class="line">    qDebug() &lt;&lt; &quot;Wrote&quot; &lt;&lt; bytesOfAudioWrittenToDevice &lt;&lt; &quot;bytes of audio to output device. Remaining bytes to read:&quot; &lt;&lt; audio_bytesRemainingToRead;</div><div class="line">    qDebug() &lt;&lt; &quot;Free bytes in audio output:&quot; &lt;&lt; audio_outputStream-&gt;bytesFree();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Once I start the audio output process, I get the following output on the console:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Current audio state: 3 Error: 0</div><div class="line">Wrote 2048 bytes of audio to output device. Remaining bytes to read: 115197952</div><div class="line">Free bytes in audio output: 6144</div><div class="line">Current audio state: 0 Error: 0</div><div class="line">Wrote 2048 bytes of audio to output device. Remaining bytes to read: 115195904</div><div class="line">Free bytes in audio output: 4096</div><div class="line">Wrote 2048 bytes of audio to output device. Remaining bytes to read: 115193856</div><div class="line">Free bytes in audio output: 2048</div><div class="line">Wrote 2048 bytes of audio to output device. Remaining bytes to read: 115191808</div><div class="line">Free bytes in audio output: 0 (This and the above line is repeated forever)</div></pre></td></tr></table></figure></p>
<p>To me, it looks like QAudioOutput isnâ€™t flushing itâ€™s internal buffer to the sound card, which goes along with the entire â€œno sound coming out of my computerâ€ thing.</p>
<p>What would cause this issue, and how could I fix it?</p>
<p>(By the way, Iâ€™m compiling my code against Qt 4.8.1, on Mac OS X 10.7.4.)</p>
<p>Thanks for any answers.</p>
<h5 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h5><p>Upfront just wanna point out: This is not a Qt bug. Why? The answer is that in the WAV specâ€™, 8-bit samples are always unsigned, whereas 16-bit samples are always signed. Any other combination does not work. This is device related, the framework can not do anything about it.</p>
<p>So this will not work because you have set 16 bit sample size and unsigned integer format. And yes, the solution is: you have to set the sample type to signed for 16-bit resolution:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">format.setSampleType(QAudioFormat::SignedInt);</div></pre></td></tr></table></figure></p>
<p>Inversely for 8-bit samples you would have to put:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">format.setSampleType(QAudioFormat:UnsignedInt);</div></pre></td></tr></table></figure></p>
<p>Also this very similar question (same problem but with 8-bit) shows you that it is not a particular problem of using signed or unsigned samples in Qt, but that it is the combination of samples size and type that matters (for the audio device, not for Qt ;) QAudioOutput in Qt5 is not producing any sound</p>
<p>IMHO the fact that Qt does not take care of handling these cases by forcing the correct format is a flaw but not a lack in functionnality.</p>
<p>You can learn more about this in the notes section of this page: <a href="https://ccrma.stanford.edu/courses/422/projects/WaveFormat/" target="_blank" rel="external">https://ccrma.stanford.edu/courses/422/projects/WaveFormat/</a></p>
<p>Iâ€™ve figured this out â€” apparently Qt has issues with UNSIGNED samples. If you set the sample type to signed, everything works fine, regardless of platform.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åœ¨MACä¸ŠåŸºäºQTå’Œffmpegå®ç°æœ€ç®€å•æ’­æ”¾å™¨,åœ¨å®Œæˆå£°éŸ³æ’­æ”¾æ¨¡å—åå¯¼è‡´æ— æ³•æ­£å¸¸æ’­æ”¾,QAudioOutput startåstateä»æ˜¯idel,å°†QAudioOutput bufferå†™æ»¡åå°±ä¸èƒ½ç»§ç»­å†™æ•°æ®äº†,å¯¼è‡´æ’­æ”¾è¢«å¡æ­».&lt;/p&gt;
&lt;p&gt;QAudioOutp
    
    </summary>
    
      <category term="QT" scheme="http://wodekouwei.com/categories/QT/"/>
    
    
      <category term="å¤šåª’ä½“" scheme="http://wodekouwei.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93/"/>
    
      <category term="QT" scheme="http://wodekouwei.com/tags/QT/"/>
    
  </entry>
  
  <entry>
    <title>FFMPEG apiä½¿ç”¨æµç¨‹</title>
    <link href="http://wodekouwei.com/2017/09/13/ffmpeg-arch/"/>
    <id>http://wodekouwei.com/2017/09/13/ffmpeg-arch/</id>
    <published>2017-09-13T02:04:15.000Z</published>
    <updated>2017-09-13T04:17:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>ffmpegæ¥å£ä½¿ç”¨æµç¨‹æ¯”è¾ƒå›ºå®š:</p>
<ol>
<li><code>av_register_all()</code>:æ³¨å†Œæ‰€æœ‰æ¨¡å—</li>
<li><code>int ret = avformat_open_input(&amp;ic, ofn, 0, 0);</code>:è·å–AVFormatContext ic(ofnä¸ºè¾“å…¥æ–‡ä»¶åœ°å€)</li>
<li><code>for(i = 0; i &lt; ic-&gt;nb_streams; i++)</code>:éå†AVFormatContextä¸­æ‰€æœ‰stream,åˆ†åˆ«æ‰¾åˆ°Audioä¸Videoå¯¹åº”çš„AVCodecContext;</li>
<li><code>AVCodec *codec = avcodec_find_decoder(enc-&gt;codec_id);</code>:æ ¹æ®AVCodecContextä¸­codec_idè·å–åˆ°AVCodec;</li>
<li><code>avcodec_open2(enc, codec,NULL)</code>:æ‰“å¼€AVCodec;</li>
<li>æ¥ä¸‹æ¥åˆ†é…AVPacketä¸AVFrame</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ffmpegæ¥å£ä½¿ç”¨æµç¨‹æ¯”è¾ƒå›ºå®š:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;av_register_all()&lt;/code&gt;:æ³¨å†Œæ‰€æœ‰æ¨¡å—&lt;/li&gt;
&lt;li&gt;&lt;code&gt;int ret = avformat_open_input(&amp;amp;ic, ofn, 0, 0);&lt;/
    
    </summary>
    
      <category term="FFMPEG" scheme="http://wodekouwei.com/categories/FFMPEG/"/>
    
    
      <category term="å¤šåª’ä½“" scheme="http://wodekouwei.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93/"/>
    
      <category term="FFMPEG" scheme="http://wodekouwei.com/tags/FFMPEG/"/>
    
  </entry>
  
  <entry>
    <title>FFMPEGç¼–è§£ç </title>
    <link href="http://wodekouwei.com/2017/09/13/ffmpeg-codec/"/>
    <id>http://wodekouwei.com/2017/09/13/ffmpeg-codec/</id>
    <published>2017-09-13T02:03:37.000Z</published>
    <updated>2017-09-13T03:47:45.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="è§£ç "><a href="#è§£ç " class="headerlink" title="è§£ç "></a>è§£ç </h3><p>ffmpeg3ç‰ˆæœ¬çš„è§£ç æ¥å£åšäº†è°ƒæ•´,ä¹‹å‰çš„è§†é¢‘è§£ç æ¥å£<code>avcodec_decode_video2</code>å’ŒéŸ³é¢‘è§£ç æ¥å£<code>avcodec_decode_audio4</code>è¢«è®¾ç½®ä¸ºdeprecated,å¯¹è¿™ä¸¤ä¸ªæ¥å£åšäº†åˆå¹¶,ä½¿ç”¨åŒä¸€çš„æ¥å£.å¹¶ä¸”å°†éŸ³è§†é¢‘è§£ç æ­¥éª¤åˆ†æˆäº†ä¸¤æ­¥,ç¬¬ä¸€æ­¥<code>avcodec_send_packet</code>,ç¬¬äºŒæ­¥<code>avcodec_receive_frame</code>,</p>
<h4 id="æ—§ç‰ˆæœ¬avcodec-decode-video2"><a href="#æ—§ç‰ˆæœ¬avcodec-decode-video2" class="headerlink" title="æ—§ç‰ˆæœ¬avcodec_decode_video2"></a>æ—§ç‰ˆæœ¬<code>avcodec_decode_video2</code></h4><h4 id="æ—§ç‰ˆæœ¬avcodec-decode-audio4"><a href="#æ—§ç‰ˆæœ¬avcodec-decode-audio4" class="headerlink" title="æ—§ç‰ˆæœ¬avcodec_decode_audio4"></a>æ—§ç‰ˆæœ¬<code>avcodec_decode_audio4</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">int got_picture;</div><div class="line">            ret = avcodec_decode_audio4(enc, pcm,&amp;got_picture, pkt);</div><div class="line">            if ( ret &lt; 0 ) &#123;</div><div class="line">                char buf[1024] = &#123;0&#125;;</div><div class="line">                av_strerror(err, buf, sizeof(buf));</div><div class="line">                printf(buf);</div><div class="line">                printf(&quot;avcodec_decode_audio4 failed:%d&quot; ,got_picture);</div><div class="line">                av_packet_unref(pkt);</div><div class="line">                av_frame_free(&amp;pcm);</div><div class="line">                if(ic) avformat_close_input(&amp;ic);</div><div class="line">                return -1;</div><div class="line">            &#125;</div></pre></td></tr></table></figure>
<p>å°†AVPacketçš„pktè§£ç æˆAVFrameçš„pcm</p>
<h4 id="æ–°ç‰ˆæœ¬avcodec-send-packet"><a href="#æ–°ç‰ˆæœ¬avcodec-send-packet" class="headerlink" title="æ–°ç‰ˆæœ¬avcodec_send_packet"></a>æ–°ç‰ˆæœ¬<code>avcodec_send_packet</code></h4><h5 id="æ¥å£æºç "><a href="#æ¥å£æºç " class="headerlink" title="æ¥å£æºç :"></a>æ¥å£æºç :</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Supply raw packet data as input to a decoder.</div><div class="line"> *</div><div class="line"> * Internally, this call will copy relevant AVCodecContext fields, which can</div><div class="line"> * influence decoding per-packet, and apply them when the packet is actually</div><div class="line"> * decoded. (For example AVCodecContext.skip_frame, which might direct the</div><div class="line"> * decoder to drop the frame contained by the packet sent with this function.)</div><div class="line"> *</div><div class="line"> * @warning The input buffer, avpkt-&gt;data must be AV_INPUT_BUFFER_PADDING_SIZE</div><div class="line"> *          larger than the actual read bytes because some optimized bitstream</div><div class="line"> *          readers read 32 or 64 bits at once and could read over the end.</div><div class="line"> *</div><div class="line"> * @warning Do not mix this API with the legacy API (like avcodec_decode_video2())</div><div class="line"> *          on the same AVCodecContext. It will return unexpected results now</div><div class="line"> *          or in future libavcodec versions.</div><div class="line"> *</div><div class="line"> * @note The AVCodecContext MUST have been opened with @ref avcodec_open2()</div><div class="line"> *       before packets may be fed to the decoder.</div><div class="line"> *</div><div class="line"> * @param avctx codec context</div><div class="line"> * @param[in] avpkt The input AVPacket. Usually, this will be a single video</div><div class="line"> *                  frame, or several complete audio frames.</div><div class="line"> *                  Ownership of the packet remains with the caller, and the</div><div class="line"> *                  decoder will not write to the packet. The decoder may create</div><div class="line"> *                  a reference to the packet data (or copy it if the packet is</div><div class="line"> *                  not reference-counted).</div><div class="line"> *                  Unlike with older APIs, the packet is always fully consumed,</div><div class="line"> *                  and if it contains multiple frames (e.g. some audio codecs),</div><div class="line"> *                  will require you to call avcodec_receive_frame() multiple</div><div class="line"> *                  times afterwards before you can send a new packet.</div><div class="line"> *                  It can be NULL (or an AVPacket with data set to NULL and</div><div class="line"> *                  size set to 0); in this case, it is considered a flush</div><div class="line"> *                  packet, which signals the end of the stream. Sending the</div><div class="line"> *                  first flush packet will return success. Subsequent ones are</div><div class="line"> *                  unnecessary and will return AVERROR_EOF. If the decoder</div><div class="line"> *                  still has frames buffered, it will return them after sending</div><div class="line"> *                  a flush packet.</div><div class="line"> *</div><div class="line"> * @return 0 on success, otherwise negative error code:</div><div class="line"> *      AVERROR(EAGAIN):   input is not accepted right now - the packet must be</div><div class="line"> *                         resent after trying to read output</div><div class="line"> *      AVERROR_EOF:       the decoder has been flushed, and no new packets can</div><div class="line"> *                         be sent to it (also returned if more than 1 flush</div><div class="line"> *                         packet is sent)</div><div class="line"> *      AVERROR(EINVAL):   codec not opened, it is an encoder, or requires flush</div><div class="line"> *      AVERROR(ENOMEM):   failed to add packet to internal queue, or similar</div><div class="line"> *      other errors: legitimate decoding errors</div><div class="line"> */</div><div class="line">int avcodec_send_packet(AVCodecContext *avctx, const AVPacket *avpkt);</div></pre></td></tr></table></figure>
<h5 id="å‚æ•°åˆ†æ"><a href="#å‚æ•°åˆ†æ" class="headerlink" title="å‚æ•°åˆ†æ"></a>å‚æ•°åˆ†æ</h5><ul>
<li><code>AVCodecContext *avctx</code>ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸æ—§çš„æ¥å£ä¸€è‡´ï¼Œæ˜¯è§†é¢‘è§£ç çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«è§£ç å™¨ã€‚</li>
<li><code>const AVPacket *avpkt</code>ï¼š ç¼–ç çš„éŸ³è§†é¢‘å¸§æ•°æ®</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¦ä¼ é€’ç©ºçš„avpkt
è¿™é‡Œæœ‰ä¸€ä¸ªè¯´æ˜æ˜¯å¯ä»¥ä¼ é€’NULLï¼Œä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ä¼ é€’NULLï¼Œä½ å¹³æ—¶çœ‹ä¸€äº›è§†é¢‘æ’­æ”¾å™¨ï¼Œæ’­æ”¾ç»å¸¸ä¼šå°‘æœ€åå‡ å¸§ï¼Œå¾ˆå¤šæƒ…å†µå°±æ˜¯å› ä¸ºæ²¡æœ‰å¤„ç†å¥½ç¼“å†²å¸§çš„é—®é¢˜ï¼Œffmpegå†…éƒ¨ä¼šç¼“å†²å‡ å¸§ï¼Œè¦æƒ³å–å‡ºæ¥å°±éœ€è¦ä¼ é€’ç©ºçš„AVPacketè¿›å»ã€‚</p>
<h4 id="æ–°ç‰ˆæœ¬avcodec-receive-frame"><a href="#æ–°ç‰ˆæœ¬avcodec-receive-frame" class="headerlink" title="æ–°ç‰ˆæœ¬avcodec_receive_frame"></a>æ–°ç‰ˆæœ¬<code>avcodec_receive_frame</code></h4><h5 id="æ¥å£æºç -1"><a href="#æ¥å£æºç -1" class="headerlink" title="æ¥å£æºç "></a>æ¥å£æºç </h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Return decoded output data from a decoder.</div><div class="line"> *</div><div class="line"> * @param avctx codec context</div><div class="line"> * @param frame This will be set to a reference-counted video or audio</div><div class="line"> *              frame (depending on the decoder type) allocated by the</div><div class="line"> *              decoder. Note that the function will always call</div><div class="line"> *              av_frame_unref(frame) before doing anything else.</div><div class="line"> *</div><div class="line"> * @return</div><div class="line"> *      0:                 success, a frame was returned</div><div class="line"> *      AVERROR(EAGAIN):   output is not available right now - user must try</div><div class="line"> *                         to send new input</div><div class="line"> *      AVERROR_EOF:       the decoder has been fully flushed, and there will be</div><div class="line"> *                         no more output frames</div><div class="line"> *      AVERROR(EINVAL):   codec not opened, or it is an encoder</div><div class="line"> *      other negative values: legitimate decoding errors</div><div class="line"> */</div><div class="line">int avcodec_receive_frame(AVCodecContext *avctx, AVFrame *frame);</div></pre></td></tr></table></figure>
<h5 id="å‚æ•°åˆ†æ-1"><a href="#å‚æ•°åˆ†æ-1" class="headerlink" title="å‚æ•°åˆ†æ"></a>å‚æ•°åˆ†æ</h5><ul>
<li><code>AVCodecContext *avctx</code>ï¼šç¬¬ä¸€ä¸ªå‚æ•°è§†é¢‘è§£ç çš„ä¸Šä¸‹æ–‡ï¼Œä¸ä¸Šé¢æ¥å£ä¸€è‡´ã€‚</li>
<li><code>AVFrame *frame</code>ï¼šè§£ç åçš„è§†é¢‘å¸§æ•°æ®ã€‚</li>
</ul>
<h5 id="ç©ºé—´ç”³è¯·å’Œé‡Šæ”¾é—®é¢˜"><a href="#ç©ºé—´ç”³è¯·å’Œé‡Šæ”¾é—®é¢˜" class="headerlink" title="ç©ºé—´ç”³è¯·å’Œé‡Šæ”¾é—®é¢˜"></a>ç©ºé—´ç”³è¯·å’Œé‡Šæ”¾é—®é¢˜</h5><p>è§£ç åå›¾åƒç©ºé—´ç”±å‡½æ•°å†…éƒ¨ç”³è¯·ï¼Œä½ æ‰€åšçš„åªéœ€è¦åˆ†é… AVFrame å¯¹è±¡ç©ºé—´ï¼Œå¦‚æœä½ æ¯æ¬¡è°ƒç”¨avcodec_receive_frameä¼ é€’åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ¥å£å†…éƒ¨ä¼šåˆ¤æ–­ç©ºé—´æ˜¯å¦å·²ç»åˆ†é…ï¼Œå¦‚æœæ²¡æœ‰åˆ†é…ä¼šåœ¨å‡½æ•°å†…éƒ¨åˆ†é…ã€‚
avcodec_send_packetå’Œavcodec_receive_frameè°ƒç”¨å…³ç³»å¹¶ä¸ä¸€å®šæ˜¯ä¸€å¯¹ä¸€çš„ï¼Œæ¯”å¦‚ä¸€äº›éŸ³é¢‘æ•°æ®ä¸€ä¸ªAVPacketä¸­åŒ…å«äº†1ç§’é’Ÿçš„éŸ³é¢‘ï¼Œè°ƒç”¨ä¸€æ¬¡avcodec_send_packetä¹‹åï¼Œå¯èƒ½éœ€è¦è°ƒç”¨25æ¬¡ avcodec_receive_frameæ‰èƒ½è·å–å…¨éƒ¨çš„è§£ç éŸ³é¢‘æ•°æ®ï¼Œæ‰€ä»¥è¦åšå¦‚ä¸‹å¤„ç†ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">int re = avcodec_send_packet(codec, pkt);</div><div class="line">if (re != 0)</div><div class="line">&#123;</div><div class="line">    return;</div><div class="line">&#125;</div><div class="line">while( avcodec_receive_frame(codec, frame) == 0)</div><div class="line">&#123;</div><div class="line">    //è¯»å–åˆ°ä¸€å¸§éŸ³é¢‘æˆ–è€…è§†é¢‘</div><div class="line">    //å¤„ç†è§£ç åéŸ³è§†é¢‘ frame</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>å‚è€ƒ
<a href="http://ffmpeg.org/doxygen/trunk/group__lavc__encdec.html" target="_blank" rel="external">send/receive encoding and decoding API overview</a></p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;è§£ç &quot;&gt;&lt;a href=&quot;#è§£ç &quot; class=&quot;headerlink&quot; title=&quot;è§£ç &quot;&gt;&lt;/a&gt;è§£ç &lt;/h3&gt;&lt;p&gt;ffmpeg3ç‰ˆæœ¬çš„è§£ç æ¥å£åšäº†è°ƒæ•´,ä¹‹å‰çš„è§†é¢‘è§£ç æ¥å£&lt;code&gt;avcodec_decode_video2&lt;/code&gt;å’ŒéŸ³é¢‘è§£ç æ¥å£&lt;
    
    </summary>
    
      <category term="FFMPEG" scheme="http://wodekouwei.com/categories/FFMPEG/"/>
    
    
      <category term="å¤šåª’ä½“" scheme="http://wodekouwei.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93/"/>
    
      <category term="FFMPEG" scheme="http://wodekouwei.com/tags/FFMPEG/"/>
    
  </entry>
  
  <entry>
    <title>FFMPEGå·¥å…·æ–¹æ³•</title>
    <link href="http://wodekouwei.com/2017/09/13/ffmpeg-util/"/>
    <id>http://wodekouwei.com/2017/09/13/ffmpeg-util/</id>
    <published>2017-09-13T02:03:27.000Z</published>
    <updated>2017-09-13T04:20:49.000Z</updated>
    
    <content type="html"><![CDATA[<h5 id="av-strerror"><a href="#av-strerror" class="headerlink" title="av_strerror"></a>av_strerror</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">int av_strerror	(	int 	errnum,</div><div class="line">char * 	errbuf,</div><div class="line">size_t 	errbuf_size</div><div class="line">)</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h5 id=&quot;av-strerror&quot;&gt;&lt;a href=&quot;#av-strerror&quot; class=&quot;headerlink&quot; title=&quot;av_strerror&quot;&gt;&lt;/a&gt;av_strerror&lt;/h5&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;tabl
    
    </summary>
    
      <category term="FFMPEG" scheme="http://wodekouwei.com/categories/FFMPEG/"/>
    
    
      <category term="å¤šåª’ä½“" scheme="http://wodekouwei.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93/"/>
    
      <category term="FFMPEG" scheme="http://wodekouwei.com/tags/FFMPEG/"/>
    
  </entry>
  
  <entry>
    <title>éŸ³è§†é¢‘å‚æ•°ä¹‹Profile</title>
    <link href="http://wodekouwei.com/2017/09/12/tips-media-profile/"/>
    <id>http://wodekouwei.com/2017/09/12/tips-media-profile/</id>
    <published>2017-09-12T04:12:19.000Z</published>
    <updated>2017-09-12T08:40:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‰ä¸¤å¤©å‘ç°å…¬å¸äº§å“ <strong>è§¦å‘</strong> æœ‰å¯¼å…¥ä»å¾®ä¿¡ç­‰ä¸‹è½½çš„å¤–éƒ¨å°è§†é¢‘æ—¶å¤±è´¥çš„æƒ…å†µ, <strong>è§¦å‘</strong> å¯¼å…¥è§†é¢‘æ—¶ä½¿ç”¨å¼€æºåº“<a href="https://github.com/INDExOS/media-for-mobile" target="_blank" rel="external">media-for-mobile</a>å¯¹è§†é¢‘è¿›è¡Œé‡æ–°ç¼–ç .media-for-mobileä½¿ç”¨androidç³»ç»Ÿæ¥å£<code>android.media.MediaExtractor</code>å¯¹mp4æ–‡ä»¶è§£å¤ç”¨,ä½¿ç”¨androidç¡¬ä»¶ç¼–è§£ç æ¥å£<code>android.media.MediaCodec</code>å¯¹è§†é¢‘è§£ç -å¤„ç†-ç¼–ç æ“ä½œ,æœ€åé€šè¿‡Androidç³»ç»ŸAPI<code>android.media.MediaMuxer</code>å°†è§†é¢‘å†™æˆæ–‡ä»¶.</p>
<p>åé¦ˆçš„ä¸¤ä¸ªæœ‰é—®é¢˜è§†é¢‘,ä¸€ä¸ªè§†é¢‘å¯¼å…¥æ—¶æŠ¥<code>BufferOverFlowException</code>é”™è¯¯,å¦ä¸€ä¸ªè§†é¢‘ä¸æŠ¥é”™ä½†æ˜¯å¯¼å…¥æ—¶è¿›åº¦ä¸€ç›´ä¸º0%.</p>
<p>ç»åˆ†æå‡ºé—®é¢˜çš„ä¸¤ä¸ªè§†é¢‘çš„Video profileä¸ºHigh,æ™®é€šè§†é¢‘ä¸º<code>Baseline</code>,æŠ¥<code>BufferOverFlowException</code>é”™è¯¯çš„è§†é¢‘çš„Audio profileä¸º<code>HE-AAC</code>,æ™®é€šè§†é¢‘çš„Audio profileä¸º<code>LC</code>.
è¯¦ç»†äº†è§£äº†ä¸€ä¸‹H264 ä¸AAC profile:</p>
<h4 id="H264å„ç§profile"><a href="#H264å„ç§profile" class="headerlink" title="H264å„ç§profile"></a>H264å„ç§profile</h4><p>ä½œä¸ºè¡Œä¸šæ ‡å‡†ï¼ŒH.264ç¼–ç ä½“ç³»å®šä¹‰äº†4ç§ä¸åŒçš„Profile(ç±»)ï¼šBaseline(åŸºçº¿ç±»),Main(ä¸»è¦ç±»), Extended(æ‰©å±•ç±»)å’ŒHigh Profile(é«˜ç«¯ç±»)ï¼ˆå®ƒä»¬å„è‡ªä¸‹åˆ†æˆè®¸å¤šä¸ªå±‚ï¼‰ï¼š</p>
<ol>
<li><code>Baseline Profile</code>: æä¾›I/På¸§ï¼Œä»…æ”¯æŒprogressive(é€è¡Œæ‰«æ)å’ŒCAVLCï¼›</li>
<li><code>Extended Profile</code>: æä¾›I/P/B/SP/SIå¸§ï¼Œä»…æ”¯æŒprogressive(é€è¡Œæ‰«æ)å’ŒCAVLCï¼›</li>
<li><code>Main Profile:</code> æä¾›I/P/Bå¸§ï¼Œæ”¯æŒprogressive(é€è¡Œæ‰«æ)å’Œinterlaced(éš”è¡Œæ‰«æ)ï¼Œæä¾›CAVLCæˆ–CABACï¼›</li>
<li><code>High Profile</code>: ï¼ˆä¹Ÿå°±æ˜¯FRExtï¼‰åœ¨Main ProfileåŸºç¡€ä¸Šæ–°å¢ï¼š8x8 intra prediction(8x8 å¸§å†…é¢„æµ‹), custom quant(è‡ªå®šä¹‰é‡åŒ–), lossless video coding(æ— æŸè§†é¢‘ç¼–ç ), æ›´å¤šçš„yuvæ ¼å¼ï¼ˆ4:4:4â€¦ï¼‰ï¼›</li>
</ol>
<p>H.264åœ¨é«˜æ¸…ä¸­å…·æœ‰æœ€å°ä½“ç§¯ã€‚åœ¨åŒç­‰å›¾åƒè´¨é‡ä¸‹ï¼Œé‡‡ç”¨H.264æŠ€æœ¯å‹ç¼©åçš„æ•°æ®é‡åªæœ‰MPEG2çš„1/8ï¼ŒMPEG4çš„1/3ï¼Œç›¸å¯¹Xvidã€Divxç­‰å±äºMPEG4ç¼–ç è€Œè¨€ï¼Œå…¶ä½“ç§¯ä¼˜åŠ¿æ˜æ˜¾ï¼Œåœ¨äº’è”ç½‘ä¸Šï¼ŒH.264èµ„æºå¤„åœ¨çˆ†å‘è¶‹åŠ¿ã€‚è€ŒHigh Profileæ˜¯H.264è§£ç ä¸­çš„é«˜ç«¯ç±»å‹ï¼Œæ‹¥æœ‰æœ€å®Œå–„çš„æ”¯æŒç¨‹åº¦ã€æœ€ä¼˜ç§€çš„ç‰¹æ€§ï¼Œå¯ä»¥è¯´æ˜¯é«˜æ¸…è§†é¢‘ç¼–ç ä¸­çš„åŠ³æ–¯è±æ–¯ï¼Œåªæœ‰å¾æœäº†è¿™ä¸ªä¼˜ç§€çš„ç¼–ç ï¼ŒMP4æ‰èƒ½å°†H.264å®Œå…¨æŒæ§ï¼Œä¹Ÿæ‰èƒ½å……åˆ†äº«å—åˆ°é«˜æ¸…è§†é¢‘å¸¦æ¥çš„è§†è§‰éœ‡æ’¼ï¼Œæ„ä¹‰éå‡¡ã€‚</p>
<p>é’ˆå¯¹å½“å‰é«˜æ¸…æ˜¯è§†é¢‘ä¼šè®®è¡Œä¸šçš„ä¸»æµå‘å±•è¶‹åŠ¿ï¼Œè€Œç›®å‰é«˜æ¸…æ™®åŠçš„ä¸»è¦é˜»åŠ›ä¹‹ä¸€å°±æ˜¯å¸¦å®½çš„é™åˆ¶ã€‚è€ŒHigh Profile H.264æŠ€æœ¯åœ¨åŒç­‰è§†é¢‘è´¨é‡çš„æƒ…å†µä¸‹å¯èŠ‚çœ50%çš„å¸¦å®½ï¼Œä¸ºå®¢æˆ·èŠ‚çœå¤§é‡çš„ç½‘ç»œå¸¦å®½æˆæœ¬ã€‚æ®ä¸šå†…ä¸“å®¶ä»‹ç»ï¼Œæ­¤æ¬¡H.264 High Profileçš„æ¨å‡ºæ˜¯è§†é¢‘æŠ€æœ¯çš„ä¸€ä¸ªå·¨å¤§è¿›æ­¥ï¼Œå…¶æ„ä¹‰ä¸äºšäº2003å¹´ä»H.263å‘H.264è¿‡æ¸¡çš„ä»·å€¼ã€‚å®ƒå°†ä¸ºç›®å‰æ­£åœ¨æ¨å¹¿çš„é«˜æ¸…è§†é¢‘é€šä¿¡åº”ç”¨æ‰«æ¸…äº†ä»¤äººå¤´ç–¼çš„ç½‘ç»œå¸¦å®½éšœç¢ï¼Œä¸ä»…å¦‚æ­¤ï¼Œè¿™äº›å˜åŒ–å¯¹äºåŒ…æ‹¬CIFã€æ ‡æ¸…ç­‰å“è´¨çš„è§†é¢‘é€šä¿¡åº”ç”¨ä¹ŸåŒæ ·é€‚ç”¨ã€‚</p>
<p>é‰´äºHigh Profile H.264å¯¹äºè§†é¢‘ä¼šè®®è¡Œä¸šçš„éå‡¡å½±å“ï¼Œç›®å‰å·²æœ‰å›½å†…å¤–å‚å•†å°é²œï¼Œå®£å¸ƒå…¶æ——ä¸‹äº§å“å…¨é¢æ”¯æŒè¯¥é¡¹æŠ€æœ¯ï¼ŒåŒ…æ‹¬å®åˆ©é€šã€åå¹³ã€åè…¾ç½‘è®¯ã€‚ä»è¿™ä¸€è¶‹åŠ¿æ¥çœ‹ï¼Œæœªæ¥è§†é¢‘ä¼šè®®äº§å“å…¨é¢æ”¯æŒHigh Profile H.264ä¹Ÿç»æˆä¸ºä¸å¯é€†è½¬çš„æ½®æµï¼Œè€Œé«˜æ¸…æ™®åŠä¹Ÿåœ¨æŠ€æœ¯å±‚é¢æ›´è¿‘äº†ä¸€æ­¥ã€‚</p>
<blockquote>
<p>å‚è€ƒ:
<a href="http://blog.csdn.net/qiaoliang328/article/details/10153313" target="_blank" rel="external">H264 å„ç§profile</a></p>
</blockquote>
<h4 id="AACå„ç§profile"><a href="#AACå„ç§profile" class="headerlink" title="AACå„ç§profile"></a>AACå„ç§profile</h4><h5 id="AACå…±æœ‰9ç§è§„æ ¼ï¼Œä»¥é€‚åº”ä¸åŒçš„åœºåˆçš„éœ€è¦ï¼š"><a href="#AACå…±æœ‰9ç§è§„æ ¼ï¼Œä»¥é€‚åº”ä¸åŒçš„åœºåˆçš„éœ€è¦ï¼š" class="headerlink" title="AACå…±æœ‰9ç§è§„æ ¼ï¼Œä»¥é€‚åº”ä¸åŒçš„åœºåˆçš„éœ€è¦ï¼š"></a>AACå…±æœ‰9ç§è§„æ ¼ï¼Œä»¥é€‚åº”ä¸åŒçš„åœºåˆçš„éœ€è¦ï¼š</h5><ol>
<li><code>MPEG-2 AAC LC</code>: ä½å¤æ‚åº¦è§„æ ¼ï¼ˆLow Complexityï¼‰â€“æ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰å¢ç›Šæ§åˆ¶ï¼Œä½†æé«˜äº†ç¼–ç æ•ˆç‡ï¼Œåœ¨ä¸­ç­‰ç ç‡çš„ç¼–ç æ•ˆç‡ä»¥åŠéŸ³è´¨æ–¹é¢ï¼Œéƒ½èƒ½æ‰¾åˆ°å¹³è¡¡ç‚¹</li>
<li><code>MPEG-2 AAC Main</code>: ä¸»è§„æ ¼    </li>
<li><code>MPEG-2 AAC SSR</code>: å¯å˜é‡‡æ ·ç‡è§„æ ¼ï¼ˆScaleable Sample Rateï¼‰</li>
<li><code>MPEG-4 AAC LC</code>: ä½å¤æ‚åº¦è§„æ ¼ï¼ˆLow Complexityï¼‰â€”â€”ç°åœ¨çš„æ‰‹æœºæ¯”è¾ƒå¸¸è§çš„MP4æ–‡ä»¶ä¸­çš„éŸ³é¢‘éƒ¨ä»½å°±åŒ…æ‹¬äº†è¯¥è§„æ ¼éŸ³é¢‘æ–‡ä»¶</li>
<li><code>MPEG-4 AAC Main</code>: ä¸»è§„æ ¼   â€”â€”åŒ…å«äº†é™¤å¢ç›Šæ§åˆ¶ä¹‹å¤–çš„å…¨éƒ¨åŠŸèƒ½ï¼Œå…¶éŸ³è´¨æœ€å¥½</li>
<li><code>MPEG-4 AAC SSR</code>: å¯å˜é‡‡æ ·ç‡è§„æ ¼ï¼ˆScaleable Sample Rateï¼‰</li>
<li><code>MPEG-4 AAC LTP</code>: é•¿æ—¶æœŸé¢„æµ‹è§„æ ¼ï¼ˆLong Term Predicitionï¼‰</li>
<li><code>MPEG-4 AAC LD</code>: ä½å»¶è¿Ÿè§„æ ¼ï¼ˆLow Delayï¼‰</li>
<li><code>MPEG-4 AAC HE</code>: é«˜æ•ˆç‡è§„æ ¼ï¼ˆHigh Efficiencyï¼‰â€”â€“è¿™ç§è§„æ ¼é€‚åˆç”¨äºä½ç ç‡ç¼–ç ï¼Œæœ‰Nero ACC ç¼–ç å™¨æ”¯æŒ</li>
</ol>
<p>14496-3æ ‡å‡†ï¼Œé‡Œé¢å®šä¹‰çš„profileé™¤äº†ä¸Šè¿°çš„ä¸€äº›è§„æ ¼ï¼Œè¿˜æœ‰å¦‚Scalable ã€ TwinVQã€  CELPã€  HVXCç­‰æ›´å¤šå…¶ä»–çš„profileã€‚</p>
<p>ç›®å‰å¬åˆ°ç”¨çš„æ¯”è¾ƒå¤šçš„åº”è¯¥æ˜¯LCå’ŒHE(é€‚åˆä½ç ç‡)ã€‚æµè¡Œçš„Nero AACçš„å‘½ä»¤è¡Œç¼–ç ç¨‹åºå°±æ”¯æŒLCï¼ŒHEï¼ŒHEv2è¿™ä¸‰ç§ï¼Œè¯•ç”¨åï¼Œç”¨MediaInfoåˆ†æäº†ç¼–ç åçš„AACéŸ³é¢‘ï¼Œå‘ç°è§„æ ¼æ˜¾ç¤ºéƒ½æ˜¯LCï¼Œå½“æ—¶å°±æ„Ÿåˆ°å¥‡æ€ªï¼Œä¸æ˜¯è¯´æ”¯æŒä¸‰ç§è§„æ ¼å—ï¼Ÿç„¶åæ‰åˆæŸ¥èµ„æ–™å‘ç°ï¼ŒåŸæ¥HEå…¶å®å°±æ˜¯AACï¼ˆLCï¼‰+SBRæŠ€æœ¯ï¼ŒHEv2å°±æ˜¯AACï¼ˆLCï¼‰+SBR+PSæŠ€æœ¯ï¼Œéš¾æ€ªç”¨MediaInfoåˆ†æåï¼ŒHEè§„æ ¼çš„æ–‡ä»¶å³æ˜¾ç¤º:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">æ ¼å¼ç®€ä»‹:LC</div><div class="line">æ ¼å¼è®¾ç½®,SBR:æ˜¯</div><div class="line">æ ¼å¼è®¾ç½®,PS:å¦</div></pre></td></tr></table></figure></p>
<h5 id="HEä¸HEv2"><a href="#HEä¸HEv2" class="headerlink" title="HEä¸HEv2"></a>HEä¸HEv2</h5><ul>
<li><p>HEï¼šâ€œhigh efficiencyâ€ï¼ˆé«˜æ•ˆæ€§ï¼‰ã€‚HE-AAC v1ï¼ˆåˆç§°AACPlusV1ï¼ŒSBR)ç”¨å®¹å™¨çš„æ–¹æ³•åŠ äº†åŸAACï¼ˆLCï¼‰+SBRæŠ€æœ¯ã€‚SBRå…¶å®ä»£è¡¨çš„æ˜¯Spectral Band Replication(é¢‘æ®µå¤åˆ¶)ã€‚ç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼ŒéŸ³ä¹çš„ä¸»è¦é¢‘è°±é›†ä¸­åœ¨ä½é¢‘æ®µï¼Œé«˜é¢‘æ®µå¹…åº¦å¾ˆå°ï¼ˆä½†å¾ˆé‡è¦ï¼Œå†³å®šäº†éŸ³è´¨ï¼‰ï¼Œå¦‚æœå¯¹æ•´ä¸ªé¢‘æ®µç¼–ç ï¼Œè¦ä¹ˆä¸ºäº†ä¿æŠ¤é«˜é¢‘é€ æˆä½é¢‘æ®µç¼–ç è¿‡ç»†ä»¥è‡´æ–‡ä»¶å·¨å¤§ï¼Œè¦ä¹ˆä¸ºäº†ä¿å­˜äº†ä½é¢‘çš„ä¸»è¦æˆåˆ†è€Œå¤±å»é«˜é¢‘æˆåˆ†ä»¥è‡´ä¸§å¤±éŸ³è´¨ã€‚SBRæŠŠé¢‘è°±åˆ‡å‰²å¼€æ¥ï¼Œä½é¢‘å•ç‹¬ç¼–ç ä¿å­˜ä¸»è¦æˆåˆ†ï¼Œé«˜é¢‘å•ç‹¬æ”¾å¤§ç¼–ç ä¿å­˜éŸ³è´¨ï¼Œâ€œç»Ÿç­¹å…¼é¡¾â€äº†ï¼Œåœ¨å‡å°‘æ–‡ä»¶å¤§å°çš„æƒ…å†µä¸‹è¿˜ä¿å­˜äº†éŸ³è´¨ï¼Œå®Œç¾çš„åŒ–è§£äº†ä¸€å¯¹çŸ›ç›¾</p>
</li>
<li><p>HEv2 å®ƒç”¨å®¹å™¨çš„æ–¹æ³•åŒ…å«äº†HE-AAC v1å’ŒPSæŠ€æœ¯ã€‚PSæŒ‡â€œparametric stereoâ€ï¼ˆå‚æ•°ç«‹ä½“å£°ï¼‰ã€‚è¿™ä¸ªå…¶å®å¥½ç†è§£ï¼ŒåŸæ¥çš„ç«‹ä½“å£°æ–‡ä»¶ï¼Œæ–‡ä»¶å¤§å°æ˜¯ä¸€ä¸ªå£°é“çš„ä¸¤å€ã€‚ä½†æ˜¯ä¸¤ä¸ªå£°é“çš„å£°éŸ³å­˜åœ¨æŸç§ç›¸ä¼¼æ€§ï¼Œæ ¹æ®é¦™å†œä¿¡æ¯ç†µç¼–ç å®šç†ï¼Œç›¸å…³æ€§åº”è¯¥è¢«å»æ‰æ‰èƒ½å‡å°æ–‡ä»¶å¤§å°ã€‚æ‰€ä»¥PSæŠ€æœ¯å­˜å‚¨äº†ä¸€ä¸ªå£°é“çš„å…¨éƒ¨ä¿¡æ¯ï¼Œç„¶åï¼ŒèŠ±å¾ˆå°‘çš„å­—èŠ‚ç”¨å‚æ•°æè¿°å¦ä¸€ä¸ªå£°é“å’Œå®ƒä¸åŒçš„åœ°æ–¹
è¿™æ ·ï¼ŒHEv1å’ŒHEv2ç”¨ä¸ªå›¾ç®€å•è¡¨ç¤ºä¸‹å°±æ˜¯ï¼š(å›¾ä¸­çš„AACå³æŒ‡çš„æ˜¯åŸæ¥çš„AAC-LC)
<img src="http://images.wodekouwei.com/media/aac-he.jpg" alt="image">
ç”±äºNERO AACç¼–ç åäº§ç”Ÿçš„æ˜¯ç»è¿‡MP4å®¹å™¨å°è£…åçš„ï¼Œè€Œæˆ‘ä»¬çš„decoderéœ€è¦å¤„ç†çš„æ˜¯æœªç»å°è£…çš„AACæµï¼Œå› æ­¤è¿˜éœ€è¦å¤„ç†ä»MP4å°è£…æ ¼å¼ä¸­extractå‡ºAACæµçš„æ­¥éª¤ï¼›å“¦ï¼Œè¿™é‡Œæåˆ°äº†MP4å®¹å™¨å°è£…ï¼Œå°±å†æŠŠæˆ‘çœ‹åˆ°çš„ä¸€äº›å…³äºMP4å®¹å™¨çš„å¿ƒå¾—æ’å…¥åœ¨æ­¤ä¹Ÿè¯´ä¸‹ï¼š</p>
</li>
</ul>
<p>å…¶å®.mp4æ ¼å¼è§„èŒƒæ˜¯MPEG4 Part 1æ ‡å‡†å®šä¹‰çš„ã€‚ä½†æ˜¯è¿™ä¸ªæ ¼å¼æœ¬èº«ç›¸å½“é€šç”¨ï¼Œå¹¶ä¸æ˜¯åªèƒ½ç”¨æ¥å­˜è´®MPEG4è§†é¢‘æ ¼å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ª.mp4æ–‡ä»¶ä¸­åŒ…å«çš„å¯èƒ½æ˜¯H.263çš„è§†é¢‘è½¨åŠAMRçš„éŸ³é¢‘è½¨ã€‚è¿™æ ·å®ƒå’ŒMPEG4è§†é¢‘å‹ç¼©ç®—æ³•å°±åŠç‚¹è¾¹éƒ½æ²¾ä¸ä¸Šã€‚ä½†å®ƒç»å¯¹æ˜¯ä¸€ä¸ªåˆæ³•çš„.mp4æ–‡ä»¶ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œ.mp4æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å°åŒ…æ ¼å¼ã€‚ä¹Ÿè®¸å®ƒçš„åŸå§‹è®¾è®¡æ„å›¾æ˜¯ä»…ç”¨äºMPEG4ï¼Œä½†äº‹å®ä¸Šå¤§å®¶è§‰å¾—å®ƒå¾ˆå¥½ç”¨ï¼Œå·²ç»æŠŠå®ƒæ‰©å±•æˆå¯ä»¥åŒ…å®¹å…¶å®ƒæ ¼å¼äº†ã€‚ç°åœ¨å¸‚åœºä¸Šæ¯”å¦‚æŸäº§å“å·ç§°â€œæ”¯æŒMP4æ’­æ”¾â€ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¦‚æœå®ƒæ˜¯æŒ‡å¯ä»¥æ’­æ”¾<em>.mp4è¿™ç§æ–‡ä»¶ï¼Œé‚£é‡Œé¢çš„éŸ³é¢‘å’Œè§†é¢‘æ ¼å¼å®ƒèƒ½æ”¯æŒå¤šå°‘ç§ç»„åˆå‘¢ï¼Ÿæ²¡è¯´æ¸…æ¥šå§ã€‚ä¸¾ä¸ªæç«¯çš„ä¾‹å­ï¼Œå‡è®¾ä¸€å°è®¾å¤‡ä»…æ”¯æŒâ€œè§†é¢‘ä¸ºæœªå‹ç¼©YUVä»¥åŠä¸å¸¦éŸ³é¢‘è½¨çš„.mp4æ–‡ä»¶ï¼Œä½†å®ƒçš„æ–‡ä»¶åç¡®å®å¯ä»¥æ˜¯</em>.mp4ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åœ¨ç›’å­ä¸Šå°ä¸Šâ€œæ”¯æŒMP4â€å‘¢ï¼Ÿé‚£ä¹ˆï¼Œä¹°å›å»ï¼Œå¤åˆ¶ä¸€ä¸ªç½‘ä¸Šä¸‹è½½çš„.mp4æ–‡ä»¶ï¼ˆMPEG4è§†é¢‘å’ŒAACéŸ³é¢‘åº”è¯¥æ˜¯ä¸ªæ¯”è¾ƒæµè¡Œçš„ç»„åˆï¼‰ï¼Œç»“æœå´å‘ç°æ ¹æœ¬ä¸èƒ½æ’­æ”¾ã€‚å°±ç®—ä¸ä¸¾è¿™ä¹ˆæç«¯çš„ä¾‹å­ï¼Œä¸€èˆ¬.mp4æ–‡ä»¶ä¸­å¸¸è§çš„è§†é¢‘éŸ³é¢‘æ ¼å¼ä¹Ÿæœ‰å¤šç§ï¼Œä¸€ä¸ªäº§å“è¦åšåˆ°æ”¯æŒæ‰€æœ‰çš„æ ¼å¼æ˜¯å¾ˆéš¾çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¦å‡†ç¡®çš„æè¿°ï¼Œåº”è¯¥å†™æ¸…æ¥šç±»ä¼¼â€œæ”¯æŒè§†é¢‘æ ¼å¼ä¸ºMPEG4æˆ–H.264/AVCï¼ŒéŸ³é¢‘ä¸ºAMRæˆ–AACçš„*.mp4æ–‡ä»¶â€ã€‚å…¶å®æ›´ä¸¥æ ¼ä¸€äº›ï¼Œè¿˜åº”è¯¥å†™æ¸…æ¥šMPEG4æ”¯æŒåˆ°å“ªç§profile, AMRæ˜¯NBè¿˜æ˜¯WBï¼ŒAACæ˜¯LCè¿˜æ˜¯HEç­‰æ›´å¤šç»†èŠ‚ã€‚å½“ç„¶ï¼Œè¿™ç§è¯¯å¯¼å‹çš„è¯´æ˜åº”è¯¥åœ¨å‡å°‘ï¼Œä¸è¿‡å¦‚æœæœ‰æ¯”è¾ƒç¡®åˆ‡çš„æ ¼å¼éœ€æ±‚ï¼Œæœ€å¥½è¿˜æ˜¯å…ˆææ¸…æ¥šè¿™äº›ç»†èŠ‚ã€‚çœ‹åˆ°ç½‘ä¸Šè¿˜æœ‰äººè¯´åˆ°N73ï¼Œå…¶å®åªæ”¯æŒè§†é¢‘ä¸ºMPEG4 Simple Profile / Advanced Simple ProfileåŠH.263 Profile 0 &amp; 3ï¼ŒéŸ³é¢‘ä¸ºAMR-NB/WBæˆ–è€…AAC-LC, HE-AACçš„mp4æ–‡ä»¶ã€‚å¦‚æœä½ æ”¾ä¸€ä¸ªè§†é¢‘æ ¼å¼ä¸ºH.264/AVCçš„mp4ä¸Šå»ï¼Œæ˜¯æ— æ³•æ’­æ”¾å‡ºç”»é¢æ¥çš„ã€‚</p>
<p>åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€äº›å·¥å…·ï¼Œå¦‚MP4UI,MP4BOX,Yamb(mp4boxçš„GUIç¨‹åº),é‡‡ç”¨å®ƒä»¬è¿›è¡Œextractæ“ä½œåå‘ç°ï¼ŒåŸæ¥çš„SBRå’ŒPSç­‰ä¿¡æ¯å’‹æ²¡æœ‰äº†ï¼Œéƒ½å˜æˆLCè§„æ ¼çš„AACæ–‡ä»¶å•¦ã€‚å¥½å®¹æ˜“å‡†å¤‡çš„æµ‹è¯•æµï¼Œéš¾é“è¿˜æ˜¯ä¸èƒ½ç”¨ï¼Ÿäºæ˜¯ä¸€ç•ªè‹¦å¯»å‘ç°ï¼Œå¯èƒ½æ˜¯SBRå’ŒPSç­‰ä¿¡æ¯åœ¨ADTSå¤´ä¸­æ˜¯æ— æ³•ä½“ç°çš„ï¼Œæ‰€ä»¥åˆ†æADTSæ ¼å¼å¤´çš„AACï¼Œå°±æ— æ³•åˆ¤åˆ«æ˜¯å¦æ˜¯HEå’ŒHEv2å•¦ã€‚ä½†æ˜¯æˆ‘æ€»è§‰å¾—SBRå’ŒPSç­‰æŠ€æœ¯ä¿¡æ¯åœ¨AACæµä¸­åº”è¯¥è¿˜æ˜¯å­˜åœ¨çš„ã€‚å› ä¸ºæˆ‘è¿˜åœ¨ä¸€ä¸ªå›½å¤–çš„è®ºå›ä¸Šçœ‹åˆ°è¿™ä¹ˆå‡ å¥è¯ï¼šThereâ€™s no requirement for MP4 with AAC to have SBR indicated in the headers. Itâ€™s still correct not to have it marked and have SBR or PS data in the stream anyway. Likewise, decoding a frame and not seeing any SBR or PS info doesnâ€™t mean you canâ€™t find it further up in the stream anywayï¼ˆæˆ‘ç†è§£å°±æ˜¯è¯´SBR OR PSä¿¡æ¯ä¸ä¸€å®šåœ¨Headerä¸­æœ‰ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€ä½ ä¸èƒ½è¿›ä¸€æ­¥åœ¨streamä¸­å‘ç°å®ƒï¼‰ã€‚</p>
<p><strong>HE-AACçš„.mp4ç æµï¼Œç»è¿‡extractå‡ºAAC(ADTS)åï¼Œ44.1KHZçš„å˜æˆäº†22.05KHZã€‚HEv2-AACçš„.mp4ç æµï¼Œç»è¿‡extractå‡ºAAC(ADTS)åï¼Œä¸ä½†44.1KHZçš„å˜æˆäº†22.05KHZ(ä¸€åŠ)ï¼Œè¿2channelsä¹Ÿå˜æˆäº†1channels</strong>ï¼Œè¿™ä¸ªé—®é¢˜æ›´å¥‡æ€ªäº†ï¼Œåœ¨è®ºå›ä¸Šæ‰¾ï¼Œå‘ç°ä¹Ÿæœ‰äººæœ‰æ­¤é—®é¢˜ï¼šâ€œI get 22050Hz, 1 channel for audio that is in fact 44100Hz, 2channels and having both SBR and PSâ€ã€‚</p>
<p>åæ¥çœ‹åˆ°MSDNä¸­çš„AAC Decoderçš„æè¿°ä¸­æœ‰è¿™ä¹ˆä¸€å°æ®µè¯ï¼š
The media type gives the sample rate and number of channels prior to the application of spectral band replication (SBR) and parametric stereo (PS) tools, if present. The effect of the SBR tool is to double the decoded sample rate relative to the core AAC-LC sample rate. The effect of the PS tool is to decode stereo from a mono-channel core AAC-LC stream.
æˆ‘çš„ç†è§£æ˜¯AACçš„decoderå¦‚æœæ”¯æŒSBRå’ŒPSï¼Œä¼šå°†AAC-HEV1(SBR)ä¸­çš„sample rateæé«˜ä¸€å€ï¼Œè€Œä¼šå°†AAC-HEV2(SBR+PS)ä¸­ä¸ä»…sample rateæé«˜ä¸€å€ï¼Œå•å£°é“ä¹Ÿæé«˜è‡³åŒå£°é“äº†ã€‚ç»“åˆå‰é¢æåˆ°çš„SBR(é¢‘æ®µå¤åˆ¶)å’ŒPS(å‚æ•°ç«‹ä½“å£°ï¼‰æŠ€æœ¯çš„ç®€å•ä»‹ç»ï¼Œå¥½åƒè§‰å¾—è¿™æ ·æ˜¯æœ‰ç‚¹å„¿é“ç†çš„å“¦~~
ç”¨IPP exampleæä¾›çš„è§£ç å·¥å…·simple_playerç®€å•è¯•äº†ä¸‹ï¼Œå¯¹äº44.1khzï¼Œstereoçš„HEv2-AACçš„.mp4ç æµï¼Œç»è¿‡extractå‡º22.05KHZï¼Œmono çš„AAC(ADTS)åï¼Œå†ä½¿ç”¨simple_playerè¿›è¡ŒéŸ³é¢‘è§£ç æµ‹è¯•ï¼Œè§£å®Œåï¼Œæœç„¶å‘ç°åˆæ¢å¤äº†44.1khzå’Œstereoã€‚ï¼ˆä½†ç›®å‰ä¹Ÿæµ‹è¯•äº†å¥½å‡ ç§extractå‡ºçš„HEå’ŒHEv2çš„aacç æµï¼Œæœ‰çš„èƒ½å°†sample rateå’Œchannel åˆdoubleå›æ¥ï¼Œæœ‰çš„åˆä¸èƒ½ï¼Œè¿™ä¸ªå…·ä½“åŸå› æ˜¯ä¸æ˜¯ç”±äºIpp exampleæä¾›çš„è§£ç å™¨çš„é—®é¢˜è¿˜ä¸ç¡®å®šï¼‰ã€‚</p>
<p>å¦å¤–ï¼Œç”¨simple_playerå¦‚æœç›´æ¥decoderç¼–ç å‡ºçš„ç»è¿‡å°è£…çš„.mp4æ ¼å¼çš„AACéŸ³é¢‘çš„è¯ï¼Œå‘ç°ï¼šå…¶å®ƒéƒ½æ­£å¸¸ï¼ŒåªAAC-HEv2æ ¼å¼çš„.mp4éŸ³é¢‘è§£ç åå˜æˆäº†å•å£°é“ã€‚éš¾é“æ˜¯è§£ç å™¨ä¸­çš„PS toolsæ²¡èƒ½å‘æŒ¥ä½œç”¨ï¼Ÿåˆæ­¥ä¼°è®¡åº”è¯¥æ˜¯IPP çš„é‚£ä¸ªå°è§£ç å™¨çš„é—®é¢˜å§ã€‚</p>
<h5 id="å…³äºADTS-amp-ADIF"><a href="#å…³äºADTS-amp-ADIF" class="headerlink" title="å…³äºADTS&amp;ADIF"></a>å…³äºADTS&amp;ADIF</h5><p>ä¸Šé¢è¯´åˆ°äº†ADTSå¤´æ ¼å¼çš„AACã€‚å…¶å®ï¼ŒAACçš„éŸ³é¢‘æ–‡ä»¶æ ¼å¼æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š</p>
<ul>
<li><strong>ADIF</strong>ï¼šAudio Data Interchange Format éŸ³é¢‘æ•°æ®äº¤æ¢æ ¼å¼ã€‚è¿™ç§æ ¼å¼çš„ç‰¹å¾æ˜¯å¯ä»¥ç¡®å®šçš„æ‰¾åˆ°è¿™ä¸ªéŸ³é¢‘æ•°æ®çš„å¼€å§‹ï¼Œä¸éœ€è¿›è¡Œåœ¨éŸ³é¢‘æ•°æ®æµä¸­é—´å¼€å§‹çš„è§£ç ï¼Œå³å®ƒçš„è§£ç å¿…é¡»åœ¨æ˜ç¡®å®šä¹‰çš„å¼€å§‹å¤„è¿›è¡Œã€‚æ•…è¿™ç§æ ¼å¼å¸¸ç”¨åœ¨ç£ç›˜æ–‡ä»¶ä¸­ã€‚</li>
<li><strong>ADTS</strong>ï¼šAudio Data Transport Stream éŸ³é¢‘æ•°æ®ä¼ è¾“æµã€‚è¿™ç§æ ¼å¼çš„ç‰¹å¾æ˜¯å®ƒæ˜¯ä¸€ä¸ªæœ‰åŒæ­¥å­—çš„æ¯”ç‰¹æµï¼Œè§£ç å¯ä»¥åœ¨è¿™ä¸ªæµä¸­ä»»ä½•ä½ç½®å¼€å§‹ã€‚å®ƒçš„ç‰¹å¾ç±»ä¼¼äºmp3æ•°æ®æµæ ¼å¼ã€‚
ç®€å•è¯´ï¼ŒADTSå¯ä»¥åœ¨ä»»æ„å¸§è§£ç ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ¯ä¸€å¸§éƒ½æœ‰å¤´ä¿¡æ¯ã€‚ADIFåªæœ‰ä¸€ä¸ªç»Ÿä¸€çš„å¤´ï¼Œæ‰€ä»¥å¿…é¡»å¾—åˆ°æ‰€æœ‰çš„æ•°æ®åè§£ç ã€‚ä¸”è¿™ä¸¤ç§çš„headerçš„æ ¼å¼ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå…·ä½“çš„ç»„ç»‡ç»“æ„åœ¨è¿™é‡Œå°±ä¸è¯¦è¯´äº†ã€‚</li>
</ul>
<blockquote>
<p>å‚è€ƒ:
<a href="http://blog.csdn.net/axdc_qa_team/article/details/4271043" target="_blank" rel="external">AACçš„å„ç§è§„æ ¼</a></p>
</blockquote>
<h4 id="é—®é¢˜åŸå› åˆ†æ"><a href="#é—®é¢˜åŸå› åˆ†æ" class="headerlink" title="é—®é¢˜åŸå› åˆ†æ"></a>é—®é¢˜åŸå› åˆ†æ</h4><p>é¦–å…ˆ<code>BufferOverFlowException</code>é—®é¢˜,ç”±äºéŸ³é¢‘é‡‡ç”¨AAC-HEå¯¼è‡´MediaExtractorè§£æå‡ºçš„éŸ³é¢‘é‡‡æ ·ç‡ä¸ºæœ¬èº«é‡‡æ ·ç‡çš„ä¸€åŠ,åŒæ—¶åˆ›å»ºå‡ºçš„è§£ç OutputBufferçš„å¤§å°æ˜¯ç¼–ç InputBufferçš„2å€,è€Œmedia-for-mobileå¼€æºé¡¹ç›®ç›´æ¥å°†ä»è§£ç å™¨OutputBufferå–å‡ºçš„æ•°æ®å¡å…¥ç¼–ç å™¨InputBufferä¸­,2å€çš„æ•°æ®æ”¾å…¥ä¸€å€çš„Bufferå¯¼è‡´æº¢å‡º,æš‚æ—¶çš„è§£å†³åŠæ³•æ‰‹åŠ¨æŒ‡å®šç¼–ç å™¨InputBuffer max-sizeä¸ºä¸€ä¸ªè¾ƒå¤§å€¼(10*1024).åŒæ—¶,ç”±äºMediaExtractorä¸èƒ½è·å–æ­£ç¡®çš„audio profile,ä¹Ÿæ— æ³•ç¡®è®¤è·å–åˆ°çš„é‡‡æ ·ç‡æ˜¯å¦ä¸æ­£ç¡®é‡‡æ ·ç‡çš„ä¸€åŠ,æ‰€ä»¥é‡‡ç”¨ffmpegæ¥å£è·å–profile,ä½†æ˜¯ffmpegè°ƒç”¨<code>avcodec_open2</code>è·å–åˆ°çš„profileä¸º-99,è€Œä¸”é‡‡æ ·ç‡ä¾ç„¶ä¸ºæ­£å¸¸é‡‡æ ·ç‡ä¸€åŠ,åªæœ‰åœ¨è§£ç ä¸€å¸§éŸ³é¢‘åæ‰èƒ½å¾—åˆ°æ­£ç¡®çš„profileä¸é‡‡æ ·ç‡.</p>
<p>å…¶æ¬¡,è½¬ç è¿›åº¦ä¸å¢åŠ çš„é—®é¢˜,ä¸»è¦æ˜¯Highçš„H264è§†é¢‘,media-for-mobileä½¿ç”¨ä¸€ä¸ªMediaExtractorä¸€æ¬¡æŠ½å–éŸ³è§†é¢‘å¸§,å¦‚æœæ˜¯éŸ³é¢‘åˆ™äº¤éŸ³é¢‘è§£ç å™¨,å¦‚æœä¸ºè§†é¢‘åˆ™äº¤è§†é¢‘è§£ç å™¨,è§£ç åå°†è§£ç å¸§è½¬äº¤ç¼–ç å™¨,ç¼–ç åå°†æ•°æ®å†™å…¥MediaMuxer,å°†æ•°æ®å†™å…¥MediaMuxerçš„å‰ææ˜¯åŠç”¨è¿‡addTrack,å°†éŸ³è§†é¢‘trackåŠ å…¥åˆ°Muxerä¸­,è€ŒaddTrackéœ€è¦åœ¨éŸ³è§†é¢‘è§£ç è‹¥å¹²å¸§åäº§ç”Ÿ<code>INFO_OUTPUT_FORMAT_CHANGED</code>,è‹¥æ²¡æœ‰addTrackä¼šå¯¼è‡´ç¼–ç åæ•°æ®å¦‚æ³•å†™å…¥Muxer,å¡æ­»ç¼–ç å™¨,Baselineè§†é¢‘åªéœ€è¦å°‘é‡å¸§å°±å¯ä»¥äº§ç”Ÿ<code>INFO_OUTPUT_FORMAT_CHANGED</code>,ä½†Highè§†é¢‘äº§ç”Ÿ<code>INFO_OUTPUT_FORMAT_CHANGED</code>éœ€è¦æ›´å¤šçš„å¸§,è€Œmedia-for-mobileä¸­,MediaExtractoré¦–å…ˆä¸€ç›´è·å–åˆ°çš„æ˜¯éŸ³é¢‘æ•°æ®,éŸ³é¢‘ä¸€ç›´è§£ç ç¼–ç ,ä½†æ˜¯è¾“å‡ºçš„muxeræ—¶,videotrackæœªè¢«æ·»åŠ ,æ‰€ä»¥æ— æ³•å°†éŸ³é¢‘ç¼–ç å™¨çš„æ•°æ®å†™å…¥muxer,éŸ³é¢‘è§£ç å™¨è¢«å¡æ­»,è€Œmediasourceä¸€ç›´è¢«äº§ç”Ÿçš„audioæ•°æ®æ— æ³•è¢«æ¶ˆè´¹,æ— æ³•è·å–åˆ°è§†é¢‘æ•°æ®å¯¼è‡´è§†é¢‘<code>INFO_OUTPUT_FORMAT_CHANGED</code>ä¸€ç›´æ— æ³•äº§ç”Ÿ,æœ€ç»ˆäº§ç”Ÿæ­»é”,å¯¼è‡´audioç­‰å¾…videoçš„<code>INFO_OUTPUT_FORMAT_CHANGED</code>,videoç­‰å¾…audioè¢«è¯»å®Œåè¯»åˆ°videoè§£ç äº§ç”Ÿ<code>INFO_OUTPUT_FORMAT_CHANGED</code>.</p>
<p>æœ€åå°†audioå’Œvideoä½¿ç”¨ä¸¤ä¸ª<code>MediaExtractor</code>å„è¯»å–å„è‡ªå†…å®¹.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å‰ä¸¤å¤©å‘ç°å…¬å¸äº§å“ &lt;strong&gt;è§¦å‘&lt;/strong&gt; æœ‰å¯¼å…¥ä»å¾®ä¿¡ç­‰ä¸‹è½½çš„å¤–éƒ¨å°è§†é¢‘æ—¶å¤±è´¥çš„æƒ…å†µ, &lt;strong&gt;è§¦å‘&lt;/strong&gt; å¯¼å…¥è§†é¢‘æ—¶ä½¿ç”¨å¼€æºåº“&lt;a href=&quot;https://github.com/INDExOS/media-for-mobile&quot; 
    
    </summary>
    
      <category term="media" scheme="http://wodekouwei.com/categories/media/"/>
    
    
      <category term="å¤šåª’ä½“" scheme="http://wodekouwei.com/tags/%E5%A4%9A%E5%AA%92%E4%BD%93/"/>
    
      <category term="éŸ³è§†é¢‘" scheme="http://wodekouwei.com/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
      <category term="tips" scheme="http://wodekouwei.com/tags/tips/"/>
    
  </entry>
  
  <entry>
    <title>androidè‡ªåŠ¨åŒ–æµ‹è¯•(ä¸€):UiAutomatorå®˜æ–¹ä»‹ç»</title>
    <link href="http://wodekouwei.com/2017/08/30/at-android-start/"/>
    <id>http://wodekouwei.com/2017/08/30/at-android-start/</id>
    <published>2017-08-30T13:43:15.000Z</published>
    <updated>2017-09-29T04:27:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>äº†è§£androidæµ‹è¯•éœ€è¦æŸ¥è¯¢androidå®˜æ–¹æ–‡æ¡£,androidå®˜æ–¹åŸ¹è®­æ•™ç¨‹<a href="https://developer.android.com/training/testing/start/index.html" target="_blank" rel="external">Getting Started with Testing</a>ä»‹ç»äº†androidæä¾›çš„æµ‹è¯•ç±»å‹,æµ‹è¯•æ¥å£ç­‰,ç›¸è¾ƒä¸ç½‘ä¸Šæ€»ç»“çš„androidè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶,å®˜æ–¹æ–‡æ¡£æ˜¾ç„¶åˆ†ç±»æ›´åˆç†,å®šä½æ›´å‡†ç¡®.</p>
<h3 id="ä¸¤ç§æµ‹è¯•ç±»å‹"><a href="#ä¸¤ç§æµ‹è¯•ç±»å‹" class="headerlink" title="ä¸¤ç§æµ‹è¯•ç±»å‹"></a>ä¸¤ç§æµ‹è¯•ç±»å‹</h3><p>åœ¨ä½¿ç”¨Android Studioåˆ›å»ºæ¨¡å—æ—¶ä¼šåœ¨<code>src</code>ä¸‹ç”Ÿæˆ<code>androidTest</code>å’Œ<code>test</code>ä¸¤ä¸ªç”¨äºæµ‹è¯•çš„çš„ç›®å½•,å¯¹åº”ä¸‹é¢ä¸¤ç§æµ‹è¯•ç±»å‹.
<img src="http://images.wodekouwei.com/technology/at_sum.png" alt="image"></p>
<h4 id="æœ¬åœ°å•å…ƒæµ‹è¯•-Local-unit-tests"><a href="#æœ¬åœ°å•å…ƒæµ‹è¯•-Local-unit-tests" class="headerlink" title="æœ¬åœ°å•å…ƒæµ‹è¯•(Local unit tests)"></a>æœ¬åœ°å•å…ƒæµ‹è¯•(Local unit tests)</h4><p>ä½äº<code>module-name/src/test/java/.</code>ä¸‹,è¿è¡Œåœ¨PCç«¯æœ¬åœ°çš„JVMè™šæ‹Ÿæœºä¸Š,å¹¶ä¸”ä¸èƒ½è®¿é—®Androidæ¡†æ¶çš„æ¥å£.
å‚è€ƒ<a href="https://developer.android.com/training/testing/unit-testing/local-unit-tests.html" target="_blank" rel="external">Building Local Tests</a></p>
<h4 id="è®¾å¤‡åŒ–æµ‹è¯•"><a href="#è®¾å¤‡åŒ–æµ‹è¯•" class="headerlink" title="è®¾å¤‡åŒ–æµ‹è¯•"></a>è®¾å¤‡åŒ–æµ‹è¯•</h4><p>ä½äº<code>module-name/src/androidTest/java/.</code>ä¸‹,å¿…é¡»è¿è¡Œåœ¨Androidç‰©ç†è®¾å¤‡å’Œè™šæ‹Ÿæœºä¸Š.
å‚è€ƒ<a href="https://developer.android.com/training/testing/unit-testing/instrumented-unit-tests.html" target="_blank" rel="external">Building Instrumented Unit Tests</a></p>
<p>Instrumented unit tests are tests that run on physical devices and emulators, and they can take advantage of the Android framework APIs and supporting APIs, such as the Android Testing Support Library. You should create instrumented unit tests if your tests need access to instrumentation information (such as the target appâ€™s Context) or if they require the real implementation of an Android framework component (such as a Parcelable or SharedPreferences object).</p>
<p>Using instrumented unit tests also helps to reduce the effort required to write and maintain mock code. You are still free to use a mocking framework, if you choose, to simulate any dependency relationships.</p>
<p>è®¾å¤‡åŒ–å•å…ƒæµ‹è¯•åˆ†ä¸º:</p>
<ul>
<li>è®¾å¤‡åŒ–å•å…ƒæµ‹è¯•(Instrumented Unit Test):<a href="https://developer.android.com/training/testing/unit-testing/instrumented-unit-tests.html" target="_blank" rel="external">Building Instrumented Unit Tests</a>: Build complex unit tests with Android dependencies that cannot be satisfied with mock objects.</li>
<li>ç»„ä»¶é›†æˆæµ‹è¯•:<a href="https://developer.android.com/training/testing/ui-testing/index.html" target="_blank" rel="external">Automating User Interface Tests</a>: Create tests to verify that the user interface behaves correctly for user interactions within a single app or for interactions across multiple apps.</li>
<li>appé›†æˆæµ‹è¯•:<a href="https://developer.android.com/training/testing/integration-testing/index.html" target="_blank" rel="external">Testing App Component Integrations</a>: Verify the behavior of components that users do not directly interact with, such as a Service or aContent Provider.</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;äº†è§£androidæµ‹è¯•éœ€è¦æŸ¥è¯¢androidå®˜æ–¹æ–‡æ¡£,androidå®˜æ–¹åŸ¹è®­æ•™ç¨‹&lt;a href=&quot;https://developer.android.com/training/testing/start/index.html&quot; target=&quot;_blank&quot; rel=&quot;ex
    
    </summary>
    
      <category term="autotest" scheme="http://wodekouwei.com/categories/autotest/"/>
    
    
      <category term="autotest" scheme="http://wodekouwei.com/tags/autotest/"/>
    
      <category term="android" scheme="http://wodekouwei.com/tags/android/"/>
    
      <category term="tools" scheme="http://wodekouwei.com/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>androidè‡ªåŠ¨åŒ–æµ‹è¯•(N):UiAutomatorå®˜æ–¹ä»‹ç»</title>
    <link href="http://wodekouwei.com/2017/08/30/at-android-uiautomator-official/"/>
    <id>http://wodekouwei.com/2017/08/30/at-android-uiautomator-official/</id>
    <published>2017-08-30T07:58:35.000Z</published>
    <updated>2017-08-30T13:43:54.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Automating-User-Interface-Tests"><a href="#Automating-User-Interface-Tests" class="headerlink" title="Automating User Interface Tests"></a><a href="https://developer.android.com/training/testing/ui-testing/index.html" target="_blank" rel="external">Automating User Interface Tests</a></h3><p>User interface (UI) testing lets you ensure that your app meets its functional requirements and achieves a high standard of quality such that it is more likely to be successfully adopted by users.</p>
<p>One approach to UI testing is to simply have a human tester perform a set of user operations on the target app and verify that it is behaving correctly. However, this manual approach can be time-consuming, tedious, and error-prone. A more efficient approach is to write your UI tests such that user actions are performed in an automated way. The automated approach allows you to run your tests quickly and reliably in a repeatable manner.</p>
<blockquote>
<p>Note: It is strongly encouraged that you use Android Studio for building your test apps, because it provides project setup, library inclusion, and packaging conveniences. This class assumes you are using Android Studio.</p>
</blockquote>
<p>To automate UI tests with Android Studio, you implement your test code in a separate Android test folder (src/androidTest/java). The Android Plug-in for Gradle builds a test app based on your test code, then loads the test app on the same device as the target app. In your test code, you can use UI testing frameworks to simulate user interactions on the target app, in order to perform testing tasks that cover specific usage scenarios.</p>
<p>For testing Android apps, you typically create these types of automated UI tests:</p>
<ul>
<li>UI tests that span a single app: This type of test verifies that the target app behaves as expected when a user performs a specific action or enters a specific input in its activities. It allows you to check that the target app returns the correct UI output in response to user interactions in the appâ€™s activities. UI testing frameworks like Espresso allow you to programmatically simulate user actions and test complex intra-app user interactions.</li>
<li>UI tests that span multiple apps: This type of test verifies the correct behavior of interactions between different user apps or between user apps and system apps. For example, you might want to test that your camera app shares images correctly with a 3rd-party social media app, or with the default Android Photos app. UI testing frameworks that support cross-app interactions, such as UI Automator, allow you to create tests for such scenarios.
The lessons in this class teach you how to use the tools and APIs in the Android Testing Support Library to build these types of automated tests. Before you begin building tests using these APIs, you must install the Android Testing Support Library, as described in Downloading the Android Testing Support Library.</li>
</ul>
<h3 id="UI-Testing"><a href="#UI-Testing" class="headerlink" title="UI Testing"></a><a href="https://stuff.mit.edu/afs/sipb/project/android/docs/tools/testing/testing_ui.html" target="_blank" rel="external">UI Testing</a></h3><p>In addition to unit testing the individual components that make up your Android application (such as activities, services, and content providers), it is also important that you test the behavior of your applicationâ€™s user interface (UI) when it is running on a device. UI testing ensures that your application returns the correct UI output in response to a sequence of user actions on a device, such as entering keyboard input or pressing toolbars, menus, dialogs, images, and other UI controls.</p>
<p>Functional or black-box UI testing does not require testers to know the internal implementation details of the app, only its expected output when a user performs a specific action or enters a specific input. This approach allows for better separation of development and testing roles in your organization.</p>
<p>One common approach to UI testing is to run tests manually and verify that the app is behaving as expected. However, this approach can be time-consuming, tedious, and error-prone. A more efficient and reliable approach is to automate the UI testing with a software testing framework. Automated testing involves creating programs to perform testing tasks (test cases) to cover specific usage scenarios, and then using the testing framework to run the test cases automatically and in a repeatable manner.</p>
<h4 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h4><p>he Android SDK provides the following tools to support automated, functional UI testing on your application:</p>
<ul>
<li>uiautomatorviewer - A GUI tool to scan and analyze the UI components of an Android application.</li>
<li><p>uiautomator - A Java library containing APIs to create customized functional UI tests, and an execution engine to automate and run the tests.
To use these tools, you must have the following versions of the Android development tools installed:</p>
</li>
<li><p>Android SDK Tools, Revision 21 or higher</p>
</li>
<li>Android SDK Platform, API 16 or higher</li>
</ul>
<p><strong>Workflow for the the uiautomator testing framework</strong>
Hereâ€™s a short overview of the steps required to automate UI testing:</p>
<ol>
<li>Prepare to test by installing the app on a test device, analyzing the appâ€™s UI components, and ensuring that your application is accessible by the test automation framework.</li>
<li>Create automated tests to simulate specific user interactions on your application.</li>
<li>Compile your test cases into a JAR file and install it on your test device along with your app.</li>
<li>Run the tests and view the test results.</li>
<li>Correct any bugs or defects discovered in testing.</li>
</ol>
<h4 id="Analyzing-Your-Applicationâ€™s-UI"><a href="#Analyzing-Your-Applicationâ€™s-UI" class="headerlink" title="Analyzing Your Applicationâ€™s UI"></a>Analyzing Your Applicationâ€™s UI</h4><p>Before you start writing your test cases, itâ€™s helpful to familiarize yourself with the UI components (including the views and controls) of the targeted application. You can use the uiautomatorviewer tool to take a snapshot of the foreground UI screen on any Android device that is connected to your development machine. The uiautomatorviewer tool provides a convenient visual interface to inspect the layout hierarchy and view the properties of the individual UI components that are displayed on the test device. Using this information, you can later create uiautomator tests with selector objects that target specific UI components to test.</p>
<p>To analyze the UI components of the application that you want to test:</p>
<ol>
<li>Connect your Android device to your development machine.</li>
<li>Open a terminal window and navigate to <android-sdk>/tools/.</android-sdk></li>
<li><p>Run the tool with this command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ uiautomatorviewer</div></pre></td></tr></table></figure>
</li>
<li><p>To capture a screen for analysis, click the Device Screenshot button in the GUI of the uiautomatorviewer tool.</p>
<blockquote>
<p>Note: If you have more than one device connected, specify the device for screen capture by setting the ANDROID_SERIAL environment variable:</p>
</blockquote>
</li>
</ol>
<p>a. Find the serial numbers for your connected devices by running this command:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ adb devices</div><div class="line">```  </div><div class="line">b. Set the ANDROID_SERIAL environment variable to select the device to test:</div></pre></td></tr></table></figure></p>
<p>#In Windows:
set ANDROID_SERIAL=<device serial="" number=""></device></p>
<p>#In UNIX:
export ANDROID_SERIAL=<device serial="" number="">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">If you are connected to only a single device, you do not need to set the ANDROID_SERIAL environment variable.</div><div class="line"></div><div class="line">5. View the UI properties for your application:</div><div class="line">- Hover over the snapshot in the left-hand panel to see the UI components identified by the uiautomatorviewer tool. You can view the componentâ€™s properties listed in the lower right-hand panel, and the layout hierarchy in the upper right-hand panel.</div><div class="line">- Optionally, click on the Toggle NAF Nodes button to see UI components that are not accessible to the uiautomator testing framework. Only limited information may be available for these components.</div><div class="line"></div><div class="line">#### Preparing to Test</div><div class="line">Before using the uiautomator testing framework, complete these pre-flight tasks:</div><div class="line"></div><div class="line">##### Load the application to a device</div><div class="line"></div><div class="line">If you are reading this document, chances are that the Android application that you want to test has not been published yet. If you have a copy of the APK file, you can install the APK onto a test device by using the adb tool. To learn how to install an APK file using the adb tool, see the [adb](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/adb.html#move) documentation.</div><div class="line"></div><div class="line">##### Identify the applicationâ€™s UI components</div><div class="line"></div><div class="line">Before writing your `uiautomator` tests, first identify the UI components in the application that you want to test. Typically, good candidates for testing are UI components that are visible and that users can interact with. The UI components should also have visible text labels, `android:contentDescription` values, or both.</div><div class="line"></div><div class="line">You can inspect the visible screen objects in an application conveniently by using the `uiautomatorviewer` tool. For more information about how to analyze an application screen with this tool, see the section [Analyzing Your Applicationâ€™s UI](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/testing/testing_ui.html#uianalaysis). For more information about the common types of UI components provided by Android, see [User Interface](https://stuff.mit.edu/afs/sipb/project/android/docs/guide/topics/ui/index.html).</div><div class="line"></div><div class="line">##### Ensure that the application is accessible</div><div class="line"></div><div class="line">This step is required because the `uiautomator` tool depends on the accessibility features of the Android framework to execute your functional UI tests. You should include these minimum optimizations to support the `uiautomator` tool:</div><div class="line">- Use the `android:contentDescription` attribute to label the `ImageButton`, `ImageView`, `CheckBox` and other user interface controls.</div><div class="line">- Provide an `android:hint` attribute instead of a content description for `EditText` fields</div><div class="line">- Associate an `android:hint` attribute with any graphical icons used by controls that provide feedback to the user (for example, status or state information).</div><div class="line">- Make sure that all the user interface elements are accessible with a directional controller, such as a trackball or D-pad.</div><div class="line">- Use the `uiautomatorviewer` tool to ensure that the UI component is accessible to the testing framework. You can also test the application by turning on accessibility services like TalkBack and Explore by Touch, and try using your application using only directional controls.</div><div class="line"></div><div class="line">For more information about implementing and testing accessibility, see [Making Applications Accessible](https://stuff.mit.edu/afs/sipb/project/android/docs/guide/topics/ui/accessibility/apps.html).</div><div class="line"></div><div class="line">&gt; Note: To identify the non-accessible components in the UI, click on the Toggle NAF Nodes option in the `uiautomatorviewer` tool.</div><div class="line"></div><div class="line">Generally, Android application developers get accessibility support for free, courtesy of the `View` and `ViewGroup` classes. However, some applications use custom view components to provide a richer user experience. Such custom components won&apos;t get the accessibility support that is provided by the standard Android UI components. If this applies to your application, ensure that the application developer exposes the custom drawn UI components to Android accessibility services, by implementing the `AccessibilityNodeProvider` class. For more information about making custom view components accessible, see [Making Applications Accessible](https://stuff.mit.edu/afs/sipb/project/android/docs/guide/topics/ui/accessibility/apps.html#custom-views).</div><div class="line"></div><div class="line">##### Configure your development environment</div><div class="line">If you&apos;re developing in Eclipse, the Android SDK provides additional tools that help you write test cases using `uiautomator` and buiild your JAR file. In order to set up Eclipse to assist you, you need to create a project that includes the `uiautomator` client library, along with the Android SDK library. To configure Eclipse:</div><div class="line"></div><div class="line">1. Create a new Java project in Eclipse, and give your project a name that is relevant to the tests youâ€™re about to create (for example, &quot;MyAppNameTests&quot;). In the project, you will create the test cases that are specific to the application that you want to test.</div><div class="line">2. From the Project Explorer, right-click on the new project that you created, then select Properties &gt; Java Build Path, and do the following:</div><div class="line">    - Click Add Library &gt; JUnit then select JUnit3 to add JUnit support.</div><div class="line">    - Click Add External JARs... and navigate to the SDK directory. Under the platforms directory, select the latest SDK version and add both the uiautomator.jar and android.jar files.</div><div class="line">If you did not configure Eclipse as your development environment, make sure that the `uiautomator.jar` and `android.jar` files from the `&lt;android-sdk&gt;/platforms/&lt;sdk&gt;` directory are in your Java class path.</div><div class="line"></div><div class="line">Once you have completed these prerequisite tasks, you&apos;re almost ready to start creating your `uiautomator` tests.</div><div class="line"></div><div class="line">#### Creating uiautomator Tests</div><div class="line">To build a test that runs in the `uiautomator` framework, create a test case that extends the `UiAutomatorTestCase` class. In Eclipse, the test case file goes under the `src` directory in your project. Later, you will build the test case as a JAR file, then copy this file to the test device. The test JAR file is not an APK file and resides separately from the application that you want to test on the device.</div><div class="line"></div><div class="line">Because the `UiAutomatorTestCase` class extends `junit.framework.TestCase`, you can use the `JUnit` Assert class to test that UI components in the app return the expected results. To learn more about JUnit, you can read the documentation on the `junit.org` home page.</div><div class="line"></div><div class="line">The first thing your test case should do is access the device that contains the target app. Itâ€™s also good practice to start the test from the Home screen of the device. From the Home screen (or some other starting location youâ€™ve chosen in the target app), you can use the classes provided by the `uiautomator` API to simulate user actions and to test specific UI components. For an example of how to put together a `uiautomator` test case, see the sample test case.</div><div class="line"></div><div class="line">##### uiautomator API</div><div class="line">The `uiautomator` API is bundled in the `uiautomator.jar` file under the `&lt;android-sdk&gt;/platforms/` directory. The API includes these key classes that allow you to capture and manipulate UI components on the target app:</div><div class="line">- [UiDevice](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiDevice.html)</div><div class="line">Represents the device state. In your tests, you can call methods on the UiDevice instance to check for the state of various properties, such as current orientation or display size. Your tests also can use the UiDevice instance to perform device level actions, such as forcing the device into a specific rotation, pressing the d-pad hardware button, or pressing the Home and Menu buttons.</div><div class="line">To get an instance of UiDevice and simulate a Home button press:</div></pre></td></tr></table></figure></device></p>
<p>getUiDevice().pressHome();
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- [UiSelector](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiSelector.html)</div><div class="line">Represents a search criteria to query and get a handle on specific elements in the currently displayed UI. If more than one matching element is found, the first matching element in the layout hierarchy is returned as the target UiObject. When constructing a UiSelector, you can chain together multiple properties to refine your search. If no matching UI element is found, a `UiAutomatorObjectNotFoundException` is thrown. You can use the childSelector() method to nest multiple UiSelector instances. For example, the following code example shows how to specify a search to find the first ListView in the currently displayed UI, then search within that ListView to find a UI element with the text property Apps.</div></pre></td></tr></table></figure></p>
<p>UiObject appItem = new UiObject(new UiSelector()
   .className(â€œandroid.widget.ListViewâ€).instance(1)
   .childSelector(new UiSelector().text(â€œAppsâ€)));
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- [UiObject](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiObject.html)</div><div class="line">Represents a UI element. To create a UiObject instance, use a UiSelector that describes how to search for, or select, the UI element.</div><div class="line">The following code example shows how to construct UiObject instances that represent a Cancel button and a OK button in your application.</div></pre></td></tr></table></figure></p>
<p>UiObject cancelButton = new UiObject(new UiSelector().text(â€œCancelâ€));
UiObject okButton = new UiObject(new UiSelector().text(â€œOKâ€));
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">You can reuse the UiObject instances that you have created in other parts of your app testing, as needed. Note that the `uiautomator` test framework searches the current display for a match every time your test uses a UiObject instance to click on a UI element or query a property.</div><div class="line">In the following code example, the `uiautomator` test framework searches for a UI element with the text property OK. If a match is found and if the element is enabled, the framework simulates a user click action on the element.</div></pre></td></tr></table></figure></p>
<p>if(okButton.exists() &amp;&amp; okButton.isEnabled())
{
  okButton.click();
}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">You can also restrict the search to find only elements of a specific class. For example, to find matches of the Button class:</div></pre></td></tr></table></figure></p>
<p>UiObject cancelButton = new UiObject(new UiSelector().text(â€œCancelâ€)
   .className(â€œandroid.widget.Buttonâ€));
UiObject okButton = new UiObject(new UiSelector().text(â€œOKâ€)
   .className(â€œandroid.widget.Buttonâ€));
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- [UiCollection](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiCollection.html)</div><div class="line">Represents a collection of items, for example songs in a music album or a list of emails in an inbox. Similar to a UiObject, you construct a UiCollection instance by specifying a UiSelector. The UiSelector for a UiCollection should search for a UI element that is a container or wrapper of other child UI elements (such as a layout view that contains child UI elements). For example, the following code snippet shows how to construct a UiCollection to represent a video album that is displayed within a FrameLayout:</div></pre></td></tr></table></figure></p>
<p>UiCollection videos = new UiCollection(new UiSelector()
   .className(â€œandroid.widget.FrameLayoutâ€));
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">If the videos are listed within a LinearLayout view, and you want to to retrieve the number of videos in this collection:</div></pre></td></tr></table></figure></p>
<p>int count = videos.getChildCount(new UiSelector()
   .className(â€œandroid.widget.LinearLayoutâ€));
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">If you want to find a specific video that is labeled with the text element Cute Baby Laughing from the collection and simulate a user-click on the video:</div></pre></td></tr></table></figure></p>
<p>UiObject video = videos.getChildByText(new UiSelector()
   .className(â€œandroid.widget.LinearLayoutâ€), â€œCute Baby Laughingâ€);
video.click();
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Similarly, you can simulate other user actions on the UI object. For example, if you want to simulate selecting a checkbox that is associated with the video:</div></pre></td></tr></table></figure></p>
<p>UiObject checkBox = video.getChild(new UiSelector()
   .className(â€œandroid.widget.Checkboxâ€));
if(!checkBox.isSelected()) checkbox.click();
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- [UiScrollable](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiScrollable.html)</div><div class="line">Represents a scrollable collection of UI elements. You can use the UiScrollable class to simulate vertical or horizontal scrolling across a display. This technique is helpful when a UI element is positioned off-screen and you need to scroll to bring it into view.</div><div class="line">For example, the following code shows how to simulate scrolling down the Settings menu and clicking on an About tablet option:</div></pre></td></tr></table></figure></p>
<p>UiScrollable settingsItem = new UiScrollable(new UiSelector()
   .className(â€œandroid.widget.ListViewâ€));
UiObject about = settingsItem.getChildByText(new UiSelector()
   .className(â€œandroid.widget.LinearLayoutâ€), â€œAbout  tabletâ€);
about.click()
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">For more information about these APIs, see the uiautomator reference.</div><div class="line"></div><div class="line">##### A sample uiautomator test case</div><div class="line">The following code example shows a simple test case which simulates a user bringing up the Settings app in a stock Android device. The test case mimics all the steps that a user would typically take to perform this task, including opening the Home screen, launching the All Apps screen, scrolling to the Settings app icon, and clicking on the icon to enter the Settings app.</div></pre></td></tr></table></figure></p>
<p>package com.uia.example.my;</p>
<p>// Import the uiautomator libraries
import com.android.uiautomator.core.UiObject;
import com.android.uiautomator.core.UiObjectNotFoundException;
import com.android.uiautomator.core.UiScrollable;
import com.android.uiautomator.core.UiSelector;
import com.android.uiautomator.testrunner.UiAutomatorTestCase;</p>
<p>public class LaunchSettings extends UiAutomatorTestCase {   </p>
<p>   public void testDemo() throws UiObjectNotFoundException {   </p>
<pre><code>// Simulate a short press on the HOME button.
getUiDevice().pressHome();

// Weâ€™re now in the home screen. Next, we want to simulate
// a user bringing up the All Apps screen.
// If you use the uiautomatorviewer tool to capture a snapshot
// of the Home screen, notice that the All Apps buttonâ€™s
// content-description property has the value â€œAppsâ€.  We can
// use this property to create a UiSelector to find the button.
UiObject allAppsButton = new UiObject(new UiSelector()
   .description(&quot;Apps&quot;));

// Simulate a click to bring up the All Apps screen.
allAppsButton.clickAndWaitForNewWindow();

// In the All Apps screen, the Settings app is located in
// the Apps tab. To simulate the user bringing up the Apps tab,
// we create a UiSelector to find a tab with the text
// label â€œAppsâ€.
UiObject appsTab = new UiObject(new UiSelector()
   .text(&quot;Apps&quot;));

// Simulate a click to enter the Apps tab.
appsTab.click();

// Next, in the apps tabs, we can simulate a user swiping until
// they come to the Settings app icon.  Since the container view
// is scrollable, we can use a UiScrollable object.
UiScrollable appViews = new UiScrollable(new UiSelector()
   .scrollable(true));

// Set the swiping mode to horizontal (the default is vertical)
appViews.setAsHorizontalList();

// Create a UiSelector to find the Settings app and simulate      
// a user click to launch the app.
UiObject settingsApp = appViews.getChildByText(new UiSelector()
   .className(android.widget.TextView.class.getName()),
   &quot;Settings&quot;);
settingsApp.clickAndWaitForNewWindow();

// Validate that the package name is the expected one
UiObject settingsValidation = new UiObject(new UiSelector()
   .packageName(&quot;com.android.settings&quot;));
assertTrue(&quot;Unable to detect Settings&quot;,
   settingsValidation.exists());   
</code></pre><p>  }<br>}
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### Building and Deploying Your uiautomator Tests</div><div class="line">1. Once you have coded your test, follow these steps to build and deploy your test JAR to your target Android test device:</div><div class="line">Create the required build configuration files to build the output JAR. To generate the build configuration files, open a terminal and run the following command:</div></pre></td></tr></table></figure></p>
<p><android-sdk>/tools/android create uitest-project -n <name> -t 1 -p <path></path>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">The &lt;name&gt; is the name of the project that contains your uiautomator test source files, and the &lt;path&gt; is the path to the corresponding project directory.</div><div class="line">2. From the command line, set the ANDROID_HOME variable:</div><div class="line">- In Windows:`set ANDROID_HOME=&lt;path_to_your_sdk&gt;`</div><div class="line">- In UNIX:`export ANDROID_HOME=&lt;path_to_your_sdk&gt;`</div><div class="line">3. Go to the project directory where your build.xml file is located and build your test JAR.</div></pre></td></tr></table></figure></name></android-sdk></p>
<p>ant build
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">4. Deploy your generated test JAR file to the test device by using the adb push command:</div></pre></td></tr></table></figure></p>
<p>adb push <path_to_output_jar> /data/local/tmp/
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hereâ€™s an example:</div></pre></td></tr></table></figure></path_to_output_jar></p>
<p>adb push ~/dev/workspace/LaunchSettings/bin/LaunchSettings.jar /data/local/tmp/
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### Running uiautomator Tests</div><div class="line">Hereâ€™s an example of how to run a test that is implemented in the `LaunchSettings.jar` file. The tests are bundled in the `com.uia.example.my` package:</div></pre></td></tr></table></figure></p>
<p>adb shell uiautomator runtest LaunchSettings.jar -c com.uia.example.my.LaunchSettings
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">To learn more about the syntax, subcommands, and options for uiautomator, see the [uiautomator](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/index.html) reference.</div><div class="line"></div><div class="line">#### Best Practices</div><div class="line">Here are some best practices for functional UI testing with the uiautomator framework:</div><div class="line"></div><div class="line">- Ensure that you validate the same UI functions on your application across the various types of devices that your application might run on (for example, devices with different screen densities).</div><div class="line">- You should also test your UI against common scenarios such as in-coming phone calls, network interruptions, and user-initiated switching to other applications on the device.</div><div class="line"></div><div class="line">### [uiautomator tools](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/index.html)</div><div class="line">The uiautomator testing framework lets you test your user interface (UI) efficiently by creating automated functional UI testcases that can be run against your app on one or more devices.</div><div class="line"></div><div class="line">For more information on testing with the uiautomator framework, see [UI Testing](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/testing/testing_ui.html).</div><div class="line"></div><div class="line">#### Syntax</div><div class="line">To run your testcases on the target device, you can use the `adb shell` command to invoke the `uiautomator` tool. The syntax is:</div></pre></td></tr></table></figure></p>
<p>adb shell uiautomator runtest <jar> -c <test_class_or_method> [options]
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hereâ€™s an example:</div></pre></td></tr></table></figure></test_class_or_method></jar></p>
<p>adb shell uiautomator runtest LaunchSettings.jar -c com.uia.example.my.LaunchSettings
```</p>
<h4 id="Command-line-Options"><a href="#Command-line-Options" class="headerlink" title="Command-line Options"></a>Command-line Options</h4><p>The following table describes the subcommands and options for uiautomator.
Table 1. Command-line options for uiautomator</p>
<table>
<thead>
<tr>
<th>Subcommand</th>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>runtest</td>
<td><code>&lt;jar&gt;</code></td>
<td>Required. The <jar> argument is the name of one or more JAR files that you deployed to the target device which contain your uiautomator testcases. You can list more than one JAR file by using a space as a separator.</jar></td>
</tr>
<tr>
<td></td>
<td><code>-c &lt;test_class_or_method&gt;</code></td>
<td>Required. The <test_class_or_method> argument is a list of one or more specific test classes or test methods from the JARs that you want uiautomator to run.Each class or method must be fully qualified with the package name, in one of these formats: package_name.class_name package_name.class_name#method_name You can list multiple classes or methods by using a space as a separator.</test_class_or_method></td>
</tr>
<tr>
<td></td>
<td>â€“nohup</td>
<td>Runs the test to completion on the device even if its parent process is terminated (for example, if the device is disconnected).</td>
</tr>
<tr>
<td></td>
<td>-e</td>
<td><name> <value></value></name></td>
<td>Specify other name-value pairs to be passed to test classes. May be repeated.Note: The -e options cannot be combined; you must prefix each option with a separate -e flag.</td>
</tr>
<tr>
<td></td>
<td>-e debug [true</td>
<td>false]</td>
<td>Wait for debugger to connect before starting.</td>
</tr>
<tr>
<td></td>
<td>dump    [file]</td>
<td>Generate an XML file with a dump of the current UI hierarchy. If a filepath is not specified, by default, the generated dump file is stored on the device in this location <code>/storage/sdcard0/window_dump.xml</code>.</td>
</tr>
<tr>
<td>events</td>
<td></td>
<td>Prints out accessibility events to the console until the connection to the device is terminated</td>
</tr>
</tbody>
</table>
<h3 id="UiAutomation-api"><a href="#UiAutomation-api" class="headerlink" title="UiAutomation api"></a><a href="https://developer.android.com/reference/android/app/UiAutomation.html" target="_blank" rel="external">UiAutomation api</a></h3><p>Class for interacting with the deviceâ€™s UI by simulation user actions and introspection of the screen content. It relies on the platform accessibility APIs to introspect the screen and to perform some actions on the remote view tree. It also allows injecting of arbitrary raw input events simulating user interaction with keyboards and touch devices. One can think of a UiAutomation as a special type of AccessibilityService which does not provide hooks for the service life cycle and exposes other APIs that are useful for UI test automation.
è¿™æ˜¯ä¸€ä¸ªé€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œæ¥ä¸è®¾å¤‡ç”¨æˆ·ç•Œé¢äº¤äº’ä»¥åŠè·å–å±å¹•å†…å®¹çš„ç±»ã€‚å®ƒä¾èµ–äºå¹³å°çš„è¾…åŠ©åŠŸèƒ½APIsæ¥åœ¨è¿œç¨‹çš„æ§ä»¶æ ‘ä¸Šè·å–å±å¹•å†…å®¹ä»¥åŠæ‰§è¡Œä¸€äº›æ“ä½œã€‚åŒæ—¶å®ƒä¹Ÿå…è®¸é€šè¿‡æ³¨å…¥åŸç”Ÿäº‹ä»¶(è¯‘è€…æ³¨:æŒ‡çš„å°±æ˜¯InputEvent. KeyEventä¹Ÿæ˜¯ç»§æ‰¿äºInputEventçš„ï¼Œæ‰€ä»¥è¯´å®ƒæ˜¯åŸç”Ÿäº‹ä»¶)æ¥æ¨¡æ‹Ÿç”¨æˆ·çš„æŒ‰é”®å’Œè§¦å±æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºUiAutomationå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„AccessibilityService,å…¶æ—¢ä¸ä¼šä¸ºæ§åˆ¶æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸè€Œæä¾›é’©å­å‡½æ•°ï¼Œä¹Ÿä¸ä¼šæš´éœ²ä»»ä½•å…¶ä»–å¯ä»¥ç›´æ¥ç”¨äºç”¨æˆ·ç•Œé¢æµ‹è¯•è‡ªåŠ¨åŒ–çš„APIs.</p>
<p>The APIs exposed by this class are low-level to maximize flexibility when developing UI test automation tools and libraries. Generally, a UiAutomation client should be using a higher-level library or implement high-level functions. For example, performing a tap on the screen requires construction and injecting of a touch down and up events which have to be delivered to the system by a call to injectInputEvent(InputEvent, boolean).
è¿™ä¸ªç±»æš´éœ²å‡ºæ¥çš„APIsæ˜¯å¾ˆä½å±‚çš„ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†åœ¨å¼€å‘ç”¨æˆ·ç•Œé¢æµ‹è¯•è‡ªåŠ¨åŒ–æ¡†æ¶å’Œåº“æ—¶æä¾›æœ€å¤§çš„å¼¹æ€§ã€‚æ€»çš„æ¥è¯´ï¼Œä¸€ä¸ªUiAutomationå®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨ä¸€äº›ï¼ˆåŸºäºUiAutomationçš„)æ›´é«˜å±‚æ¬¡çš„åº“æˆ–è€…å®ç°æ›´é«˜å±‚æ¬¡çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ·åœ¨å±å¹•ä¸Šçš„ç‚¹å‡»äº‹ä»¶éœ€è¦æ„é€ å¹¶æ³¨å…¥ä¸€ä¸ªæŒ‰ä¸‹å’Œä¸€ä¸ªå¼¹èµ·äº‹ä»¶ï¼Œç„¶åå¿…é¡»è°ƒç”¨UiAutomationçš„ä¸€ä¸ªinjectInputEvent(InputEvent, boolean)çš„è°ƒç”¨æ¥å‘é€ç»™æ“ä½œç³»ç»Ÿã€‚</p>
<p>The APIs exposed by this class operate across applications enabling a client to write tests that cover use cases spanning over multiple applications. For example, going to the settings application to change a setting and then interacting with another application whose behavior depends on that setting.
è¿™ä¸ªç±»æš´éœ²å‡ºæ¥çš„APIså¯ä»¥è·¨åº”ç”¨ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥ç¼–å†™å¯ä»¥è·¨è¶Šå¤šä¸ªåº”ç”¨çš„æµ‹è¯•ç”¨ä¾‹è„šæœ¬äº†ã€‚æ¯”å¦‚ï¼Œæ‰“å¼€ç³»ç»Ÿçš„è®¾ç½®åº”ç”¨å»ä¿®æ”¹ä¸€äº›è®¾ç½®ç„¶åå†ä¸å¦å¤–ä¸€ä¸ªä¾èµ–äºè¯¥è®¾ç½®çš„åº”ç”¨è¿›è¡Œäº¤äº’ï¼ˆè¯‘è€…æ³¨ï¼šè¿™ä¸ªåœ¨instrumentationè¿™ä¸ªæ¡†æ¶å¯ä»¥åšä¸åˆ°çš„ï¼‰</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;Automating-User-Interface-Tests&quot;&gt;&lt;a href=&quot;#Automating-User-Interface-Tests&quot; class=&quot;headerlink&quot; title=&quot;Automating User Interface Test
    
    </summary>
    
      <category term="autotest" scheme="http://wodekouwei.com/categories/autotest/"/>
    
    
      <category term="autotest" scheme="http://wodekouwei.com/tags/autotest/"/>
    
      <category term="android" scheme="http://wodekouwei.com/tags/android/"/>
    
      <category term="tools" scheme="http://wodekouwei.com/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>androidè‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹(N):æµ‹è¯•æ”¯æŒåº“</title>
    <link href="http://wodekouwei.com/2017/08/30/at-android-support-library/"/>
    <id>http://wodekouwei.com/2017/08/30/at-android-support-library/</id>
    <published>2017-08-30T02:14:05.000Z</published>
    <updated>2017-08-30T02:37:11.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#setup" target="_blank" rel="external">Androidå®˜æ–¹æ–‡æ¡£-æµ‹è¯•æ”¯æŒåº“</a></p>
</blockquote>
<p>Android æµ‹è¯•æ”¯æŒåº“æä¾›äº†å¤§é‡ç”¨äºæµ‹è¯• Android åº”ç”¨çš„æ¡†æ¶ã€‚æ­¤åº“æä¾›äº†ä¸€ç»„ APIï¼Œè®©æ‚¨å¯ä»¥ä¸ºåº”ç”¨å¿«é€Ÿæ„å»ºä½•è¿è¡Œæµ‹è¯•ä»£ç ï¼ŒåŒ…æ‹¬ JUnit 4 å’ŒåŠŸèƒ½æ€§ç”¨æˆ·ç•Œé¢ (UI) æµ‹è¯•ã€‚æ‚¨å¯ä»¥ä» <a href="https://developer.android.com/tools/studio/index.html" target="_blank" rel="external">Android Studio IDE</a> æˆ–å‘½ä»¤è¡Œè¿è¡Œä½¿ç”¨è¿™äº› API åˆ›å»ºçš„æµ‹è¯•ã€‚</p>
<p>Android æµ‹è¯•æ”¯æŒåº“é€šè¿‡ Android SDK ç®¡ç†å™¨æä¾›ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://developer.android.com/topic/libraries/testing-support-library/index.html#setup" target="_blank" rel="external">æµ‹è¯•æ”¯æŒåº“è®¾ç½®</a></p>
<p>æœ¬é¡µä»‹ç»äº† Android æµ‹è¯•æ”¯æŒåº“æä¾›äº†å“ªäº›å·¥å…·ã€å¦‚ä½•åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œä»¥åŠåº“ç‰ˆæœ¬çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<h3 id="æµ‹è¯•æ”¯æŒåº“åŠŸèƒ½"><a href="#æµ‹è¯•æ”¯æŒåº“åŠŸèƒ½" class="headerlink" title="æµ‹è¯•æ”¯æŒåº“åŠŸèƒ½"></a>æµ‹è¯•æ”¯æŒåº“åŠŸèƒ½</h3><p>Android æµ‹è¯•æ”¯æŒåº“åŒ…æ‹¬ä»¥ä¸‹è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼š</p>
<ul>
<li>AndroidJUnitRunnerï¼šé€‚ç”¨äº Android ä¸”ä¸ JUnit 4 å…¼å®¹çš„æµ‹è¯•è¿è¡Œå™¨</li>
<li>Espressoï¼šUI æµ‹è¯•æ¡†æ¶ï¼›é€‚åˆåº”ç”¨ä¸­çš„åŠŸèƒ½æ€§ UI æµ‹è¯•</li>
<li>UI Automatorï¼šUI æµ‹è¯•æ¡†æ¶ï¼›é€‚åˆè·¨ç³»ç»Ÿå’Œå·²å®‰è£…åº”ç”¨çš„è·¨åº”ç”¨åŠŸèƒ½æ€§ UI æµ‹è¯•</li>
</ul>
<h4 id="AndroidJUnitRunner"><a href="#AndroidJUnitRunner" class="headerlink" title="AndroidJUnitRunner"></a>AndroidJUnitRunner</h4><p>AndroidJUnitRunner ç±»æ˜¯ä¸€ä¸ª <a href="http://junit.org/" target="_blank" rel="external">JUnit</a> æµ‹è¯•è¿è¡Œå™¨ï¼Œå¯è®©æ‚¨åœ¨ Android è®¾å¤‡ä¸Šè¿è¡Œ JUnit 3 æˆ– JUnit 4 æ ·å¼æµ‹è¯•ç±»ï¼ŒåŒ…æ‹¬ä½¿ç”¨ Espresso å’Œ UI Automator æµ‹è¯•æ¡†æ¶çš„è®¾å¤‡ã€‚æµ‹è¯•è¿è¡Œå™¨å¯ä»¥å°†æµ‹è¯•è½¯ä»¶åŒ…å’Œè¦æµ‹è¯•çš„åº”ç”¨åŠ è½½åˆ°è®¾å¤‡ã€è¿è¡Œæµ‹è¯•å¹¶æŠ¥å‘Šæµ‹è¯•ç»“æœã€‚æ­¤ç±»å°†æ›¿æ¢ <a href="https://developer.android.com/reference/android/test/InstrumentationTestRunner.html" target="_blank" rel="external">InstrumentationTestRunner</a> ç±»ï¼Œåè€…ä»…æ”¯æŒ JUnit 3 æµ‹è¯•ã€‚</p>
<p>æ­¤æµ‹è¯•è¿è¡Œå™¨çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>JUnit æ”¯æŒ</li>
<li>è®¿é—®ä»ªå™¨ä¿¡æ¯</li>
<li>æµ‹è¯•ç­›é€‰</li>
<li>æµ‹è¯•åˆ†ç‰‡
è¦æ±‚ Android 2.2ï¼ˆAPI çº§åˆ« 8ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
</ul>
<h5 id="JUnit-æ”¯æŒ"><a href="#JUnit-æ”¯æŒ" class="headerlink" title="JUnit æ”¯æŒ"></a>JUnit æ”¯æŒ</h5><p>æµ‹è¯•è¿è¡Œå™¨ä¸ JUnit 3 å’Œ JUnit 4ï¼ˆæœ€é«˜ç‰ˆæœ¬ä¸º JUnit 4.10ï¼‰æµ‹è¯•å…¼å®¹ã€‚ä¸è¿‡ï¼Œè¯·å‹¿åœ¨åŒä¸€è½¯ä»¶åŒ…ä¸­æ··ç”¨ JUnit 3 å’Œ JUnit 4 æµ‹è¯•ä»£ç ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ„å¤–ç»“æœã€‚å¦‚æœè¦åˆ›å»ºä¸€ä¸ª JUnit 4 ä»ªå™¨æµ‹è¯•ç±»ä»¥åœ¨è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œï¼Œåˆ™æµ‹è¯•ç±»å¿…é¡»ä»¥ <code>@RunWith(AndroidJUnit4.class)</code> æ³¨è§£ä½œä¸ºå‰ç¼€ã€‚</p>
<p>ä»¥ä¸‹ä»£ç æ®µæ˜¾ç¤ºäº†å¦‚ä½•ç¼–å†™ JUnit 4 ä»ªå™¨æµ‹è¯•æ¥éªŒè¯ CalculatorActivity ç±»ä¸­çš„ add æ“ä½œæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">import android.support.test.runner.AndroidJUnit4;</div><div class="line">import android.support.test.runner.AndroidJUnitRunner;</div><div class="line">import android.test.ActivityInstrumentationTestCase2;</div><div class="line"></div><div class="line">@RunWith(AndroidJUnit4.class)</div><div class="line">public class CalculatorInstrumentationTest</div><div class="line">        extends ActivityInstrumentationTestCase2&lt;CalculatorActivity&gt; &#123;</div><div class="line"></div><div class="line">    @Before</div><div class="line">    public void setUp() throws Exception &#123;</div><div class="line">        super.setUp();</div><div class="line"></div><div class="line">        // Injecting the Instrumentation instance is required</div><div class="line">        // for your test to run with AndroidJUnitRunner.</div><div class="line">        injectInstrumentation(InstrumentationRegistry.getInstrumentation());</div><div class="line">        mActivity = getActivity();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public void typeOperandsAndPerformAddOperation() &#123;</div><div class="line">        // Call the CalculatorActivity add() method and pass in some operand values, then</div><div class="line">        // check that the expected value is returned.</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @After</div><div class="line">    public void tearDown() throws Exception &#123;</div><div class="line">        super.tearDown();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="è®¿é—®ä»ªå™¨ä¿¡æ¯"><a href="#è®¿é—®ä»ªå™¨ä¿¡æ¯" class="headerlink" title="è®¿é—®ä»ªå™¨ä¿¡æ¯"></a>è®¿é—®ä»ªå™¨ä¿¡æ¯</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://developer.android.com/reference/android/support/test/InstrumentationRegistry.html" target="_blank" rel="external">InstrumentationRegistry</a> ç±»è®¿é—®ä¸æµ‹è¯•è¿è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚æ­¤ç±»åŒ…æ‹¬ <a href="https://developer.android.com/reference/android/app/Instrumentation.html" target="_blank" rel="external">Instrumentation</a> å¯¹è±¡ã€ç›®æ ‡åº”ç”¨ Context å¯¹è±¡ã€æµ‹è¯•åº”ç”¨ Context å¯¹è±¡ï¼Œä»¥åŠä¼ é€’åˆ°æµ‹è¯•ä¸­çš„å‘½ä»¤è¡Œå‚æ•°ã€‚ä½¿ç”¨ UI Automator æ¡†æ¶ç¼–å†™æµ‹è¯•æˆ–ç¼–å†™ä¾èµ–äº Instrumentation æˆ– Context å¯¹è±¡çš„æµ‹è¯•æ—¶ï¼Œæ­¤æ•°æ®éå¸¸æœ‰ç”¨ã€‚</p>
<h5 id="æµ‹è¯•ç­›é€‰"><a href="#æµ‹è¯•ç­›é€‰" class="headerlink" title="æµ‹è¯•ç­›é€‰"></a>æµ‹è¯•ç­›é€‰</h5><p>åœ¨ JUnit 4.x æµ‹è¯•ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ³¨è§£å¯¹æµ‹è¯•è¿è¡Œè¿›è¡Œé…ç½®ã€‚æ­¤åŠŸèƒ½å¯å°†å‘æµ‹è¯•ä¸­æ·»åŠ æ ·æ¿æ–‡ä»¶å’Œæ¡ä»¶ä»£ç çš„éœ€æ±‚é™è‡³æœ€ä½ã€‚é™¤äº† JUnit 4 æ”¯æŒçš„æ ‡å‡†æ³¨è§£å¤–ï¼Œæµ‹è¯•è¿è¡Œå™¨è¿˜æ”¯æŒ Android ç‰¹å®šçš„æ³¨è§£ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>@RequiresDevice</code>ï¼šæŒ‡å®šæµ‹è¯•ä»…åœ¨ç‰©ç†è®¾å¤‡è€Œä¸åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œã€‚</li>
<li><code>@SdkSupress</code>ï¼šç¦æ­¢åœ¨ä½äºç»™å®šçº§åˆ«çš„ Android API çº§åˆ«ä¸Šè¿è¡Œæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œè¦ç¦æ­¢åœ¨ä½äº 18 çš„æ‰€æœ‰ API çº§åˆ«ä¸Šè¿è¡Œæµ‹è¯•ï¼Œè¯·ä½¿ç”¨æ³¨è§£ - - @SDKSupress(minSdkVersion=18)ã€‚</li>
<li><code>@SmallTest</code>ã€<code>@MediumTest</code> å’Œ <code>@LargeTest</code>ï¼šæŒ‡å®šæµ‹è¯•çš„è¿è¡Œæ—¶é•¿ä»¥åŠè¿è¡Œé¢‘ç‡ã€‚<h5 id="æµ‹è¯•åˆ†ç‰‡"><a href="#æµ‹è¯•åˆ†ç‰‡" class="headerlink" title="æµ‹è¯•åˆ†ç‰‡"></a>æµ‹è¯•åˆ†ç‰‡</h5>æµ‹è¯•è¿è¡Œå™¨æ”¯æŒå°†å•ä¸€æµ‹è¯•å¥—ä»¶æ‹†åˆ†æˆå¤šä¸ªç¢ç‰‡ï¼Œå› æ­¤æ‚¨å¯ä»¥å°†å±äºåŒä¸€ç¢ç‰‡çš„æµ‹è¯•ä½œä¸ºä¸€ä¸ªç»„åœ¨åŒä¸€ Instrumentation å®ä¾‹ä¸‹è¿è¡Œã€‚æ¯ä¸ªåˆ†ç‰‡ç”±ä¸€ä¸ªç´¢å¼•å·è¿›è¡Œæ ‡è¯†ã€‚è¿è¡Œæµ‹è¯•æ—¶ï¼Œä½¿ç”¨ -e numShards é€‰é¡¹æŒ‡å®šè¦åˆ›å»ºçš„ç‹¬ç«‹åˆ†ç‰‡æ•°é‡ï¼Œå¹¶ä½¿ç”¨ -e shardIndex é€‰é¡¹æŒ‡å®šè¦è¿è¡Œå“ªä¸ªåˆ†ç‰‡ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œè¦å°†æµ‹è¯•å¥—ä»¶æ‹†åˆ†æˆ 10 ä¸ªåˆ†ç‰‡ï¼Œä¸”ä»…è¿è¡Œç¬¬äºŒä¸ªç¢ç‰‡ä¸­çš„æµ‹è¯•ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<p><code>adb shell am instrument -w -e numShards 10 -e shardIndex 2</code>
è¦è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨æ­¤æµ‹è¯•è¿è¡Œå™¨ï¼Œè¯·å‚é˜… <a href="https://developer.android.com/reference/android/support/test/package-summary.html" target="_blank" rel="external">API å‚è€ƒ</a>ã€‚</p>
<h4 id="Espresso"><a href="#Espresso" class="headerlink" title="Espresso"></a>Espresso</h4><p>Espresso æµ‹è¯•æ¡†æ¶æä¾›äº†ä¸€ç»„ API æ¥æ„å»º UI æµ‹è¯•ï¼Œç”¨äºæµ‹è¯•åº”ç”¨ä¸­çš„ç”¨æˆ·æµã€‚åˆ©ç”¨è¿™äº› APIï¼Œæ‚¨å¯ä»¥ç¼–å†™ç®€æ´ã€è¿è¡Œå¯é çš„è‡ªåŠ¨åŒ– UI æµ‹è¯•ã€‚Espresso éå¸¸é€‚åˆç¼–å†™ç™½ç›’è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå…¶ä¸­æµ‹è¯•ä»£ç å°†åˆ©ç”¨æ‰€æµ‹è¯•åº”ç”¨çš„å®ç°ä»£ç è¯¦æƒ…ã€‚</p>
<p>Espresso æµ‹è¯•æ¡†æ¶çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>çµæ´»çš„ APIï¼Œç”¨äºç›®æ ‡åº”ç”¨ä¸­çš„è§†å›¾å’Œé€‚é…å™¨åŒ¹é…ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è§†å›¾åŒ¹é…ã€‚</li>
<li>ä¸€ç»„ä¸°å¯Œçš„æ“ä½œ APIï¼Œç”¨äºè‡ªåŠ¨åŒ– UI äº¤äº’ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ“ä½œ APIã€‚</li>
<li>UI çº¿ç¨‹åŒæ­¥ï¼Œç”¨äºæå‡æµ‹è¯•å¯é æ€§ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… UI çº¿ç¨‹åŒæ­¥ã€‚
è¦æ±‚ Android 2.2ï¼ˆAPI çº§åˆ« 8ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
</ul>
<h5 id="è§†å›¾åŒ¹é…"><a href="#è§†å›¾åŒ¹é…" class="headerlink" title="è§†å›¾åŒ¹é…"></a>è§†å›¾åŒ¹é…</h5><p>åˆ©ç”¨ Espresso.onView() æ–¹æ³•ï¼Œæ‚¨å¯ä»¥è®¿é—®ç›®æ ‡åº”ç”¨ä¸­çš„ UI ç»„ä»¶å¹¶ä¸ä¹‹äº¤äº’ã€‚æ­¤æ–¹æ³•æ¥å— Matcher å‚æ•°å¹¶æœç´¢è§†å›¾å±‚æ¬¡ç»“æ„ï¼Œä»¥æ‰¾åˆ°ç¬¦åˆç»™å®šæ¡ä»¶çš„ç›¸åº” View å®ä¾‹ã€‚æ‚¨å¯ä»¥é€šè¿‡æŒ‡å®šä»¥ä¸‹æ¡ä»¶æ¥ä¼˜åŒ–æœç´¢ï¼š</p>
<ul>
<li>è§†å›¾çš„ç±»åç§°</li>
<li>è§†å›¾çš„å†…å®¹æè¿°</li>
<li>è§†å›¾çš„ R.id</li>
<li>åœ¨è§†å›¾ä¸­æ˜¾ç¤ºçš„æ–‡æœ¬
ä¾‹å¦‚ï¼Œè¦æ‰¾åˆ° ID å€¼ä¸º my_button çš„æŒ‰é’®ï¼Œå¯ä»¥æŒ‡å®šå¦‚ä¸‹åŒ¹é…å™¨ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onView(withId(R.id.my_button));</div></pre></td></tr></table></figure>
</li>
</ul>
<p>å¦‚æœæœç´¢æˆåŠŸï¼ŒonView() æ–¹æ³•å°†è¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œè®©æ‚¨å¯ä»¥æ‰§è¡Œç”¨æˆ·æ“ä½œå¹¶åŸºäºç›®æ ‡è§†å›¾å¯¹æ–­è¨€è¿›è¡Œæµ‹è¯•ã€‚</p>
<h5 id="é€‚é…å™¨åŒ¹é…"><a href="#é€‚é…å™¨åŒ¹é…" class="headerlink" title="é€‚é…å™¨åŒ¹é…"></a>é€‚é…å™¨åŒ¹é…</h5><p>åœ¨ AdapterView å¸ƒå±€ä¸­ï¼Œå¸ƒå±€åœ¨è¿è¡Œæ—¶ç”±å­è§†å›¾åŠ¨æ€å¡«å……ã€‚å¦‚æœç›®æ ‡è§†å›¾ä½äºæŸä¸ªå¸ƒå±€å†…éƒ¨ï¼Œè€Œè¯¥å¸ƒå±€æ˜¯ä» AdapterViewï¼ˆä¾‹å¦‚ ListView æˆ– GridViewï¼‰æ´¾ç”Ÿå‡ºçš„å­ç±»ï¼Œåˆ™ onView() æ–¹æ³•å¯èƒ½æ— æ³•å·¥ä½œï¼Œå› ä¸ºåªæœ‰å¸ƒå±€è§†å›¾çš„å­é›†ä¼šåŠ è½½åˆ°å½“å‰è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ã€‚</p>
<p>å› æ­¤ï¼Œè¯·ä½¿ç”¨ Espresso.onData() æ–¹æ³•è®¿é—®ç›®æ ‡è§†å›¾å…ƒç´ ã€‚Espresso.onData() æ–¹æ³•å°†è¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œè®©æ‚¨å¯ä»¥æ‰§è¡Œç”¨æˆ·æ“ä½œå¹¶æ ¹æ® AdapterView ä¸­çš„å…ƒç´ å¯¹æ–­è¨€è¿›è¡Œæµ‹è¯•ã€‚</p>
<h5 id="æ“ä½œ-API"><a href="#æ“ä½œ-API" class="headerlink" title="æ“ä½œ API"></a>æ“ä½œ API</h5><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ ¹æ®åº”ç”¨çš„ç”¨æˆ·ç•Œé¢æ‰§è¡ŒæŸäº›ç”¨æˆ·äº¤äº’æ¥æµ‹è¯•åº”ç”¨ã€‚å€ŸåŠ© ViewActions APIï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å®ç°è¿™äº›æ“ä½œçš„è‡ªåŠ¨åŒ–ã€‚æ‚¨å¯ä»¥æ‰§è¡Œå¤šç§ UI äº¤äº’ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>è§†å›¾ç‚¹å‡»</li>
<li>æ»‘åŠ¨</li>
<li>æŒ‰ä¸‹æŒ‰é”®å’ŒæŒ‰é’®</li>
<li>é”®å…¥æ–‡æœ¬</li>
<li>æ‰“å¼€é“¾æ¥
ä¾‹å¦‚ï¼Œè¦æ¨¡æ‹Ÿè¾“å…¥å­—ç¬¦ä¸²å€¼å¹¶æŒ‰ä¸‹æŒ‰é’®ä»¥æäº¤è¯¥å€¼ï¼Œæ‚¨å¯ä»¥åƒä¸‹é¢ä¸€æ ·ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ã€‚ViewInteraction.perform() å’Œ DataInteraction.perform() æ–¹æ³•é‡‡ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª ViewAction å‚æ•°ï¼Œå¹¶ä»¥æä¾›çš„é¡ºåºè¿è¡Œæ“ä½œã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// Type text into an EditText view, then close the soft keyboard</div><div class="line">onView(withId(R.id.editTextUserInput))</div><div class="line">    .perform(typeText(STRING_TO_BE_TYPED), closeSoftKeyboard());</div><div class="line"></div><div class="line">// Press the button to submit the text change</div><div class="line">onView(withId(R.id.changeTextBt)).perform(click());</div></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="UI-çº¿ç¨‹åŒæ­¥"><a href="#UI-çº¿ç¨‹åŒæ­¥" class="headerlink" title="UI çº¿ç¨‹åŒæ­¥"></a>UI çº¿ç¨‹åŒæ­¥</h5><p>ç”±äºè®¡æ—¶é—®é¢˜ï¼ŒAndroid è®¾å¤‡ä¸Šçš„æµ‹è¯•å¯èƒ½éšæœºå¤±è´¥ã€‚æ­¤æµ‹è¯•é—®é¢˜ç§°ä¸ºæµ‹è¯•ä¸ç¨³å®šã€‚åœ¨ Espresso ä¹‹å‰ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨æµ‹è¯•ä¸­æ’å…¥è¶³å¤Ÿé•¿çš„ä¼‘çœ æˆ–è¶…æ—¶æœŸæˆ–æ·»åŠ ä»£ç ï¼Œä»¥ä¾¿é‡è¯•å¤±è´¥çš„æ“ä½œã€‚Espresso æµ‹è¯•æ¡†æ¶å¯ä»¥å¤„ç† Instrumentation ä¸ UI çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼›è¿™å°±æ¶ˆé™¤äº†å¯¹ä¹‹å‰çš„è®¡æ—¶è§£å†³æ–¹æ³•çš„éœ€æ±‚ï¼Œå¹¶ç¡®ä¿æµ‹è¯•æ“ä½œä¸æ–­è¨€æ›´å¯é åœ°è¿è¡Œã€‚</p>
<p>è¦è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨ Espressoï¼Œè¯·å‚é˜… <a href="https://developer.android.com/reference/android/support/test/package-summary.html" target="_blank" rel="external">API å‚è€ƒ</a>å’Œ<a href="https://developer.android.com/training/testing/ui-testing/espresso-testing.html" target="_blank" rel="external">æµ‹è¯•å•ä¸ªåº”ç”¨çš„ UI </a>åŸ¹è®­ã€‚</p>
<h4 id="UI-Automator"><a href="#UI-Automator" class="headerlink" title="UI Automator"></a>UI Automator</h4><p>UI Automator æµ‹è¯•æ¡†æ¶æä¾›äº†ä¸€ç»„ API æ¥æ„å»º UI æµ‹è¯•ï¼Œç”¨äºåœ¨ç”¨æˆ·åº”ç”¨å’Œç³»ç»Ÿåº”ç”¨ä¸­æ‰§è¡Œäº¤äº’ã€‚åˆ©ç”¨ UI Automator APIï¼Œæ‚¨å¯ä»¥æ‰§è¡Œåœ¨æµ‹è¯•è®¾å¤‡ä¸­æ‰“å¼€â€œè®¾ç½®â€èœå•æˆ–åº”ç”¨å¯åŠ¨å™¨ç­‰æ“ä½œã€‚UI Automator æµ‹è¯•æ¡†æ¶éå¸¸é€‚åˆç¼–å†™é»‘ç›’è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå…¶ä¸­çš„æµ‹è¯•ä»£ç ä¸ä¾èµ–äºç›®æ ‡åº”ç”¨çš„å†…éƒ¨å®ç°è¯¦æƒ…ã€‚</p>
<p>UI Automator æµ‹è¯•æ¡†æ¶çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç”¨äºæ£€æŸ¥å¸ƒå±€å±‚æ¬¡ç»“æ„çš„æŸ¥çœ‹å™¨ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… UI Automator æŸ¥çœ‹å™¨ã€‚</li>
<li>åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ£€ç´¢çŠ¶æ€ä¿¡æ¯å¹¶æ‰§è¡Œæ“ä½œçš„ APIã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è®¿é—®è®¾å¤‡çŠ¶æ€ã€‚</li>
<li>æ”¯æŒè·¨åº”ç”¨ UI æµ‹è¯•çš„ APIã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… UI Automator APIã€‚
è¦æ±‚ Android 4.3ï¼ˆAPI çº§åˆ« 18ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
</ul>
<h5 id="UI-Automator-æŸ¥çœ‹å™¨"><a href="#UI-Automator-æŸ¥çœ‹å™¨" class="headerlink" title="UI Automator æŸ¥çœ‹å™¨"></a>UI Automator æŸ¥çœ‹å™¨</h5><p>uiautomatorviewer å·¥å…·æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ GUIï¼Œå¯ä»¥æ‰«æå’Œåˆ†æ Android è®¾å¤‡ä¸Šå½“å‰æ˜¾ç¤ºçš„ UI ç»„ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤å·¥å…·æ£€æŸ¥å¸ƒå±€å±‚æ¬¡ç»“æ„ï¼Œå¹¶æŸ¥çœ‹åœ¨è®¾å¤‡å‰å°æ˜¾ç¤ºçš„ UI ç»„ä»¶å±æ€§ã€‚åˆ©ç”¨æ­¤ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ UI Automatorï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡åˆ›å»ºä¸ç‰¹å®šå¯è§å±æ€§åŒ¹é…çš„ UI é€‰æ‹©å™¨ï¼‰åˆ›å»ºæ§åˆ¶æ›´åŠ ç²¾ç¡®çš„æµ‹è¯•ã€‚</p>
<p>uiautomatorviewer å·¥å…·ä½äº <code>&lt;android-sdk&gt;/tools/</code>ç›®å½•ä¸­ã€‚</p>
<h5 id="è®¿é—®è®¾å¤‡çŠ¶æ€"><a href="#è®¿é—®è®¾å¤‡çŠ¶æ€" class="headerlink" title="è®¿é—®è®¾å¤‡çŠ¶æ€"></a>è®¿é—®è®¾å¤‡çŠ¶æ€</h5><p>UI Automator æµ‹è¯•æ¡†æ¶æä¾›äº†ä¸€ä¸ª UiDevice ç±»ï¼Œç”¨äºåœ¨ç›®æ ‡åº”ç”¨è¿è¡Œçš„è®¾å¤‡ä¸Šè®¿é—®å’Œæ‰§è¡Œæ“ä½œã€‚æ‚¨å¯ä»¥è°ƒç”¨å…¶æ–¹æ³•æ¥è®¿é—®è®¾å¤‡å±æ€§ï¼Œå¦‚å½“å‰å±å¹•æ–¹å‘æˆ–æ˜¾ç¤ºå°ºå¯¸ã€‚UiDevice ç±»è¿˜å¯ç”¨äºæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>æ›´æ”¹è®¾å¤‡æ—‹è½¬</li>
<li>æŒ‰ D-pad æŒ‰é’®</li>
<li>æŒ‰â€œè¿”å›â€ã€â€œä¸»å±å¹•â€æˆ–â€œèœå•â€æŒ‰é’®</li>
<li>æ‰“å¼€é€šçŸ¥æ </li>
<li>å¯¹å½“å‰çª—å£è¿›è¡Œå±å¹•æˆªå›¾
ä¾‹å¦‚ï¼Œè¦æ¨¡æ‹ŸæŒ‰ä¸‹â€œä¸»å±å¹•â€æŒ‰é’®ï¼Œè¯·è°ƒç”¨ <code>UiDevice.pressHome()</code> æ–¹æ³•ã€‚</li>
</ul>
<h5 id="UI-Automator-API"><a href="#UI-Automator-API" class="headerlink" title="UI Automator API"></a>UI Automator API</h5><p>åˆ©ç”¨ UI Automator APIï¼Œæ‚¨å¯ä»¥ç¼–å†™ç¨³å¥å¯é çš„æµ‹è¯•ï¼Œè€Œæ— éœ€äº†è§£ç›®æ ‡åº”ç”¨çš„å®ç°è¯¦æƒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº› API åœ¨å¤šä¸ªåº”ç”¨ä¸­æ•è·å’Œæ“ä½œ UI ç»„ä»¶ï¼š</p>
<ul>
<li><a href="https://developer.android.com/reference/android/support/test/uiautomator/UiCollection.html" target="_blank" rel="external">UiCollection</a>ï¼šæšä¸¾å®¹å™¨çš„ UI å…ƒç´ ä»¥ä¾¿è®¡ç®—å­å…ƒç´ ä¸ªæ•°ï¼Œæˆ–è€…é€šè¿‡å¯è§çš„æ–‡æœ¬æˆ–å†…å®¹æè¿°å±æ€§æ¥æŒ‡ä»£å­å…ƒç´ ã€‚</li>
<li><a href="https://developer.android.com/reference/android/support/test/uiautomator/UiObject.html" target="_blank" rel="external">UiObject</a>ï¼šè¡¨ç¤ºè®¾å¤‡ä¸Šå¯è§çš„ UI å…ƒç´ ã€‚</li>
<li><a href="https://developer.android.com/reference/android/support/test/uiautomator/UiScrollable.html" target="_blank" rel="external">UiScrollable</a>ï¼šä¸ºåœ¨å¯æ»šåŠ¨ UI å®¹å™¨ä¸­æœç´¢é¡¹ç›®æä¾›æ”¯æŒã€‚</li>
<li><a href="https://developer.android.com/reference/android/support/test/uiautomator/UiSelector.html" target="_blank" rel="external">UiSelector</a>ï¼šè¡¨ç¤ºåœ¨è®¾å¤‡ä¸ŠæŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡ UI å…ƒç´ ã€‚</li>
<li><a href="https://developer.android.com/reference/android/support/test/uiautomator/Configurator.html" target="_blank" rel="external">Configurator</a>ï¼šå…è®¸æ‚¨è®¾ç½®è¿è¡Œ UI Automator æµ‹è¯•æ‰€éœ€çš„å…³é”®å‚æ•°ã€‚
ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•ç¼–å†™å¯åœ¨è®¾å¤‡ä¸­è°ƒç”¨é»˜è®¤åº”ç”¨å¯åŠ¨å™¨çš„æµ‹è¯•è„šæœ¬ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// Initialize UiDevice instance</div><div class="line">mDevice = UiDevice.getInstance(getInstrumentation());</div><div class="line"></div><div class="line">// Perform a short press on the HOME button</div><div class="line">mDevice.pressHome();</div><div class="line"></div><div class="line">// Bring up the default launcher by searching for</div><div class="line">// a UI component that matches the content-description for the launcher button</div><div class="line">UiObject allAppsButton = mDevice</div><div class="line">        .findObject(new UiSelector().description(&quot;Apps&quot;));</div><div class="line"></div><div class="line">// Perform a click on the button to bring up the launcher</div><div class="line">allAppsButton.clickAndWaitForNewWindow();</div></pre></td></tr></table></figure>
</li>
</ul>
<p>è¦è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨ UI Automatorï¼Œè¯·å‚é˜… <a href="https://developer.android.com/reference/android/support/test/package-summary.html" target="_blank" rel="external">API å‚è€ƒ</a>å’Œ<a href="https://developer.android.com/training/testing/ui-testing/uiautomator-testing.html" target="_blank" rel="external">æµ‹è¯•å¤šä¸ªåº”ç”¨çš„ UI </a>åŸ¹è®­ã€‚</p>
<h3 id="æµ‹è¯•æ”¯æŒåº“è®¾ç½®"><a href="#æµ‹è¯•æ”¯æŒåº“è®¾ç½®" class="headerlink" title="æµ‹è¯•æ”¯æŒåº“è®¾ç½®"></a>æµ‹è¯•æ”¯æŒåº“è®¾ç½®</h3><p>Android æµ‹è¯•æ”¯æŒåº“è½¯ä»¶åŒ…åœ¨æœ€æ–°ç‰ˆæœ¬çš„ Android æ”¯æŒå­˜å‚¨åº“ä¸­æä¾›ï¼Œåè€…å¯ä½œä¸ºè¾…åŠ©ç»„ä»¶é€šè¿‡ Android SDK ç®¡ç†å™¨ä¸‹è½½ã€‚</p>
<p>è¦é€šè¿‡ SDK ç®¡ç†å™¨ä¸‹è½½ Android æ”¯æŒå­˜å‚¨åº“ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>å¯åŠ¨ Android SDK ç®¡ç†å™¨ã€‚</li>
<li>åœ¨ SDK ç®¡ç†å™¨çª—å£ä¸­ï¼Œæ»šåŠ¨åˆ° Packages åˆ—è¡¨æœ«å°¾ï¼Œæ‰¾åˆ° Extras æ–‡ä»¶å¤¹å¹¶å±•å¼€ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ä»¥æ˜¾ç¤ºå…¶å†…å®¹ã€‚</li>
<li>é€‰æ‹© Android Support Repository é¡¹ã€‚</li>
<li>ç‚¹å‡» Install packagesâ€¦ æŒ‰é’®ã€‚</li>
</ul>
<p>ä¸‹è½½åï¼Œæ­¤å·¥å…·ä¼šå°†æ”¯æŒå­˜å‚¨åº“æ–‡ä»¶å®‰è£…åˆ°æ‚¨ç°æœ‰çš„ Android SDK ç›®å½•ä¸­ã€‚åº“æ–‡ä»¶ä½äº SDK çš„ä»¥ä¸‹å­ç›®å½•ä¸­ï¼š<code>&lt;sdk&gt;/extras/android/m2repository</code> ç›®å½•ã€‚</p>
<p>Android æµ‹è¯•æ”¯æŒåº“çš„ç±»ä½äº <code>android.support.test</code> è½¯ä»¶åŒ…ä¸­ã€‚</p>
<p>è¦åœ¨ Gradle é¡¹ç›®ä¸­ä½¿ç”¨ Android æµ‹è¯•æ”¯æŒåº“ï¼Œè¯·åœ¨ build.gradle æ–‡ä»¶ä¸­æ·»åŠ è¿™äº›ä¾èµ–å…³ç³»ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">  androidTestCompile &apos;com.android.support.test:runner:0.4&apos;</div><div class="line">  // Set this dependency to use JUnit 4 rules</div><div class="line">  androidTestCompile &apos;com.android.support.test:rules:0.4&apos;</div><div class="line">  // Set this dependency to build and run Espresso tests</div><div class="line">  androidTestCompile &apos;com.android.support.test.espresso:espresso-core:2.2.1&apos;</div><div class="line">  // Set this dependency to build and run UI Automator tests</div><div class="line">  androidTestCompile &apos;com.android.support.test.uiautomator:uiautomator-v18:2.1.2&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¦å°† AndroidJUnitRunner è®¾ç½®ä¸º Gradle é¡¹ç›®ä¸­çš„é»˜è®¤æµ‹è¯•ä»ªå™¨è¿è¡Œå™¨ï¼Œè¯·åœ¨ build.gradle æ–‡ä»¶ä¸­æŒ‡å®šæ­¤ä¾èµ–å…³ç³»ï¼š</p>
<p>``
android {
    defaultConfig {
        testInstrumentationRunner â€œandroid.support.test.runner.AndroidJUnitRunnerâ€
    }
}
```</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.android.com/topic/libraries/testing-support-library/index.html#setup&quot; target=&quot;_blank&quot; rel=&quot;extern
    
    </summary>
    
      <category term="autotest" scheme="http://wodekouwei.com/categories/autotest/"/>
    
    
      <category term="autotest" scheme="http://wodekouwei.com/tags/autotest/"/>
    
      <category term="android" scheme="http://wodekouwei.com/tags/android/"/>
    
      <category term="tools" scheme="http://wodekouwei.com/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>androidè‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹(N):adbå·¥å…·</title>
    <link href="http://wodekouwei.com/2017/08/29/at-android-adb/"/>
    <id>http://wodekouwei.com/2017/08/29/at-android-adb/</id>
    <published>2017-08-29T06:43:09.000Z</published>
    <updated>2017-08-29T08:47:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>Androidæ‰‹æœºè‡ªåŠ¨åŒ–æµ‹è¯•è¿‡ç¨‹ç¦»ä¸å¼€adbå·¥å…·,ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„adbå‘½ä»¤.</p>
<h3 id="1-adb-forward"><a href="#1-adb-forward" class="headerlink" title="1. adb forward"></a>1. <code>adb forward</code></h3><p>å‘½ä»¤ç¤ºä¾‹:
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb forward tcp:8000 tcp:9000</div></pre></td></tr></table></figure></p>
<p>ä½œç”¨:
æŠŠPCç«¯8000ç«¯å£çš„æ•°æ®, è½¬å‘åˆ°Androidç«¯çš„9000ç«¯å£ä¸Š,PCç«¯çš„8000ç«¯å£ä¼šè¢« adb
ç›‘å¬, è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åªéœ€è¦å¾€8000ç«¯å£å†™æ•°æ®, è¿™ä¸ªæ•°æ®å°±ä¼šå‘é€åˆ°æ‰‹æœºç«¯çš„9000ç«¯å£ä¸Š.</p>
<h3 id="2-adb-connect"><a href="#2-adb-connect" class="headerlink" title="2. adb connect"></a>2. <code>adb connect</code></h3><p>å‘½ä»¤ç¤ºä¾‹:
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb connect + IP</div></pre></td></tr></table></figure></p>
<p>ä½œç”¨:
é€šè¿‡æ— çº¿ç½‘ç»œåœ¨PCç«¯adbè¿æ¥æ‰‹æœºç«¯</p>
<p>æ³¨æ„:</p>
<ol>
<li>è¦é“¾æ¥çš„IP ï¼Œå¿…é¡»å’Œè‡ªå·±çš„PCçš„ç½‘ç»œåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œadb ä¸èƒ½è·¨å±€åŸŸç½‘é“¾æ¥è®¾å¤‡</li>
<li>å¦‚æœé€šè¿‡usbé“¾æ¥Androidè®¾å¤‡ï¼Œé€šè¿‡adb devices å¯ä»¥çœ‹è§è®¾å¤‡åˆ—è¡¨ï¼Œä½†æ˜¯ä½¿ç”¨ä¸äº†ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„å‘½ä»¤è¯´æ˜æ‰‹æœºç«¯çš„æœåŠ¡æœªå¼€å¯,éœ€è¦è¿æ¥usbå¼€å¯æ‰‹æœºæœåŠ¡,é»˜è®¤ç«¯å£5555:<code>adb tcpip 5555</code>,å¼€å¯åæ‹”æ‰usbé€šè¿‡<code>adb connect 192.168.0.101:5555</code>å³å¯è¿æ¥</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Androidæ‰‹æœºè‡ªåŠ¨åŒ–æµ‹è¯•è¿‡ç¨‹ç¦»ä¸å¼€adbå·¥å…·,ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„adbå‘½ä»¤.&lt;/p&gt;
&lt;h3 id=&quot;1-adb-forward&quot;&gt;&lt;a href=&quot;#1-adb-forward&quot; class=&quot;headerlink&quot; title=&quot;1. adb forward&quot;&gt;&lt;/
    
    </summary>
    
      <category term="autotest" scheme="http://wodekouwei.com/categories/autotest/"/>
    
    
      <category term="autotest" scheme="http://wodekouwei.com/tags/autotest/"/>
    
      <category term="android" scheme="http://wodekouwei.com/tags/android/"/>
    
      <category term="tools" scheme="http://wodekouwei.com/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>RecyclerViewå®ç°å•é€‰åˆ—è¡¨</title>
    <link href="http://wodekouwei.com/2017/08/24/tips-recyclerview-selectable/"/>
    <id>http://wodekouwei.com/2017/08/24/tips-recyclerview-selectable/</id>
    <published>2017-08-23T16:49:31.000Z</published>
    <updated>2017-08-23T16:55:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¸¸è§„æ–¹æ³•ï¼š
åœ¨Javabeané‡Œå¢åŠ ä¸€ä¸ªboolean isSelectedå­—æ®µï¼Œ
å¹¶åœ¨Adapteré‡Œæ ¹æ®è¿™ä¸ªå­—æ®µçš„å€¼è®¾ç½®â€œCheckBoxâ€çš„é€‰ä¸­çŠ¶æ€ã€‚
åœ¨æ¯æ¬¡é€‰ä¸­ä¸€ä¸ªæ–°ä¼˜æƒ åˆ¸æ—¶ï¼Œæ”¹å˜æ•°æ®æºé‡Œçš„isSelectedå­—æ®µï¼Œ
å¹¶notifyDataSetChanged()åˆ·æ–°æ•´ä¸ªåˆ—è¡¨ã€‚
è¿™æ ·å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œä»£ç é‡ä¹Ÿå¾ˆå°‘ï¼Œå”¯ä¸€ä¸è¶³çš„åœ°æ–¹å°±æ˜¯æ€§èƒ½æœ‰æŸè€—ï¼Œä¸æ˜¯æœ€ä¼˜é›…ã€‚
Soä½œä¸ºä¸€ä¸ªæœ‰è¿½æ±‚ ä»Šå¤©æ¯”è¾ƒé—² çš„ç¨‹åºå‘˜ï¼Œæˆ‘å†³å¿ƒåˆ†äº«ä¸€æ³¢ä¼˜é›…æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡ä¼šåˆ—ä¸¾åˆ†æä¸€ä¸‹åœ¨ListViewå’ŒRecyclerViewä¸­, åˆ—è¡¨å®ç°å•é€‰çš„å‡ ç§æ–¹æ¡ˆï¼Œå¹¶æ¨èé‡‡ç”¨å®šå‘åˆ·æ–° éƒ¨åˆ†ç»‘å®šçš„æ–¹æ¡ˆï¼Œå› ä¸ºæ›´é«˜æ•ˆandä¼˜é›…</p>
<h3 id="1å¸¸è§„æ–¹æ¡ˆ"><a href="#1å¸¸è§„æ–¹æ¡ˆ" class="headerlink" title="1å¸¸è§„æ–¹æ¡ˆ:"></a>1å¸¸è§„æ–¹æ¡ˆ:</h3><p>å¸¸è§„æ–¹æ¡ˆ è¯·å…‰é€Ÿé˜…è¯»ï¼Œç›´æ¥ä¸Šç ï¼š
Beanç»“æ„ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class TestBean extends SelectedBean &#123;</div><div class="line">    private String name;</div><div class="line">    public TestBean(String name,boolean isSelected) &#123;</div><div class="line">        this.name = name;</div><div class="line">        setSelected(isSelected);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æˆ‘é¡¹ç›®é‡Œæœ‰å¥½å¤šå•é€‰éœ€æ±‚ï¼Œæ‡’å¾—å†™isSelectedå­—æ®µï¼Œæ‰€ä»¥å¼„äº†ä¸ªçˆ¶ç±»ä¾›å­ç±»ç»§æ‰¿ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public class SelectedBean &#123;</div><div class="line">    private boolean isSelected;</div><div class="line">    public boolean isSelected() &#123;</div><div class="line">        return isSelected;</div><div class="line">    &#125;</div><div class="line">    public void setSelected(boolean selected) &#123;</div><div class="line">        isSelected = selected;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Acitivity å’ŒAdapterå…¶ä»–æ–¹æ³•éƒ½æ˜¯æœ€æ™®é€šçš„ä¸å†èµ˜è¿°ã€‚
Adapterçš„onBindViewHolder()å¦‚ä¸‹ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">Log.d(&quot;TAG&quot;, &quot;onBindViewHolder() called with: holder = [&quot; + holder + &quot;], position = [&quot; + position + &quot;]&quot;);</div><div class="line">        holder.ivSelect.setSelected(mDatas.get(position).isSelected());//â€œCheckBoxâ€</div><div class="line">        holder.tvCoupon.setText(mDatas.get(position).getName());//TextView</div><div class="line">        holder.ivSelect.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View view) &#123;</div><div class="line">                //å®ç°å•é€‰ï¼Œç¬¬ä¸€ç§æ–¹æ³•ï¼Œååˆ†ç®€å•ï¼Œ Lv Rvé€šç”¨,å› ä¸ºå®ƒä»¬éƒ½æœ‰notifyDataSetChanged()æ–¹æ³•</div><div class="line">                // æ¯æ¬¡ç‚¹å‡»æ—¶ï¼Œå…ˆå°†æ‰€æœ‰çš„selectedè®¾ä¸ºfalseï¼Œå¹¶ä¸”å°†å½“å‰ç‚¹å‡»çš„item è®¾ä¸ºtrueï¼Œ åˆ·æ–°æ•´ä¸ªè§†å›¾</div><div class="line">                for (TestBean data : mDatas) &#123;</div><div class="line">                    data.setSelected(false);</div><div class="line">                &#125;</div><div class="line">                mDatas.get(position).setSelected(true);</div><div class="line">                notifyDataSetChanged();</div><div class="line"></div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">ViewHolderï¼š</div><div class="line"></div><div class="line">    public static class CouponVH extends RecyclerView.ViewHolder &#123;</div><div class="line">        private ImageView ivSelect;</div><div class="line">        private TextView tvCoupon;</div><div class="line"></div><div class="line">        public CouponVH(View itemView) &#123;</div><div class="line">            super(itemView);</div><div class="line">            ivSelect = (ImageView) itemView.findViewById(R.id.ivSelect);</div><div class="line">            tvCoupon = (TextView) itemView.findViewById(R.id.tvCoupon);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>æ–¹æ¡ˆä¼˜ç‚¹ï¼šç®€å•ç²—æš´</li>
<li>æ–¹æ¡ˆç¼ºç‚¹ï¼š
å…¶å®éœ€è¦ä¿®æ”¹çš„Itemåªæœ‰ä¸¤é¡¹ï¼š
ä¸€ä¸ªå½“å‰å¤„äºé€‰ä¸­çŠ¶æ€çš„Item-&gt;æ™®é€šçŠ¶æ€
å†å°†å½“å‰æ‰‹æŒ‡ç‚¹å‡»çš„è¿™ä¸ªItem-&gt;é€‰ä¸­çŠ¶æ€
ä½†é‡‡ç”¨æ™®é€šæ–¹æ¡ˆï¼Œåˆ™ä¼šåˆ·æ–°æ•´ä¸ªä¸€å±å¯è§çš„Itemï¼Œé‡èµ°ä»–ä»¬çš„getView()/onBindViewHolder()æ–¹æ³•ã€‚
å…¶å®ä¸€ä¸ªå±å¹•ä¸€èˆ¬æœ€å¤šå¯è§10+ä¸ªItemï¼Œéå†ä¸€éä¹Ÿæ— ä¼¤å¤§é›…ã€‚
ä½†å’±ä»¬è¿˜æ˜¯è¦æœ‰è¿½æ±‚ä¼˜é›…çš„å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚</li>
</ul>
<h3 id="2-åˆ©ç”¨Rvçš„notifyItemChanged-å®šå‘åˆ·æ–°"><a href="#2-åˆ©ç”¨Rvçš„notifyItemChanged-å®šå‘åˆ·æ–°" class="headerlink" title="2 åˆ©ç”¨Rvçš„notifyItemChanged()å®šå‘åˆ·æ–°:"></a>2 åˆ©ç”¨Rvçš„notifyItemChanged()å®šå‘åˆ·æ–°:</h3><p>æœ¬æ–¹æ¡ˆå¯ä»¥ä¸­é€Ÿé˜…è¯»</p>
<ol>
<li><p>æœ¬æ–¹æ¡ˆéœ€è¦åœ¨Adapteré‡Œæ–°å¢ä¸€ä¸ªå­—æ®µï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private int mSelectedPos = -1;//å®ç°å•é€‰  æ–¹æ³•äºŒï¼Œå˜é‡ä¿å­˜å½“å‰é€‰ä¸­çš„position</div></pre></td></tr></table></figure>
</li>
<li><p>åœ¨è®¾ç½®æ•°æ®é›†æ—¶(æ„é€ å‡½æ•°ï¼ŒsetData()æ–¹æ³•ç­‰ï¼š)ï¼Œåˆå§‹åŒ– mSelectedPos çš„å€¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//å®ç°å•é€‰æ–¹æ³•äºŒï¼š è®¾ç½®æ•°æ®é›†æ—¶ï¼Œæ‰¾åˆ°é»˜è®¤é€‰ä¸­çš„pos</div><div class="line">for (int i = 0; i &lt; mDatas.size(); i++) &#123;</div><div class="line">    if (mDatas.get(i).isSelected()) &#123;</div><div class="line">        mSelectedPos = i;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>onClické‡Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//å®ç°å•é€‰æ–¹æ³•äºŒï¼š notifyItemChanged() å®šå‘åˆ·æ–°ä¸¤ä¸ªè§†å›¾</div><div class="line">//å¦‚æœå‹¾é€‰çš„ä¸æ˜¯å·²ç»å‹¾é€‰çŠ¶æ€çš„Item</div><div class="line">if (mSelectedPos!=position)&#123;</div><div class="line">    //å…ˆå–æ¶ˆä¸Šä¸ªitemçš„å‹¾é€‰çŠ¶æ€</div><div class="line">    mDatas.get(mSelectedPos).setSelected(false);</div><div class="line">    notifyItemChanged(mSelectedPos);</div><div class="line">    //è®¾ç½®æ–°Itemçš„å‹¾é€‰çŠ¶æ€</div><div class="line">    mSelectedPos = position;</div><div class="line">    mDatas.get(mSelectedPos).setSelected(true);</div><div class="line">    notifyItemChanged(mSelectedPos);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>æœ¬æ–¹æ¡ˆç”±äºè°ƒç”¨äº†notifyItemChanged()ï¼Œæ‰€ä»¥è¿˜ä¼šä¼´æœ‰â€œç™½å…‰ä¸€é—ªâ€çš„åŠ¨ç”»ã€‚</p>
<ul>
<li><p>æ–¹æ¡ˆä¼˜ç‚¹ï¼š
æœ¬æ–¹æ¡ˆï¼Œè¾ƒä¼˜é›…äº†ï¼Œä¸ä¼šé‡èµ°ä¸€å±å¯è§çš„Itemçš„getView()/onBindViewHolder()æ–¹æ³•ï¼Œ
ä½†ä»ç„¶ä¼šé‡èµ°éœ€è¦ä¿®æ”¹çš„ä¸¤ä¸ªItemçš„getView()/onBindViewHolder()æ–¹æ³•ï¼Œ</p>
</li>
<li><p>æ–¹æ¡ˆç¼ºç‚¹ï¼š
æˆ‘ä»¬å®é™…ä¸Šéœ€è¦ä¿®æ”¹çš„ï¼Œåªæ˜¯é‡Œé¢â€œCheckBoxâ€çš„å€¼ï¼Œ
æŒ‰ç…§åœ¨DiffUtilä¸€æ–‡å­¦ä¹ åˆ°çš„å§¿åŠ¿ï¼Œæœ¯è¯­åº”è¯¥æ˜¯â€œPartial bind â€œï¼Œ
ï¼ˆå®‰åˆ©æ—¶é—´,æ²¡å¬è¿‡DiffUtilå’ŒPartial bindçš„ æˆ³-&gt;ï¼šã€Androidã€‘è¯¦è§£7.0å¸¦æ¥çš„æ–°å·¥å…·ç±»ï¼šDiffUtilï¼‰
æˆ‘ä»¬éœ€è¦çš„åªæ˜¯éƒ¨åˆ†ç»‘å®šã€‚</p>
</li>
</ul>
<p>ä¸€ä¸ªç–‘ç‚¹ï¼š
ä½¿ç”¨æ–¹æ³•2 åœ¨ç¬¬ä¸€æ¬¡é€‰ä¸­å…¶ä»–Itemæ—¶ï¼Œåˆ‡æ¢selectedçŠ¶æ€æ—¶ï¼Œ
æŸ¥çœ‹logï¼Œå¹¶ä¸æ˜¯åªé‡èµ°äº†æ–°æ—§Itemçš„onBindViewHolder()æ–¹æ³•ï¼Œè¿˜èµ°äº†ä¸¤ä¸ªæ ¹æœ¬ä¸åœ¨å±å¹•èŒƒå›´é‡Œçš„Itemçš„onBindViewHolder()æ–¹æ³•ï¼Œ
å¦‚ï¼Œæœ¬ä¾‹ä¸­ åœ¨è¿˜æœ‰item 0-3 åœ¨å±å¹•é‡Œï¼Œé»˜è®¤å‹¾é€‰item1ï¼Œæˆ‘é€‰ä¸­item0åï¼Œlogæ˜¾ç¤ºpostion 4,5,0,1 ä¾æ¬¡æ‰§è¡Œäº†onBindViewHolder()æ–¹æ³•ã€‚
ä½†æ˜¯å†æ¬¡åˆ‡æ¢å…¶ä»–Itemæ—¶ï¼Œ ä¼šç¬¦åˆé¢„æœŸï¼šåªèµ°éœ€è¦ä¿®æ”¹çš„ä¸¤ä¸ªItemçš„getView()/onBindViewHolder()æ–¹æ³•ã€‚
åŸå› æœªçŸ¥ï¼Œæœ‰æœ‹å‹çŸ¥é“çƒ¦è¯·å‘ŠçŸ¥ï¼Œå¤šè°¢ã€‚</p>
<h3 id="3-Rv-å®ç°éƒ¨åˆ†ç»‘å®šï¼ˆæ¨èï¼‰"><a href="#3-Rv-å®ç°éƒ¨åˆ†ç»‘å®šï¼ˆæ¨èï¼‰" class="headerlink" title="3 Rv å®ç°éƒ¨åˆ†ç»‘å®šï¼ˆæ¨èï¼‰:"></a>3 Rv å®ç°éƒ¨åˆ†ç»‘å®šï¼ˆæ¨èï¼‰:</h3><p>åˆ©ç”¨RecyclerViewçš„ findViewHolderForLayoutPosition()æ–¹æ³•ï¼Œè·å–æŸä¸ªpostionçš„ViewHolderï¼ŒæŒ‰ç…§æºç é‡Œè¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šï¼Œå®ƒå¯èƒ½è¿”å›nullã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ³¨æ„åˆ¤ç©ºï¼Œï¼ˆç©ºå³åœ¨å±å¹•ä¸å¯è§ï¼‰ã€‚
ä¸æ–¹æ³•2åªæœ‰onClické‡Œçš„ä»£ç ä¸ä¸€æ ·ï¼Œæ ¸å¿ƒè¿˜æ˜¯åˆ©ç”¨mSelectedPos å­—æ®µæäº‹æƒ…ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//å®ç°å•é€‰æ–¹æ³•ä¸‰ï¼š RecyclerViewå¦ä¸€ç§å®šå‘åˆ·æ–°æ–¹æ³•ï¼šä¸ä¼šæœ‰ç™½å…‰ä¸€é—ªåŠ¨ç”» ä¹Ÿä¸ä¼šé‡å¤onBindVIewHolder</div><div class="line">CouponVH couponVH = (CouponVH) mRv.findViewHolderForLayoutPosition(mSelectedPos);</div><div class="line">if (couponVH != null) &#123;//è¿˜åœ¨å±å¹•é‡Œ</div><div class="line">    couponVH.ivSelect.setSelected(false);</div><div class="line">&#125;else &#123;</div><div class="line">    //add by 2016 11 22 for ä¸€äº›æç«¯æƒ…å†µï¼Œholderè¢«ç¼“å­˜åœ¨Recyclerçš„cacheViewé‡Œï¼Œ</div><div class="line">    //æ­¤æ—¶æ‹¿ä¸åˆ°ViewHolderï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šå›è°ƒonBindViewHolderæ–¹æ³•ã€‚æ‰€ä»¥addä¸€ä¸ªå¼‚å¸¸å¤„ç†</div><div class="line">    notifyItemChanged(mSelectedPos);</div><div class="line">&#125;</div><div class="line">mDatas.get(mSelectedPos).setSelected(false);//ä¸ç®¡åœ¨ä¸åœ¨å±å¹•é‡Œ éƒ½éœ€è¦æ”¹å˜æ•°æ®</div><div class="line">//è®¾ç½®æ–°Itemçš„å‹¾é€‰çŠ¶æ€</div><div class="line">mSelectedPos = position;</div><div class="line">mDatas.get(mSelectedPos).setSelected(true);</div><div class="line">holder.ivSelect.setSelected(true);</div></pre></td></tr></table></figure></p>
<ul>
<li>æ–¹æ¡ˆä¼˜ç‚¹ï¼š
å®šå‘åˆ·æ–°ä¸¤ä¸ªItemï¼Œåªä¿®æ”¹å¿…è¦çš„éƒ¨åˆ†ï¼Œä¸ä¼šé‡èµ°onBindViewHolder()ï¼Œå±äºæ‰‹åŠ¨éƒ¨åˆ†ç»‘å®šã€‚ä»£ç é‡ä¹Ÿé€‚ä¸­ï¼Œä¸å¤šã€‚</li>
<li>æ–¹æ¡ˆç¼ºç‚¹ï¼š
æ²¡æœ‰ç™½å…‰ä¸€é—ªåŠ¨ç”»ï¼Ÿï¼Ÿï¼Ÿï¼ˆå¦‚æœè¿™ç®—ç¼ºç‚¹ï¼‰</li>
</ul>
<h3 id="4-Rv-åˆ©ç”¨payloadså®ç°éƒ¨åˆ†ç»‘å®š-ä¸æ¨è"><a href="#4-Rv-åˆ©ç”¨payloadså®ç°éƒ¨åˆ†ç»‘å®š-ä¸æ¨è" class="headerlink" title="4 Rv åˆ©ç”¨payloadså®ç°éƒ¨åˆ†ç»‘å®š(ä¸æ¨è):"></a>4 Rv åˆ©ç”¨payloadså®ç°éƒ¨åˆ†ç»‘å®š(ä¸æ¨è):</h3><p>æœ¬æ–¹æ¡ˆå±äºå¼€æ‹“æ€ç»´ï¼Œæ˜¯åœ¨æ–¹æ¡ˆ2çš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨payloadså’ŒnotifyItemChanged(int position, Object payload)æäº‹æƒ…ã€‚
ä¸çŸ¥é“payloadsæ˜¯ä»€ä¹ˆçš„ï¼Œçœ‹ä¸æ‡‚æ­¤æ–¹æ¡ˆçš„ï¼Œæˆ‘åˆè¦å®‰åˆ©ï¼šï¼ˆæˆ³-&gt;ï¼šã€Androidã€‘è¯¦è§£7.0å¸¦æ¥çš„æ–°å·¥å…·ç±»ï¼šDiffUtilï¼‰
onClickä»£ç å¦‚ä¸‹ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//å®ç°å•é€‰æ–¹æ³•å››ï¼š</div><div class="line">if (mSelectedPos != position) &#123;</div><div class="line">    //å…ˆå–æ¶ˆä¸Šä¸ªitemçš„å‹¾é€‰çŠ¶æ€</div><div class="line">    mDatas.get(mSelectedPos).setSelected(false);</div><div class="line">    //ä¼ é€’ä¸€ä¸ªpayload</div><div class="line">    Bundle payloadOld = new Bundle();</div><div class="line">    payloadOld.putBoolean(&quot;KEY_BOOLEAN&quot;, false);</div><div class="line">    notifyItemChanged(mSelectedPos, payloadOld);</div><div class="line">    //è®¾ç½®æ–°Itemçš„å‹¾é€‰çŠ¶æ€</div><div class="line">    mSelectedPos = position;</div><div class="line">    mDatas.get(mSelectedPos).setSelected(true);</div><div class="line">    Bundle payloadNew = new Bundle();</div><div class="line">    payloadNew.putBoolean(&quot;KEY_BOOLEAN&quot;, true);</div><div class="line">    notifyItemChanged(mSelectedPos, payloadNew);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>éœ€è¦é‡å†™ä¸‰å‚æ•°çš„onBindViewHolder() æ–¹æ³•ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void onBindViewHolder(CouponVH holder, int position, List&lt;Object&gt; payloads) &#123;</div><div class="line">    if (payloads.isEmpty()) &#123;</div><div class="line">        onBindViewHolder(holder, position);</div><div class="line">    &#125; else &#123;</div><div class="line">        Bundle payload = (Bundle) payloads.get(0);</div><div class="line">        if (payload.containsKey(&quot;KEY_BOOLEAN&quot;)) &#123;</div><div class="line">            boolean aBoolean = payload.getBoolean(&quot;KEY_BOOLEAN&quot;);</div><div class="line">            holder.ivSelect.setSelected(aBoolean);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><p>æ–¹æ¡ˆä¼˜ç‚¹ï¼š
åŒæ–¹æ³•3</p>
</li>
<li><p>æ–¹æ¡ˆç¼ºç‚¹ï¼š
ä»£ç é‡å¤šï¼Œå®ç°æ•ˆæœå’Œæ–¹æ³•ä¸‰ä¸€æ ·ï¼Œä»…åšå¼€æ‹“æ€ç»´ç”¨ï¼Œæ‰€ä»¥é€‰æ‹©æ–¹æ³•ä¸‰ã€‚</p>
</li>
</ul>
<p>ä½œè€…ï¼šå¼ æ—­ç«¥
é“¾æ¥ï¼š<a href="http://www.jianshu.com/p/1ac13f74da63" target="_blank" rel="external">http://www.jianshu.com/p/1ac13f74da63</a>
ä¾†æºï¼šç®€ä¹¦</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¸¸è§„æ–¹æ³•ï¼š
åœ¨Javabeané‡Œå¢åŠ ä¸€ä¸ªboolean isSelectedå­—æ®µï¼Œ
å¹¶åœ¨Adapteré‡Œæ ¹æ®è¿™ä¸ªå­—æ®µçš„å€¼è®¾ç½®â€œCheckBoxâ€çš„é€‰ä¸­çŠ¶æ€ã€‚
åœ¨æ¯æ¬¡é€‰ä¸­ä¸€ä¸ªæ–°ä¼˜æƒ åˆ¸æ—¶ï¼Œæ”¹å˜æ•°æ®æºé‡Œçš„isSelectedå­—æ®µï¼Œ
å¹¶notifyDataSetChanged()åˆ·
    
    </summary>
    
      <category term="Android" scheme="http://wodekouwei.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://wodekouwei.com/tags/Android/"/>
    
      <category term="tips" scheme="http://wodekouwei.com/tags/tips/"/>
    
  </entry>
  
  <entry>
    <title>Android Activityä»»åŠ¡å’Œè¿”å›æ ˆ</title>
    <link href="http://wodekouwei.com/2017/08/24/tips-activity-stack/"/>
    <id>http://wodekouwei.com/2017/08/24/tips-activity-stack/</id>
    <published>2017-08-23T16:31:17.000Z</published>
    <updated>2017-08-23T16:50:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>é—®é¢˜:<a href="http://blog.csdn.net/love100628/article/details/43238135" target="_blank" rel="external">å®ä¾‹åŒ–launcher activity</a>
è¿™ä¸ªé—®é¢˜è¡¨ç°:</p>
<ol>
<li><p>åœ¨package installers å®‰è£…ç•Œé¢å®‰è£…å®Œä¸€ä¸ªåº”ç”¨åï¼Œç›´æ¥æ‰“å¼€appï¼Œç„¶åè¿›å…¥äº† Activity_1, æ­¤æ—¶å†é€šè¿‡æ­¤activityç”¨startActivity(intent)çš„æ–¹æ³•æ‰“å¼€ Activity_2.</p>
</li>
<li><p>ç„¶åæŒ‰homeé”®è¿”å›æ¡Œé¢ï¼Œåœ¨æ¡Œé¢ç‚¹å‡»appå›¾æ ‡è¿›å…¥ï¼Œä½ è§‰å¾—åº”è¯¥è¿›å…¥çš„æ˜¯ Activity_2 ï¼Œå®é™…ä¸Šå´æ˜¯launcher Activity_1 .</p>
</li>
<li><p>ç„¶è€Œè¿˜æ²¡å®Œï¼Œè¿™æ—¶å€™ä½ æŒ‰ back è¿”å›é”®ï¼Œä¼šå‘ç°è¿”å›åˆ°äº†ä¹‹å‰æ‰“å¼€çš„ Activity_2ï¼Œå†æŒ‰è¿”å›ï¼Œåˆå‡ºç° launcherActivity_1. ä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿé‡å¤å®ä¾‹åŒ–äº†Activity_1.</p>
</li>
<li><p>é€€å‡ºappåå†æ¬¡ç‚¹å‡»æ¡Œé¢å›¾æ ‡è¿›å…¥ï¼Œåå¤è¯•éªŒï¼Œæ²¡æœ‰å†å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªé—®é¢˜ï¼ˆbug ï¼Ÿï¼‰åªå‡ºç°åœ¨æ“ä½œæ­¥éª¤ï¼ˆ1ï¼‰åæ‰ä¼šäº§ç”Ÿ.</p>
</li>
</ol>
<p>ä»¥ä¸Šé—®é¢˜æˆ‘åœ¨ä¸€äº›çŸ¥åå‚å•†çš„app ä¸Šå‘ç°ä¹Ÿå­˜åœ¨è¿™ä¸ªBUG ï¼š</p>
<p>ç™¾åº¦äº‘</p>
<p>é™Œé™Œ</p>
<p>å»å“ªå„¿æ—…è¡Œ</p>
<p>â€¦QQæ²¡æœ‰å‡ºç°è¿™ä¸ªé—®é¢˜</p>
<p>å¦å¤–ï¼Œå¦‚æœä»¥rootæ–¹å¼é™é»˜å®‰è£…çš„è¯ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œåœ¨eclipseé‡Œç›´æ¥å‘å¸ƒåˆ°æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œä¹Ÿæ²¡æœ‰å‡ºç°è¿™ä¸ªé—®é¢˜</p>
<p>è§£å†³æ–¹æ¡ˆ:
åœ¨super.onCreate(â€¦)æ–¹æ³•ä¹‹åæ’å…¥ä»£ç ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">if(!this.isTaskRoot()) &#123; //åˆ¤æ–­è¯¥Activityæ˜¯ä¸æ˜¯ä»»åŠ¡ç©ºé—´çš„æºActivityï¼Œâ€œéâ€ä¹Ÿå°±æ˜¯è¯´æ˜¯è¢«ç³»ç»Ÿé‡æ–°å®ä¾‹åŒ–å‡ºæ¥  </div><div class="line">//å¦‚æœä½ å°±æ”¾åœ¨launcher Activityä¸­è¯ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥returnäº†  </div><div class="line">        Intent mainIntent=getIntent();   </div><div class="line">String action=mainIntent.getAction();  </div><div class="line">if(mainIntent.hasCategory(Intent.CATEGORY_LAUNCHER) &amp;&amp; action.equals(Intent.ACTION_MAIN)) &#123;  </div><div class="line">finish();  </div><div class="line">return;//finish()ä¹‹åè¯¥æ´»åŠ¨ä¼šç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ï¼Œä½ å¯ä»¥logCatéªŒè¯ï¼ŒåŠ returné¿å…å¯èƒ½çš„exception  </div><div class="line">&#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>æ¥æºgoogle ï¼š
<a href="https://code.google.com/p/android/issues/detail?id=14262" target="_blank" rel="external">https://code.google.com/p/android/issues/detail?id=14262</a></p>
<p><a href="https://code.google.com/p/android/issues/detail?id=2373#c40" target="_blank" rel="external">https://code.google.com/p/android/issues/detail?id=2373#c40</a></p>
<p>è¿˜æœ‰å¦ä¸€ç§æ–¹æ¡ˆï¼š</p>
<p><a href="http://stackoverflow.com/questions/3042420/home-key-press-behaviour/4782423#4782423" target="_blank" rel="external">http://stackoverflow.com/questions/3042420/home-key-press-behaviour/4782423#4782423</a></p>
<p><a href="https://developer.android.com/guide/components/tasks-and-back-stack.html" target="_blank" rel="external">ä»¥ä¸‹å¼•ç”¨è‡ªgoogleå®˜æ–¹æ–‡æ¡£</a></p>
<p>åº”ç”¨é€šå¸¸åŒ…å«å¤šä¸ª Activityã€‚æ¯ä¸ª Activity å‡åº”å›´ç»•ç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„ç‰¹å®šæ“ä½œè®¾è®¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯åŠ¨å…¶ä»– Activityã€‚ ä¾‹å¦‚ï¼Œç”µå­é‚®ä»¶åº”ç”¨å¯èƒ½æœ‰ä¸€ä¸ª Activity æ˜¾ç¤ºæ–°é‚®ä»¶çš„åˆ—è¡¨ã€‚ç”¨æˆ·é€‰æ‹©æŸé‚®ä»¶æ—¶ï¼Œä¼šæ‰“å¼€ä¸€ä¸ªæ–° Activity ä»¥æŸ¥çœ‹è¯¥é‚®ä»¶ã€‚</p>
<p>ä¸€ä¸ª Activity ç”šè‡³å¯ä»¥å¯åŠ¨è®¾å¤‡ä¸Šå…¶ä»–åº”ç”¨ä¸­å­˜åœ¨çš„ Activityã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨æƒ³è¦å‘é€ç”µå­é‚®ä»¶ï¼Œåˆ™å¯å°† Intent å®šä¹‰ä¸ºæ‰§è¡Œâ€œå‘é€â€æ“ä½œå¹¶åŠ å…¥ä¸€äº›æ•°æ®ï¼Œå¦‚ç”µå­é‚®ä»¶åœ°å€å’Œç”µå­é‚®ä»¶ã€‚ ç„¶åï¼Œç³»ç»Ÿå°†æ‰“å¼€å…¶ä»–åº”ç”¨ä¸­å£°æ˜è‡ªå·±å¤„ç†æ­¤ç±» Intent çš„ Activityã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒIntent æ˜¯è¦å‘é€ç”µå­é‚®ä»¶ï¼Œå› æ­¤å°†å¯åŠ¨ç”µå­é‚®ä»¶åº”ç”¨çš„â€œæ’°å†™â€Activityï¼ˆå¦‚æœå¤šä¸ª Activity æ”¯æŒç›¸åŒ Intentï¼Œåˆ™ç³»ç»Ÿä¼šè®©ç”¨æˆ·é€‰æ‹©è¦ä½¿ç”¨çš„ Activityï¼‰ã€‚å‘é€ç”µå­é‚®ä»¶æ—¶ï¼ŒActivity å°†æ¢å¤ï¼Œçœ‹èµ·æ¥å¥½åƒç”µå­é‚®ä»¶ Activity æ˜¯æ‚¨çš„åº”ç”¨çš„ä¸€éƒ¨åˆ†ã€‚ å³ä½¿è¿™ä¸¤ä¸ª Activity å¯èƒ½æ¥è‡ªä¸åŒçš„åº”ç”¨ï¼Œä½†æ˜¯ Android ä»ä¼šå°† Activity ä¿ç•™åœ¨ç›¸åŒçš„ä»»åŠ¡ä¸­ï¼Œä»¥ç»´æŠ¤è¿™ç§æ— ç¼çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>ä»»åŠ¡æ˜¯æŒ‡åœ¨æ‰§è¡Œç‰¹å®šä½œä¸šæ—¶ä¸ç”¨æˆ·äº¤äº’çš„ä¸€ç³»åˆ— Activityã€‚ è¿™äº› Activity æŒ‰ç…§å„è‡ªçš„æ‰“å¼€é¡ºåºæ’åˆ—åœ¨å †æ ˆï¼ˆå³è¿”å›æ ˆï¼‰ä¸­ã€‚</p>
<p>è®¾å¤‡ä¸»å±å¹•æ˜¯å¤§å¤šæ•°ä»»åŠ¡çš„èµ·ç‚¹ã€‚å½“ç”¨æˆ·è§¦æ‘¸åº”ç”¨å¯åŠ¨å™¨ä¸­çš„å›¾æ ‡ï¼ˆæˆ–ä¸»å±å¹•ä¸Šçš„å¿«æ·æ–¹å¼ï¼‰æ—¶ï¼Œè¯¥åº”ç”¨çš„ä»»åŠ¡å°†å‡ºç°åœ¨å‰å°ã€‚ å¦‚æœåº”ç”¨ä¸å­˜åœ¨ä»»åŠ¡ï¼ˆåº”ç”¨æœ€è¿‘æœªæ›¾ä½¿ç”¨ï¼‰ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œå¹¶ä¸”è¯¥åº”ç”¨çš„â€œä¸»â€Activity å°†ä½œä¸ºå †æ ˆä¸­çš„æ ¹ Activity æ‰“å¼€ã€‚</p>
<p>å½“å‰ Activity å¯åŠ¨å¦ä¸€ä¸ª Activity æ—¶ï¼Œè¯¥æ–° Activity ä¼šè¢«æ¨é€åˆ°å †æ ˆé¡¶éƒ¨ï¼Œæˆä¸ºç„¦ç‚¹æ‰€åœ¨ã€‚ å‰ä¸€ä¸ª Activity ä»ä¿ç•™åœ¨å †æ ˆä¸­ï¼Œä½†æ˜¯å¤„äºåœæ­¢çŠ¶æ€ã€‚Activity åœæ­¢æ—¶ï¼Œç³»ç»Ÿä¼šä¿æŒå…¶ç”¨æˆ·ç•Œé¢çš„å½“å‰çŠ¶æ€ã€‚ ç”¨æˆ·æŒ‰â€œè¿”å›â€æŒ‰é’®æ—¶ï¼Œå½“å‰ Activity ä¼šä»å †æ ˆé¡¶éƒ¨å¼¹å‡ºï¼ˆActivity è¢«é”€æ¯ï¼‰ï¼Œè€Œå‰ä¸€ä¸ª Activity æ¢å¤æ‰§è¡Œï¼ˆæ¢å¤å…¶ UI çš„å‰ä¸€çŠ¶æ€ï¼‰ã€‚ å †æ ˆä¸­çš„ Activity æ°¸è¿œä¸ä¼šé‡æ–°æ’åˆ—ï¼Œä»…æ¨å…¥å’Œå¼¹å‡ºå †æ ˆï¼šç”±å½“å‰ Activity å¯åŠ¨æ—¶æ¨å…¥å †æ ˆï¼›ç”¨æˆ·ä½¿ç”¨â€œè¿”å›â€æŒ‰é’®é€€å‡ºæ—¶å¼¹å‡ºå †æ ˆã€‚ å› æ­¤ï¼Œè¿”å›æ ˆä»¥â€œåè¿›å…ˆå‡ºâ€å¯¹è±¡ç»“æ„è¿è¡Œã€‚ å›¾ 1 é€šè¿‡æ—¶é—´çº¿æ˜¾ç¤º Activity ä¹‹é—´çš„è¿›åº¦ä»¥åŠæ¯ä¸ªæ—¶é—´ç‚¹çš„å½“å‰è¿”å›æ ˆï¼Œç›´è§‚å‘ˆç°äº†è¿™ç§è¡Œä¸ºã€‚
<img src="https://developer.android.com/images/fundamentals/diagram_backstack.png" alt="image">
å›¾ 1. æ˜¾ç¤ºä»»åŠ¡ä¸­çš„æ¯ä¸ªæ–° Activity å¦‚ä½•å‘è¿”å›æ ˆæ·»åŠ é¡¹ç›®ã€‚ ç”¨æˆ·æŒ‰â€œè¿”å›â€æŒ‰é’®æ—¶ï¼Œå½“å‰ Activity éšå³è¢«é”€æ¯ï¼Œè€Œå‰ä¸€ä¸ª Activity æ¢å¤æ‰§è¡Œã€‚</p>
<p>å¦‚æœç”¨æˆ·ç»§ç»­æŒ‰â€œè¿”å›â€ï¼Œå †æ ˆä¸­çš„ç›¸åº” Activity å°±ä¼šå¼¹å‡ºï¼Œä»¥æ˜¾ç¤ºå‰ä¸€ä¸ª Activityï¼Œç›´åˆ°ç”¨æˆ·è¿”å›ä¸»å±å¹•ä¸ºæ­¢ï¼ˆæˆ–è€…ï¼Œè¿”å›ä»»åŠ¡å¼€å§‹æ—¶æ­£åœ¨è¿è¡Œçš„ä»»æ„ Activityï¼‰ã€‚ å½“æ‰€æœ‰ Activity å‡ä»å †æ ˆä¸­ç§»é™¤åï¼Œä»»åŠ¡å³ä¸å¤å­˜åœ¨ã€‚</p>
<p>ä»»åŠ¡æ˜¯ä¸€ä¸ªæœ‰æœºæ•´ä½“ï¼Œå½“ç”¨æˆ·å¼€å§‹æ–°ä»»åŠ¡æˆ–é€šè¿‡â€œä¸»é¡µâ€æŒ‰é’®è½¬åˆ°ä¸»å±å¹•æ—¶ï¼Œå¯ä»¥ç§»åŠ¨åˆ°â€œåå°â€ã€‚ å°½ç®¡åœ¨åå°æ—¶ï¼Œè¯¥ä»»åŠ¡ä¸­çš„æ‰€æœ‰ Activity å…¨éƒ¨åœæ­¢ï¼Œä½†æ˜¯ä»»åŠ¡çš„è¿”å›æ ˆä»æ—§ä¸å˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å¦ä¸€ä¸ªä»»åŠ¡å‘ç”Ÿæ—¶ï¼Œè¯¥ä»»åŠ¡ä»…ä»…å¤±å»ç„¦ç‚¹è€Œå·²ï¼Œå¦‚å›¾ 2 ä¸­æ‰€ç¤ºã€‚ç„¶åï¼Œä»»åŠ¡å¯ä»¥è¿”å›åˆ°â€œå‰å°â€ï¼Œç”¨æˆ·å°±èƒ½å¤Ÿå›åˆ°ç¦»å¼€æ—¶çš„çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾å½“å‰ä»»åŠ¡ï¼ˆä»»åŠ¡ Aï¼‰çš„å †æ ˆä¸­æœ‰ä¸‰ä¸ª Activityï¼Œå³å½“å‰ Activity ä¸‹æ–¹è¿˜æœ‰ä¸¤ä¸ª Activityã€‚ ç”¨æˆ·å…ˆæŒ‰â€œä¸»é¡µâ€æŒ‰é’®ï¼Œç„¶åä»åº”ç”¨å¯åŠ¨å™¨å¯åŠ¨æ–°åº”ç”¨ã€‚ æ˜¾ç¤ºä¸»å±å¹•æ—¶ï¼Œä»»åŠ¡ A è¿›å…¥åå°ã€‚æ–°åº”ç”¨å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šä½¿ç”¨è‡ªå·±çš„ Activity å †æ ˆä¸ºè¯¥åº”ç”¨å¯åŠ¨ä¸€ä¸ªä»»åŠ¡ï¼ˆä»»åŠ¡ Bï¼‰ã€‚ä¸è¯¥åº”ç”¨äº¤äº’ä¹‹åï¼Œç”¨æˆ·å†æ¬¡è¿”å›ä¸»å±å¹•å¹¶é€‰æ‹©æœ€åˆå¯åŠ¨ä»»åŠ¡ A çš„åº”ç”¨ã€‚ç°åœ¨ï¼Œä»»åŠ¡ A å‡ºç°åœ¨å‰å°ï¼Œå…¶å †æ ˆä¸­çš„æ‰€æœ‰ä¸‰ä¸ª Activity ä¿æŒä¸å˜ï¼Œè€Œä½äºå †æ ˆé¡¶éƒ¨çš„ Activity åˆ™ä¼šæ¢å¤æ‰§è¡Œã€‚ æ­¤æ—¶ï¼Œç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡è½¬åˆ°ä¸»å±å¹•å¹¶é€‰æ‹©å¯åŠ¨è¯¥ä»»åŠ¡çš„åº”ç”¨å›¾æ ‡ï¼ˆæˆ–è€…ï¼Œé€šè¿‡ä»æ¦‚è§ˆå±å¹•é€‰æ‹©è¯¥åº”ç”¨çš„ä»»åŠ¡ï¼‰åˆ‡æ¢å›ä»»åŠ¡ Bã€‚è¿™æ˜¯ Android ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå¤šä»»åŠ¡ç¤ºä¾‹ã€‚
<img src="https://developer.android.com/images/fundamentals/diagram_multitasking.png" alt="image">
å›¾ 2. ä¸¤ä¸ªä»»åŠ¡ï¼šä»»åŠ¡ B åœ¨å‰å°æ¥æ”¶ç”¨æˆ·äº¤äº’ï¼Œè€Œä»»åŠ¡ A åˆ™åœ¨åå°ç­‰å¾…æ¢å¤ã€‚</p>
<blockquote>
<p>æ³¨ï¼šåå°å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·åŒæ—¶è¿è¡Œå¤šä¸ªåå°ä»»åŠ¡ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¼šå¼€å§‹é”€æ¯åå° Activityï¼Œä»¥å›æ”¶å†…å­˜èµ„æºï¼Œä»è€Œå¯¼è‡´ Activity çŠ¶æ€ä¸¢å¤±ã€‚è¯·å‚é˜…ä¸‹é¢æœ‰å…³ Activity çŠ¶æ€çš„éƒ¨åˆ†ã€‚</p>
</blockquote>
<p>ç”±äºè¿”å›æ ˆä¸­çš„ Activity æ°¸è¿œä¸ä¼šé‡æ–°æ’åˆ—ï¼Œå› æ­¤å¦‚æœåº”ç”¨å…è®¸ç”¨æˆ·ä»å¤šä¸ª Activity ä¸­å¯åŠ¨ç‰¹å®š Activityï¼Œåˆ™ä¼šåˆ›å»ºè¯¥ Activity çš„æ–°å®ä¾‹å¹¶æ¨å…¥å †æ ˆä¸­ï¼ˆè€Œä¸æ˜¯å°† Activity çš„ä»»ä¸€å…ˆå‰å®ä¾‹ç½®äºé¡¶éƒ¨ï¼‰ã€‚ å› æ­¤ï¼Œåº”ç”¨ä¸­çš„ä¸€ä¸ª Activity å¯èƒ½ä¼šå¤šæ¬¡å®ä¾‹åŒ–ï¼ˆå³ä½¿ Activity æ¥è‡ªä¸åŒçš„ä»»åŠ¡ï¼‰ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚å› æ­¤ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨â€œè¿”å›â€æŒ‰é’®å‘åå¯¼èˆªï¼Œåˆ™ä¼šæŒ‰ Activity æ¯ä¸ªå®ä¾‹çš„æ‰“å¼€é¡ºåºæ˜¾ç¤ºè¿™äº›å®ä¾‹ï¼ˆæ¯ä¸ªå®ä¾‹çš„ UI çŠ¶æ€å„ä¸ç›¸åŒï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸å¸Œæœ› Activity å¤šæ¬¡å®ä¾‹åŒ–ï¼Œåˆ™å¯ä¿®æ”¹æ­¤è¡Œä¸ºã€‚ å…·ä½“æ“ä½œæ–¹æ³•å°†åœ¨åé¢çš„ç®¡ç†ä»»åŠ¡éƒ¨åˆ†ä¸­è®¨è®ºã€‚
<img src="https://developer.android.com/images/fundamentals/diagram_multiple_instances.png" alt="image">
å›¾ 3. ä¸€ä¸ª Activity å°†å¤šæ¬¡å®ä¾‹åŒ–ã€‚</p>
<p>Activity å’Œä»»åŠ¡çš„é»˜è®¤è¡Œä¸ºæ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li>å½“ Activity A å¯åŠ¨ Activity B æ—¶ï¼ŒActivity A å°†ä¼šåœæ­¢ï¼Œä½†ç³»ç»Ÿä¼šä¿ç•™å…¶çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œæ»šåŠ¨ä½ç½®å’Œå·²è¾“å…¥è¡¨å•ä¸­çš„æ–‡æœ¬ï¼‰ã€‚å¦‚æœç”¨æˆ·åœ¨å¤„äº Activity B æ—¶æŒ‰â€œè¿”å›â€æŒ‰é’®ï¼Œåˆ™ Activity A å°†æ¢å¤å…¶çŠ¶æ€ï¼Œç»§ç»­æ‰§è¡Œã€‚</li>
<li>ç”¨æˆ·é€šè¿‡æŒ‰â€œä¸»é¡µâ€æŒ‰é’®ç¦»å¼€ä»»åŠ¡æ—¶ï¼Œå½“å‰ Activity å°†åœæ­¢ä¸”å…¶ä»»åŠ¡ä¼šè¿›å…¥åå°ã€‚ ç³»ç»Ÿå°†ä¿ç•™ä»»åŠ¡ä¸­æ¯ä¸ª Activity çš„çŠ¶æ€ã€‚å¦‚æœç”¨æˆ·ç¨åé€šè¿‡é€‰æ‹©å¼€å§‹ä»»åŠ¡çš„å¯åŠ¨å™¨å›¾æ ‡æ¥æ¢å¤ä»»åŠ¡ï¼Œåˆ™ä»»åŠ¡å°†å‡ºç°åœ¨å‰å°å¹¶æ¢å¤æ‰§è¡Œå †æ ˆé¡¶éƒ¨çš„ Activityã€‚</li>
<li>å¦‚æœç”¨æˆ·æŒ‰â€œè¿”å›â€æŒ‰é’®ï¼Œåˆ™å½“å‰ Activity ä¼šä»å †æ ˆå¼¹å‡ºå¹¶è¢«é”€æ¯ã€‚ å †æ ˆä¸­çš„å‰ä¸€ä¸ª Activity æ¢å¤æ‰§è¡Œã€‚é”€æ¯ Activity æ—¶ï¼Œç³»ç»Ÿä¸ä¼šä¿ç•™è¯¥ Activity çš„çŠ¶æ€ã€‚</li>
<li>å³ä½¿æ¥è‡ªå…¶ä»–ä»»åŠ¡ï¼ŒActivity ä¹Ÿå¯ä»¥å¤šæ¬¡å®ä¾‹åŒ–ã€‚</li>
</ul>
<h3 id="ä¿å­˜-Activity-çŠ¶æ€"><a href="#ä¿å­˜-Activity-çŠ¶æ€" class="headerlink" title="ä¿å­˜ Activity çŠ¶æ€"></a>ä¿å­˜ Activity çŠ¶æ€</h3><p>æ­£å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå½“ Activity åœæ­¢æ—¶ï¼Œç³»ç»Ÿçš„é»˜è®¤è¡Œä¸ºä¼šä¿ç•™å…¶çŠ¶æ€ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå½“ç”¨æˆ·å¯¼èˆªå›åˆ°ä¸Šä¸€ä¸ª Activity æ—¶ï¼Œå…¶ç”¨æˆ·ç•Œé¢ä¸ç”¨æˆ·ç¦»å¼€æ—¶ä¸€æ ·ã€‚ ä½†æ˜¯ï¼Œåœ¨ Activity è¢«é”€æ¯ä¸”å¿…é¡»é‡å»ºæ—¶ï¼Œæ‚¨å¯ä»¥è€Œä¸”åº”å½“ä¸»åŠ¨ä½¿ç”¨å›è°ƒæ–¹æ³•ä¿ç•™ Activity çš„çŠ¶æ€ã€‚</p>
<p>ç³»ç»Ÿåœæ­¢æ‚¨çš„ä¸€ä¸ª Activity æ—¶ï¼ˆä¾‹å¦‚ï¼Œæ–° Activity å¯åŠ¨æˆ–ä»»åŠ¡è½¬åˆ°å‰å°ï¼‰ï¼Œå¦‚æœç³»ç»Ÿéœ€è¦å›æ”¶ç³»ç»Ÿå†…å­˜èµ„æºï¼Œåˆ™å¯èƒ½ä¼šå®Œå…¨é”€æ¯è¯¥ Activityã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæœ‰å…³è¯¥ Activity çŠ¶æ€çš„ä¿¡æ¯å°†ä¼šä¸¢å¤±ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œç³»ç»Ÿä»ä¼šçŸ¥é“è¯¥ Activity å­˜åœ¨äºè¿”å›æ ˆä¸­ï¼Œä½†æ˜¯å½“è¯¥ Activity è¢«ç½®äºå †æ ˆé¡¶éƒ¨æ—¶ï¼Œç³»ç»Ÿä¸€å®šä¼šé‡å»º Activityï¼ˆè€Œä¸æ˜¯æ¢å¤ Activityï¼‰ã€‚ ä¸ºäº†é¿å…ç”¨æˆ·çš„å·¥ä½œä¸¢å¤±ï¼Œæ‚¨åº”ä¸»åŠ¨é€šè¿‡åœ¨ Activity ä¸­å®ç° onSaveInstanceState() å›è°ƒæ–¹æ³•æ¥ä¿ç•™å·¥ä½œã€‚</p>
<p>å¦‚éœ€äº†è§£æœ‰å…³å¦‚ä½•ä¿å­˜ Activity çŠ¶æ€çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Activity æ–‡æ¡£ã€‚</p>
<h3 id="ç®¡ç†ä»»åŠ¡"><a href="#ç®¡ç†ä»»åŠ¡" class="headerlink" title="ç®¡ç†ä»»åŠ¡"></a>ç®¡ç†ä»»åŠ¡</h3><p>Android ç®¡ç†ä»»åŠ¡å’Œè¿”å›æ ˆçš„æ–¹å¼ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œå³ï¼šå°†æ‰€æœ‰è¿ç»­å¯åŠ¨çš„ Activity æ”¾å…¥åŒä¸€ä»»åŠ¡å’Œâ€œåè¿›å…ˆå‡ºâ€å †æ ˆä¸­ï¼‰éå¸¸é€‚ç”¨äºå¤§å¤šæ•°åº”ç”¨ï¼Œè€Œæ‚¨ä¸å¿…æ‹…å¿ƒ Activity å¦‚ä½•ä¸ä»»åŠ¡å…³è”æˆ–è€…å¦‚ä½•å­˜åœ¨äºè¿”å›æ ˆä¸­ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯èƒ½ä¼šå†³å®šè¦ä¸­æ–­æ­£å¸¸è¡Œä¸ºã€‚ ä¹Ÿè®¸æ‚¨å¸Œæœ›åº”ç”¨ä¸­çš„ Activity åœ¨å¯åŠ¨æ—¶å¼€å§‹æ–°ä»»åŠ¡ï¼ˆè€Œä¸æ˜¯æ”¾ç½®åœ¨å½“å‰ä»»åŠ¡ä¸­ï¼‰ï¼›æˆ–è€…ï¼Œå½“å¯åŠ¨ Activity æ—¶ï¼Œæ‚¨å¸Œæœ›å°†å…¶ç°æœ‰å®ä¾‹ä¸Šç§»ä¸€å±‚ï¼ˆè€Œä¸æ˜¯åœ¨è¿”å›æ ˆçš„é¡¶éƒ¨åˆ›å»ºæ–°å®ä¾‹ï¼‰ï¼›æˆ–è€…ï¼Œæ‚¨å¸Œæœ›åœ¨ç”¨æˆ·ç¦»å¼€ä»»åŠ¡æ—¶ï¼Œæ¸…é™¤è¿”å›æ ˆä¸­é™¤æ ¹ Activity ä»¥å¤–çš„æ‰€æœ‰å…¶ä»– Activityã€‚</p>
<p>é€šè¿‡ä½¿ç”¨ <activity> æ¸…å•æ–‡ä»¶å…ƒç´ ä¸­çš„å±æ€§å’Œä¼ é€’ç»™ startActivity() çš„ Intent ä¸­çš„æ ‡å¿—ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œæ‰€æœ‰è¿™äº›æ“ä½œä»¥åŠå…¶ä»–æ“ä½œã€‚</activity></p>
<p>åœ¨è¿™ä¸€æ–¹é¢ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨çš„ä¸»è¦ <activity> å±æ€§åŒ…æ‹¬ï¼š</activity></p>
<ul>
<li>taskAffinity</li>
<li>launchMode</li>
<li>allowTaskReparenting</li>
<li>clearTaskOnLaunch</li>
<li>alwaysRetainTaskState</li>
<li>finishOnTaskLaunch</li>
</ul>
<p>æ‚¨å¯ä»¥ä½¿ç”¨çš„ä¸»è¦ Intent æ ‡å¿—åŒ…æ‹¬ï¼š</p>
<ul>
<li>FLAG_ACTIVITY_NEW_TASK</li>
<li>FLAG_ACTIVITY_CLEAR_TOP</li>
<li>FLAG_ACTIVITY_SINGLE_TOP</li>
</ul>
<p>åœ¨ä¸‹æ–‡ä¸­ï¼Œæ‚¨å°†äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›æ¸…å•æ–‡ä»¶å±æ€§å’Œ Intent æ ‡å¿—å®šä¹‰ Activity ä¸ä»»åŠ¡çš„å…³è”æ–¹å¼ï¼Œä»¥åŠ Activity åœ¨è¿”å›æ ˆä¸­çš„è¡Œä¸ºæ–¹å¼ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å•ç‹¬ä»‹ç»äº†æœ‰å…³å¦‚ä½•åœ¨æ¦‚è§ˆå±å¹•ä¸­æ˜¾ç¤ºå’Œç®¡ç†ä»»åŠ¡ä¸ Activity çš„æ³¨æ„äº‹é¡¹ã€‚ å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ¦‚è§ˆå±å¹•ã€‚ é€šå¸¸ï¼Œæ‚¨åº”è¯¥å…è®¸ç³»ç»Ÿå®šä¹‰ä»»åŠ¡å’Œ Activity åœ¨æ¦‚è§ˆå±å¹•ä¸­çš„æ˜¾ç¤ºæ–¹æ³•ï¼Œå¹¶ä¸”æ— éœ€ä¿®æ”¹æ­¤è¡Œä¸ºã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¤§å¤šæ•°åº”ç”¨éƒ½ä¸å¾—ä¸­æ–­ Activity å’Œä»»åŠ¡çš„é»˜è®¤è¡Œä¸ºï¼š å¦‚æœç¡®å®šæ‚¨çš„ Activity å¿…é¡»ä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œå½“ä½¿ç”¨â€œè¿”å›â€æŒ‰é’®ä»å…¶ä»– Activity å’Œä»»åŠ¡å¯¼èˆªå›åˆ°è¯¥ Activity æ—¶ï¼Œè¯·åŠ¡å¿…è¦è°¨æ…å¹¶ç¡®ä¿åœ¨å¯åŠ¨æœŸé—´æµ‹è¯•è¯¥ Activity çš„å¯ç”¨æ€§ã€‚è¯·ç¡®ä¿æµ‹è¯•å¯¼èˆªè¡Œä¸ºæ˜¯å¦æœ‰å¯èƒ½ä¸ç”¨æˆ·çš„é¢„æœŸè¡Œä¸ºå†²çªã€‚</p>
</blockquote>
<h3 id="å®šä¹‰å¯åŠ¨æ¨¡å¼"><a href="#å®šä¹‰å¯åŠ¨æ¨¡å¼" class="headerlink" title="å®šä¹‰å¯åŠ¨æ¨¡å¼"></a>å®šä¹‰å¯åŠ¨æ¨¡å¼</h3><p>å¯åŠ¨æ¨¡å¼å…è®¸æ‚¨å®šä¹‰ Activity çš„æ–°å®ä¾‹å¦‚ä½•ä¸å½“å‰ä»»åŠ¡å…³è”ã€‚ æ‚¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹æ³•å®šä¹‰ä¸åŒçš„å¯åŠ¨æ¨¡å¼ï¼š</p>
<ol>
<li>ä½¿ç”¨æ¸…å•æ–‡ä»¶
åœ¨æ¸…å•æ–‡ä»¶ä¸­å£°æ˜ Activity æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡å®š Activity åœ¨å¯åŠ¨æ—¶åº”è¯¥å¦‚ä½•ä¸ä»»åŠ¡å…³è”ã€‚</li>
<li>ä½¿ç”¨ Intent æ ‡å¿—
è°ƒç”¨ startActivity() æ—¶ï¼Œå¯ä»¥åœ¨ Intent ä¸­åŠ å…¥ä¸€ä¸ªæ ‡å¿—ï¼Œç”¨äºå£°æ˜æ–° Activity å¦‚ä½•ï¼ˆæˆ–æ˜¯å¦ï¼‰ä¸å½“å‰ä»»åŠ¡å…³è”ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œå¦‚æœ Activity A å¯åŠ¨ Activity Bï¼Œåˆ™ Activity B å¯ä»¥åœ¨å…¶æ¸…å•æ–‡ä»¶ä¸­å®šä¹‰å®ƒåº”è¯¥å¦‚ä½•ä¸å½“å‰ä»»åŠ¡å…³è”ï¼ˆå¦‚æœå¯èƒ½ï¼‰ï¼Œå¹¶ä¸” Activity A è¿˜å¯ä»¥è¯·æ±‚ Activity B åº”è¯¥å¦‚ä½•ä¸å½“å‰ä»»åŠ¡å…³è”ã€‚å¦‚æœè¿™ä¸¤ä¸ª Activity å‡å®šä¹‰ Activity B åº”è¯¥å¦‚ä½•ä¸ä»»åŠ¡å…³è”ï¼Œåˆ™ Activity A çš„è¯·æ±‚ï¼ˆå¦‚ Intent ä¸­æ‰€å®šä¹‰ï¼‰ä¼˜å…ˆçº§è¦é«˜äº Activity B çš„è¯·æ±‚ï¼ˆå¦‚å…¶æ¸…å•æ–‡ä»¶ä¸­æ‰€å®šä¹‰ï¼‰ã€‚</p>
<blockquote>
<p>æ³¨ï¼šæŸäº›é€‚ç”¨äºæ¸…å•æ–‡ä»¶çš„å¯åŠ¨æ¨¡å¼ä¸å¯ç”¨ä½œ Intent æ ‡å¿—ï¼ŒåŒæ ·ï¼ŒæŸäº›å¯ç”¨ä½œ Intent æ ‡å¿—çš„å¯åŠ¨æ¨¡å¼æ— æ³•åœ¨æ¸…å•æ–‡ä»¶ä¸­å®šä¹‰ã€‚</p>
<h4 id="ä½¿ç”¨æ¸…å•æ–‡ä»¶"><a href="#ä½¿ç”¨æ¸…å•æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨æ¸…å•æ–‡ä»¶"></a>ä½¿ç”¨æ¸…å•æ–‡ä»¶</h4><p>åœ¨æ¸…å•æ–‡ä»¶ä¸­å£°æ˜ Activity æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <activity> å…ƒç´ çš„ launchMode å±æ€§æŒ‡å®š Activity åº”è¯¥å¦‚ä½•ä¸ä»»åŠ¡å…³è”ã€‚</activity></p>
</blockquote>
<p>launchMode å±æ€§æŒ‡å®šæœ‰å…³åº”å¦‚ä½•å°† Activity å¯åŠ¨åˆ°ä»»åŠ¡ä¸­çš„æŒ‡ä»¤ã€‚æ‚¨å¯ä»¥åˆ†é…ç»™ launchMode å±æ€§çš„å¯åŠ¨æ¨¡å¼å…±æœ‰å››ç§ï¼š</p>
<ul>
<li>â€œstandardâ€ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰
é»˜è®¤ã€‚ç³»ç»Ÿåœ¨å¯åŠ¨ Activity çš„ä»»åŠ¡ä¸­åˆ›å»º Activity çš„æ–°å®ä¾‹å¹¶å‘å…¶ä¼ é€ Intentã€‚Activity å¯ä»¥å¤šæ¬¡å®ä¾‹åŒ–ï¼Œè€Œæ¯ä¸ªå®ä¾‹å‡å¯å±äºä¸åŒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸€ä¸ªä»»åŠ¡å¯ä»¥æ‹¥æœ‰å¤šä¸ªå®ä¾‹ã€‚</li>
<li>â€œsingleTopâ€
å¦‚æœå½“å‰ä»»åŠ¡çš„é¡¶éƒ¨å·²å­˜åœ¨ Activity çš„ä¸€ä¸ªå®ä¾‹ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡è°ƒç”¨è¯¥å®ä¾‹çš„ onNewIntent() æ–¹æ³•å‘å…¶ä¼ é€ Intentï¼Œè€Œä¸æ˜¯åˆ›å»º Activity çš„æ–°å®ä¾‹ã€‚Activity å¯ä»¥å¤šæ¬¡å®ä¾‹åŒ–ï¼Œè€Œæ¯ä¸ªå®ä¾‹å‡å¯å±äºä¸åŒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸€ä¸ªä»»åŠ¡å¯ä»¥æ‹¥æœ‰å¤šä¸ªå®ä¾‹ï¼ˆä½†å‰ææ˜¯ä½äºè¿”å›æ ˆé¡¶éƒ¨çš„ Activity å¹¶ä¸æ˜¯ Activity çš„ç°æœ‰å®ä¾‹ï¼‰ã€‚
ä¾‹å¦‚ï¼Œå‡è®¾ä»»åŠ¡çš„è¿”å›æ ˆåŒ…å«æ ¹ Activity A ä»¥åŠ Activity Bã€C å’Œä½äºé¡¶éƒ¨çš„ Dï¼ˆå †æ ˆæ˜¯ A-B-C-Dï¼›D ä½äºé¡¶éƒ¨ï¼‰ã€‚æ”¶åˆ°é’ˆå¯¹ D ç±» Activity çš„ Intentã€‚å¦‚æœ D å…·æœ‰é»˜è®¤çš„ â€œstandardâ€ å¯åŠ¨æ¨¡å¼ï¼Œåˆ™ä¼šå¯åŠ¨è¯¥ç±»çš„æ–°å®ä¾‹ï¼Œä¸”å †æ ˆä¼šå˜æˆ A-B-C-D-Dã€‚ä½†æ˜¯ï¼Œå¦‚æœ D çš„å¯åŠ¨æ¨¡å¼æ˜¯ â€œsingleTopâ€ï¼Œåˆ™ D çš„ç°æœ‰å®ä¾‹ä¼šé€šè¿‡ onNewIntent() æ¥æ”¶ Intentï¼Œå› ä¸ºå®ƒä½äºå †æ ˆçš„é¡¶éƒ¨ï¼›è€Œå †æ ˆä»ä¸º A-B-C-Dã€‚ä½†æ˜¯ï¼Œå¦‚æœæ”¶åˆ°é’ˆå¯¹ B ç±» Activity çš„ Intentï¼Œåˆ™ä¼šå‘å †æ ˆæ·»åŠ  B çš„æ–°å®ä¾‹ï¼Œå³ä¾¿å…¶å¯åŠ¨æ¨¡å¼ä¸º â€œsingleTopâ€ ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</li>
</ul>
<blockquote>
<p>æ³¨ï¼šä¸ºæŸä¸ª Activity åˆ›å»ºæ–°å®ä¾‹æ—¶ï¼Œç”¨æˆ·å¯ä»¥æŒ‰â€œè¿”å›â€æŒ‰é’®è¿”å›åˆ°å‰ä¸€ä¸ª Activityã€‚ ä½†æ˜¯ï¼Œå½“ Activity çš„ç°æœ‰å®ä¾‹å¤„ç†æ–° Intent æ—¶ï¼Œåˆ™åœ¨æ–° Intent åˆ°è¾¾ onNewIntent() ä¹‹å‰ï¼Œç”¨æˆ·æ— æ³•æŒ‰â€œè¿”å›â€æŒ‰é’®è¿”å›åˆ° Activity çš„çŠ¶æ€ã€‚</p>
</blockquote>
<ul>
<li><p>â€œsingleTaskâ€
ç³»ç»Ÿåˆ›å»ºæ–°ä»»åŠ¡å¹¶å®ä¾‹åŒ–ä½äºæ–°ä»»åŠ¡åº•éƒ¨çš„ Activityã€‚ä½†æ˜¯ï¼Œå¦‚æœè¯¥ Activity çš„ä¸€ä¸ªå®ä¾‹å·²å­˜åœ¨äºä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡ä¸­ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡è°ƒç”¨ç°æœ‰å®ä¾‹çš„ onNewIntent() æ–¹æ³•å‘å…¶ä¼ é€ Intentï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°å®ä¾‹ã€‚ä¸€æ¬¡åªèƒ½å­˜åœ¨ Activity çš„ä¸€ä¸ªå®ä¾‹ã€‚</p>
<blockquote>
<p>æ³¨ï¼šå°½ç®¡ Activity åœ¨æ–°ä»»åŠ¡ä¸­å¯åŠ¨ï¼Œä½†æ˜¯ç”¨æˆ·æŒ‰â€œè¿”å›â€æŒ‰é’®ä»ä¼šè¿”å›åˆ°å‰ä¸€ä¸ª Activityã€‚</p>
</blockquote>
</li>
<li><p>â€œsingleInstanceâ€.
ä¸ â€œsingleTaskâ€ ç›¸åŒï¼Œåªæ˜¯ç³»ç»Ÿä¸ä¼šå°†ä»»ä½•å…¶ä»– Activity å¯åŠ¨åˆ°åŒ…å«å®ä¾‹çš„ä»»åŠ¡ä¸­ã€‚è¯¥ Activity å§‹ç»ˆæ˜¯å…¶ä»»åŠ¡å”¯ä¸€ä»…æœ‰çš„æˆå‘˜ï¼›ç”±æ­¤ Activity å¯åŠ¨çš„ä»»ä½• Activity å‡åœ¨å•ç‹¬çš„ä»»åŠ¡ä¸­æ‰“å¼€ã€‚</p>
</li>
</ul>
<p>æˆ‘ä»¬å†æ¥çœ‹å¦ä¸€ç¤ºä¾‹ï¼ŒAndroid æµè§ˆå™¨åº”ç”¨å£°æ˜ç½‘ç»œæµè§ˆå™¨ Activity åº”å§‹ç»ˆåœ¨å…¶è‡ªå·±çš„ä»»åŠ¡ä¸­æ‰“å¼€ï¼ˆé€šè¿‡åœ¨ <activity> å…ƒç´ ä¸­æŒ‡å®š singleTask å¯åŠ¨æ¨¡å¼ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨å‘å‡ºæ‰“å¼€ Android æµè§ˆå™¨çš„ Intentï¼Œåˆ™å…¶ Activity ä¸æ‚¨çš„åº”ç”¨ä½äºä¸åŒçš„ä»»åŠ¡ä¸­ã€‚ç›¸åï¼Œç³»ç»Ÿä¼šä¸ºæµè§ˆå™¨å¯åŠ¨æ–°ä»»åŠ¡ï¼Œæˆ–è€…å¦‚æœæµè§ˆå™¨å·²æœ‰ä»»åŠ¡æ­£åœ¨åå°è¿è¡Œï¼Œåˆ™ä¼šå°†è¯¥ä»»åŠ¡ä¸Šç§»ä¸€å±‚ä»¥å¤„ç†æ–° Intentã€‚</activity></p>
<p>æ— è®º Activity æ˜¯åœ¨æ–°ä»»åŠ¡ä¸­å¯åŠ¨ï¼Œè¿˜æ˜¯åœ¨ä¸å¯åŠ¨ Activity ç›¸åŒçš„ä»»åŠ¡ä¸­å¯åŠ¨ï¼Œç”¨æˆ·æŒ‰â€œè¿”å›â€æŒ‰é’®å§‹ç»ˆä¼šè½¬åˆ°å‰ä¸€ä¸ª Activityã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¯åŠ¨æŒ‡å®š singleTask å¯åŠ¨æ¨¡å¼çš„ Activityï¼Œåˆ™å½“æŸåå°ä»»åŠ¡ä¸­å­˜åœ¨è¯¥ Activity çš„å®ä¾‹æ—¶ï¼Œæ•´ä¸ªä»»åŠ¡éƒ½ä¼šè½¬ç§»åˆ°å‰å°ã€‚æ­¤æ—¶ï¼Œè¿”å›æ ˆåŒ…æ‹¬ä¸Šç§»åˆ°å †æ ˆé¡¶éƒ¨çš„ä»»åŠ¡ä¸­çš„æ‰€æœ‰ Activityã€‚ å›¾ 4 æ˜¾ç¤ºäº†è¿™ç§æƒ…å†µã€‚
<img src="https://developer.android.com/images/fundamentals/diagram_backstack_singletask_multiactivity.png" alt="image">
å›¾ 4. æ˜¾ç¤ºå¦‚ä½•å°†å¯åŠ¨æ¨¡å¼ä¸ºâ€œsingleTaskâ€çš„ Activity æ·»åŠ åˆ°è¿”å›æ ˆã€‚ å¦‚æœ Activity å·²ç»æ˜¯æŸä¸ªæ‹¥æœ‰è‡ªå·±çš„è¿”å›æ ˆçš„åå°ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™æ•´ä¸ªè¿”å›æ ˆä¹Ÿä¼šä¸Šç§»åˆ°å½“å‰ä»»åŠ¡çš„é¡¶éƒ¨ã€‚</p>
<p>å¦‚éœ€äº†è§£æœ‰å…³åœ¨æ¸…å•æ–‡ä»¶ä¸­ä½¿ç”¨å¯åŠ¨æ¨¡å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <activity> å…ƒç´ æ–‡æ¡£ï¼Œå…¶ä¸­æ›´è¯¦ç»†åœ°è®¨è®ºäº† launchMode å±æ€§å’Œå¯æ¥å—çš„å€¼ã€‚</activity></p>
<blockquote>
<p>æ³¨ï¼šä½¿ç”¨ launchMode å±æ€§ä¸º Activity æŒ‡å®šçš„è¡Œä¸ºå¯ç”± Intent é™„å¸¦çš„ Activity å¯åŠ¨æ ‡å¿—æ›¿ä»£ï¼Œä¸‹æ–‡å°†å¯¹æ­¤è¿›è¡Œè®¨è®ºã€‚</p>
</blockquote>
<h4 id="ä½¿ç”¨-Intent-æ ‡å¿—"><a href="#ä½¿ç”¨-Intent-æ ‡å¿—" class="headerlink" title="ä½¿ç”¨ Intent æ ‡å¿—"></a>ä½¿ç”¨ Intent æ ‡å¿—</h4><p>å¯åŠ¨ Activity æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ä¼ é€’ç»™ startActivity() çš„ Intent ä¸­åŠ å…¥ç›¸åº”çš„æ ‡å¿—ï¼Œä¿®æ”¹ Activity ä¸å…¶ä»»åŠ¡çš„é»˜è®¤å…³è”æ–¹å¼ã€‚å¯ç”¨äºä¿®æ”¹é»˜è®¤è¡Œä¸ºçš„æ ‡å¿—åŒ…æ‹¬ï¼š</p>
<ul>
<li><p>FLAG_ACTIVITY_NEW_TASK
åœ¨æ–°ä»»åŠ¡ä¸­å¯åŠ¨ Activityã€‚å¦‚æœå·²ä¸ºæ­£åœ¨å¯åŠ¨çš„ Activity è¿è¡Œä»»åŠ¡ï¼Œåˆ™è¯¥ä»»åŠ¡ä¼šè½¬åˆ°å‰å°å¹¶æ¢å¤å…¶æœ€åçŠ¶æ€ï¼ŒåŒæ—¶ Activity ä¼šåœ¨ onNewIntent() ä¸­æ”¶åˆ°æ–° Intentã€‚
æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œè¿™ä¼šäº§ç”Ÿä¸ â€œsingleTaskâ€launchMode å€¼ç›¸åŒçš„è¡Œä¸ºã€‚</p>
</li>
<li><p>FLAG_ACTIVITY_SINGLE_TOP
å¦‚æœæ­£åœ¨å¯åŠ¨çš„ Activity æ˜¯å½“å‰ Activityï¼ˆä½äºè¿”å›æ ˆçš„é¡¶éƒ¨ï¼‰ï¼Œåˆ™ ç°æœ‰å®ä¾‹ä¼šæ¥æ”¶å¯¹ onNewIntent() çš„è°ƒç”¨ï¼Œè€Œä¸æ˜¯åˆ›å»º Activity çš„æ–°å®ä¾‹ã€‚
æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œè¿™ä¼šäº§ç”Ÿä¸ â€œsingleTopâ€launchMode å€¼ç›¸åŒçš„è¡Œä¸ºã€‚</p>
</li>
<li><p>FLAG_ACTIVITY_CLEAR_TOP
å¦‚æœæ­£åœ¨å¯åŠ¨çš„ Activity å·²åœ¨å½“å‰ä»»åŠ¡ä¸­è¿è¡Œï¼Œåˆ™ä¼šé”€æ¯å½“å‰ä»»åŠ¡é¡¶éƒ¨çš„æ‰€æœ‰ Activityï¼Œå¹¶é€šè¿‡ onNewIntent() å°†æ­¤ Intent ä¼ é€’ç»™ Activity å·²æ¢å¤çš„å®ä¾‹ï¼ˆç°åœ¨ä½äºé¡¶éƒ¨ï¼‰ï¼Œè€Œä¸æ˜¯å¯åŠ¨è¯¥ Activity çš„æ–°å®ä¾‹ã€‚
äº§ç”Ÿè¿™ç§è¡Œä¸ºçš„ launchMode å±æ€§æ²¡æœ‰å€¼ã€‚</p>
<p>FLAG_ACTIVITY_CLEAR_TOP é€šå¸¸ä¸ FLAG_ACTIVITY_NEW_TASK ç»“åˆä½¿ç”¨ã€‚ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œé€šè¿‡è¿™äº›æ ‡å¿—ï¼Œå¯ä»¥æ‰¾åˆ°å…¶ä»–ä»»åŠ¡ä¸­çš„ç°æœ‰ Activityï¼Œå¹¶å°†å…¶æ”¾å…¥å¯ä»ä¸­å“åº” Intent çš„ä½ç½®ã€‚</p>
<blockquote>
<p>æ³¨ï¼šå¦‚æœæŒ‡å®š Activity çš„å¯åŠ¨æ¨¡å¼ä¸º â€œstandardâ€ï¼Œåˆ™è¯¥ Activity ä¹Ÿä¼šä»å †æ ˆä¸­ç§»é™¤ï¼Œå¹¶åœ¨å…¶ä½ç½®å¯åŠ¨ä¸€ä¸ªæ–°å®ä¾‹ï¼Œä»¥ä¾¿å¤„ç†ä¼ å…¥çš„ Intentã€‚ è¿™æ˜¯å› ä¸ºå½“å¯åŠ¨æ¨¡å¼ä¸º â€œstandardâ€ æ—¶ï¼Œå°†å§‹ç»ˆä¸ºæ–° Intent åˆ›å»ºæ–°å®ä¾‹ã€‚</p>
</blockquote>
</li>
</ul>
<h3 id="å¤„ç†å…³è”"><a href="#å¤„ç†å…³è”" class="headerlink" title="å¤„ç†å…³è”"></a>å¤„ç†å…³è”</h3><p>â€œå…³è”â€æŒ‡ç¤º Activity ä¼˜å…ˆå±äºå“ªä¸ªä»»åŠ¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒä¸€åº”ç”¨ä¸­çš„æ‰€æœ‰ Activity å½¼æ­¤å…³è”ã€‚ å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒä¸€åº”ç”¨ä¸­çš„æ‰€æœ‰ Activity ä¼˜å…ˆä½äºç›¸åŒä»»åŠ¡ä¸­ã€‚ ä¸è¿‡ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹ Activity çš„é»˜è®¤å…³è”ã€‚ åœ¨ä¸åŒåº”ç”¨ä¸­å®šä¹‰çš„ Activity å¯ä»¥å…±äº«å…³è”ï¼Œæˆ–è€…å¯ä¸ºåœ¨åŒä¸€åº”ç”¨ä¸­å®šä¹‰çš„ Activity åˆ†é…ä¸åŒçš„ä»»åŠ¡å…³è”ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <activity> å…ƒç´ çš„ taskAffinity å±æ€§ä¿®æ”¹ä»»ä½•ç»™å®š Activity çš„å…³è”ã€‚</activity></p>
<p>taskAffinity å±æ€§å–å­—ç¬¦ä¸²å€¼ï¼Œè¯¥å€¼å¿…é¡»ä¸åŒäºåœ¨ <manifest> å…ƒç´ ä¸­å£°æ˜çš„é»˜è®¤è½¯ä»¶åŒ…åç§°ï¼Œå› ä¸ºç³»ç»Ÿä½¿ç”¨è¯¥åç§°æ ‡è¯†åº”ç”¨çš„é»˜è®¤ä»»åŠ¡å…³è”ã€‚</manifest></p>
<p>åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œå…³è”ä¼šèµ·ä½œç”¨ï¼š</p>
<ul>
<li>å¯åŠ¨ Activity çš„ Intent åŒ…å« FLAG_ACTIVITY_NEW_TASK æ ‡å¿—ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–° Activity ä¼šå¯åŠ¨åˆ°è°ƒç”¨ startActivity() çš„ Activity ä»»åŠ¡ä¸­ã€‚å®ƒå°†æ¨å…¥ä¸è°ƒç”¨æ–¹ç›¸åŒçš„è¿”å›æ ˆã€‚ ä½†æ˜¯ï¼Œå¦‚æœä¼ é€’ç»™ startActivity() çš„ Intent åŒ…å« FLAG_ACTIVITY_NEW_TASK æ ‡å¿—ï¼Œåˆ™ç³»ç»Ÿä¼šå¯»æ‰¾å…¶ä»–ä»»åŠ¡æ¥å‚¨å­˜æ–° Activityã€‚è¿™é€šå¸¸æ˜¯æ–°ä»»åŠ¡ï¼Œä½†æœªåšå¼ºåˆ¶è¦æ±‚ã€‚ å¦‚æœç°æœ‰ä»»åŠ¡ä¸æ–° Activity å…·æœ‰ç›¸åŒå…³è”ï¼Œåˆ™ä¼šå°† Activity å¯åŠ¨åˆ°è¯¥ä»»åŠ¡ä¸­ã€‚ å¦åˆ™ï¼Œå°†å¼€å§‹æ–°ä»»åŠ¡ã€‚
å¦‚æœæ­¤æ ‡å¿—å¯¼è‡´ Activity å¼€å§‹æ–°ä»»åŠ¡ï¼Œä¸”ç”¨æˆ·æŒ‰â€œä¸»é¡µâ€æŒ‰é’®ç¦»å¼€ï¼Œåˆ™å¿…é¡»ä¸ºç”¨æˆ·æä¾›å¯¼èˆªå›ä»»åŠ¡çš„æ–¹å¼ã€‚ æœ‰äº›å®ä½“ï¼ˆå¦‚é€šçŸ¥ç®¡ç†å™¨ï¼‰å§‹ç»ˆåœ¨å¤–éƒ¨ä»»åŠ¡ä¸­å¯åŠ¨ Activityï¼Œè€Œä»ä¸ä½œä¸ºå…¶è‡ªèº«çš„ä¸€éƒ¨åˆ†å¯åŠ¨ Activityï¼Œå› æ­¤å®ƒä»¬å§‹ç»ˆå°† FLAG_ACTIVITY_NEW_TASK æ”¾å…¥ä¼ é€’ç»™ startActivity() çš„ Intent ä¸­ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœ Activity èƒ½å¤Ÿç”±å¯ä»¥ä½¿ç”¨æ­¤æ ‡å¿—çš„å¤–éƒ¨å®ä½“è°ƒç”¨ï¼Œåˆ™ç”¨æˆ·å¯ä»¥é€šè¿‡ç‹¬ç«‹æ–¹å¼è¿”å›åˆ°å¯åŠ¨çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨å¯åŠ¨å™¨å›¾æ ‡ï¼ˆä»»åŠ¡çš„æ ¹ Activity å…·æœ‰ CATEGORY_LAUNCHER Intent è¿‡æ»¤å™¨ï¼›è¯·å‚é˜…ä¸‹é¢çš„å¯åŠ¨ä»»åŠ¡éƒ¨åˆ†ï¼‰ã€‚</li>
<li><p>Activity å°†å…¶ allowTaskReparenting å±æ€§è®¾ç½®ä¸º â€œtrueâ€ã€‚
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒActivity å¯ä»¥ä»å…¶å¯åŠ¨çš„ä»»åŠ¡ç§»åŠ¨åˆ°ä¸å…¶å…·æœ‰å…³è”çš„ä»»åŠ¡ï¼ˆå¦‚æœè¯¥ä»»åŠ¡å‡ºç°åœ¨å‰å°ï¼‰ã€‚</p>
<blockquote>
<p>æç¤ºï¼šå¦‚æœä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œä¸€ä¸ª .apk æ–‡ä»¶åŒ…å«å¤šä¸ªâ€œåº”ç”¨â€ï¼Œåˆ™æ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨ taskAffinity å±æ€§å°†ä¸åŒå…³è”åˆ†é…ç»™ä¸æ¯ä¸ªâ€œåº”ç”¨â€ç›¸å…³çš„ Activityã€‚</p>
</blockquote>
</li>
</ul>
<h3 id="æ¸…ç†è¿”å›æ ˆ"><a href="#æ¸…ç†è¿”å›æ ˆ" class="headerlink" title="æ¸…ç†è¿”å›æ ˆ"></a>æ¸…ç†è¿”å›æ ˆ</h3><p>å¦‚æœç”¨æˆ·é•¿æ—¶é—´ç¦»å¼€ä»»åŠ¡ï¼Œåˆ™ç³»ç»Ÿä¼šæ¸…é™¤æ‰€æœ‰ Activity çš„ä»»åŠ¡ï¼Œæ ¹ Activity é™¤å¤–ã€‚ å½“ç”¨æˆ·å†æ¬¡è¿”å›åˆ°ä»»åŠ¡æ—¶ï¼Œä»…æ¢å¤æ ¹ Activityã€‚ç³»ç»Ÿè¿™æ ·åšçš„åŸå› æ˜¯ï¼Œç»è¿‡å¾ˆé•¿ä¸€æ®µæ—¶é—´åï¼Œç”¨æˆ·å¯èƒ½å·²ç»æ”¾å¼ƒä¹‹å‰æ‰§è¡Œçš„æ“ä½œï¼Œè¿”å›åˆ°ä»»åŠ¡æ˜¯è¦å¼€å§‹æ‰§è¡Œæ–°çš„æ“ä½œã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‡ ä¸ª Activity å±æ€§ä¿®æ”¹æ­¤è¡Œä¸ºï¼š</p>
<ul>
<li>alwaysRetainTaskState
å¦‚æœåœ¨ä»»åŠ¡çš„æ ¹ Activity ä¸­å°†æ­¤å±æ€§è®¾ç½®ä¸º â€œtrueâ€ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿåˆšæ‰æ‰€è¿°çš„é»˜è®¤è¡Œä¸ºã€‚å³ä½¿åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´åï¼Œä»»åŠ¡ä»å°†æ‰€æœ‰ Activity ä¿ç•™åœ¨å…¶å †æ ˆä¸­ã€‚</li>
<li>clearTaskOnLaunch
å¦‚æœåœ¨ä»»åŠ¡çš„æ ¹ Activity ä¸­å°†æ­¤å±æ€§è®¾ç½®ä¸º â€œtrueâ€ï¼Œåˆ™æ¯å½“ç”¨æˆ·ç¦»å¼€ä»»åŠ¡ç„¶åè¿”å›æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šå°†å †æ ˆæ¸…é™¤åˆ°åªå‰©ä¸‹æ ¹ Activityã€‚ æ¢è€Œè¨€ä¹‹ï¼Œå®ƒä¸ alwaysRetainTaskState æ­£å¥½ç›¸åã€‚ å³ä½¿åªç¦»å¼€ä»»åŠ¡ç‰‡åˆ»æ—¶é—´ï¼Œç”¨æˆ·ä¹Ÿå§‹ç»ˆä¼šè¿”å›åˆ°ä»»åŠ¡çš„åˆå§‹çŠ¶æ€ã€‚</li>
<li>finishOnTaskLaunch
æ­¤å±æ€§ç±»ä¼¼äº clearTaskOnLaunchï¼Œä½†å®ƒå¯¹å•ä¸ª Activity èµ·ä½œç”¨ï¼Œè€Œéæ•´ä¸ªä»»åŠ¡ã€‚ æ­¤å¤–ï¼Œå®ƒè¿˜æœ‰å¯èƒ½ä¼šå¯¼è‡´ä»»ä½• Activity åœæ­¢ï¼ŒåŒ…æ‹¬æ ¹ Activityã€‚ è®¾ç½®ä¸º â€œtrueâ€ æ—¶ï¼ŒActivity ä»æ˜¯ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä»…é™äºå½“å‰ä¼šè¯ã€‚å¦‚æœç”¨æˆ·ç¦»å¼€ç„¶åè¿”å›ä»»åŠ¡ï¼Œåˆ™ä»»åŠ¡å°†ä¸å¤å­˜åœ¨ã€‚<h3 id="å¯åŠ¨ä»»åŠ¡"><a href="#å¯åŠ¨ä»»åŠ¡" class="headerlink" title="å¯åŠ¨ä»»åŠ¡"></a>å¯åŠ¨ä»»åŠ¡</h3>é€šè¿‡ä¸º Activity æä¾›ä¸€ä¸ªä»¥ â€œandroid.intent.action.MAINâ€ ä¸ºæŒ‡å®šæ“ä½œã€ä»¥ â€œandroid.intent.category.LAUNCHERâ€ ä¸ºæŒ‡å®šç±»åˆ«çš„ Intent è¿‡æ»¤å™¨ï¼Œæ‚¨å¯ä»¥å°† Activity è®¾ç½®ä¸ºä»»åŠ¡çš„å…¥å£ç‚¹ã€‚ ä¾‹å¦‚ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;activity ... &gt;</div><div class="line">    &lt;intent-filter ... &gt;</div><div class="line">        &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</div><div class="line">        &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</div><div class="line">    &lt;/intent-filter&gt;</div><div class="line">    ...</div><div class="line">&lt;/activity&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>æ­¤ç±» Intent è¿‡æ»¤å™¨ä¼šä½¿ Activity çš„å›¾æ ‡å’Œæ ‡ç­¾æ˜¾ç¤ºåœ¨åº”ç”¨å¯åŠ¨å™¨ä¸­ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿå¯åŠ¨ Activity å¹¶åœ¨å¯åŠ¨ä¹‹åéšæ—¶è¿”å›åˆ°åˆ›å»ºçš„ä»»åŠ¡ä¸­ã€‚</p>
<p>ç¬¬äºŒä¸ªåŠŸèƒ½éå¸¸é‡è¦ï¼šç”¨æˆ·å¿…é¡»èƒ½å¤Ÿåœ¨ç¦»å¼€ä»»åŠ¡åï¼Œå†ä½¿ç”¨æ­¤ Activity å¯åŠ¨å™¨è¿”å›è¯¥ä»»åŠ¡ã€‚ å› æ­¤ï¼Œåªæœ‰åœ¨ Activity å…·æœ‰ ACTION_MAIN å’Œ CATEGORY_LAUNCHER è¿‡æ»¤å™¨æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨å°† Activity æ ‡è®°ä¸ºâ€œå§‹ç»ˆå¯åŠ¨ä»»åŠ¡â€çš„ä¸¤ç§å¯åŠ¨æ¨¡å¼ï¼Œå³ â€œsingleTaskâ€ å’Œ â€œsingleInstanceâ€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åƒä¸€ä¸‹å¦‚æœç¼ºå°‘è¿‡æ»¤å™¨ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼š Intent å¯åŠ¨ä¸€ä¸ª â€œsingleTaskâ€ Activityï¼Œä»è€Œå¯åŠ¨ä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ç”¨æˆ·èŠ±äº†äº›æ—¶é—´å¤„ç†è¯¥ä»»åŠ¡ã€‚ç„¶åï¼Œç”¨æˆ·æŒ‰â€œä¸»é¡µâ€æŒ‰é’®ã€‚ ä»»åŠ¡ç°å·²å‘é€åˆ°åå°ï¼Œè€Œä¸”ä¸å¯è§ã€‚ç°åœ¨ï¼Œç”¨æˆ·æ— æ³•è¿”å›åˆ°ä»»åŠ¡ï¼Œå› ä¸ºè¯¥ä»»åŠ¡æœªæ˜¾ç¤ºåœ¨åº”ç”¨å¯åŠ¨å™¨ä¸­ã€‚</p>
<p>å¦‚æœæ‚¨å¹¶ä¸æƒ³ç”¨æˆ·èƒ½å¤Ÿè¿”å›åˆ° Activityï¼Œå¯¹äºè¿™äº›æƒ…å†µï¼Œè¯·å°† <activity> å…ƒç´ çš„ finishOnTaskLaunch è®¾ç½®ä¸º â€œtrueâ€ï¼ˆè¯·å‚é˜…æ¸…ç†å †æ ˆï¼‰ã€‚</activity></p>
<p>æœ‰å…³å¦‚ä½•åœ¨æ¦‚è§ˆå±å¹•ä¸­æ˜¾ç¤ºå’Œç®¡ç†ä»»åŠ¡ä¸ Activity çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ¦‚è§ˆå±å¹•ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é—®é¢˜:&lt;a href=&quot;http://blog.csdn.net/love100628/article/details/43238135&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;å®ä¾‹åŒ–launcher activity&lt;/a&gt;
è¿™ä¸ªé—®é¢˜è¡¨ç°:&lt;/p&gt;
    
    </summary>
    
      <category term="Android" scheme="http://wodekouwei.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://wodekouwei.com/tags/Android/"/>
    
      <category term="tips" scheme="http://wodekouwei.com/tags/tips/"/>
    
  </entry>
  
  <entry>
    <title>homeåä»serviceé‡æ–°å¯åŠ¨activityå»¶è¿Ÿé—®é¢˜</title>
    <link href="http://wodekouwei.com/2017/08/24/tips-starting-an-activity-from-a-service-after-home-button/"/>
    <id>http://wodekouwei.com/2017/08/24/tips-starting-an-activity-from-a-service-after-home-button/</id>
    <published>2017-08-23T16:23:17.000Z</published>
    <updated>2017-08-23T16:30:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>é—®é¢˜:
åœ¨Activityç•Œé¢ï¼ŒæŒ‰ä¸‹HOMEé”®åï¼Œç‚¹å‡»æ‚¬æµ®å±‚æŒ‰é’®ï¼Œå†å¯åŠ¨Activityï¼Œ Activityè¦å»¶æ—¶5Såæ‰å‡ºæ¥ã€‚
ç»éªŒè¯ï¼Œè¿™ä¸ªé—®é¢˜ä¸æ˜¯åº”ç”¨è‡ªèº«çš„BUGã€‚é‚£æ€•è¯¥Activityæ˜¯ç©ºçš„ï¼Œä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜</p>
<p>Androidä¸ºäº†é¿å…åº”ç”¨åœ¨æŒ‰ä¸‹HOMEé”®é€€å‡ºåè¿˜å¯ä»¥å¼ºåˆ¶æŠŠè‡ªå·±å¯åŠ¨ï¼Œç‰¹æ„åŠ çš„é™åˆ¶ã€‚
åœ¨ç°æœ‰çš„APIæƒ…å†µä¸‹ï¼Œä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé™¤éä½ çš„åº”ç”¨æ˜¯ä¸€ä¸ªå¯åŠ¨å™¨ï¼ˆLauncherï¼‰ï¼Œ æ·»åŠ äº†home/ launcher intent filterã€‚å¦‚æœä½ ä¸æ˜¯å¯åŠ¨å™¨ï¼Œåˆè¦ä»æ‚¬æµ®å±‚å¯åŠ¨ä¸€ä¸ªActivityï¼Œå°±æŠŠè¯¥Activityä¹Ÿæ”¹æˆæ‚¬æµ®å±‚å§</p>
<h3 id="1-ä¸ä»åå°å¯åŠ¨-Activity-å‡†åˆ™ï¼š"><a href="#1-ä¸ä»åå°å¯åŠ¨-Activity-å‡†åˆ™ï¼š" class="headerlink" title="1. ä¸ä»åå°å¯åŠ¨ Activity å‡†åˆ™ï¼š"></a>1. ä¸ä»åå°å¯åŠ¨ Activity å‡†åˆ™ï¼š</h3><p>åœ¨è°·æ­Œçš„ Android API Guides ä¸­ï¼Œç‰¹æ„æé†’å¼€å‘è€…ä¸è¦åœ¨åå°å¯åŠ¨ activityï¼ŒåŒ…æ‹¬åœ¨ Service å’Œ BroadcastReceiver ä¸­ï¼Œè¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†é¿å…åœ¨ç”¨æˆ·æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹çªç„¶ä¸­æ–­ç”¨æˆ·æ­£åœ¨è¿›è¡Œçš„å·¥ä½œï¼Œåœ¨  <a href="http://developer.android.com/guide/practices/seamlessness.html#interrupt" target="_blank" rel="external">http://developer.android.com/guide/practices/seamlessness.html#interrupt</a> ä¸­æœ‰å¦‚ä¸‹è§£é‡Šï¼š</p>
<p>That is, donâ€™t call startActivity() from BroadcastReceivers or Services running in the background. Doing so will interrupt whatever application is currently running, and result in an annoyed user. Perhaps even worse, your Activity may become a â€œkeystroke banditâ€ and receive some of the input the user was in the middle of providing to the previous Activity. Depending on what your application does, this could be bad news.</p>
<h3 id="2-éœ€è¦è¿åâ€œä¸ä»åå°å¯åŠ¨-Activityâ€å‡†åˆ™çš„ç‰¹ä¾‹ï¼š"><a href="#2-éœ€è¦è¿åâ€œä¸ä»åå°å¯åŠ¨-Activityâ€å‡†åˆ™çš„ç‰¹ä¾‹ï¼š" class="headerlink" title="2. éœ€è¦è¿åâ€œä¸ä»åå°å¯åŠ¨ Activityâ€å‡†åˆ™çš„ç‰¹ä¾‹ï¼š"></a>2. éœ€è¦è¿åâ€œä¸ä»åå°å¯åŠ¨ Activityâ€å‡†åˆ™çš„ç‰¹ä¾‹ï¼š</h3><p>ç‰¹ä¾‹ï¼šå³ä¾¿å¦‚æ­¤ï¼Œæ‰‹æœºå‚å•†çš„å¼€å‘è€…ä»¬åœ¨å¼€å‘åŸºäºç³»ç»Ÿçº§çš„åº”ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½ä»ç„¶éœ€è¦æœ‰ä» Service æˆ– BroadcastReceiver ä¸­ startActivity çš„éœ€æ±‚ï¼Œå¾€å¾€è¿™æ ·çš„å‰ææ˜¯è¿è¿™æ ·çš„ Service æˆ– BroadcastReceiver ä¹Ÿæ˜¯ç”±ç”¨æˆ·çš„æŸäº›æ“ä½œè€Œè§¦å‘çš„ï¼ŒService æˆ– BroadcastReceiver åªæ˜¯å……å½“äº†å³å°†å¯åŠ¨ activity ä¹‹å‰çš„ä¸€äº›ä»£ç†å‚æ•°æ£€æŸ¥å·¥ä½œä»¥ä¾¿å†³å®šæ˜¯å¦éœ€è¦ start è¯¥ activityã€‚</p>
<p>é™¤éæ˜¯ä¸Šè¿°ç¬”è€…æ‰€è¿°çš„ç‰¹æ®Šæƒ…å†µï¼Œåº”ç”¨å¼€å‘è€…éƒ½åº”è¯¥éµå¾ª â€œä¸è¦ä»åå°å¯åŠ¨ Activityâ€å‡†åˆ™ã€‚</p>
<p>ä¸€ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œç‰¹ä¾‹ä¸­æ‰€è¿°çš„æƒ…å†µè¿˜ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“é€šè¿‡ home é”®å°†å½“å‰ activity ç½®äºåå°æ—¶ï¼Œä»»ä½•åœ¨åå°startActivity çš„æ“ä½œéƒ½å°†ä¼šå»¶è¿Ÿ 5 ç§’ï¼Œé™¤éè¯¥åº”ç”¨è·å–äº† â€œandroid.permission.STOP_APP_SWITCHESâ€ æƒé™ã€‚</p>
<p>å…³äºå»¶è¿Ÿ 5 ç§’çš„æ“ä½œåœ¨ com.android.server.am.ActivityManagerService ä¸­çš„ stopAppSwitches() æ–¹æ³•ä¸­ï¼Œç³»ç»Ÿçº§çš„åº”ç”¨å½“è·å–äº† â€œandroid.permission.STOP_APP_SWITCHESâ€ åå°†ä¸ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•æ¥å»¶è¿Ÿé€šè¿‡åå°å¯åŠ¨ activity çš„æ“ä½œï¼Œäº‹å®ä¸Š android åŸç”Ÿçš„ Phone åº”ç”¨å°±æ˜¯è¿™æ ·çš„æƒ…å†µï¼Œå®ƒæ˜¯ä¸€ä¸ªè·å–äº†â€android.permission.STOP_APP_SWITCHESâ€ æƒé™çš„ç³»ç»Ÿçº§åº”ç”¨ï¼Œå½“æœ‰æ¥ç”µæ—¶ï¼Œä¸€ä¸ªä»åå°å¯åŠ¨çš„ activity å°†çªç„¶å‡ºç°åœ¨ç”¨æˆ·çš„é¢å‰ï¼Œè­¦é†’ç”¨æˆ·æœ‰æ–°çš„æ¥ç”µï¼Œè¿™æ ·çš„è®¾è®¡æ˜¯åˆç†çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“ä½ éœ€è¦å¼€å‘ç±»ä¼¼ Phone è¿™æ ·çš„åº”ç”¨æ—¶ï¼Œéœ€è¦åšå¦‚ä¸‹å·¥ä½œï¼š</p>
<ol>
<li>root ä½ çš„æ‰‹æœºï¼›</li>
<li>åœ¨ AndroidManifest.xml ä¸­æ·»åŠ  â€œandroid.permission.STOP_APP_SWITCHESâ€  ç”¨æˆ·æƒé™ï¼›</li>
<li>å°†ä½ å¼€å‘çš„åº”ç”¨ç¨‹åº push åˆ°æ‰‹æœºçš„ /system/app ç›®å½•ä¸­ã€‚</li>
</ol>
<h3 id="3-å‚è€ƒèµ„æ–™ï¼š"><a href="#3-å‚è€ƒèµ„æ–™ï¼š" class="headerlink" title="3. å‚è€ƒèµ„æ–™ï¼š"></a>3. å‚è€ƒèµ„æ–™ï¼š</h3><p><a href="http://developer.android.com/guide/practices/seamlessness.html#interrupt" target="_blank" rel="external">æ— ç¼çš„è®¾è®¡ä¹‹â€”â€”ä¸è¦ä¸­æ–­ä½ çš„ç”¨æˆ·</a>
<a href="http://stackoverflow.com/questions/5600084/starting-an-activity-from-a-service-after-home-button-pressed-without-the-5-seco" target="_blank" rel="external">stackoverflow ä¸­å…³äºåå° startActivity è¢«å»¶è¿Ÿ 5 ç§’çš„æ¢è®¨</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é—®é¢˜:
åœ¨Activityç•Œé¢ï¼ŒæŒ‰ä¸‹HOMEé”®åï¼Œç‚¹å‡»æ‚¬æµ®å±‚æŒ‰é’®ï¼Œå†å¯åŠ¨Activityï¼Œ Activityè¦å»¶æ—¶5Såæ‰å‡ºæ¥ã€‚
ç»éªŒè¯ï¼Œè¿™ä¸ªé—®é¢˜ä¸æ˜¯åº”ç”¨è‡ªèº«çš„BUGã€‚é‚£æ€•è¯¥Activityæ˜¯ç©ºçš„ï¼Œä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜&lt;/p&gt;
&lt;p&gt;Androidä¸ºäº†é¿å…åº”ç”¨åœ¨æŒ‰ä¸‹HOMEé”®é€€å‡º
    
    </summary>
    
      <category term="Android" scheme="http://wodekouwei.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://wodekouwei.com/tags/Android/"/>
    
      <category term="tips" scheme="http://wodekouwei.com/tags/tips/"/>
    
  </entry>
  
  <entry>
    <title>Linuxä¸‹Cå¼€å‘ä½¿ç”¨å°æŠ€å·§</title>
    <link href="http://wodekouwei.com/2017/08/06/tips-c-language/"/>
    <id>http://wodekouwei.com/2017/08/06/tips-c-language/</id>
    <published>2017-08-06T02:45:03.000Z</published>
    <updated>2017-09-30T04:13:35.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ¶æ„ç±»"><a href="#æ¶æ„ç±»" class="headerlink" title="æ¶æ„ç±»"></a>æ¶æ„ç±»</h3><h4 id="Linux-Cä»£ç å®ç°ä¸»å‡½æ•°å‚æ•°é€‰é¡¹è§£æ"><a href="#Linux-Cä»£ç å®ç°ä¸»å‡½æ•°å‚æ•°é€‰é¡¹è§£æ" class="headerlink" title="Linux Cä»£ç å®ç°ä¸»å‡½æ•°å‚æ•°é€‰é¡¹è§£æ"></a>Linux Cä»£ç å®ç°ä¸»å‡½æ•°å‚æ•°é€‰é¡¹è§£æ</h4><h5 id="1-æ‰‹åŠ¨è§£æç‰ˆæœ¬"><a href="#1-æ‰‹åŠ¨è§£æç‰ˆæœ¬" class="headerlink" title="1. æ‰‹åŠ¨è§£æç‰ˆæœ¬"></a>1. æ‰‹åŠ¨è§£æç‰ˆæœ¬</h5><p>ä½¿ç”¨argcã€argvï¼Œé€ä¸ªå­—ç¬¦æ¯”è¾ƒï¼Œå¾—åˆ°è¦æƒ³çš„å‚æ•°åå­—å³è¿›è¡Œåˆ¤æ–­ã€è§£æã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;stdlib.h&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line">#include &lt;ctype.h&gt;</div><div class="line"></div><div class="line">int debug;</div><div class="line"></div><div class="line">void show_version(char* name)</div><div class="line">&#123;</div><div class="line">    printf(&quot;%s by Late Lee, version: 1.0\n&quot;, name);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void usage(char* name)</div><div class="line">&#123;</div><div class="line">    show_version(name);</div><div class="line"></div><div class="line">    printf(&quot;         -h,  --help           short help\n&quot;);</div><div class="line">    printf(&quot;         -v,  --version        show version\n&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">int main(int argc, char *argv[])</div><div class="line">&#123;</div><div class="line">    int i = 0;</div><div class="line"></div><div class="line">    /* early check for debug and config parameter */</div><div class="line">    if (argc &gt; 1) &#123;</div><div class="line">        for (i = 1; i &lt; argc; i++)</div><div class="line">        &#123;</div><div class="line">            if ((strcmp(argv[i], &quot;-D&quot;)==0) || (strcmp(argv[i], &quot;--debug&quot;)==0))</div><div class="line">            &#123;</div><div class="line">                debug = 1;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //</div><div class="line">    /* parse parameters, maybe not the best way but... */</div><div class="line">    for (i = 1; i &lt; argc; i++)</div><div class="line">    &#123;</div><div class="line">        if (debug)</div><div class="line">            printf(&quot;arg %d: \&quot;%s\&quot;\n&quot;,i,argv[i]);</div><div class="line">        // help</div><div class="line">        if ((strcmp(argv[i],&quot;-h&quot;)==0) || (strcmp(argv[i],&quot;--help&quot;)==0))</div><div class="line">        &#123;</div><div class="line">            usage(argv[0]);</div><div class="line">            return 0;</div><div class="line">        &#125;</div><div class="line">        // version</div><div class="line">        else if ((strcmp(argv[i],&quot;-v&quot;)==0) || (strcmp(argv[i],&quot;--version&quot;)==0))</div><div class="line">        &#123;</div><div class="line">            show_version(argv[0]);</div><div class="line">            return 0;</div><div class="line">        &#125;</div><div class="line">        // debug</div><div class="line">        else if ((strcmp(argv[i],&quot;-D&quot;)==0) || (strcmp(argv[i],&quot;--debug&quot;)==0))</div><div class="line">        &#123;</div><div class="line">            debug=1;</div><div class="line">        &#125;</div><div class="line">        else if ((strcmp(argv[i],&quot;fpga&quot;)==0))</div><div class="line">        &#123;</div><div class="line">            printf(&quot;test of fpga...\n&quot;);</div><div class="line">        &#125;</div><div class="line">        // string</div><div class="line">        else if ((strcmp(argv[i],&quot;-i&quot;)==0) || (strcmp(argv[i],&quot;--iface&quot;)==0))</div><div class="line">        &#123;</div><div class="line">            if (i+1&lt;argc)</div><div class="line">            &#123;</div><div class="line">                char interface[32] = &#123;0&#125;;</div><div class="line">                strncpy(interface, argv[i+1], 32);</div><div class="line">                if (debug)</div><div class="line">                    printf(&quot;Used interface: %s\n&quot;, interface);</div><div class="line">                i++;</div><div class="line">                continue;</div><div class="line">            &#125; else &#123;</div><div class="line">                printf(&quot;Error: Interface for -i missing.\n&quot;);</div><div class="line">                return 1;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        // number</div><div class="line">        else if ((strcmp(argv[i],&quot;-ru&quot;)==0) || (strcmp(argv[i],&quot;--rateunit&quot;))==0)</div><div class="line">        &#123;</div><div class="line">            if (i+1&lt;argc &amp;&amp; isdigit(argv[i+1][0])) &#123;</div><div class="line">                int rateunit = 0;</div><div class="line">                rateunit = atoi(argv[i+1]);</div><div class="line">                if (rateunit &lt; 0 || rateunit &gt; 1)</div><div class="line">                &#123;</div><div class="line">                    printf(&quot;Error: Invalid parameter \&quot;%d\&quot; for --rateunit.\n&quot;, rateunit);</div><div class="line">                    printf(&quot; Valid parameters:\n&quot;);</div><div class="line">                    printf(&quot;    0 - bytes\n&quot;);</div><div class="line">                    printf(&quot;    1 - bits\n&quot;);</div><div class="line">                    return 1;</div><div class="line">                &#125;</div><div class="line">                if (debug)</div><div class="line">                    printf(&quot;Rateunit changed: %d\n&quot;, rateunit);</div><div class="line">                i++;</div><div class="line">                continue;</div><div class="line">            &#125;</div><div class="line">            else</div><div class="line">            &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        // only one</div><div class="line">        else if (strcmp(argv[i],&quot;--enable&quot;)==0)</div><div class="line">        &#123;</div><div class="line">            int enable = 0;</div><div class="line">            enable = 1;</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">            printf(&quot;Unknown parameter \&quot;%s\&quot;. Use --help for help.\n&quot;,argv[i]);</div><div class="line">            return 1;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="2-åˆ©ç”¨getoptå‡½æ•°å®Œæˆ"><a href="#2-åˆ©ç”¨getoptå‡½æ•°å®Œæˆ" class="headerlink" title="2. åˆ©ç”¨getoptå‡½æ•°å®Œæˆ"></a>2. åˆ©ç”¨getoptå‡½æ•°å®Œæˆ</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">è§£æå‘½ä»¤é€‰é¡¹ç¤ºä¾‹</div><div class="line"></div><div class="line">#include &lt;unistd.h&gt;</div><div class="line">extern char *optarg;   //é€‰é¡¹çš„å‚æ•°æŒ‡é’ˆ</div><div class="line">extern int optind,    //ä¸‹ä¸€æ¬¡è°ƒç”¨getoptçš„æ—¶ï¼Œä»optindå­˜å‚¨çš„ä½ç½®å¤„é‡æ–°å¼€å§‹æ£€æŸ¥é€‰é¡¹ã€‚</div><div class="line">extern int opterr,   //å½“opterr=0æ—¶ï¼Œgetoptä¸å‘stderrè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚</div><div class="line">extern int optopt;   //å½“å‘½ä»¤è¡Œé€‰é¡¹å­—ç¬¦ä¸åŒ…æ‹¬åœ¨optstringä¸­æˆ–è€…é€‰é¡¹ç¼ºå°‘å¿…è¦çš„å‚æ•°æ—¶ï¼Œè¯¥é€‰é¡¹å­˜å‚¨åœ¨optoptä¸­ï¼Œgetoptè¿”å›&apos;ï¼Ÿâ€™ã€</div><div class="line">int getopt(int argc, char * const argv[], const char *optstring);</div><div class="line"></div><div class="line">ä½¿ç”¨ï¼š</div><div class="line">$ ./a.out -Wall -o hello.c</div><div class="line"></div><div class="line">*/</div><div class="line">#include &lt;unistd.h&gt;</div><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;stdlib.h&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line">#include &lt;stdarg.h&gt;</div><div class="line"></div><div class="line">int debug_level = 0;</div><div class="line"></div><div class="line">#define _AUTHOR &quot;Late Lee&quot;</div><div class="line">#define _VERSION_STR &quot;1.0&quot;</div><div class="line">#define _DATE &quot;&quot;</div><div class="line"></div><div class="line">// é»˜è®¤æ‰“å°errorç­‰çº§</div><div class="line">enum</div><div class="line">&#123;</div><div class="line">    MSG_ERROR = 0,</div><div class="line">    MSG_WARNING,</div><div class="line">    MSG_INFO,</div><div class="line">    MSG_DEBUG,</div><div class="line">    MSG_MSGDUMP,</div><div class="line">    MSG_EXCESSIVE,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">void ll_printf(int level, const char *fmt, ...) __attribute__ ((format (printf, 2, 3)));</div><div class="line"></div><div class="line">void ll_printf(int level, const char *fmt, ...)</div><div class="line">&#123;</div><div class="line">    va_list ap;</div><div class="line"></div><div class="line">    va_start(ap, fmt);</div><div class="line">    if (debug_level &gt;= level)</div><div class="line">    &#123;</div><div class="line">#ifdef CONFIG_DEBUG_SYSLOG</div><div class="line">        if (wpa_debug_syslog) &#123;</div><div class="line">            vsyslog(syslog_priority(level), fmt, ap);</div><div class="line">        &#125; else &#123;</div><div class="line">#endif /* CONFIG_DEBUG_SYSLOG */</div><div class="line">        //debug_print_timestamp();</div><div class="line">#ifdef CONFIG_DEBUG_FILE</div><div class="line">        if (out_file) &#123;</div><div class="line">            vfprintf(out_file, fmt, ap);</div><div class="line">            fprintf(out_file, &quot;\n&quot;);</div><div class="line">        &#125; else &#123;</div><div class="line">#endif /* CONFIG_DEBUG_FILE */</div><div class="line">        vprintf(fmt, ap);</div><div class="line">        printf(&quot;\n&quot;);</div><div class="line">#ifdef CONFIG_DEBUG_FILE</div><div class="line">        &#125;</div><div class="line">#endif /* CONFIG_DEBUG_FILE */</div><div class="line">#ifdef CONFIG_DEBUG_SYSLOG</div><div class="line">        &#125;</div><div class="line">#endif /* CONFIG_DEBUG_SYSLOG */</div><div class="line">    &#125;</div><div class="line">    va_end(ap);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void show_version(char* name)</div><div class="line">&#123;</div><div class="line">    printf(&quot;%s by %s, version: %s\n&quot;, name, _AUTHOR, _VERSION_STR);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void usage(char* name)</div><div class="line">&#123;</div><div class="line">    show_version(name);</div><div class="line"></div><div class="line">    printf(&quot;    -h,    short help\n&quot;);</div><div class="line">    printf(&quot;    -v,    show version\n&quot;);</div><div class="line">    printf(&quot;    -d,    debug level\n&quot;);</div><div class="line"></div><div class="line">    exit(0);</div><div class="line">&#125;</div><div class="line"></div><div class="line">const char* my_opt = &quot;hOo:W:d:&quot;;</div><div class="line"></div><div class="line">int main(int argc, char *argv[])</div><div class="line">&#123;</div><div class="line">    int c;</div><div class="line">    const char* p1 = NULL;</div><div class="line">    const char* p2 = NULL;</div><div class="line">    const char* p3 = NULL;</div><div class="line">    while(1)</div><div class="line">    &#123;</div><div class="line">        c = getopt(argc, argv, my_opt);</div><div class="line">        printf(&quot;optind: %d\n&quot;, optind);</div><div class="line">        if (c &lt; 0)</div><div class="line">        &#123;</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line">        printf(&quot;option char: %x %c\n&quot;, c, c);</div><div class="line">        switch(c)</div><div class="line">        &#123;</div><div class="line">        case &apos;d&apos;:</div><div class="line">                debug_level = atoi(optarg);</div><div class="line">                printf(&quot;debug level: %d\n&quot;, debug_level);</div><div class="line">                break;</div><div class="line">        case &apos;O&apos;:</div><div class="line">                printf(&quot;optimization flag is open.\n\n&quot;);</div><div class="line">                break;</div><div class="line">        case &apos;o&apos;:</div><div class="line">                printf(&quot;the obj is: %s\n\n&quot;, optarg);</div><div class="line">                p1 = optarg;</div><div class="line">                break;</div><div class="line">        case &apos;W&apos;:</div><div class="line">                printf(&quot;optarg: %s\n\n&quot;, optarg);</div><div class="line">                p2 = optarg;</div><div class="line">                break;</div><div class="line">        case &apos;:&apos;:</div><div class="line">                fprintf(stderr, &quot;miss option char in optstring.\n&quot;);</div><div class="line">                break;</div><div class="line">        case &apos;?&apos;:</div><div class="line">        case &apos;h&apos;:</div><div class="line">        default:</div><div class="line">                usage(argv[0]);</div><div class="line">                break;</div><div class="line">                //return 0;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    if (optind == 1)</div><div class="line">    &#123;</div><div class="line">        usage(argv[0]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ll_printf(MSG_ERROR, &quot;p1: %s p2: %s\n&quot;, p1, p2);</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="ç½‘ç»œæ¨¡å—"><a href="#ç½‘ç»œæ¨¡å—" class="headerlink" title="ç½‘ç»œæ¨¡å—"></a>ç½‘ç»œæ¨¡å—</h4><h4 id="æ—¥å¿—æ¨¡å—"><a href="#æ—¥å¿—æ¨¡å—" class="headerlink" title="æ—¥å¿—æ¨¡å—"></a>æ—¥å¿—æ¨¡å—</h4><h4 id="è¯»å–é…ç½®æ–‡ä»¶æ¨¡å—"><a href="#è¯»å–é…ç½®æ–‡ä»¶æ¨¡å—" class="headerlink" title="è¯»å–é…ç½®æ–‡ä»¶æ¨¡å—"></a>è¯»å–é…ç½®æ–‡ä»¶æ¨¡å—</h4><h4 id="å†…å­˜æ± æ¨¡å—"><a href="#å†…å­˜æ± æ¨¡å—" class="headerlink" title="å†…å­˜æ± æ¨¡å—"></a>å†…å­˜æ± æ¨¡å—</h4><h4 id="ç¼“å­˜åº“æ¨¡å—"><a href="#ç¼“å­˜åº“æ¨¡å—" class="headerlink" title="ç¼“å­˜åº“æ¨¡å—"></a>ç¼“å­˜åº“æ¨¡å—</h4><h4 id="æ–‡ä»¶ç³»ç»Ÿæ¨¡å—"><a href="#æ–‡ä»¶ç³»ç»Ÿæ¨¡å—" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿæ¨¡å—"></a>æ–‡ä»¶ç³»ç»Ÿæ¨¡å—</h4><h4 id="ç®¡ç†åå°æ¨¡å—"><a href="#ç®¡ç†åå°æ¨¡å—" class="headerlink" title="ç®¡ç†åå°æ¨¡å—"></a>ç®¡ç†åå°æ¨¡å—</h4><h4 id="æ•°æ®åº“æ¨¡å—"><a href="#æ•°æ®åº“æ¨¡å—" class="headerlink" title="æ•°æ®åº“æ¨¡å—"></a>æ•°æ®åº“æ¨¡å—</h4><h3 id="æŠ€å·§ç±»"><a href="#æŠ€å·§ç±»" class="headerlink" title="æŠ€å·§ç±»"></a>æŠ€å·§ç±»</h3><h4 id="Linuxç¨‹åºä¸­é¢„å®šä¹‰çš„å‡ ä¸ªè°ƒè¯•å®"><a href="#Linuxç¨‹åºä¸­é¢„å®šä¹‰çš„å‡ ä¸ªè°ƒè¯•å®" class="headerlink" title="Linuxç¨‹åºä¸­é¢„å®šä¹‰çš„å‡ ä¸ªè°ƒè¯•å®"></a>Linuxç¨‹åºä¸­é¢„å®šä¹‰çš„å‡ ä¸ªè°ƒè¯•å®</h4><p>Linuxä¸‹Cè¯­è¨€ç¼–ç¨‹ä¸­æœ‰å‡ ä¸ªå¾ˆå®ç”¨çš„è°ƒè¯•å®
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">__LINE__ __FILE__  __FUNCTION__ __TIME__ __DATA__</div></pre></td></tr></table></figure></p>
<p>è¿™å‡ ä¸ªé¢„å®šä¹‰å®æ˜¯å±äºANSIæ ‡å‡†çš„ï¼Œå†…ç½®äºç¼–è¯‘å™¨ï¼Œå…¨å±€æ€§çš„å˜é‡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°ä»£ç è·Ÿè¸ªè°ƒè¯•ï¼Œä¸æ˜¯åœ¨å“ªä¸ªå¤´æ–‡ä»¶ä¸­åŒ…å«çš„ï¼Œè§ä¸‹ä¾‹ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line"></div><div class="line">int main()</div><div class="line">&#123;</div><div class="line">    printf(&quot;The file is %s.\n&quot;,__FILE__);</div><div class="line">    printf( &quot;The date is %s.\n&quot;, __DATE__ );</div><div class="line">    printf( &quot;The time is %s.\n&quot;, __TIME__ );</div><div class="line">    printf( &quot;This is line %d.\n&quot;, __LINE__ );</div><div class="line">    printf( &quot;This function is %s.\n&quot;, __FUNCTION__ );   </div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœ:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">The file is macro.c.</div><div class="line">The date is Aug 24 2012.</div><div class="line">The time is 23:13:26.</div><div class="line">This is line 8.</div><div class="line">This function is main.</div></pre></td></tr></table></figure></p>
<p><code>line è¡Œæ•° æ–‡ä»¶å</code>æŒ‡ä»¤å¯ä»¥æ”¹å˜å®ƒçš„å€¼ï¼Œç®€å•çš„è®²ï¼Œç¼–è¯‘æ—¶ï¼Œå®ƒä»¬åŒ…å«ç¨‹åºçš„å½“å‰è¡Œæ•°å’Œæ–‡ä»¶åã€‚</p>
<p>DATE å®æŒ‡ä»¤å«æœ‰å½¢å¼ä¸ºæœˆ/æ—¥/å¹´çš„ä¸²,è¡¨ç¤ºæºæ–‡ä»¶è¢«ç¿»è¯‘åˆ°ä»£ç æ—¶çš„æ—¥æœŸã€‚
TIME å®æŒ‡ä»¤åŒ…å«ç¨‹åºç¼–è¯‘çš„æ—¶é—´ã€‚æ—¶é—´ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå…¶å½¢å¼ä¸ºæ—¶ï¼šåˆ†ï¼šç§’</p>
<p><code>__func__</code>ä»£è¡¨è¿™æ¡è¯­å¥æ‰€åœ¨çš„å‡½æ•°çš„å‡½æ•°å</p>
<h4 id="è”åˆä½“ç”¨é€”"><a href="#è”åˆä½“ç”¨é€”" class="headerlink" title="è”åˆä½“ç”¨é€”"></a>è”åˆä½“ç”¨é€”</h4><p>å­—èŠ‚åºæœ‰ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ï¼šå¤§ç«¯æ³•ï¼ˆbig endingï¼‰ï¼Œå°ç«¯æ³•ï¼ˆlittle  endingï¼‰ã€‚ç½‘ç»œå­—èŠ‚åºé‡‡ç”¨çš„æ˜¯å¤§ç«¯æ³•ã€‚ä¸»æœºå­—èŠ‚åºä¸åŒçš„CPUé‡‡ç”¨çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä»£ç æ¥æŸ¥çœ‹è‡ªå·±ä¸»æœºçš„å­—èŠ‚åºã€‚</p>
<ul>
<li>å¤§ç«¯æ³•ï¼šé«˜ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜ä½åœ°å€ç«¯ï¼Œä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚</li>
<li>å°ç«¯æ³•ï¼šä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ç«¯ï¼Œé«˜ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚
çœ‹ä¸€ä¸ªunsigned short æ•°æ®ï¼Œå®ƒå 2ä¸ªå­—èŠ‚ï¼Œç»™å®ƒèµ‹å€¼0x1234ã€‚</li>
<li>è‹¥é‡‡ç”¨çš„å¤§ç«¯æ³•ï¼Œåˆ™å…¶ä½åœ°å€ç«¯åº”è¯¥å­˜æ”¾çš„æ˜¯0x12ï¼›</li>
<li>è‹¥é‡‡ç”¨çš„å°ç«¯æ³•ï¼Œåˆ™å…¶ä½åœ°å€ç«¯åº”è¯¥å­˜æ”¾çš„æ˜¯0x34ï¼›
å¯ä»¥é€šè¿‡è”åˆä½“æ¥è·å¾—å…¶é«˜ä½åœ°å€çš„æ•°æ®ã€‚æµ‹è¯•ä¸»æœºå­—èŠ‚åºçš„ä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">typedef union&#123;</div><div class="line">    unsigned short value;</div><div class="line">    unsigned char bytes[2];</div><div class="line">&#125;Test;</div><div class="line"></div><div class="line">int main(void)</div><div class="line">&#123;</div><div class="line">    Test test_value;</div><div class="line">    test_value.value = 0x1234;</div><div class="line">    if(test_value.bytes[0] == 0x12 &amp;&amp; test_value.bytes[1] == 0x34)</div><div class="line">    &#123;</div><div class="line">        printf(&quot;big ending&quot;);</div><div class="line">    &#125;</div><div class="line">    else if(test_value.bytes[0] == 0x34 &amp;&amp; test_value.bytes[1] == 0x12)</div><div class="line">    &#123;</div><div class="line">        printf(&quot;little ending&quot;);</div><div class="line">    &#125;else&#123;</div><div class="line">        printf(&quot;use test_value error&quot;);</div><div class="line">    &#125;</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h3><h4 id="è‡ªå®šä¹‰æ—¥å¿—çš„è°ƒè¯•æ‰“å°ä¿¡æ¯"><a href="#è‡ªå®šä¹‰æ—¥å¿—çš„è°ƒè¯•æ‰“å°ä¿¡æ¯" class="headerlink" title="è‡ªå®šä¹‰æ—¥å¿—çš„è°ƒè¯•æ‰“å°ä¿¡æ¯"></a>è‡ªå®šä¹‰æ—¥å¿—çš„è°ƒè¯•æ‰“å°ä¿¡æ¯</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#define TRACE_NONE      0</div><div class="line">#define TRACE_FATAL     1</div><div class="line">#define TRACE_ERROR     2</div><div class="line">#define TRACE_WARNING   3</div><div class="line">#define TRACE_INFO      4</div><div class="line">#define TRACE_DEBUG     5</div><div class="line"></div><div class="line">#define TRACE_LEN_MAX    64</div><div class="line"></div><div class="line">extern int  *TraceLevel;</div><div class="line">extern char TraceName[TRACE_LEN_MAX + 1];</div><div class="line"></div><div class="line">#define Log(A, format,args...) \</div><div class="line">    ((TraceLevel == NULL || TraceName == NULL || *TraceLevel &lt; (A)) ? 0 : LogMsg(A, __FILE__, __LINE__, format, ##args))</div><div class="line"></div><div class="line">#define LogFatal(format,args...) \</div><div class="line">    Log(TRACE_FATAL, format, ##args)</div><div class="line">#define LogError(format,args...) \</div><div class="line">    Log(TRACE_ERROR, format, ##args)</div><div class="line">#define LogWarning(format,args...) \</div><div class="line">    Log(TRACE_WARNING, format, ##args)</div><div class="line">#define LogInfo(format,args...) \</div><div class="line">    Log(TRACE_INFO, format, ##args)</div><div class="line">#define LogDebug(format,args...) \</div><div class="line">    Log(TRACE_DEBUG, format, ##args)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">int LogMsg(int level, const char *filename,</div><div class="line">           int line, const char *fmt, ...)</div><div class="line">&#123;</div><div class="line">    va_list      ap;</div><div class="line">    FILE         *fp;</div><div class="line">    char         sLogFile[128 + 1];</div><div class="line">    char         sCurrTime[6 + 1];</div><div class="line">    struct timeb tTimeB;</div><div class="line">    char         sMilliTM[4];</div><div class="line"></div><div class="line">    memset(sLogFile, 0, sizeof(sLogFile));</div><div class="line">    LogFile(sLogFile);</div><div class="line">    GetTime_HHMMSS(sCurrTime);</div><div class="line">    memset(&amp;tTimeB, 0, sizeof(tTimeB));    </div><div class="line">    ftime(&amp;tTimeB);</div><div class="line">    snprintf(sMilliTM, sizeof(sMilliTM), &quot;%03d&quot;, tTimeB.millitm);</div><div class="line"></div><div class="line">    fp = fopen(sLogFile, &quot;a+&quot;);</div><div class="line">    if (fp != (FILE*)NULL) &#123;</div><div class="line">        fprintf(fp, &quot;[%08d][%.6s:%.3s][%16s][%04d][%7s]&quot;,</div><div class="line">                getpid(), sCurrTime, sMilliTM, filename, line, g_LevelDsp[level]);</div><div class="line">        va_start(ap, fmt);</div><div class="line">        vfprintf(fp, fmt, ap);</div><div class="line">        va_end(ap);</div><div class="line">        fprintf(fp, &quot;\n&quot;);</div><div class="line">        fflush(fp);</div><div class="line">        fclose(fp);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å†åœ¨åå°è¿›ç¨‹ä¸­è®¾ç½®TraceLevelå’ŒTraceNameå³å¯ã€‚</p>
<h4 id="è·å–å½“å‰ç³»ç»Ÿæ—¥æœŸã€æ—¶é—´"><a href="#è·å–å½“å‰ç³»ç»Ÿæ—¥æœŸã€æ—¶é—´" class="headerlink" title="è·å–å½“å‰ç³»ç»Ÿæ—¥æœŸã€æ—¶é—´"></a>è·å–å½“å‰ç³»ç»Ÿæ—¥æœŸã€æ—¶é—´</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/*****************************************************************************</div><div class="line">  **  å‡½æ•°åç§°: GetDate</div><div class="line">  **  åŠŸèƒ½æè¿°: å–å½“å‰ç³»ç»Ÿæ—¥æœŸ                           </div><div class="line">  **  å½“å‰ç‰ˆæœ¬: 1.0.0.0                                                    </div><div class="line">  **  ä½œ    è€…:                                             </div><div class="line">  **  ä¿®    æ”¹ï¼š                                                        </div><div class="line">  **  è¾“å…¥å‚æ•°:</div><div class="line">  **  è¾“å‡ºå‚æ•°: char * psDate  -- ç³»ç»Ÿæ—¥æœŸ, æ ¼å¼ä¸ºyyyymmdd</div><div class="line">  **  è¿”å›ç»“æœï¼šint</div><div class="line">                   0    ---&gt;  æˆåŠŸ</div><div class="line">  ****************************************************************************/</div><div class="line">int GetDate(char * psDate)</div><div class="line">&#123;</div><div class="line">    time_t nSeconds;</div><div class="line">    struct tm * pTM;</div><div class="line"></div><div class="line">    time(&amp;nSeconds);</div><div class="line">    pTM = localtime(&amp;nSeconds);</div><div class="line"></div><div class="line">    /* ç³»ç»Ÿæ—¥æœŸ, æ ¼å¼ï¼šYYYYMMDD */</div><div class="line">    sprintf( psDate,&quot;%04d%02d%02d&quot;,</div><div class="line">            pTM-&gt;tm_year + 1900, pTM-&gt;tm_mon + 1,pTM-&gt;tm_mday );</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/*****************************************************************************</div><div class="line">  **  å‡½æ•°åç§°: GetTime</div><div class="line">  **  åŠŸèƒ½æè¿°: å–å½“å‰ç³»ç»Ÿæ—¶é—´                           </div><div class="line">  **  å½“å‰ç‰ˆæœ¬: 1.0.0.0                                                    </div><div class="line">  **  ä½œ    è€…:                                            </div><div class="line">  **  ä¿®    æ”¹ï¼š                                                        </div><div class="line">  **  è¾“å…¥å‚æ•°:</div><div class="line">  **  è¾“å‡ºå‚æ•°: char * psTime  -- ç³»ç»Ÿæ—¶é—´, æ ¼å¼ä¸ºHHMMSS</div><div class="line">  **  è¿”å›ç»“æœï¼šint</div><div class="line">                   0    ---&gt;  æˆåŠŸ</div><div class="line">  ****************************************************************************/</div><div class="line">int GetTime(char * psTime)</div><div class="line">&#123;</div><div class="line">    time_t nSeconds;</div><div class="line">    struct tm * pTM;</div><div class="line"></div><div class="line">    time(&amp;nSeconds);</div><div class="line">    pTM = localtime(&amp;nSeconds);</div><div class="line"></div><div class="line">    /* ç³»ç»Ÿæ—¶é—´, æ ¼å¼ï¼šHHMMSS */</div><div class="line">    sprintf( psTime,&quot;%02d%02d%02d&quot;,</div><div class="line">            pTM-&gt;tm_hour,pTM-&gt;tm_min, pTM-&gt;tm_sec);</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">/*****************************************************************************</div><div class="line">  **  å‡½æ•°åç§°: GetDateTime</div><div class="line">  **  åŠŸèƒ½æè¿°: å–å½“å‰ç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´                           </div><div class="line">  **  å½“å‰ç‰ˆæœ¬: 1.0.0.0                                                    </div><div class="line">  **  ä½œ    è€…:                                            </div><div class="line">  **  ä¿®    æ”¹ï¼š                                                        </div><div class="line">  **  è¾“å…¥å‚æ•°:</div><div class="line">  **  è¾“å‡ºå‚æ•°: char * psDateTime  -- ç³»ç»Ÿæ—¥æœŸæ—¶é—´, æ ¼å¼ä¸ºyyyymmddHHMMSS</div><div class="line">  **  è¿”å›ç»“æœï¼šint</div><div class="line">                   0    ---&gt;  æˆåŠŸ</div><div class="line">  ****************************************************************************/</div><div class="line">int GetDateTime(char * psDateTime)</div><div class="line">&#123;</div><div class="line">    time_t nSeconds;</div><div class="line">    struct tm * pTM;</div><div class="line"></div><div class="line">    time(&amp;nSeconds);</div><div class="line">    pTM = localtime(&amp;nSeconds);</div><div class="line"></div><div class="line">    /* ç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´, æ ¼å¼ï¼šyyyymmddHHMMSS */</div><div class="line">    sprintf( psDateTime,&quot;%04d%02d%02d%02d%02d%02d&quot;,</div><div class="line">            pTM-&gt;tm_year + 1900, pTM-&gt;tm_mon + 1,pTM-&gt;tm_mday,</div><div class="line">            pTM-&gt;tm_hour,pTM-&gt;tm_min, pTM-&gt;tm_sec );</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è°ƒç”¨çš„æ—¶å€™å®šä¹‰ä¸€ä¸ªcharæ•°ç»„ï¼Œå¤§å°ä¸ºæ—¥æœŸçš„é•¿åº¦å¤§å°åŠ 1ï¼Œç„¶åç›´æ¥è°ƒç”¨ä¸Šé¢çš„å‡½æ•°ï¼Œå‚æ•°ä¸ºæ•°ç»„åå³å¯ã€‚
ã€€ã€€å½“ç„¶ï¼Œè¿˜æœ‰å…¶ä»–è®¸å¤šå…³äºæ—¥æœŸã€æ—¶é—´æ“ä½œçš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸åŒæ—¥æœŸã€æ—¶é—´æ ¼å¼é—´çš„è½¬æ¢ç­‰ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;æ¶æ„ç±»&quot;&gt;&lt;a href=&quot;#æ¶æ„ç±»&quot; class=&quot;headerlink&quot; title=&quot;æ¶æ„ç±»&quot;&gt;&lt;/a&gt;æ¶æ„ç±»&lt;/h3&gt;&lt;h4 id=&quot;Linux-Cä»£ç å®ç°ä¸»å‡½æ•°å‚æ•°é€‰é¡¹è§£æ&quot;&gt;&lt;a href=&quot;#Linux-Cä»£ç å®ç°ä¸»å‡½æ•°å‚æ•°é€‰é¡¹è§£æ&quot; class=&quot;
    
    </summary>
    
      <category term="language" scheme="http://wodekouwei.com/categories/language/"/>
    
    
      <category term="tips" scheme="http://wodekouwei.com/tags/tips/"/>
    
      <category term="language" scheme="http://wodekouwei.com/tags/language/"/>
    
      <category term="C" scheme="http://wodekouwei.com/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>FQA</title>
    <link href="http://wodekouwei.com/2017/07/25/FQA/"/>
    <id>http://wodekouwei.com/2017/07/25/FQA/</id>
    <published>2017-07-25T12:42:03.000Z</published>
    <updated>2017-07-25T12:43:47.000Z</updated>
    
    <content type="html"><![CDATA[<h5 id="sshè¿æ¥æœåŠ¡å™¨å‡ºé”™"><a href="#sshè¿æ¥æœåŠ¡å™¨å‡ºé”™" class="headerlink" title="sshè¿æ¥æœåŠ¡å™¨å‡ºé”™"></a>sshè¿æ¥æœåŠ¡å™¨å‡ºé”™</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</div><div class="line">@ WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED! @</div><div class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</div><div class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</div><div class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</div><div class="line">It is also possible that a host key has just been changed.</div><div class="line">The fingerprint for the RSA key sent by the remote host is</div><div class="line">da:f7:3e:ba:f7:00:e6:44:76:f2:58:6e:48:**.</div><div class="line">Please contact your system administrator.</div><div class="line">Add correct host key in /ç”¨æˆ·homeç›®å½•/.ssh/known_hosts to get rid of this message.</div><div class="line">Offending RSA key in /ç”¨æˆ·homeç›®å½•/.ssh/known_hosts:1</div><div class="line">RSA host key for ipåœ°å€ has changed and you have requested strict checking.</div><div class="line">Host key verification failed.</div></pre></td></tr></table></figure>
<p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯,ç¬¬ä¸€æ¬¡ä½¿ç”¨SSHè¿æ¥æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè®¤è¯ï¼Œå‚¨å­˜åœ¨å®¢æˆ·ç«¯çš„known_hostsä¸­.</p>
<p>å¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æŸ¥çœ‹:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -l -f ~/.ssh/known_hosts</div></pre></td></tr></table></figure></p>
<p>ç”±äºæœåŠ¡å™¨é‡æ–°å®‰è£…ç³»ç»Ÿäº†ï¼Œæ‰€ä»¥ä¼šå‡ºç°ä»¥ä¸Šé”™è¯¯ã€‚
è§£å†³åŠæ³•:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -R æœåŠ¡å™¨ç«¯çš„ipåœ°å€</div></pre></td></tr></table></figure></p>
<p>æˆ–è€…ç›´æ¥åœ¨known_hostsä¸­åˆ é™¤å¯¹åº”ipçš„è¡Œ</p>
]]></content>
    
    <summary type="html">
    
      &lt;h5 id=&quot;sshè¿æ¥æœåŠ¡å™¨å‡ºé”™&quot;&gt;&lt;a href=&quot;#sshè¿æ¥æœåŠ¡å™¨å‡ºé”™&quot; class=&quot;headerlink&quot; title=&quot;sshè¿æ¥æœåŠ¡å™¨å‡ºé”™&quot;&gt;&lt;/a&gt;sshè¿æ¥æœåŠ¡å™¨å‡ºé”™&lt;/h5&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;t
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Webrtcçº¿ç¨‹æ¨¡å‹</title>
    <link href="http://wodekouwei.com/2017/07/23/webrtc-source-thread/"/>
    <id>http://wodekouwei.com/2017/07/23/webrtc-source-thread/</id>
    <published>2017-07-23T02:22:18.000Z</published>
    <updated>2017-07-24T07:07:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>webrtcçš„baseçš„ threadï¼Œæ˜¯æˆ‘è§è¿‡çš„å°è£…æœ€å¸…çš„c++çº¿ç¨‹åº“ï¼Œæ ¹æ®æ¯”qtçš„è¿˜å¥½ç”¨,å‘ä¸ªä¾‹å­ç»™ä½ 
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"> using namespace webrtc;</div><div class="line">using namespace rtc;</div><div class="line">//std::cout&lt;&lt;&quot;Thread::Current()ï¼š&quot; &lt;&lt; Thread::Current()-&gt;GetId();</div><div class="line">//Thread::Current()-&gt;Start(); ä¸èƒ½è°ƒç”¨startï¼Œå› ä¸ºä¸æ˜¯æˆ‘åˆ›å»ºçš„ï¼Œä»–å·²ç»å¼€å§‹äº†</div><div class="line">   //Thread::Current()-&gt;Run(); //é˜»å¡å½“å‰çº¿ç¨‹è¿›å…¥çº¿ç¨‹å¾ªç¯</div><div class="line"></div><div class="line">Thread * thread = new Thread();</div><div class="line">//MyRunnable run;</div><div class="line">//thread-&gt;Start(&amp;run);//å¯ä»¥å¸¦ä¸€ä¸ªRunnableå‚æ•°è¿è¡Œ,è¿è¡Œå®Œå°±ç»“æŸï¼Œå¦åˆ™è¿è¡ŒThread::Runè¿›å…¥æ¶ˆæ¯å¾ªç¯</div><div class="line">thread-&gt;Start();</div><div class="line">//std::cout &lt;&lt; &quot;Thread::Invoke()ï¼š&quot;&lt;&lt; thread-&gt;Invoke&lt;bool&gt;(RTC_FROM_HERE, &amp;task)&lt;&lt; &quot; at &quot; &lt;&lt; Thread::Current()-&gt;GetId() &lt;&lt; std::endl;</div><div class="line">thread-&gt;Post(RTC_FROM_HERE, Bind(task2));//å°†æœ€å¸¸ç”¨çš„</div><div class="line">auto  handler= new MessageClient;</div><div class="line">//thread-&gt;PostAt(RTC_FROM_HERE, (int64_t)3000,handler);</div><div class="line">//thread-&gt;PostDelayed(RTC_FROM_HERE, (int64_t)5000, handler);</div><div class="line">//thread-&gt;Stop();</div><div class="line"></div><div class="line"></div><div class="line">Thread * thread2 = new Thread();</div><div class="line">thread2-&gt;Start();</div><div class="line">thread2-&gt;Post(RTC_FROM_HERE, Bind(task2));//å°†æœ€å¸¸ç”¨çš„</div><div class="line">//thread2-&gt;Invoke() éå¸¸æœ‰ç”¨ï¼Œåœ¨ä»»ä½•åœ°æ–¹å¯ä»¥æŒ‡å®šæˆ‘çš„ä»£ç è¿è¡Œåœ¨æŸä¸ªçº¿ç¨‹</div><div class="line"></div><div class="line">//apiä¸‹çš„proxyæœºåˆ¶ï¼Œå®é™…ä¸Šå°±æ˜¯è®¾ç½®è¦æ‰§è¡Œçš„çº¿ç¨‹ï¼Œç„¶ååŠ é”ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æœã€‚è¿™æ˜¯æˆ‘è®¾è®¡å¯¹å¤–æ¥å£å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹è°ƒç”¨è€Œä¸å‡ºé”™çš„å¸¸ç”¨æ–¹æ³•</div><div class="line"></div><div class="line">//baseçš„asyncinvokerä¸proxyç±»ä¼¼çš„æœºåˆ¶ã€‚</div></pre></td></tr></table></figure></p>
<p>æœ‰iosçš„gdcï¼Œandroidçš„handlerå¼‚æ›²åŒå·¥</p>
<p>å› ä¸ºç¼–å†™å¤æ‚ç¨³å®šçš„å¤šçº¿ç¨‹C++é¡¹ç›®å®åœ¨å¤ªéš¾ï¼Œæ‰€ä»¥ä¸€ä¸ªå¥½çš„è·¨å¹³å°C++åŸºç¡€åº“æ˜¯æˆ‘æœ€æ±‚çš„ç›®æ ‡,ç›®å‰æ¯”è¾ƒæ¬£èµçš„é¡¹ç›®æœ‰ï¼š</p>
<p>Boost:å¤§è€Œå…¨ï¼Œç¼ºå°‘ä¸€äº›å¯ä»¥ç›´æ¥ä¸Šæ‰‹çš„ä¸œè¥¿å¦‚çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ™ºèƒ½æŒ‡é’ˆå¹¶éçº¿ç¨‹å®‰å…¨ã€‚
QT coreï¼šéå¸¸å¥½
C++11ï¼šä¹Ÿéœ€è¦çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œçº¿ç¨‹å®‰å…¨æ™ºèƒ½æŒ‡é’ˆã€‚
chromiumçš„baseåº“ï¼šå¤ªå¤§äº†
å½“æˆ‘çœ‹åˆ°webrtcçš„baseæ—¶ï¼Œéå¸¸æƒŠè®¶çš„å‘ç°å®ƒæ­£æ˜¯æˆ‘æƒ³è¦çš„,ç‰¹ç‚¹ï¼š</p>
<p>å°ï¼šåªæœ‰å‡ M
çº¯ï¼šåŸºäºc++æ ‡å‡†åº“å’Œå„æ“ä½œç³»ç»Ÿsdk
è·¨å¹³å°
å¯¹æ™ºèƒ½æŒ‡é’ˆã€çº¿ç¨‹ã€socketå°è£…éå¸¸å¥½ã€‚
ä¸æ–­æ›´æ–°ï¼ˆéœ€è¦ä¸€ç›´è·Ÿè¸ªå®˜æ–¹ä»£ç ï¼‰
ç§»æ¤å‡ºæ¥å•ç‹¬ä½¿ç”¨ï¼Œæ–¹æ¡ˆæœ‰ä¸‰ï¼š</p>
<p>æŠŠæºç æ‹·è´å‡ºæ¥ç”¨é€šç”¨çš„ç¼–è¯‘å·¥å…·ï¼ˆmakefileï¼Œcmakeï¼Œqmakeï¼‰ç®¡ç†ã€‚ï¼ˆmakefileè¾ƒå¤æ‚ï¼Œcmakeç®€å•ï¼Œqmakeæœ€ç®€å•ï¼‰
æŠŠæºç æ‹·è´å‡ºæ¥ç”¨åŸºäºè‡ªå¸¦çš„gnç®¡ç†
åœ¨webrtcé¡¹ç›®é‡Œé¢ç¼–è¯‘å’Œåˆå¹¶éœ€è¦çš„é™æ€åº“å’Œpdb</p>
<p>å› ä¸ºgoogleå®˜æ–¹è¯´äº†ï¼šå¼•ç”¨è®¡æ•°+å¼•ç”¨è®¡æ•°çš„æ™ºèƒ½åŒ–ï¼ˆscoped_ref_ptrï¼‰+å¼±å¼•ç”¨å°±å¯ä»¥è§£å†³é—®é¢˜ã€‚
shared_pträ¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºshared_ptræœ‰ä¸¤ä¸ªæˆå‘˜ï¼šå¼•ç”¨è®¡æ•°ï¼Œå’Œæºå¯¹è±¡æŒ‡é’ˆã€‚æ²¡åŠæ³•å¯¹ä¸¤ä¸ªæˆå‘˜åŒæ—¶å®ç°åŸå­æ“ä½œã€‚
ä½†unique_ptræ˜¯ä¸ªå¥½ä¸œè¥¿</p>
<p>æ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨ï¼š</p>
<ol>
<li>ä¸ç”¨å†ä½¿ç”¨deleteã€‚</li>
<li>å°½é‡ä½¿ç”¨unique_ptrã€‚</li>
<li>å¤šä¸ªçº¿ç¨‹è¯»å†™åŒä¸€ä¸ª shared_ptr å¯¹è±¡ï¼Œé‚£ä¹ˆéœ€è¦åŠ é”ã€‚</li>
<li>shared_ptr å’Œweak_ptré…åˆè§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</li>
</ol>
<p>weak_ptrå¿…é¡»ï¼Œocï¼Œswiftçš„ViewControlerå’Œæ§ä»¶éƒ½æ˜¯weakå…³ç³»</p>
<p>å†…å­˜ç®¡ç†æ¨¡å‹çš„ä¸‰ç§çº§åˆ«ï¼š
1 æ‰‹åŠ¨å†…å­˜ç®¡ç†(c/c++çš„mallocä¸freeï¼Œnewä¸delete)ï¼šå®¹æ˜“å‡ºé”™ã€‚
2 è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼ˆocçš„arcï¼Œc++çš„æ™ºèƒ½æŒ‡é’ˆï¼Œscoped_ptrï¼‰ï¼šå­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œé€šè¿‡ç¨‹åºå‘˜è‡ªå·±ç®¡ç†å¼ºå¼±å¼•ç”¨å…³ç³»è§£å†³ã€‚
3 åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆå¦‚java,pythonï¼‰ï¼šåå°GCé™ä½äº†ç¨‹åºæ•ˆç‡ï¼Œå¥½çš„ç¨‹åºå‘˜ä»ç„¶å¥½è€ƒè™‘javaçš„å¼ºå¼•ç”¨[è¡¨æƒ…]å¼•ç”¨/è½¯å¼•ç”¨/</p>
<p>3 çº¿ç¨‹æ¨¡å‹
1 ç”Ÿäº§è€…æ¶ˆè´¹æ¨¡å‹ï¼ˆmutexï¼Œconditionï¼‰ï¼šæœ€æœ€å¸¸ç”¨çš„æ¨¡å‹ã€‚
2 çº¿ç¨‹æ± æ¨¡å‹ï¼šè§£å†³å¤§é‡è¯·æ±‚åˆ†é…å¤ªå¤šçº¿ç¨‹çš„é—®é¢˜ã€‚æ¯”å¦‚ä¸€ä¸ªandroidå’Œiosçš„appï¼Œhttpè¯·æ±‚ä¼šå¾ˆå¤šå¾ˆå¤šã€‚
3 (ç€é‡å¼ºè°ƒï¼‰ä¸²è¡Œæ¨¡å‹ï¼šiosæœ‰GCD(Grand Central Dispatchï¼Œglobal queueæ˜¯çº¿ç¨‹æ± ï¼‰ï¼Œandroidæœ‰looperï¼Œ win32æœ‰PostMessageï¼Œboostæœ‰strand
è¯»å†™é”ï¼šç‰¹åˆ«åªæœ‰å†™æ‰ä¼šä¸å®‰å…¨çš„æƒ…å†µã€‚
å†ç»“åˆå…¶ä»–çš„æ‰‹æ®µä¼šè®©ç¨‹åºç®€æ´ä¼˜ç¾æ˜“è¯»ï¼šjavaçš„handlerï¼Œocçš„delegateå’Œblockã€swiftçš„é—­åŒ…ï¼Œmvcæ¨¡å¼ ï¼Œc++çš„function/bind/lambdaï¼Œpythonå’Œjavascriptçš„function</p>
<p>è€Œä¸²è¡Œæ¨¡å‹å°±æˆäº†è§£å†³è¿™ç±»å¤šçº¿ç¨‹é—®é¢˜çš„é¦–é€‰ï¼Œå°±æ˜¯çº¿ç¨‹æ¶ˆæ¯æ¨¡å‹ã€‚
åœ¨android ç³»ç»Ÿé‡Œé¢ï¼Œæ— æ•°è¿™æ ·çš„ä¾‹å­ã€‚</p>
<h3 id="æ¨¡å—å¤„ç†çº¿ç¨‹"><a href="#æ¨¡å—å¤„ç†çº¿ç¨‹" class="headerlink" title="æ¨¡å—å¤„ç†çº¿ç¨‹"></a>æ¨¡å—å¤„ç†çº¿ç¨‹</h3><p>Callæ„é€ æ–¹æ³•ä¸­åˆ›å»ºmodule_process_threadä¸pacer_threadä¸¤ä¸ªProcessThread.æ¥ç€ä¸ºmodule_process_threadæ³¨å†ŒCallStats, ReceiveSideCongestionController, SendSideCongestionControlleræ¨¡å—,ä¸ºpacer_threadæ³¨å†ŒPacedSender, RemoteBitrateEstimatoræ¨¡å—.</p>
<p>Call::CreateVideoSendStreamåˆ›å»ºVideoSendStreamæ—¶,å°†module_process_threadåšæ„é€ å‚æ•°ä¼ å…¥,è°ƒç”¨RegisterProcessThreadæ–¹æ³•,æ³¨å†Œæ‰€æœ‰çš„rtc_rtcpæ¨¡å—åˆ°module_process_threadçº¿ç¨‹.åŒæ ·çš„ä¸ºVideoReceiveStreamä¸­è®¾ç½®.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;webrtcçš„baseçš„ threadï¼Œæ˜¯æˆ‘è§è¿‡çš„å°è£…æœ€å¸…çš„c++çº¿ç¨‹åº“ï¼Œæ ¹æ®æ¯”qtçš„è¿˜å¥½ç”¨,å‘ä¸ªä¾‹å­ç»™ä½ 
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line
    
    </summary>
    
      <category term="webrtc" scheme="http://wodekouwei.com/categories/webrtc/"/>
    
    
      <category term="webrtc" scheme="http://wodekouwei.com/tags/webrtc/"/>
    
      <category term="æºç " scheme="http://wodekouwei.com/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>AndroidStudioå¸¸è§é—®é¢˜</title>
    <link href="http://wodekouwei.com/2017/07/23/tips-androidstudio/"/>
    <id>http://wodekouwei.com/2017/07/23/tips-androidstudio/</id>
    <published>2017-07-23T00:09:17.000Z</published>
    <updated>2017-07-24T01:24:17.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="å¦‚ä½•è§£å†³Unsupported-major-minor-version-52-0é—®é¢˜ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³Unsupported-major-minor-version-52-0é—®é¢˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³Unsupported major.minor version 52.0é—®é¢˜ï¼Ÿ"></a>å¦‚ä½•è§£å†³Unsupported major.minor version 52.0é—®é¢˜ï¼Ÿ</h4><blockquote>
<p><a href="http://www.jianshu.com/p/5eebd3c609d6" target="_blank" rel="external">http://www.jianshu.com/p/5eebd3c609d6</a></p>
</blockquote>
<p>è¿è¡Œ./gradlew :PandaAndroidDemo:releaseå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">FAILURE: Build failed with an exception.</div><div class="line"></div><div class="line">* Where:</div><div class="line">Build file &apos;/Users/shitianci/work/Lab/panda.android/PandaAndroidDemo/build.gradle&apos; line: 1</div><div class="line"></div><div class="line">* What went wrong:</div><div class="line">A problem occurred evaluating project &apos;:PandaAndroidDemo&apos;.</div><div class="line">&gt; java.lang.UnsupportedClassVersionError: com/android/build/gradle/AppPlugin : Unsupported major.minor version 52.0</div><div class="line"></div><div class="line">* Try:</div><div class="line">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.</div><div class="line"></div><div class="line">BUILD FAILED</div></pre></td></tr></table></figure></p>
<p>ç›´æ¥ç‚¹å‡» runæŒ‰é’® æˆ–è€… Buildâ†’Generate Build APK å´è¿è¡Œæ­£å¸¸ã€‚</p>
<p>è¿™é‡Œé¢æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<p>ä¸ºä»€ä¹ˆå‡ºç°Unsupported major.minor version 52.0ï¼Ÿ
ä¸ºä»€ä¹ˆgradleå‘½ä»¤å’Œandroid studioæŒ‰é’®è¿è¡Œç»“æœä¸ä¸€æ ·ï¼Ÿ</p>
<h5 id="é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆå‡ºç°Unsupported-major-minor-version-52-0ï¼Ÿ"><a href="#é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆå‡ºç°Unsupported-major-minor-version-52-0ï¼Ÿ" class="headerlink" title="é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆå‡ºç°Unsupported major.minor version 52.0ï¼Ÿ"></a>é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆå‡ºç°Unsupported major.minor version 52.0ï¼Ÿ</h5><p>åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€åœˆï¼Œæœ€ååœ¨stackoverflowæ‰¾åˆ°äº†æœ¬è´¨åŸå› 
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">You get this error because a Java 7 VM tries to load a class compiled for Java 8</div><div class="line"></div><div class="line">Java 8 has the class file version 52.0 but a Java 7 VM can only load class files up to version 51.0</div><div class="line"></div><div class="line">In your case the Java 7 VM is your gradle build and the class is com.android.build.gradle.AppPlugin</div></pre></td></tr></table></figure></p>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯javaçš„ç¼–è¯‘ç¯å¢ƒç‰ˆæœ¬å¤ªä½ï¼Œjava 8 class fileçš„ç‰ˆæœ¬æ˜¯52ï¼ŒJava 7è™šæ‹Ÿæœºåªèƒ½æ”¯æŒåˆ°51ã€‚æ‰€ä»¥éœ€è¦å‡çº§åˆ°java 8 vmæ‰è¡Œã€‚</p>
<h5 id="é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆgradleå‘½ä»¤å’Œandroid-studioæŒ‰é’®è¿è¡Œç»“æœä¸ä¸€æ ·ï¼Ÿ"><a href="#é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆgradleå‘½ä»¤å’Œandroid-studioæŒ‰é’®è¿è¡Œç»“æœä¸ä¸€æ ·ï¼Ÿ" class="headerlink" title="é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆgradleå‘½ä»¤å’Œandroid studioæŒ‰é’®è¿è¡Œç»“æœä¸ä¸€æ ·ï¼Ÿ"></a>é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆgradleå‘½ä»¤å’Œandroid studioæŒ‰é’®è¿è¡Œç»“æœä¸ä¸€æ ·ï¼Ÿ</h5><p>ä»é—®é¢˜1æ¥çœ‹ï¼Œè‚¯å®šAndroid StudioæŒ‰é’®è°ƒç”¨çš„æ˜¯java 8 vmï¼Œæ‰€ä»¥æŸ¥æ‰¾ä¸€ä¸‹ç³»ç»Ÿé…ç½®ï¼Œæœ€ç»ˆåœ¨Project Structureæ‰¾åˆ°äº†å¦‚ä¸‹è®¾ç½®ï¼š
Android Studio 2.2.2ä½¿ç”¨äº†è‡ªå¸¦çš„JDKç¯å¢ƒï¼Œå…¶åœ°å€ä¸º
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/Applications/Android Studio.app/Contents/jre/jdk/Contents/Home</div></pre></td></tr></table></figure></p>
<p>è€Œgradleå‘½ä»¤çš„æ‰§è¡Œç¯å¢ƒæ˜¯åœ¨gradle.propertiesé…ç½®çš„ï¼Œå…¶æŒ‡å‘ä¸ºï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">org.gradle.java.home=/Library/Java/JavaVirtualMachines/jdk1.7.0_71.jdk/Contents/home</div></pre></td></tr></table></figure></p>
<p>å°†å…¶ä¿®æ”¹ä¸ºï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">org.gradle.java.home=/Applications/Android Studio.app/Contents/jre/jdk/Contents/Home</div></pre></td></tr></table></figure></p>
<h4 id="INSTALL-PARSE-FAILED-NO-CERTIFICATESå®‰è£…é—®é¢˜"><a href="#INSTALL-PARSE-FAILED-NO-CERTIFICATESå®‰è£…é—®é¢˜" class="headerlink" title="INSTALL_PARSE_FAILED_NO_CERTIFICATESå®‰è£…é—®é¢˜"></a>INSTALL_PARSE_FAILED_NO_CERTIFICATESå®‰è£…é—®é¢˜</h4><p>Android studio
æ›´æ–°åˆ°25åæ‰“åŒ…é—®é¢˜ï¼Œæ‰“åŒ…åçš„åº”ç”¨å®‰è£…æç¤ºï¼šINSTALL_PARSE_FAILED_NO_CERTIFICATES
Android N å¼•å…¥ä¸€é¡¹æ–°çš„åº”ç”¨ç­¾åæ–¹æ¡ˆ APK Signature Scheme v2ï¼Œå®ƒèƒ½æä¾›æ›´å¿«çš„åº”ç”¨å®‰è£…æ—¶é—´å’Œæ›´å¤šé’ˆå¯¹æœªæˆæƒ</p>
<p>APK æ–‡ä»¶æ›´æ”¹çš„ä¿æŠ¤ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒAndroid Studio 2.2 å’Œ Android Gradle 2.2 æ’ä»¶ä¼šä½¿ç”¨ APK</p>
<p>Signature Scheme v2 å’Œä¼ ç»Ÿç­¾åæ–¹æ¡ˆæ¥ç­¾ç½²æ‚¨çš„åº”ç”¨ã€‚</p>
<p>è„çš„è§£å†³æ–¹å¼ï¼šä½¿ç”¨v1æ‰“åŒ…</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;å¦‚ä½•è§£å†³Unsupported-major-minor-version-52-0é—®é¢˜ï¼Ÿ&quot;&gt;&lt;a href=&quot;#å¦‚ä½•è§£å†³Unsupported-major-minor-version-52-0é—®é¢˜ï¼Ÿ&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•è§£å†³Un
    
    </summary>
    
      <category term="Android" scheme="http://wodekouwei.com/categories/Android/"/>
    
    
      <category term="Android" scheme="http://wodekouwei.com/tags/Android/"/>
    
      <category term="tips" scheme="http://wodekouwei.com/tags/tips/"/>
    
      <category term="AndroidStudio" scheme="http://wodekouwei.com/tags/AndroidStudio/"/>
    
  </entry>
  
</feed>
