<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="老司机种菜" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:type" content="article">
<meta property="og:title" content="tips-net-socket">
<meta property="og:url" content="http://wodekouwei.com/2019/03/13/tips-net-socket/index.html">
<meta property="og:site_name" content="老司机种菜">
<meta property="og:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:updated_time" content="2019-03-25T06:35:48.376Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="tips-net-socket">
<meta name="twitter:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wodekouwei.com/2019/03/13/tips-net-socket/"/>





  <title> tips-net-socket | 老司机种菜 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2021aa5f03a4203621d42ef374e0d5f7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">老司机种菜</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2019/03/13/tips-net-socket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                tips-net-socket
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-13T20:05:55+08:00">
                2019-03-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a class="cloud-tie-join-count" href="/2019/03/13/tips-net-socket/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count join-count" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div></pre></td><td class="code"><pre><div class="line">FCNTL(2)                    BSD System Calls Manual                   FCNTL(2)</div><div class="line"></div><div class="line">NAME</div><div class="line">     fcntl -- file control</div><div class="line"></div><div class="line">SYNOPSIS</div><div class="line">     #include &lt;fcntl.h&gt;</div><div class="line"></div><div class="line">     int</div><div class="line">     fcntl(int fildes, int cmd, ...);</div><div class="line"></div><div class="line">DESCRIPTION</div><div class="line">     fcntl() provides for control over descriptors.  The argument fildes is a descriptor to be operated on</div><div class="line">     by cmd as follows:</div><div class="line"></div><div class="line">     F_DUPFD            Return a new descriptor as follows:</div><div class="line"></div><div class="line">                            o   Lowest numbered available descriptor greater than or equal to arg.</div><div class="line">                            o   Same object references as the original descriptor.</div><div class="line">                            o   New descriptor shares the same file offset if the object was a file.</div><div class="line">                            o   Same access mode (read, write or read/write).</div><div class="line">                            o   Same file status flags (i.e., both file descriptors share the same file</div><div class="line">                                status flags).</div><div class="line">                            o   The close-on-exec flag associated with the new file descriptor is cleared</div><div class="line">                                so that the descriptor remains open across an execv(2) system call.</div><div class="line"></div><div class="line">     F_DUPFD_CLOEXEC    Like F_DUPFD, except that the close-on-exec flag associated with the new file</div><div class="line">                        descriptor is set.</div><div class="line"></div><div class="line">     F_GETFD            Get the flags associated with the file descriptor fildes, as described below (arg</div><div class="line">                        is ignored).</div><div class="line"></div><div class="line">     F_SETFD            Set the file descriptor flags to arg.</div><div class="line"></div><div class="line">     F_GETFL            Get descriptor status flags, as described below (arg is ignored).</div><div class="line"></div><div class="line">     F_SETFL            Set descriptor status flags to arg.</div><div class="line"></div><div class="line">     F_GETOWN           Get the process ID or process group currently receiving SIGIO and SIGURG signals;</div><div class="line">                        process groups are returned as negative values (arg is ignored).</div><div class="line"></div><div class="line">     F_SETOWN           Set the process or process group to receive SIGIO and SIGURG signals; process</div><div class="line">                        groups are specified by supplying arg as negative, otherwise arg is interpreted as</div><div class="line">                        a process ID.</div><div class="line"></div><div class="line">     F_GETPATH          Get the path of the file descriptor Fildes.  The argument must be a buffer of size</div><div class="line">                        MAXPATHLEN or greater.</div><div class="line"></div><div class="line">     F_PREALLOCATE      Preallocate file storage space. Note: upon success, the space that is allocated</div><div class="line">                        can be the size requested, larger than the size requested, or (if the</div><div class="line">                        F_ALLOCATEALL flag is not provided) smaller than the space requested.</div><div class="line"></div><div class="line">     F_PUNCHHOLE        Deallocate a region and replace it with a hole. Subsequent reads of the affected</div><div class="line">                        region will return bytes of zeros that are usually not backed by physical blocks.</div><div class="line">                        This will not change the actual file size. Holes must be aligned to file system</div><div class="line">                        block boundaries. This will fail on file systems that do not support this inter-</div><div class="line">                        face.</div><div class="line"></div><div class="line">     F_SETSIZE          Truncate a file without zeroing space.  The calling process must have root privi-</div><div class="line">                        leges.</div><div class="line"></div><div class="line">     F_RDADVISE         Issue an advisory read async with no copy to user.</div><div class="line"></div><div class="line">     F_RDAHEAD          Turn read ahead off/on.  A zero value in arg disables read ahead.  A non-zero</div><div class="line">                        value in arg turns read ahead on.</div><div class="line"></div><div class="line">     F_READBOOTSTRAP    Read bootstrap from disk.</div><div class="line"></div><div class="line">     F_WRITEBOOTSTRAP   Write bootstrap on disk.  The calling process must have root privileges.</div><div class="line"></div><div class="line">     F_NOCACHE          Turns data caching off/on. A non-zero value in arg turns data caching off.  A</div><div class="line">                        value of zero in arg turns data caching on.</div><div class="line"></div><div class="line">     F_LOG2PHYS         Get disk device information.  Currently this only returns the disk device address</div><div class="line">                        that corresponds to the current file offset. Note that the system may return -1 as</div><div class="line">                        the disk device address if the file is not backed by physical blocks. This is sub-</div><div class="line">                        ject to change.</div><div class="line"></div><div class="line">     F_LOG2PHYS_EXT     Variant of F_LOG2PHYS that uses the passed in file offset and length.</div><div class="line"></div><div class="line">     F_FULLFSYNC        Does the same thing as fsync(2) then asks the drive to flush all buffered data to</div><div class="line">                        the permanent storage device (arg is ignored).  This is currently implemented on</div><div class="line">                        HFS, MS-DOS (FAT), and Universal Disk Format (UDF) file systems.  The operation</div><div class="line">                        may take quite a while to complete.  Certain FireWire drives have also been known</div><div class="line">                        to ignore the request to flush their buffered data.</div><div class="line"></div><div class="line">     F_SETNOSIGPIPE     Determines whether a SIGPIPE signal will be generated when a write fails on a pipe</div><div class="line">                        or socket for which there is no reader.  If arg is non-zero, SIGPIPE generation is</div><div class="line">                        disabled for descriptor fildes, while an arg of zero enables it (the default).</div><div class="line"></div><div class="line">     F_GETNOSIGPIPE     Returns whether a SIGPIPE signal will be generated when a write fails on a pipe or</div><div class="line">                        socket for which there is no reader.  The semantics of the return value match</div><div class="line">                        those of the arg of F_SETNOSIGPIPE.</div><div class="line"></div><div class="line">     The flags for the F_GETFD and F_SETFD commands are as follows:</div><div class="line"></div><div class="line">           FD_CLOEXEC   Close-on-exec; the given file descriptor will be automatically closed in the suc-</div><div class="line">                        cessor process image when one of the execv(2) or posix_spawn(2) family of system</div><div class="line">                        calls is invoked.</div><div class="line"></div><div class="line">     The flags for the F_GETFL and F_SETFL commands are as follows:</div><div class="line"></div><div class="line">           O_NONBLOCK   Non-blocking I/O; if no data is available to a read call, or if a write operation</div><div class="line">                        would block, the read or write call returns -1 with the error EAGAIN.</div><div class="line"></div><div class="line">           O_APPEND     Force each write to append at the end of file; corresponds to the O_APPEND flag of</div><div class="line">                        open(2).</div><div class="line"></div><div class="line">           O_ASYNC      Enable the SIGIO signal to be sent to the process group when I/O is possible,</div><div class="line">                        e.g., upon availability of data to be read.</div><div class="line"></div><div class="line">     Several commands are available for doing advisory file locking; they all operate on the following</div><div class="line">     structure:</div><div class="line"></div><div class="line">             struct flock &#123;</div><div class="line">                 off_t       l_start;    /* starting offset */</div><div class="line">                 off_t       l_len;      /* len = 0 means until end of file */</div><div class="line">                 pid_t       l_pid;      /* lock owner */</div><div class="line">                 short       l_type;     /* lock type: read/write, etc. */</div><div class="line">                 short       l_whence;   /* type of l_start */</div><div class="line">             &#125;;</div><div class="line"></div><div class="line">     The commands available for advisory record locking are as follows:</div><div class="line"></div><div class="line">     F_GETLK    Get the first lock that blocks the lock description pointed to by the third argument, arg,</div><div class="line">                taken as a pointer to a struct flock (see above).  The information retrieved overwrites</div><div class="line">                the information passed to fcntl in the flock structure.  If no lock is found that would</div><div class="line">                prevent this lock from being created, the structure is left unchanged by this function</div><div class="line">                call except for the lock type which is set to F_UNLCK.</div><div class="line"></div><div class="line">     F_SETLK    Set or clear a file segment lock according to the lock description pointed to by the third</div><div class="line">                argument, arg, taken as a pointer to a struct flock (see above).  F_SETLK is used to</div><div class="line">                establish shared (or read) locks (F_RDLCK) or exclusive (or write) locks, (F_WRLCK), as</div><div class="line">                well as remove either type of lock (F_UNLCK).  If a shared or exclusive lock cannot be</div><div class="line">                set, fcntl returns immediately with EAGAIN.</div><div class="line"></div><div class="line">     F_SETLKW   This command is the same as F_SETLK except that if a shared or exclusive lock is blocked</div><div class="line">                by other locks, the process waits until the request can be satisfied.  If a signal that is</div><div class="line">                to be caught is received while fcntl is waiting for a region, the fcntl will be inter-</div><div class="line">                rupted if the signal handler has not specified the SA_RESTART (see sigaction(2)).</div><div class="line"></div><div class="line">     When a shared lock has been set on a segment of a file, other processes can set shared locks on that</div><div class="line">     segment or a portion of it.  A shared lock prevents any other process from setting an exclusive lock</div><div class="line">     on any portion of the protected area.  A request for a shared lock fails if the file descriptor was</div><div class="line">     not opened with read access.</div><div class="line"></div><div class="line">     An exclusive lock prevents any other process from setting a shared lock or an exclusive lock on any</div><div class="line">     portion of the protected area.  A request for an exclusive lock fails if the file was not opened with</div><div class="line">     write access.</div><div class="line"></div><div class="line">     The value of l_whence is SEEK_SET, SEEK_CUR, or SEEK_END to indicate that the relative offset,</div><div class="line">     l_start bytes, will be measured from the start of the file, current position, or end of the file,</div><div class="line">     respectively.  The value of l_len is the number of consecutive bytes to be locked.  If l_len is nega-</div><div class="line">     tive, the result is undefined.  The l_pid field is only used with F_GETLK to return the process ID of</div><div class="line">     the process holding a blocking lock.  After a successful F_GETLK request, the value of l_whence is</div><div class="line">     SEEK_SET.</div><div class="line"></div><div class="line">     Locks may start and extend beyond the current end of a file, but may not start or extend before the</div><div class="line">     beginning of the file.  A lock is set to extend to the largest possible value of the file offset for</div><div class="line">     that file if l_len is set to zero. If l_whence and l_start point to the beginning of the file, and</div><div class="line">     l_len is zero, the entire file is locked.  If an application wishes only to do entire file locking,</div><div class="line">     the flock(2) system call is much more efficient.</div><div class="line"></div><div class="line">     There is at most one type of lock set for each byte in the file.  Before a successful return from an</div><div class="line">     F_SETLK or an F_SETLKW request when the calling process has previously existing locks on bytes in the</div><div class="line">     region specified by the request, the previous lock type for each byte in the specified region is</div><div class="line">     replaced by the new lock type.  As specified above under the descriptions of shared locks and exclu-</div><div class="line">     sive locks, an F_SETLK or an F_SETLKW request fails or blocks respectively when another process has</div><div class="line">     existing locks on bytes in the specified region and the type of any of those locks conflicts with the</div><div class="line">     type specified in the request.</div><div class="line"></div><div class="line">     This interface follows the completely stupid semantics of System V and IEEE Std 1003.1-1988</div><div class="line">     (``POSIX.1&apos;&apos;) that require that all locks associated with a file for a given process are removed when</div><div class="line">     any file descriptor for that file is closed by that process.  This semantic means that applications</div><div class="line">     must be aware of any files that a subroutine library may access.  For example if an application for</div><div class="line">     updating the password file locks the password file database while making the update, and then calls</div><div class="line">     getpwname(3) to retrieve a record, the lock will be lost because getpwname(3) opens, reads, and</div><div class="line">     closes the password database.  The database close will release all locks that the process has associ-</div><div class="line">     ated with the database, even if the library routine never requested a lock on the database.  Another</div><div class="line">     minor semantic problem with this interface is that locks are not inherited by a child process created</div><div class="line">     using the fork(2) function.  The flock(2) interface has much more rational last close semantics and</div><div class="line">     allows locks to be inherited by child processes.  Flock(2) is recommended for applications that want</div><div class="line">     to ensure the integrity of their locks when using library routines or wish to pass locks to their</div><div class="line">     children.  Note that flock(2) and fcntl(2) locks may be safely used concurrently.</div><div class="line"></div><div class="line">     All locks associated with a file for a given process are removed when the process terminates.</div><div class="line"></div><div class="line">     A potential for deadlock occurs if a process controlling a locked region is put to sleep by attempt-</div><div class="line">     ing to lock the locked region of another process.  This implementation detects that sleeping until a</div><div class="line">     locked region is unlocked would cause a deadlock and fails with an EDEADLK error.</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">     The F_PREALLOCATE command operates on the following structure:</div><div class="line"></div><div class="line">             typedef struct fstore &#123;</div><div class="line">                 u_int32_t fst_flags;      /* IN: flags word */</div><div class="line">                 int       fst_posmode;    /* IN: indicates offset field */</div><div class="line">                 off_t     fst_offset;     /* IN: start of the region */</div><div class="line">                 off_t     fst_length;     /* IN: size of the region */</div><div class="line">                 off_t     fst_bytesalloc; /* OUT: number of bytes allocated */</div><div class="line">             &#125; fstore_t;</div><div class="line"></div><div class="line">     The flags (fst_flags) for the F_PREALLOCATE command are as follows:</div><div class="line"></div><div class="line">           F_ALLOCATECONTIG   Allocate contiguous space.</div><div class="line"></div><div class="line">           F_ALLOCATEALL      Allocate all requested space or no space at all.</div><div class="line"></div><div class="line">     The position modes (fst_posmode) for the F_PREALLOCATE command indicate how to use the offset field.</div><div class="line">     The modes are as follows:</div><div class="line"></div><div class="line">           F_PEOFPOSMODE   Allocate from the physical end of file.</div><div class="line"></div><div class="line">           F_VOLPOSMODE    Allocate from the volume offset.</div><div class="line"></div><div class="line">     The F_PUNCHHOLE command operates on the following structure:</div><div class="line"></div><div class="line">             typedef struct fpunchhole &#123;</div><div class="line">                 u_int32_t fp_flags;     /* unused */</div><div class="line">                 u_int32_t reserved;     /* (to maintain 8-byte alignment) */</div><div class="line">                 off_t     fp_offset;    /* IN: start of the region */</div><div class="line">                 off_t     fp_length;    /* IN: size of the region */</div><div class="line">             &#125; fpunchhole_t;</div><div class="line"></div><div class="line">     The F_RDADVISE command operates on the following structure which holds information passed from the</div><div class="line">     user to the system:</div><div class="line"></div><div class="line">             struct radvisory &#123;</div><div class="line">                off_t   ra_offset;  /* offset into the file */</div><div class="line">                int     ra_count;   /* size of the read     */</div><div class="line">             &#125;;</div><div class="line"></div><div class="line">     The F_READBOOTSTRAP and F_WRITEBOOTSTRAP commands operate on the following structure.</div><div class="line"></div><div class="line">             typedef struct fbootstraptransfer &#123;</div><div class="line">                 off_t fbt_offset;       /* IN: offset to start read/write */</div><div class="line">                 size_t fbt_length;      /* IN: number of bytes to transfer */</div><div class="line">                 void *fbt_buffer;       /* IN: buffer to be read/written */</div><div class="line">             &#125; fbootstraptransfer_t;</div><div class="line"></div><div class="line">     The F_LOG2PHYS command operates on the following structure:</div><div class="line"></div><div class="line">             struct log2phys &#123;</div><div class="line">                 u_int32_t l2p_flags;        /* unused so far */</div><div class="line">                 off_t     l2p_contigbytes;  /* unused so far */</div><div class="line">                 off_t     l2p_devoffset;    /* bytes into device */</div><div class="line">             &#125;;</div><div class="line"></div><div class="line">     The F_LOG2PHYS_EXT command operates on the same structure as F_LOG2PHYS but treats it as an in/out:</div><div class="line"></div><div class="line">             struct log2phys &#123;</div><div class="line">                 u_int32_t l2p_flags;        /* unused so far */</div><div class="line">                 off_t     l2p_contigbytes;  /* IN: number of bytes to be queried;</div><div class="line">                                                OUT: number of contiguous bytes allocated at this position */</div><div class="line">                 off_t     l2p_devoffset;    /* IN: bytes into file;</div><div class="line">                                                OUT: bytes into device */</div><div class="line">             &#125;;</div><div class="line"></div><div class="line">     If fildes is a socket, then the F_SETNOSIGPIPE and F_GETNOSIGPIPE commands are directly analogous,</div><div class="line">     and fully interoperate with the SO_NOSIGPIPE option of setsockopt(2) and getsockopt(2) respectively.</div><div class="line"></div><div class="line">RETURN VALUES</div><div class="line">     Upon successful completion, the value returned depends on cmd as follows:</div><div class="line"></div><div class="line">           F_DUPFD    A new file descriptor.</div><div class="line"></div><div class="line">           F_GETFD    Value of flag (only the low-order bit is defined).</div><div class="line"></div><div class="line">           F_GETFL    Value of flags.</div><div class="line"></div><div class="line">           F_GETOWN   Value of file descriptor owner.</div><div class="line"></div><div class="line">           other      Value other than -1.</div><div class="line"></div><div class="line">     Otherwise, a value of -1 is returned and errno is set to indicate the error.</div><div class="line"></div><div class="line">ERRORS</div><div class="line">     The fcntl() system call will fail if:</div><div class="line"></div><div class="line">     [EAGAIN]           The argument cmd is F_SETLK, the type of lock (l_type) is a shared lock (F_RDLCK)</div><div class="line">                        or exclusive lock (F_WRLCK), and the segment of a file to be locked is already</div><div class="line">                        exclusive-locked by another process; or the type is an exclusive lock and some</div><div class="line">                        portion of the segment of a file to be locked is already shared-locked or exclu-</div><div class="line">                        sive-locked by another process.</div><div class="line"></div><div class="line">     [EACCESS]          The argument cmd is either F_SETSIZE or F_WRITEBOOTSTRAP and the calling process</div><div class="line">                        does not have root privileges.</div><div class="line"></div><div class="line">     [EBADF]            Fildes is not a valid open file descriptor.</div><div class="line"></div><div class="line">                        The argument cmd is F_SETLK or F_SETLKW, the type of lock (l_type) is a shared</div><div class="line">                        lock (F_RDLCK), and fildes is not a valid file descriptor open for reading.</div><div class="line"></div><div class="line">                        The argument cmd is F_SETLK or F_SETLKW, the type of lock (l_type) is an exclusive</div><div class="line">                        lock (F_WRLCK), and fildes is not a valid file descriptor open for writing.</div><div class="line"></div><div class="line">                        The argument cmd is F_PREALLOCATE and the calling process does not have file write</div><div class="line">                        permission.</div><div class="line"></div><div class="line">                        The argument cmd is F_LOG2PHYS or F_LOG2PHYS_EXT and fildes is not a valid file</div><div class="line">                        descriptor open for reading.</div><div class="line"></div><div class="line">     [EDEADLK]          The argument cmd is F_SETLKW, and a deadlock condition was detected.</div><div class="line"></div><div class="line">     [EINTR]            The argument cmd is F_SETLKW, and the function was interrupted by a signal.</div><div class="line"></div><div class="line">     [EINVAL]           Cmd is F_DUPFD and arg is negative or greater than the maximum allowable number</div><div class="line">                        (see getdtablesize(2)).</div><div class="line"></div><div class="line">                        The argument cmd is F_GETLK, F_SETLK, or F_SETLKW and the data to which arg points</div><div class="line">                        is not valid, or fildes refers to a file that does not support locking.</div><div class="line"></div><div class="line">                        The argument cmd is F_PREALLOCATE and the fst_posmode is not a valid mode, or when</div><div class="line">                        F_PEOFPOSMODE is set and fst_offset is a non-zero value, or when F_VOLPOSMODE is</div><div class="line">                        set and fst_offset is a negative or zero value.</div><div class="line"></div><div class="line">                        The argument cmd is F_PUNCHHOLE and either fp_offset or fp_length are negative, or</div><div class="line">                        both fp_offset and fp_length are not multiples of the file system block size.</div><div class="line"></div><div class="line">                        The argument cmd is either F_READBOOTSTRAP or F_WRITEBOOTSTRAP and the operation</div><div class="line">                        was attempted on a non-HFS disk type.</div><div class="line"></div><div class="line">     [EMFILE]           Cmd is F_DUPFD and the maximum allowed number of file descriptors are currently</div><div class="line">                        open.</div><div class="line"></div><div class="line">     [EMFILE]           The argument cmd is F_DUPED and the maximum number of file descriptors permitted</div><div class="line">                        for the process are already in use, or no file descriptors greater than or equal</div><div class="line">                        to arg are available.</div><div class="line"></div><div class="line">     [ENOLCK]           The argument cmd is F_SETLK or F_SETLKW, and satisfying the lock or unlock request</div><div class="line">                        would result in the number of locked regions in the system exceeding a system-</div><div class="line">                        imposed limit.</div><div class="line"></div><div class="line">     [ENOSPC]           The argument cmd is F_PREALLOCATE and either there is no space available on the</div><div class="line">                        volume containing fildes or fst_flags contains F_ALLOCATEALL and there is not</div><div class="line">                        enough space available on the volume containing fildes to satisfy the entire</div><div class="line">                        request.</div><div class="line"></div><div class="line">                        The argument cmd is F_PUNCHHOLE and there is not enough space available on the</div><div class="line">                        volume containing fildes to satisfy the request. As an example, a filesystem that</div><div class="line">                        supports cloned files may return this error if punching a hole requires the cre-</div><div class="line">                        ation of a clone and there is not enough space available to do so.</div><div class="line"></div><div class="line">     [EOVERFLOW]        A return value would overflow its representation.  For example, cmd is F_GETLK,</div><div class="line">                        F_SETLK, or F_SETLKW and the smallest (or, if l_len is non-zero, the largest) off-</div><div class="line">                        set of a byte in the requested segment will not fit in an object of type off_t.</div><div class="line"></div><div class="line">     [EPERM]            The argument cmd is F_PUNCHHOLE and the calling process does not have file write</div><div class="line">                        permission.</div><div class="line"></div><div class="line">     [ESRCH]            Cmd is F_SETOWN and the process ID given as argument is not in use.</div><div class="line"></div><div class="line">SEE ALSO</div><div class="line">     close(2), execve(2), flock(2), getdtablesize(2), open(2), pipe(2), socket(2), setsockopt(2),</div><div class="line">     sigaction(3)</div><div class="line"></div><div class="line">HISTORY</div><div class="line">     The fcntl() function call appeared in 4.2BSD.</div><div class="line"></div><div class="line">4.2 Berkeley Distribution       August 24, 2017      4.2 Berkeley Distribution</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">GETSOCKOPT(2)               BSD System Calls Manual              GETSOCKOPT(2)</div><div class="line"></div><div class="line">NAME</div><div class="line">     getsockopt, setsockopt -- get and set options on sockets</div><div class="line"></div><div class="line">SYNOPSIS</div><div class="line">     #include &lt;sys/socket.h&gt;</div><div class="line"></div><div class="line">     int</div><div class="line">     getsockopt(int socket, int level, int option_name, void *restrict option_value,</div><div class="line">         socklen_t *restrict option_len);</div><div class="line"></div><div class="line">     int</div><div class="line">     setsockopt(int socket, int level, int option_name, const void *option_value, socklen_t option_len);</div><div class="line"></div><div class="line">DESCRIPTION</div><div class="line">     getsockopt() and setsockopt() manipulate the options associated with a socket.  Options may exist at</div><div class="line">     multiple protocol levels; they are always present at the uppermost ``socket&apos;&apos; level.</div><div class="line"></div><div class="line">     When manipulating socket options the level at which the option resides and the name of the option</div><div class="line">     must be specified.  To manipulate options at the socket level, level is specified as SOL_SOCKET.  To</div><div class="line">     manipulate options at any other level the protocol number of the appropriate protocol controlling the</div><div class="line">     option is supplied.  For example, to indicate that an option is to be interpreted by the TCP proto-</div><div class="line">     col, level should be set to the protocol number of TCP; see getprotoent(3).</div><div class="line"></div><div class="line">     The parameters option_value and option_len are used to access option values for setsockopt().  For</div><div class="line">     getsockopt() they identify a buffer in which the value for the requested option(s) are to be</div><div class="line">     returned.  For getsockopt(), option_len is a value-result parameter, initially containing the size of</div><div class="line">     the buffer pointed to by option_value, and modified on return to indicate the actual size of the</div><div class="line">     value returned.  If no option value is to be supplied or returned, option_value may be NULL.</div><div class="line"></div><div class="line">     option_name and any specified options are passed uninterpreted to the appropriate protocol module for</div><div class="line">     interpretation.  The include file &lt;sys/socket.h&gt; contains definitions for socket level options,</div><div class="line">     described below.  Options at other protocol levels vary in format and name; consult the appropriate</div><div class="line">     entries in section 4 of the manual.</div><div class="line"></div><div class="line">     Most socket-level options utilize an int parameter for option_value.  For setsockopt(), the parameter</div><div class="line">     should be non-zero to enable a boolean option, or zero if the option is to be disabled.  SO_LINGER</div><div class="line">     uses a struct linger parameter, defined in &lt;sys/socket.h&gt;, which specifies the desired state of the</div><div class="line">     option and the linger interval (see below).  SO_SNDTIMEO and SO_RCVTIMEO use a struct timeval parame-</div><div class="line">     ter, defined in &lt;sys/time.h&gt;.</div><div class="line"></div><div class="line">     The following options are recognized at the socket level.  Except as noted, each may be examined with</div><div class="line">     getsockopt() and set with setsockopt().</div><div class="line"></div><div class="line">           SO_DEBUG        enables recording of debugging information</div><div class="line">           SO_REUSEADDR    enables local address reuse</div><div class="line">           SO_REUSEPORT    enables duplicate address and port bindings</div><div class="line">           SO_KEEPALIVE    enables keep connections alive</div><div class="line">           SO_DONTROUTE    enables routing bypass for outgoing messages</div><div class="line">           SO_LINGER       linger on close if data present</div><div class="line">           SO_BROADCAST    enables permission to transmit broadcast messages</div><div class="line">           SO_OOBINLINE    enables reception of out-of-band data in band</div><div class="line">           SO_SNDBUF       set buffer size for output</div><div class="line">           SO_RCVBUF       set buffer size for input</div><div class="line">           SO_SNDLOWAT     set minimum count for output</div><div class="line">           SO_RCVLOWAT     set minimum count for input</div><div class="line">           SO_SNDTIMEO     set timeout value for output</div><div class="line">           SO_RCVTIMEO     set timeout value for input</div><div class="line">           SO_TYPE         get the type of the socket (get only)</div><div class="line">           SO_ERROR        get and clear error on the socket (get only)</div><div class="line">           SO_NOSIGPIPE    do not generate SIGPIPE, instead return EPIPE</div><div class="line">           SO_NREAD        number of bytes to be read (get only)</div><div class="line">           SO_NWRITE       number of bytes written not yet sent by the protocol (get only)</div><div class="line">           SO_LINGER_SEC   linger on close if data present with timeout in seconds</div><div class="line"></div><div class="line">     SO_DEBUG enables debugging in the underlying protocol modules.</div><div class="line"></div><div class="line">     SO_REUSEADDR indicates that the rules used in validating addresses supplied in a bind(2) call should</div><div class="line">     allow reuse of local addresses.</div><div class="line"></div><div class="line">     SO_REUSEPORT allows completely duplicate bindings by multiple processes if they all set SO_REUSEPORT</div><div class="line">     before binding the port.  This option permits multiple instances of a program to each receive UDP/IP</div><div class="line">     multicast or broadcast datagrams destined for the bound port.</div><div class="line"></div><div class="line">     SO_KEEPALIVE enables the periodic transmission of messages on a connected socket.  Should the con-</div><div class="line">     nected party fail to respond to these messages, the connection is considered broken and processes</div><div class="line">     using the socket are notified via a SIGPIPE signal when attempting to send data.</div><div class="line"></div><div class="line">     SO_DONTROUTE indicates that outgoing messages should bypass the standard routing facilities.</div><div class="line">     Instead, messages are directed to the appropriate network interface according to the network portion</div><div class="line">     of the destination address.</div><div class="line"></div><div class="line">     SO_LINGER controls the action taken when unsent messages are queued on socket and a close(2) is per-</div><div class="line">     formed.  If the socket promises reliable delivery of data and SO_LINGER is set, the system will block</div><div class="line">     the process on the close attempt until it is able to transmit the data or until it decides it is</div><div class="line">     unable to deliver the information (a timeout period, termed the linger interval, is specified in the</div><div class="line">     setsockopt() call when SO_LINGER is requested).  If SO_LINGER is disabled and a close is issued, the</div><div class="line">     system will process the close in a manner that allows the process to continue as quickly as possible.</div><div class="line"></div><div class="line">     SO_LINGER_SEC is the same option as SO_LINGER except the linger time is in seconds for SO_LINGER_SEC.</div><div class="line"></div><div class="line">     The option SO_BROADCAST requests permission to send broadcast datagrams on the socket.  Broadcast was</div><div class="line">     a privileged operation in earlier versions of the system.</div><div class="line"></div><div class="line">     With protocols that support out-of-band data, the SO_OOBINLINE option requests that out-of-band data</div><div class="line">     be placed in the normal data input queue as received; it will then be accessible with recv or read</div><div class="line">     calls without the MSG_OOB flag.  Some protocols always behave as if this option is set.</div><div class="line"></div><div class="line">     SO_SNDBUF and SO_RCVBUF are options to adjust the normal buffer sizes allocated for output and input</div><div class="line">     buffers, respectively.  The buffer size may be increased for high-volume connections, or may be</div><div class="line">     decreased to limit the possible backlog of incoming data.  The system places an absolute limit on</div><div class="line">     these values.</div><div class="line"></div><div class="line">     SO_SNDLOWAT is an option to set the minimum count for output operations.  Most output operations</div><div class="line">     process all of the data supplied by the call, delivering data to the protocol for transmission and</div><div class="line">     blocking as necessary for flow control.  Nonblocking output operations will process as much data as</div><div class="line">     permitted (subject to flow control) without blocking, but will process no data if flow control does</div><div class="line">     not allow the smaller of the low-water mark value or the entire request to be processed.  A select(2)</div><div class="line">     operation testing the ability to write to a socket will return true only if the low-water mark amount</div><div class="line">     could be processed.  The default value for SO_SNDLOWAT is set to a convenient size for network effi-</div><div class="line">     ciency, often 2048.</div><div class="line"></div><div class="line">     SO_RCVLOWAT is an option to set the minimum count for input operations.  In general, receive calls</div><div class="line">     will block until any (non-zero) amount of data is received, then return with the smaller of the</div><div class="line">     amount available or the amount requested.  The default value for SO_RCVLOWAT is 1.  If SO_RCVLOWAT is</div><div class="line">     set to a larger value, blocking receive calls normally wait until they have received the smaller of</div><div class="line">     the low-water mark value or the requested amount.  Receive calls may still return less than the low-</div><div class="line">     water mark if an error occurs, a signal is caught, or the type of data next in the receive queue is</div><div class="line">     different than that returned.</div><div class="line"></div><div class="line">     SO_SNDTIMEO is an option to set a timeout value for output operations.  It accepts a struct timeval</div><div class="line">     parameter with the number of seconds and microseconds used to limit waits for output operations to</div><div class="line">     complete.  If a send operation has blocked for this much time, it returns with a partial count or</div><div class="line">     with the error EWOULDBLOCK if no data were sent.  In the current implementation, this timer is</div><div class="line">     restarted each time additional data are delivered to the protocol, implying that the limit applies to</div><div class="line">     output portions ranging in size from the low-water mark to the high-water mark for output.</div><div class="line"></div><div class="line">     SO_RCVTIMEO is an option to set a timeout value for input operations.  It accepts a struct timeval</div><div class="line">     parameter with the number of seconds and microseconds used to limit waits for input operations to</div><div class="line">     complete.  In the current implementation, this timer is restarted each time additional data are</div><div class="line">     received by the protocol, and thus the limit is in effect an inactivity timer.  If a receive opera-</div><div class="line">     tion has been blocked for this much time without receiving additional data, it returns with a short</div><div class="line">     count or with the error EWOULDBLOCK if no data were received.  The struct timeval parameter must rep-</div><div class="line">     resent a positive time interval; otherwise, setsockopt() returns with the error EDOM.</div><div class="line"></div><div class="line">     SO_NOSIGPIPE is an option that prevents SIGPIPE from being raised when a write fails on a socket to</div><div class="line">     which there is no reader; instead, the write to the socket returns with the error EPIPE when there is</div><div class="line">     no reader.</div><div class="line"></div><div class="line">     Finally, SO_TYPE, SO_ERROR, SO_NREAD, and SO_NWRITE are options used only with getsockopt().</div><div class="line"></div><div class="line">     SO_TYPE returns the type of the socket, such as SOCK_STREAM; it is useful for servers that inherit</div><div class="line">     sockets on startup.</div><div class="line"></div><div class="line">     SO_ERROR returns any pending error on the socket and clears the error status.  It may be used to</div><div class="line">     check for asynchronous errors on connected datagram sockets or for other asynchronous errors.</div><div class="line"></div><div class="line">     SO_NREAD returns the amount of data in the input buffer that is available to be received.  For data-</div><div class="line">     gram oriented sockets, SO_NREAD returns the size of the first packet -- this differs from the ioctl()</div><div class="line">     command FIONREAD that returns the total amount of data available.</div><div class="line"></div><div class="line">     SO_NWRITE returns the amount of data in the output buffer not yet sent by the protocol.</div><div class="line"></div><div class="line">RETURN VALUES</div><div class="line">     Upon successful completion, the value 0 is returned; otherwise the value -1 is returned and the</div><div class="line">     global variable errno is set to indicate the error.</div><div class="line"></div><div class="line">ERRORS</div><div class="line">     The getsockopt() and setsockopt() system calls will succeed unless:</div><div class="line"></div><div class="line">     [EBADF]            The argument socket is not a valid file descriptor.</div><div class="line"></div><div class="line">     [EFAULT]           The address pointed to by option_value is not in a valid part of the process</div><div class="line">                        address space.  For getsockopt(), this error may also be returned if option_len is</div><div class="line">                        not in a valid part of the process address space.</div><div class="line"></div><div class="line">     [EINVAL]           The option is invalid at the level indicated.</div><div class="line"></div><div class="line">     [ENOBUFS]          Insufficient system resources available for the call to complete.</div><div class="line"></div><div class="line">     [ENOMEM]           Insufficient memory available for the system call to complete.</div><div class="line"></div><div class="line">     [ENOPROTOOPT]      The option is unknown at the level indicated.</div><div class="line"></div><div class="line">     [ENOTSOCK]         The argument socket is not a socket (e.g., a plain file).</div><div class="line"></div><div class="line">     The setsockopt() system call will succeed unless:</div><div class="line"></div><div class="line">     [EDOM]             The argument option_value is out of bounds.</div><div class="line"></div><div class="line">     [EISCONN]          socket is already connected and a specified option cannot be set while this is the</div><div class="line">                        case.</div><div class="line"></div><div class="line">     [EINVAL]           The socket has been shut down.</div><div class="line"></div><div class="line">LEGACY SYNOPSIS</div><div class="line">     #include &lt;sys/types.h&gt;</div><div class="line">     #include &lt;sys/socket.h&gt;</div><div class="line"></div><div class="line">     The include file &lt;sys/types.h&gt; is necessary.</div><div class="line"></div><div class="line">SEE ALSO</div><div class="line">     socket(2), bind(2), ioctl(2), getprotoent(3), protocols(5)</div><div class="line"></div><div class="line">BUGS</div><div class="line">     Several of the socket options should be handled at lower levels of the system.</div><div class="line"></div><div class="line">HISTORY</div><div class="line">     The getsockopt() system call appeared in 4.2BSD.</div><div class="line"></div><div class="line">4.3-Reno Berkeley Distribution  April 19, 1994  4.3-Reno Berkeley Distribution</div></pre></td></tr></table></figure>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://images.wodekouwei.com/Pay/weixin_qingkouwei.png" alt="轻口味 WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="http://images.wodekouwei.com/Pay/zhifubao_qingkouwei.jpg" alt="轻口味 Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/12/tips-net-mars-heartbeat/" rel="next" title="Android微信智能心跳方案">
                <i class="fa fa-chevron-left"></i> Android微信智能心跳方案
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/03/26/tool-markdown/" rel="prev" title="markdown语法">
                markdown语法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg"
               alt="轻口味" />
          <p class="site-author-name" itemprop="name">轻口味</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">167</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">62</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/qingkouwei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/LightTaste" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/turnpp/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  豆瓣
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/shen-jun-wei-9/" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://github.com/ossrs/srs" title="SRS" target="_blank">SRS</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">轻口味</span>
</div>

<div>
<a href="http://www.miitbeian.gov.cn/">京ICP备17018543号</a>

        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "bb46b146831e4e34808d09cd94c85f50",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  
  


  

</body>
</html>
