<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[tips-shell-language]]></title>
    <url>%2F2017%2F09%2F30%2Ftips-shell-language%2F</url>
    <content type="text"><![CDATA[å†™è„šæœ¬ä¿®æ”¹æ•°æ®åº“ä¸­è¡¨çš„æŸä¸€å­—æ®µå€¼12345678910111213141516171819202122###########################################################ä¿®æ”¹è¡¨TBL_BAT_TASK_CTLçš„USE_FLAGå­—æ®µï¼Œå¯åŠ¨æˆ–åœæ­¢è´·è®°å¡é”€å¡çš„æ‰¹å¤„ç†#useageï¼šæ‰§è¡Œè„šæœ¬æ—¶åŠ -nå‚æ•°å°±æ˜¯å…³é—­æ‰¹å¤„ç†# æ‰§è¡Œè„šæœ¬æ—¶åŠ -yå‚æ•°å°±æ˜¯æ‰“å¼€æ‰¹å¤„ç†###########################################################!/bin/bashif test &quot;$1&quot; = &quot;-n&quot;then db2 connect to $DBLINK db2 &quot;update TBL_BAT_TASK_CTL set USE_FLAG=&apos;N&apos; where BAT_ID=&apos;0024&apos; or BAT_ID=&apos;0025&apos;&quot; db2 terminate# exit 0fiif test &quot;$1&quot; = &quot;-y&quot;then db2 connect to $DBLINK db2 &quot;update TBL_BAT_TASK_CTL set USE_FLAG=&apos;Y&apos; where BAT_ID=&apos;0024&apos; or BAT_ID=&apos;0025&apos;&quot; db2 terminatefi]]></content>
      <categories>
        <category>language</category>
      </categories>
      <tags>
        <tag>tips</tag>
        <tag>language</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[opencvæ ¸å¿ƒç±»åž‹]]></title>
    <url>%2F2017%2F09%2F29%2Fopencv-core%2F</url>
    <content type="text"><![CDATA[matåˆ›å»ºå’Œæ¸…ç†matç©ºé—´ Mat mat(3000, 4000, CV_8UC3);//3000è¡Œ,4000åˆ—æ•°ç»„,æ•°ç»„é‡Œå­˜æ”¾3ä¸ªunsigned charç±»åž‹çš„æ•°æ® mat.create(rows, cols, CV_8UC1);//è¡Œæ•°,åˆ—æ•° releaseæˆ–è€…æžæž„:å¼•ç”¨è®¡æ•°ä¸º1æ—¶é‡Šæ”¾]]></content>
      <categories>
        <category>opencv</category>
      </categories>
      <tags>
        <tag>opencv</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[opencvå¼€å‘çŽ¯å¢ƒæ­å»º]]></title>
    <url>%2F2017%2F09%2F29%2Fopencv-env%2F</url>
    <content type="text"><![CDATA[ä»Žgithubä¸‹è½½opencvæœ€æ–°æºç https://github.com/opencv/opencv,ç›®å‰æœ€æ–°æ˜¯`5e93c8202363a13fc72df30f8c14069c5ab66e42`. UbuntuçŽ¯å¢ƒä¸‹ç¼–è¯‘å®‰è£…ä¾èµ–åº“: 123456789sudo apt-get install build-essentialsudo apt-get install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-devsudo apt-get install python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-devgit clone https://github.com/opencv/opencv.gitsudo apt-get install cmake-gui MacçŽ¯å¢ƒä¸‹ç¼–è¯‘è¿›å…¥æºç è·¯å¾„,æ–°å»ºä¸€ä¸ªreleaseçš„æ–‡ä»¶å¤¹,å¹¶è¿›å…¥,æ‰§è¡Œ: 123cmake -G &quot;Unix Makefiles&quot; ..makesudo make install ç¼–è¯‘å®ŒæˆåŽä¼šåœ¨releaseç”Ÿæˆlibç›®å½•,libä¸‹å­˜æ”¾æ‰€æœ‰ç¼–è¯‘æˆçš„åŠ¨æ€åº“,å¯èƒ½ä¸Žubuntuä¸‹ç¼–è¯‘ç»“æžœä¸åŒ,ubuntuä¸‹ç¼–è¯‘åªç”Ÿæˆlibopencv_world.soä¸€ä¸ªåŠ¨æ€åº“,è€Œmacä¸‹ä¼šç”Ÿæˆopencv_core opencv_highgui opencv_imgproc opencv_ml opencv_objdetect opencv_photo opencv_video opencv_dnn opencv_imgcodecs opencv_shapeç­‰å¤šä¸ªåŠ¨æ€åº“.æ‰§è¡Œmake installåŽä¼šå°†å¤´æ–‡ä»¶æ‹·è´åˆ°/usr/local/include/ä¸‹,å°†åŠ¨æ€åº“æ‹·è´åˆ°/usr/local/lib/ä¸‹,å°†jaråŒ…ç­‰å…¶ä»–æ–‡ä»¶æ‹·è´åˆ°/usr/local/share/OpenCV/ä¸‹,makefileè„šæœ¬åŠ å…¥åŠ¨æ€é“¾æŽ¥åº“: 12testopencv:main.cpp g++ $+ -o $@ -lopencv_core -lopencv_highgui -lopencv_imgproc -lopencv_ml -lopencv_objdetect -lopencv_photo -lopencv_video -lopencv_dnn -lopencv_imgcodecs -lopencv_shape main.cppä¸‹è¾“å…¥ä¸‹é¢æµ‹è¯•ä»£ç : 123456789101112#include &lt;opencv2/core.hpp&gt;#include &lt;opencv2/imgcodecs.hpp&gt;#include &lt;opencv2/highgui.hpp&gt;using namespace cv;int main(int argc, char *argv[])&#123; Mat image = imread(&quot;1.png&quot;); namedWindow(&quot;img&quot;); imshow(&quot;img&quot;, image); waitKey(0); return 0;&#125; åœ¨ç”Ÿæˆçš„æ‰§è¡Œæ–‡ä»¶åŒç›®å½•ä¸‹æ”¾å…¥åå­—ä¸º1.pngçš„å›¾ç‰‡. é…ç½®QTçŽ¯å¢ƒåœ¨æ–°å»ºçš„QTå·¥ç¨‹ä¸­çš„.proæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ä»£ç : 1234567INCLUDEPATH += /usr/local/includeINCLUDEPATH += /usr/local/include/opencvINCLUDEPATH += /usr/local/include/opencv2LIBS += -L/usr/local/lib \ -lopencv_core \ -lopencv_highgui \ -lopencv_imgproc \ å®Œæˆä»¥ä¸Šæ­¥éª¤åŽæŒ‰ç†åº”è¯¥æ˜¯èƒ½æˆåŠŸçš„ï¼Œä½†æ˜¯è¿è¡Œæ—¶å‘çŽ°ä¼šå‡ºçŽ°å¦‚ä¸‹çš„é”™è¯¯ã€‚ 1234dyld: Symbol not found: __cg_jpeg_resync_to_restartReferenced from: /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIOExpected in: /usr/local/lib/libjpeg.8.dylibin /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO é’ˆå¯¹ä»¥ä¸Šé—®é¢˜,åœ¨é¡¹ç›®-è¿è¡Œé…ç½®ä¸­,å¢žåŠ å˜é‡DYLD_LIBRARY_PATHå€¼ä¸º/Application/QT5.7.0/5.7/clang_64/lib:/usr/local/lib]]></content>
      <categories>
        <category>opencv</category>
      </categories>
      <tags>
        <tag>opencv</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[tips-android]]></title>
    <url>%2F2017%2F09%2F27%2Ftips-android%2F</url>
    <content type="text"><![CDATA[1.ä½¿ç”¨Glideåº“æå–è§†é¢‘å¸§å›¾ç‰‡åŠ è½½æ¡†æž¶Glideå°±å¯ä»¥åšåˆ°èŽ·å–æœ¬åœ°è§†é¢‘çš„ç¼©ç•¥å›¾(ä¸èƒ½èŽ·å–ç½‘ç»œè§†é¢‘æ–‡ä»¶): 12345String filePath = &quot;/storage/emulated/0/Pictures/example_video.mp4&quot;;Glide .with( context ) .load( Uri.fromFile( new File( filePath ) ) ) .into( imageViewGifAsBitmap );]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>tips</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽQT QAudioOutput pushæ¨¡å¼é—®é¢˜]]></title>
    <url>%2F2017%2F09%2F13%2Ftips-qt-audiooutput%2F</url>
    <content type="text"><![CDATA[åœ¨MACä¸ŠåŸºäºŽQTå’Œffmpegå®žçŽ°æœ€ç®€å•æ’­æ”¾å™¨,åœ¨å®Œæˆå£°éŸ³æ’­æ”¾æ¨¡å—åŽå¯¼è‡´æ— æ³•æ­£å¸¸æ’­æ”¾,QAudioOutput startåŽstateä»æ˜¯idel,å°†QAudioOutput bufferå†™æ»¡åŽå°±ä¸èƒ½ç»§ç»­å†™æ•°æ®äº†,å¯¼è‡´æ’­æ”¾è¢«å¡æ­». QAudioOutputåˆ›å»ºä»£ç : 12345678910111213141516171819QAudioFormat fmt;fmt.setSampleRate(this-&gt;sampleRate);fmt.setSampleSize(this-&gt;sampleSize);fmt.setChannelCount(this-&gt;channel);fmt.setCodec(&quot;audio/pcm&quot;);fmt.setByteOrder(QAudioFormat::LittleEndian);fmt.setSampleType(QAudioFormat::UnSignedInt);QAudioDeviceInfo info = QAudioDeviceInfo::defaultOutputDevice();printf(&quot;deviceName:%s\n&quot;,qPrintable(info.deviceName()));if (!info.isFormatSupported(fmt)) &#123; printf(&quot;default format not supported try to use nearest\n&quot;); fmt = info.nearestFormat(fmt);&#125;output = new QAudioOutput(fmt);//connect(output, SIGNAL(stateChanged(QAudio::State)), this, SLOT(handleStateChanged(QAudio::State)));io = output-&gt;start();printf(&quot;io:%p\n&quot;, io);//printf(&quot;state:%s&quot;,output-&gt;state());QAudio::State stat = output-&gt;state(); åœ¨stackoverflow Qt QAudioOutput push modeçœ‹åˆ°åˆ«äººçš„é—®é¢˜å’Œè§£é‡Š,å‘çŽ°æ˜¯setSampleTypeå¼•èµ·çš„,ä»£ç åœ¨windowä¸Šå¯ä»¥æ­£å¸¸è·‘,åªæ˜¯åœ¨macä¸Šå¤±è´¥. é—®é¢˜Iâ€™ve got a question about using QAudioOutput to directly write samples at a specific sample rate to the sound output device. Iâ€™m writing an emulator that emualates sound chips on a per-frame basis, and then gets a buffer containing a frameâ€™s worth of audio samples, which I would like to write to the audio output. Currently, to test my audio output routine, I allocate a huge (5 minute) buffer to put random numbers into, like so: Header: 1234uint16_t *audio_outputBuffer;uint32_t audio_bytesRemainingToRead;QAudioOutput *audio_outputStream;QIODevice *audio_outputDevice; Implementation: 12345678910audio_outputBuffer = (uint16_t *) malloc((96000 * 4) * 300);int i = 0;uint16_t *tempAudioBuffer = audio_outputBuffer;for(i = 0; i &lt; ((96000 * 4) * 150); i++) &#123; *tempAudioBuffer = (uint16_t) rand() &amp; 0xFFFF; tempAudioBuffer++;&#125;audio_bytesRemainingToRead = (96000 * 4) * 300; Next, I set up my audio device with some basic parameters: 1234567891011121314151617// Set up the formatQAudioFormat format;format.setFrequency(96000); // Usually this is specified through an UI optionformat.setChannels(2);format.setSampleSize(16);format.setCodec(&quot;audio/pcm&quot;);format.setByteOrder(QAudioFormat::LittleEndian);format.setSampleType(QAudioFormat::UnSignedInt);// There&apos;s code here to notify the user of inability to match the format and choose an action, which is omitted for clarity// Create audio output stream, set up signalsaudio_outputStream = new QAudioOutput(format, this);connect(audio_outputStream, SIGNAL(stateChanged(QAudio::State)), this, SLOT(audio_stateChanged(QAudio::State)));audio_outputDevice = audio_outputStream-&gt;start(); Then, in my timer tick routine, which is called by a QTimer at 60 FPS, I do the following code to write a â€˜chunkâ€™ of audio data to the QAudioOutputâ€™s buffer: 123456if(audio_outputDevice-&gt;isOpen() &amp;&amp; audio_outputStream-&gt;state() != QAudio::StoppedState) &#123; qint64 bytesOfAudioWrittenToDevice = audio_outputDevice-&gt;write((char *) audio_outputBuffer, audio_outputStream-&gt;periodSize()); audio_bytesRemainingToRead -= bytesOfAudioWrittenToDevice; qDebug() &lt;&lt; &quot;Wrote&quot; &lt;&lt; bytesOfAudioWrittenToDevice &lt;&lt; &quot;bytes of audio to output device. Remaining bytes to read:&quot; &lt;&lt; audio_bytesRemainingToRead; qDebug() &lt;&lt; &quot;Free bytes in audio output:&quot; &lt;&lt; audio_outputStream-&gt;bytesFree();&#125; Once I start the audio output process, I get the following output on the console: 12345678910Current audio state: 3 Error: 0Wrote 2048 bytes of audio to output device. Remaining bytes to read: 115197952Free bytes in audio output: 6144Current audio state: 0 Error: 0Wrote 2048 bytes of audio to output device. Remaining bytes to read: 115195904Free bytes in audio output: 4096Wrote 2048 bytes of audio to output device. Remaining bytes to read: 115193856Free bytes in audio output: 2048Wrote 2048 bytes of audio to output device. Remaining bytes to read: 115191808Free bytes in audio output: 0 (This and the above line is repeated forever) To me, it looks like QAudioOutput isnâ€™t flushing itâ€™s internal buffer to the sound card, which goes along with the entire â€œno sound coming out of my computerâ€ thing. What would cause this issue, and how could I fix it? (By the way, Iâ€™m compiling my code against Qt 4.8.1, on Mac OS X 10.7.4.) Thanks for any answers. è§£é‡ŠUpfront just wanna point out: This is not a Qt bug. Why? The answer is that in the WAV specâ€™, 8-bit samples are always unsigned, whereas 16-bit samples are always signed. Any other combination does not work. This is device related, the framework can not do anything about it. So this will not work because you have set 16 bit sample size and unsigned integer format. And yes, the solution is: you have to set the sample type to signed for 16-bit resolution: 1format.setSampleType(QAudioFormat::SignedInt); Inversely for 8-bit samples you would have to put: 1format.setSampleType(QAudioFormat:UnsignedInt); Also this very similar question (same problem but with 8-bit) shows you that it is not a particular problem of using signed or unsigned samples in Qt, but that it is the combination of samples size and type that matters (for the audio device, not for Qt ;) QAudioOutput in Qt5 is not producing any sound IMHO the fact that Qt does not take care of handling these cases by forcing the correct format is a flaw but not a lack in functionnality. You can learn more about this in the notes section of this page: https://ccrma.stanford.edu/courses/422/projects/WaveFormat/ Iâ€™ve figured this out â€” apparently Qt has issues with UNSIGNED samples. If you set the sample type to signed, everything works fine, regardless of platform.]]></content>
      <categories>
        <category>QT</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>QT</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[FFMPEG apiä½¿ç”¨æµç¨‹]]></title>
    <url>%2F2017%2F09%2F13%2Fffmpeg-arch%2F</url>
    <content type="text"><![CDATA[ffmpegæŽ¥å£ä½¿ç”¨æµç¨‹æ¯”è¾ƒå›ºå®š: av_register_all():æ³¨å†Œæ‰€æœ‰æ¨¡å— int ret = avformat_open_input(&amp;ic, ofn, 0, 0);:èŽ·å–AVFormatContext ic(ofnä¸ºè¾“å…¥æ–‡ä»¶åœ°å€) for(i = 0; i &lt; ic-&gt;nb_streams; i++):éåŽ†AVFormatContextä¸­æ‰€æœ‰stream,åˆ†åˆ«æ‰¾åˆ°Audioä¸ŽVideoå¯¹åº”çš„AVCodecContext; AVCodec *codec = avcodec_find_decoder(enc-&gt;codec_id);:æ ¹æ®AVCodecContextä¸­codec_idèŽ·å–åˆ°AVCodec; avcodec_open2(enc, codec,NULL):æ‰“å¼€AVCodec; æŽ¥ä¸‹æ¥åˆ†é…AVPacketä¸ŽAVFrame]]></content>
      <categories>
        <category>FFMPEG</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>FFMPEG</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[FFMPEGç¼–è§£ç ]]></title>
    <url>%2F2017%2F09%2F13%2Fffmpeg-codec%2F</url>
    <content type="text"><![CDATA[è§£ç ffmpeg3ç‰ˆæœ¬çš„è§£ç æŽ¥å£åšäº†è°ƒæ•´,ä¹‹å‰çš„è§†é¢‘è§£ç æŽ¥å£avcodec_decode_video2å’ŒéŸ³é¢‘è§£ç æŽ¥å£avcodec_decode_audio4è¢«è®¾ç½®ä¸ºdeprecated,å¯¹è¿™ä¸¤ä¸ªæŽ¥å£åšäº†åˆå¹¶,ä½¿ç”¨åŒä¸€çš„æŽ¥å£.å¹¶ä¸”å°†éŸ³è§†é¢‘è§£ç æ­¥éª¤åˆ†æˆäº†ä¸¤æ­¥,ç¬¬ä¸€æ­¥avcodec_send_packet,ç¬¬äºŒæ­¥avcodec_receive_frame, æ—§ç‰ˆæœ¬avcodec_decode_video2æ—§ç‰ˆæœ¬avcodec_decode_audio4123456789101112int got_picture; ret = avcodec_decode_audio4(enc, pcm,&amp;got_picture, pkt); if ( ret &lt; 0 ) &#123; char buf[1024] = &#123;0&#125;; av_strerror(err, buf, sizeof(buf)); printf(buf); printf(&quot;avcodec_decode_audio4 failed:%d&quot; ,got_picture); av_packet_unref(pkt); av_frame_free(&amp;pcm); if(ic) avformat_close_input(&amp;ic); return -1; &#125; å°†AVPacketçš„pktè§£ç æˆAVFrameçš„pcm æ–°ç‰ˆæœ¬avcodec_send_packetæŽ¥å£æºç :12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849/** * Supply raw packet data as input to a decoder. * * Internally, this call will copy relevant AVCodecContext fields, which can * influence decoding per-packet, and apply them when the packet is actually * decoded. (For example AVCodecContext.skip_frame, which might direct the * decoder to drop the frame contained by the packet sent with this function.) * * @warning The input buffer, avpkt-&gt;data must be AV_INPUT_BUFFER_PADDING_SIZE * larger than the actual read bytes because some optimized bitstream * readers read 32 or 64 bits at once and could read over the end. * * @warning Do not mix this API with the legacy API (like avcodec_decode_video2()) * on the same AVCodecContext. It will return unexpected results now * or in future libavcodec versions. * * @note The AVCodecContext MUST have been opened with @ref avcodec_open2() * before packets may be fed to the decoder. * * @param avctx codec context * @param[in] avpkt The input AVPacket. Usually, this will be a single video * frame, or several complete audio frames. * Ownership of the packet remains with the caller, and the * decoder will not write to the packet. The decoder may create * a reference to the packet data (or copy it if the packet is * not reference-counted). * Unlike with older APIs, the packet is always fully consumed, * and if it contains multiple frames (e.g. some audio codecs), * will require you to call avcodec_receive_frame() multiple * times afterwards before you can send a new packet. * It can be NULL (or an AVPacket with data set to NULL and * size set to 0); in this case, it is considered a flush * packet, which signals the end of the stream. Sending the * first flush packet will return success. Subsequent ones are * unnecessary and will return AVERROR_EOF. If the decoder * still has frames buffered, it will return them after sending * a flush packet. * * @return 0 on success, otherwise negative error code: * AVERROR(EAGAIN): input is not accepted right now - the packet must be * resent after trying to read output * AVERROR_EOF: the decoder has been flushed, and no new packets can * be sent to it (also returned if more than 1 flush * packet is sent) * AVERROR(EINVAL): codec not opened, it is an encoder, or requires flush * AVERROR(ENOMEM): failed to add packet to internal queue, or similar * other errors: legitimate decoding errors */int avcodec_send_packet(AVCodecContext *avctx, const AVPacket *avpkt); å‚æ•°åˆ†æž AVCodecContext *avctxï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸Žæ—§çš„æŽ¥å£ä¸€è‡´ï¼Œæ˜¯è§†é¢‘è§£ç çš„ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«è§£ç å™¨ã€‚ const AVPacket *avpktï¼š ç¼–ç çš„éŸ³è§†é¢‘å¸§æ•°æ® ä¸ºä»€ä¹ˆè¦ä¼ é€’ç©ºçš„avpkt è¿™é‡Œæœ‰ä¸€ä¸ªè¯´æ˜Žæ˜¯å¯ä»¥ä¼ é€’NULLï¼Œä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ä¼ é€’NULLï¼Œä½ å¹³æ—¶çœ‹ä¸€äº›è§†é¢‘æ’­æ”¾å™¨ï¼Œæ’­æ”¾ç»å¸¸ä¼šå°‘æœ€åŽå‡ å¸§ï¼Œå¾ˆå¤šæƒ…å†µå°±æ˜¯å› ä¸ºæ²¡æœ‰å¤„ç†å¥½ç¼“å†²å¸§çš„é—®é¢˜ï¼Œffmpegå†…éƒ¨ä¼šç¼“å†²å‡ å¸§ï¼Œè¦æƒ³å–å‡ºæ¥å°±éœ€è¦ä¼ é€’ç©ºçš„AVPacketè¿›åŽ»ã€‚ æ–°ç‰ˆæœ¬avcodec_receive_frameæŽ¥å£æºç 12345678910111213141516171819/** * Return decoded output data from a decoder. * * @param avctx codec context * @param frame This will be set to a reference-counted video or audio * frame (depending on the decoder type) allocated by the * decoder. Note that the function will always call * av_frame_unref(frame) before doing anything else. * * @return * 0: success, a frame was returned * AVERROR(EAGAIN): output is not available right now - user must try * to send new input * AVERROR_EOF: the decoder has been fully flushed, and there will be * no more output frames * AVERROR(EINVAL): codec not opened, or it is an encoder * other negative values: legitimate decoding errors */int avcodec_receive_frame(AVCodecContext *avctx, AVFrame *frame); å‚æ•°åˆ†æž AVCodecContext *avctxï¼šç¬¬ä¸€ä¸ªå‚æ•°è§†é¢‘è§£ç çš„ä¸Šä¸‹æ–‡ï¼Œä¸Žä¸Šé¢æŽ¥å£ä¸€è‡´ã€‚ AVFrame *frameï¼šè§£ç åŽçš„è§†é¢‘å¸§æ•°æ®ã€‚ ç©ºé—´ç”³è¯·å’Œé‡Šæ”¾é—®é¢˜è§£ç åŽå›¾åƒç©ºé—´ç”±å‡½æ•°å†…éƒ¨ç”³è¯·ï¼Œä½ æ‰€åšçš„åªéœ€è¦åˆ†é… AVFrame å¯¹è±¡ç©ºé—´ï¼Œå¦‚æžœä½ æ¯æ¬¡è°ƒç”¨avcodec_receive_frameä¼ é€’åŒä¸€ä¸ªå¯¹è±¡ï¼ŒæŽ¥å£å†…éƒ¨ä¼šåˆ¤æ–­ç©ºé—´æ˜¯å¦å·²ç»åˆ†é…ï¼Œå¦‚æžœæ²¡æœ‰åˆ†é…ä¼šåœ¨å‡½æ•°å†…éƒ¨åˆ†é…ã€‚ avcodec_send_packetå’Œavcodec_receive_frameè°ƒç”¨å…³ç³»å¹¶ä¸ä¸€å®šæ˜¯ä¸€å¯¹ä¸€çš„ï¼Œæ¯”å¦‚ä¸€äº›éŸ³é¢‘æ•°æ®ä¸€ä¸ªAVPacketä¸­åŒ…å«äº†1ç§’é’Ÿçš„éŸ³é¢‘ï¼Œè°ƒç”¨ä¸€æ¬¡avcodec_send_packetä¹‹åŽï¼Œå¯èƒ½éœ€è¦è°ƒç”¨25æ¬¡ avcodec_receive_frameæ‰èƒ½èŽ·å–å…¨éƒ¨çš„è§£ç éŸ³é¢‘æ•°æ®ï¼Œæ‰€ä»¥è¦åšå¦‚ä¸‹å¤„ç†ï¼š 12345678910int re = avcodec_send_packet(codec, pkt);if (re != 0)&#123; return;&#125;while( avcodec_receive_frame(codec, frame) == 0)&#123; //è¯»å–åˆ°ä¸€å¸§éŸ³é¢‘æˆ–è€…è§†é¢‘ //å¤„ç†è§£ç åŽéŸ³è§†é¢‘ frame&#125; å‚è€ƒ send/receive encoding and decoding API overview]]></content>
      <categories>
        <category>FFMPEG</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>FFMPEG</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[FFMPEGå·¥å…·æ–¹æ³•]]></title>
    <url>%2F2017%2F09%2F13%2Fffmpeg-util%2F</url>
    <content type="text"><![CDATA[av_strerror1234int av_strerror ( int errnum,char * errbuf,size_t errbuf_size)]]></content>
      <categories>
        <category>FFMPEG</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>FFMPEG</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[éŸ³è§†é¢‘å‚æ•°ä¹‹Profile]]></title>
    <url>%2F2017%2F09%2F12%2Ftips-media-profile%2F</url>
    <content type="text"><![CDATA[å‰ä¸¤å¤©å‘çŽ°å…¬å¸äº§å“ è§¦å‘ æœ‰å¯¼å…¥ä»Žå¾®ä¿¡ç­‰ä¸‹è½½çš„å¤–éƒ¨å°è§†é¢‘æ—¶å¤±è´¥çš„æƒ…å†µ, è§¦å‘ å¯¼å…¥è§†é¢‘æ—¶ä½¿ç”¨å¼€æºåº“media-for-mobileå¯¹è§†é¢‘è¿›è¡Œé‡æ–°ç¼–ç .media-for-mobileä½¿ç”¨androidç³»ç»ŸæŽ¥å£android.media.MediaExtractorå¯¹mp4æ–‡ä»¶è§£å¤ç”¨,ä½¿ç”¨androidç¡¬ä»¶ç¼–è§£ç æŽ¥å£android.media.MediaCodecå¯¹è§†é¢‘è§£ç -å¤„ç†-ç¼–ç æ“ä½œ,æœ€åŽé€šè¿‡Androidç³»ç»ŸAPIandroid.media.MediaMuxerå°†è§†é¢‘å†™æˆæ–‡ä»¶. åé¦ˆçš„ä¸¤ä¸ªæœ‰é—®é¢˜è§†é¢‘,ä¸€ä¸ªè§†é¢‘å¯¼å…¥æ—¶æŠ¥BufferOverFlowExceptioné”™è¯¯,å¦ä¸€ä¸ªè§†é¢‘ä¸æŠ¥é”™ä½†æ˜¯å¯¼å…¥æ—¶è¿›åº¦ä¸€ç›´ä¸º0%. ç»åˆ†æžå‡ºé—®é¢˜çš„ä¸¤ä¸ªè§†é¢‘çš„Video profileä¸ºHigh,æ™®é€šè§†é¢‘ä¸ºBaseline,æŠ¥BufferOverFlowExceptioné”™è¯¯çš„è§†é¢‘çš„Audio profileä¸ºHE-AAC,æ™®é€šè§†é¢‘çš„Audio profileä¸ºLC. è¯¦ç»†äº†è§£äº†ä¸€ä¸‹H264 ä¸ŽAAC profile: H264å„ç§profileä½œä¸ºè¡Œä¸šæ ‡å‡†ï¼ŒH.264ç¼–ç ä½“ç³»å®šä¹‰äº†4ç§ä¸åŒçš„Profile(ç±»)ï¼šBaseline(åŸºçº¿ç±»),Main(ä¸»è¦ç±»), Extended(æ‰©å±•ç±»)å’ŒHigh Profile(é«˜ç«¯ç±»)ï¼ˆå®ƒä»¬å„è‡ªä¸‹åˆ†æˆè®¸å¤šä¸ªå±‚ï¼‰ï¼š Baseline Profile: æä¾›I/På¸§ï¼Œä»…æ”¯æŒprogressive(é€è¡Œæ‰«æ)å’ŒCAVLCï¼› Extended Profile: æä¾›I/P/B/SP/SIå¸§ï¼Œä»…æ”¯æŒprogressive(é€è¡Œæ‰«æ)å’ŒCAVLCï¼› Main Profile: æä¾›I/P/Bå¸§ï¼Œæ”¯æŒprogressive(é€è¡Œæ‰«æ)å’Œinterlaced(éš”è¡Œæ‰«æ)ï¼Œæä¾›CAVLCæˆ–CABACï¼› High Profile: ï¼ˆä¹Ÿå°±æ˜¯FRExtï¼‰åœ¨Main ProfileåŸºç¡€ä¸Šæ–°å¢žï¼š8x8 intra prediction(8x8 å¸§å†…é¢„æµ‹), custom quant(è‡ªå®šä¹‰é‡åŒ–), lossless video coding(æ— æŸè§†é¢‘ç¼–ç ), æ›´å¤šçš„yuvæ ¼å¼ï¼ˆ4:4:4â€¦ï¼‰ï¼› H.264åœ¨é«˜æ¸…ä¸­å…·æœ‰æœ€å°ä½“ç§¯ã€‚åœ¨åŒç­‰å›¾åƒè´¨é‡ä¸‹ï¼Œé‡‡ç”¨H.264æŠ€æœ¯åŽ‹ç¼©åŽçš„æ•°æ®é‡åªæœ‰MPEG2çš„1/8ï¼ŒMPEG4çš„1/3ï¼Œç›¸å¯¹Xvidã€Divxç­‰å±žäºŽMPEG4ç¼–ç è€Œè¨€ï¼Œå…¶ä½“ç§¯ä¼˜åŠ¿æ˜Žæ˜¾ï¼Œåœ¨äº’è”ç½‘ä¸Šï¼ŒH.264èµ„æºå¤„åœ¨çˆ†å‘è¶‹åŠ¿ã€‚è€ŒHigh Profileæ˜¯H.264è§£ç ä¸­çš„é«˜ç«¯ç±»åž‹ï¼Œæ‹¥æœ‰æœ€å®Œå–„çš„æ”¯æŒç¨‹åº¦ã€æœ€ä¼˜ç§€çš„ç‰¹æ€§ï¼Œå¯ä»¥è¯´æ˜¯é«˜æ¸…è§†é¢‘ç¼–ç ä¸­çš„åŠ³æ–¯èŽ±æ–¯ï¼Œåªæœ‰å¾æœäº†è¿™ä¸ªä¼˜ç§€çš„ç¼–ç ï¼ŒMP4æ‰èƒ½å°†H.264å®Œå…¨æŽŒæŽ§ï¼Œä¹Ÿæ‰èƒ½å……åˆ†äº«å—åˆ°é«˜æ¸…è§†é¢‘å¸¦æ¥çš„è§†è§‰éœ‡æ’¼ï¼Œæ„ä¹‰éžå‡¡ã€‚ é’ˆå¯¹å½“å‰é«˜æ¸…æ˜¯è§†é¢‘ä¼šè®®è¡Œä¸šçš„ä¸»æµå‘å±•è¶‹åŠ¿ï¼Œè€Œç›®å‰é«˜æ¸…æ™®åŠçš„ä¸»è¦é˜»åŠ›ä¹‹ä¸€å°±æ˜¯å¸¦å®½çš„é™åˆ¶ã€‚è€ŒHigh Profile H.264æŠ€æœ¯åœ¨åŒç­‰è§†é¢‘è´¨é‡çš„æƒ…å†µä¸‹å¯èŠ‚çœ50%çš„å¸¦å®½ï¼Œä¸ºå®¢æˆ·èŠ‚çœå¤§é‡çš„ç½‘ç»œå¸¦å®½æˆæœ¬ã€‚æ®ä¸šå†…ä¸“å®¶ä»‹ç»ï¼Œæ­¤æ¬¡H.264 High Profileçš„æŽ¨å‡ºæ˜¯è§†é¢‘æŠ€æœ¯çš„ä¸€ä¸ªå·¨å¤§è¿›æ­¥ï¼Œå…¶æ„ä¹‰ä¸äºšäºŽ2003å¹´ä»ŽH.263å‘H.264è¿‡æ¸¡çš„ä»·å€¼ã€‚å®ƒå°†ä¸ºç›®å‰æ­£åœ¨æŽ¨å¹¿çš„é«˜æ¸…è§†é¢‘é€šä¿¡åº”ç”¨æ‰«æ¸…äº†ä»¤äººå¤´ç–¼çš„ç½‘ç»œå¸¦å®½éšœç¢ï¼Œä¸ä»…å¦‚æ­¤ï¼Œè¿™äº›å˜åŒ–å¯¹äºŽåŒ…æ‹¬CIFã€æ ‡æ¸…ç­‰å“è´¨çš„è§†é¢‘é€šä¿¡åº”ç”¨ä¹ŸåŒæ ·é€‚ç”¨ã€‚ é‰´äºŽHigh Profile H.264å¯¹äºŽè§†é¢‘ä¼šè®®è¡Œä¸šçš„éžå‡¡å½±å“ï¼Œç›®å‰å·²æœ‰å›½å†…å¤–åŽ‚å•†å°é²œï¼Œå®£å¸ƒå…¶æ——ä¸‹äº§å“å…¨é¢æ”¯æŒè¯¥é¡¹æŠ€æœ¯ï¼ŒåŒ…æ‹¬å®åˆ©é€šã€åŽå¹³ã€åŽè…¾ç½‘è®¯ã€‚ä»Žè¿™ä¸€è¶‹åŠ¿æ¥çœ‹ï¼Œæœªæ¥è§†é¢‘ä¼šè®®äº§å“å…¨é¢æ”¯æŒHigh Profile H.264ä¹Ÿç»æˆä¸ºä¸å¯é€†è½¬çš„æ½®æµï¼Œè€Œé«˜æ¸…æ™®åŠä¹Ÿåœ¨æŠ€æœ¯å±‚é¢æ›´è¿‘äº†ä¸€æ­¥ã€‚ å‚è€ƒ: H264 å„ç§profile AACå„ç§profileAACå…±æœ‰9ç§è§„æ ¼ï¼Œä»¥é€‚åº”ä¸åŒçš„åœºåˆçš„éœ€è¦ï¼š MPEG-2 AAC LC: ä½Žå¤æ‚åº¦è§„æ ¼ï¼ˆLow Complexityï¼‰â€“æ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰å¢žç›ŠæŽ§åˆ¶ï¼Œä½†æé«˜äº†ç¼–ç æ•ˆçŽ‡ï¼Œåœ¨ä¸­ç­‰ç çŽ‡çš„ç¼–ç æ•ˆçŽ‡ä»¥åŠéŸ³è´¨æ–¹é¢ï¼Œéƒ½èƒ½æ‰¾åˆ°å¹³è¡¡ç‚¹ MPEG-2 AAC Main: ä¸»è§„æ ¼ MPEG-2 AAC SSR: å¯å˜é‡‡æ ·çŽ‡è§„æ ¼ï¼ˆScaleable Sample Rateï¼‰ MPEG-4 AAC LC: ä½Žå¤æ‚åº¦è§„æ ¼ï¼ˆLow Complexityï¼‰â€”â€”çŽ°åœ¨çš„æ‰‹æœºæ¯”è¾ƒå¸¸è§çš„MP4æ–‡ä»¶ä¸­çš„éŸ³é¢‘éƒ¨ä»½å°±åŒ…æ‹¬äº†è¯¥è§„æ ¼éŸ³é¢‘æ–‡ä»¶ MPEG-4 AAC Main: ä¸»è§„æ ¼ â€”â€”åŒ…å«äº†é™¤å¢žç›ŠæŽ§åˆ¶ä¹‹å¤–çš„å…¨éƒ¨åŠŸèƒ½ï¼Œå…¶éŸ³è´¨æœ€å¥½ MPEG-4 AAC SSR: å¯å˜é‡‡æ ·çŽ‡è§„æ ¼ï¼ˆScaleable Sample Rateï¼‰ MPEG-4 AAC LTP: é•¿æ—¶æœŸé¢„æµ‹è§„æ ¼ï¼ˆLong Term Predicitionï¼‰ MPEG-4 AAC LD: ä½Žå»¶è¿Ÿè§„æ ¼ï¼ˆLow Delayï¼‰ MPEG-4 AAC HE: é«˜æ•ˆçŽ‡è§„æ ¼ï¼ˆHigh Efficiencyï¼‰â€”â€“è¿™ç§è§„æ ¼é€‚åˆç”¨äºŽä½Žç çŽ‡ç¼–ç ï¼Œæœ‰Nero ACC ç¼–ç å™¨æ”¯æŒ 14496-3æ ‡å‡†ï¼Œé‡Œé¢å®šä¹‰çš„profileé™¤äº†ä¸Šè¿°çš„ä¸€äº›è§„æ ¼ï¼Œè¿˜æœ‰å¦‚Scalable ã€ TwinVQã€ CELPã€ HVXCç­‰æ›´å¤šå…¶ä»–çš„profileã€‚ ç›®å‰å¬åˆ°ç”¨çš„æ¯”è¾ƒå¤šçš„åº”è¯¥æ˜¯LCå’ŒHE(é€‚åˆä½Žç çŽ‡)ã€‚æµè¡Œçš„Nero AACçš„å‘½ä»¤è¡Œç¼–ç ç¨‹åºå°±æ”¯æŒLCï¼ŒHEï¼ŒHEv2è¿™ä¸‰ç§ï¼Œè¯•ç”¨åŽï¼Œç”¨MediaInfoåˆ†æžäº†ç¼–ç åŽçš„AACéŸ³é¢‘ï¼Œå‘çŽ°è§„æ ¼æ˜¾ç¤ºéƒ½æ˜¯LCï¼Œå½“æ—¶å°±æ„Ÿåˆ°å¥‡æ€ªï¼Œä¸æ˜¯è¯´æ”¯æŒä¸‰ç§è§„æ ¼å—ï¼Ÿç„¶åŽæ‰åˆæŸ¥èµ„æ–™å‘çŽ°ï¼ŒåŽŸæ¥HEå…¶å®žå°±æ˜¯AACï¼ˆLCï¼‰+SBRæŠ€æœ¯ï¼ŒHEv2å°±æ˜¯AACï¼ˆLCï¼‰+SBR+PSæŠ€æœ¯ï¼Œéš¾æ€ªç”¨MediaInfoåˆ†æžåŽï¼ŒHEè§„æ ¼çš„æ–‡ä»¶å³æ˜¾ç¤º: 123æ ¼å¼ç®€ä»‹:LCæ ¼å¼è®¾ç½®,SBR:æ˜¯æ ¼å¼è®¾ç½®,PS:å¦ HEä¸ŽHEv2 HEï¼šâ€œhigh efficiencyâ€ï¼ˆé«˜æ•ˆæ€§ï¼‰ã€‚HE-AAC v1ï¼ˆåˆç§°AACPlusV1ï¼ŒSBR)ç”¨å®¹å™¨çš„æ–¹æ³•åŠ äº†åŽŸAACï¼ˆLCï¼‰+SBRæŠ€æœ¯ã€‚SBRå…¶å®žä»£è¡¨çš„æ˜¯Spectral Band Replication(é¢‘æ®µå¤åˆ¶)ã€‚ç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼ŒéŸ³ä¹çš„ä¸»è¦é¢‘è°±é›†ä¸­åœ¨ä½Žé¢‘æ®µï¼Œé«˜é¢‘æ®µå¹…åº¦å¾ˆå°ï¼ˆä½†å¾ˆé‡è¦ï¼Œå†³å®šäº†éŸ³è´¨ï¼‰ï¼Œå¦‚æžœå¯¹æ•´ä¸ªé¢‘æ®µç¼–ç ï¼Œè¦ä¹ˆä¸ºäº†ä¿æŠ¤é«˜é¢‘é€ æˆä½Žé¢‘æ®µç¼–ç è¿‡ç»†ä»¥è‡´æ–‡ä»¶å·¨å¤§ï¼Œè¦ä¹ˆä¸ºäº†ä¿å­˜äº†ä½Žé¢‘çš„ä¸»è¦æˆåˆ†è€Œå¤±åŽ»é«˜é¢‘æˆåˆ†ä»¥è‡´ä¸§å¤±éŸ³è´¨ã€‚SBRæŠŠé¢‘è°±åˆ‡å‰²å¼€æ¥ï¼Œä½Žé¢‘å•ç‹¬ç¼–ç ä¿å­˜ä¸»è¦æˆåˆ†ï¼Œé«˜é¢‘å•ç‹¬æ”¾å¤§ç¼–ç ä¿å­˜éŸ³è´¨ï¼Œâ€œç»Ÿç­¹å…¼é¡¾â€äº†ï¼Œåœ¨å‡å°‘æ–‡ä»¶å¤§å°çš„æƒ…å†µä¸‹è¿˜ä¿å­˜äº†éŸ³è´¨ï¼Œå®Œç¾Žçš„åŒ–è§£äº†ä¸€å¯¹çŸ›ç›¾ HEv2 å®ƒç”¨å®¹å™¨çš„æ–¹æ³•åŒ…å«äº†HE-AAC v1å’ŒPSæŠ€æœ¯ã€‚PSæŒ‡â€œparametric stereoâ€ï¼ˆå‚æ•°ç«‹ä½“å£°ï¼‰ã€‚è¿™ä¸ªå…¶å®žå¥½ç†è§£ï¼ŒåŽŸæ¥çš„ç«‹ä½“å£°æ–‡ä»¶ï¼Œæ–‡ä»¶å¤§å°æ˜¯ä¸€ä¸ªå£°é“çš„ä¸¤å€ã€‚ä½†æ˜¯ä¸¤ä¸ªå£°é“çš„å£°éŸ³å­˜åœ¨æŸç§ç›¸ä¼¼æ€§ï¼Œæ ¹æ®é¦™å†œä¿¡æ¯ç†µç¼–ç å®šç†ï¼Œç›¸å…³æ€§åº”è¯¥è¢«åŽ»æŽ‰æ‰èƒ½å‡å°æ–‡ä»¶å¤§å°ã€‚æ‰€ä»¥PSæŠ€æœ¯å­˜å‚¨äº†ä¸€ä¸ªå£°é“çš„å…¨éƒ¨ä¿¡æ¯ï¼Œç„¶åŽï¼ŒèŠ±å¾ˆå°‘çš„å­—èŠ‚ç”¨å‚æ•°æè¿°å¦ä¸€ä¸ªå£°é“å’Œå®ƒä¸åŒçš„åœ°æ–¹ è¿™æ ·ï¼ŒHEv1å’ŒHEv2ç”¨ä¸ªå›¾ç®€å•è¡¨ç¤ºä¸‹å°±æ˜¯ï¼š(å›¾ä¸­çš„AACå³æŒ‡çš„æ˜¯åŽŸæ¥çš„AAC-LC) ç”±äºŽNERO AACç¼–ç åŽäº§ç”Ÿçš„æ˜¯ç»è¿‡MP4å®¹å™¨å°è£…åŽçš„ï¼Œè€Œæˆ‘ä»¬çš„decoderéœ€è¦å¤„ç†çš„æ˜¯æœªç»å°è£…çš„AACæµï¼Œå› æ­¤è¿˜éœ€è¦å¤„ç†ä»ŽMP4å°è£…æ ¼å¼ä¸­extractå‡ºAACæµçš„æ­¥éª¤ï¼›å“¦ï¼Œè¿™é‡Œæåˆ°äº†MP4å®¹å™¨å°è£…ï¼Œå°±å†æŠŠæˆ‘çœ‹åˆ°çš„ä¸€äº›å…³äºŽMP4å®¹å™¨çš„å¿ƒå¾—æ’å…¥åœ¨æ­¤ä¹Ÿè¯´ä¸‹ï¼š å…¶å®ž.mp4æ ¼å¼è§„èŒƒæ˜¯MPEG4 Part 1æ ‡å‡†å®šä¹‰çš„ã€‚ä½†æ˜¯è¿™ä¸ªæ ¼å¼æœ¬èº«ç›¸å½“é€šç”¨ï¼Œå¹¶ä¸æ˜¯åªèƒ½ç”¨æ¥å­˜è´®MPEG4è§†é¢‘æ ¼å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ª.mp4æ–‡ä»¶ä¸­åŒ…å«çš„å¯èƒ½æ˜¯H.263çš„è§†é¢‘è½¨åŠAMRçš„éŸ³é¢‘è½¨ã€‚è¿™æ ·å®ƒå’ŒMPEG4è§†é¢‘åŽ‹ç¼©ç®—æ³•å°±åŠç‚¹è¾¹éƒ½æ²¾ä¸ä¸Šã€‚ä½†å®ƒç»å¯¹æ˜¯ä¸€ä¸ªåˆæ³•çš„.mp4æ–‡ä»¶ã€‚ä»Žè¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œ.mp4æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å°åŒ…æ ¼å¼ã€‚ä¹Ÿè®¸å®ƒçš„åŽŸå§‹è®¾è®¡æ„å›¾æ˜¯ä»…ç”¨äºŽMPEG4ï¼Œä½†äº‹å®žä¸Šå¤§å®¶è§‰å¾—å®ƒå¾ˆå¥½ç”¨ï¼Œå·²ç»æŠŠå®ƒæ‰©å±•æˆå¯ä»¥åŒ…å®¹å…¶å®ƒæ ¼å¼äº†ã€‚çŽ°åœ¨å¸‚åœºä¸Šæ¯”å¦‚æŸäº§å“å·ç§°â€œæ”¯æŒMP4æ’­æ”¾â€ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¦‚æžœå®ƒæ˜¯æŒ‡å¯ä»¥æ’­æ”¾.mp4è¿™ç§æ–‡ä»¶ï¼Œé‚£é‡Œé¢çš„éŸ³é¢‘å’Œè§†é¢‘æ ¼å¼å®ƒèƒ½æ”¯æŒå¤šå°‘ç§ç»„åˆå‘¢ï¼Ÿæ²¡è¯´æ¸…æ¥šå§ã€‚ä¸¾ä¸ªæžç«¯çš„ä¾‹å­ï¼Œå‡è®¾ä¸€å°è®¾å¤‡ä»…æ”¯æŒâ€œè§†é¢‘ä¸ºæœªåŽ‹ç¼©YUVä»¥åŠä¸å¸¦éŸ³é¢‘è½¨çš„.mp4æ–‡ä»¶ï¼Œä½†å®ƒçš„æ–‡ä»¶åç¡®å®žå¯ä»¥æ˜¯.mp4ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åœ¨ç›’å­ä¸Šå°ä¸Šâ€œæ”¯æŒMP4â€å‘¢ï¼Ÿé‚£ä¹ˆï¼Œä¹°å›žåŽ»ï¼Œå¤åˆ¶ä¸€ä¸ªç½‘ä¸Šä¸‹è½½çš„.mp4æ–‡ä»¶ï¼ˆMPEG4è§†é¢‘å’ŒAACéŸ³é¢‘åº”è¯¥æ˜¯ä¸ªæ¯”è¾ƒæµè¡Œçš„ç»„åˆï¼‰ï¼Œç»“æžœå´å‘çŽ°æ ¹æœ¬ä¸èƒ½æ’­æ”¾ã€‚å°±ç®—ä¸ä¸¾è¿™ä¹ˆæžç«¯çš„ä¾‹å­ï¼Œä¸€èˆ¬.mp4æ–‡ä»¶ä¸­å¸¸è§çš„è§†é¢‘éŸ³é¢‘æ ¼å¼ä¹Ÿæœ‰å¤šç§ï¼Œä¸€ä¸ªäº§å“è¦åšåˆ°æ”¯æŒæ‰€æœ‰çš„æ ¼å¼æ˜¯å¾ˆéš¾çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æžœè¦å‡†ç¡®çš„æè¿°ï¼Œåº”è¯¥å†™æ¸…æ¥šç±»ä¼¼â€œæ”¯æŒè§†é¢‘æ ¼å¼ä¸ºMPEG4æˆ–H.264/AVCï¼ŒéŸ³é¢‘ä¸ºAMRæˆ–AACçš„*.mp4æ–‡ä»¶â€ã€‚å…¶å®žæ›´ä¸¥æ ¼ä¸€äº›ï¼Œè¿˜åº”è¯¥å†™æ¸…æ¥šMPEG4æ”¯æŒåˆ°å“ªç§profile, AMRæ˜¯NBè¿˜æ˜¯WBï¼ŒAACæ˜¯LCè¿˜æ˜¯HEç­‰æ›´å¤šç»†èŠ‚ã€‚å½“ç„¶ï¼Œè¿™ç§è¯¯å¯¼åž‹çš„è¯´æ˜Žåº”è¯¥åœ¨å‡å°‘ï¼Œä¸è¿‡å¦‚æžœæœ‰æ¯”è¾ƒç¡®åˆ‡çš„æ ¼å¼éœ€æ±‚ï¼Œæœ€å¥½è¿˜æ˜¯å…ˆæžæ¸…æ¥šè¿™äº›ç»†èŠ‚ã€‚çœ‹åˆ°ç½‘ä¸Šè¿˜æœ‰äººè¯´åˆ°N73ï¼Œå…¶å®žåªæ”¯æŒè§†é¢‘ä¸ºMPEG4 Simple Profile / Advanced Simple ProfileåŠH.263 Profile 0 &amp; 3ï¼ŒéŸ³é¢‘ä¸ºAMR-NB/WBæˆ–è€…AAC-LC, HE-AACçš„mp4æ–‡ä»¶ã€‚å¦‚æžœä½ æ”¾ä¸€ä¸ªè§†é¢‘æ ¼å¼ä¸ºH.264/AVCçš„mp4ä¸ŠåŽ»ï¼Œæ˜¯æ— æ³•æ’­æ”¾å‡ºç”»é¢æ¥çš„ã€‚ åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€äº›å·¥å…·ï¼Œå¦‚MP4UI,MP4BOX,Yamb(mp4boxçš„GUIç¨‹åº),é‡‡ç”¨å®ƒä»¬è¿›è¡Œextractæ“ä½œåŽå‘çŽ°ï¼ŒåŽŸæ¥çš„SBRå’ŒPSç­‰ä¿¡æ¯å’‹æ²¡æœ‰äº†ï¼Œéƒ½å˜æˆLCè§„æ ¼çš„AACæ–‡ä»¶å•¦ã€‚å¥½å®¹æ˜“å‡†å¤‡çš„æµ‹è¯•æµï¼Œéš¾é“è¿˜æ˜¯ä¸èƒ½ç”¨ï¼ŸäºŽæ˜¯ä¸€ç•ªè‹¦å¯»å‘çŽ°ï¼Œå¯èƒ½æ˜¯SBRå’ŒPSç­‰ä¿¡æ¯åœ¨ADTSå¤´ä¸­æ˜¯æ— æ³•ä½“çŽ°çš„ï¼Œæ‰€ä»¥åˆ†æžADTSæ ¼å¼å¤´çš„AACï¼Œå°±æ— æ³•åˆ¤åˆ«æ˜¯å¦æ˜¯HEå’ŒHEv2å•¦ã€‚ä½†æ˜¯æˆ‘æ€»è§‰å¾—SBRå’ŒPSç­‰æŠ€æœ¯ä¿¡æ¯åœ¨AACæµä¸­åº”è¯¥è¿˜æ˜¯å­˜åœ¨çš„ã€‚å› ä¸ºæˆ‘è¿˜åœ¨ä¸€ä¸ªå›½å¤–çš„è®ºå›ä¸Šçœ‹åˆ°è¿™ä¹ˆå‡ å¥è¯ï¼šThereâ€™s no requirement for MP4 with AAC to have SBR indicated in the headers. Itâ€™s still correct not to have it marked and have SBR or PS data in the stream anyway. Likewise, decoding a frame and not seeing any SBR or PS info doesnâ€™t mean you canâ€™t find it further up in the stream anywayï¼ˆæˆ‘ç†è§£å°±æ˜¯è¯´SBR OR PSä¿¡æ¯ä¸ä¸€å®šåœ¨Headerä¸­æœ‰ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€ä½ ä¸èƒ½è¿›ä¸€æ­¥åœ¨streamä¸­å‘çŽ°å®ƒï¼‰ã€‚ HE-AACçš„.mp4ç æµï¼Œç»è¿‡extractå‡ºAAC(ADTS)åŽï¼Œ44.1KHZçš„å˜æˆäº†22.05KHZã€‚HEv2-AACçš„.mp4ç æµï¼Œç»è¿‡extractå‡ºAAC(ADTS)åŽï¼Œä¸ä½†44.1KHZçš„å˜æˆäº†22.05KHZ(ä¸€åŠ)ï¼Œè¿ž2channelsä¹Ÿå˜æˆäº†1channelsï¼Œè¿™ä¸ªé—®é¢˜æ›´å¥‡æ€ªäº†ï¼Œåœ¨è®ºå›ä¸Šæ‰¾ï¼Œå‘çŽ°ä¹Ÿæœ‰äººæœ‰æ­¤é—®é¢˜ï¼šâ€œI get 22050Hz, 1 channel for audio that is in fact 44100Hz, 2channels and having both SBR and PSâ€ã€‚ åŽæ¥çœ‹åˆ°MSDNä¸­çš„AAC Decoderçš„æè¿°ä¸­æœ‰è¿™ä¹ˆä¸€å°æ®µè¯ï¼š The media type gives the sample rate and number of channels prior to the application of spectral band replication (SBR) and parametric stereo (PS) tools, if present. The effect of the SBR tool is to double the decoded sample rate relative to the core AAC-LC sample rate. The effect of the PS tool is to decode stereo from a mono-channel core AAC-LC stream. æˆ‘çš„ç†è§£æ˜¯AACçš„decoderå¦‚æžœæ”¯æŒSBRå’ŒPSï¼Œä¼šå°†AAC-HEV1(SBR)ä¸­çš„sample rateæé«˜ä¸€å€ï¼Œè€Œä¼šå°†AAC-HEV2(SBR+PS)ä¸­ä¸ä»…sample rateæé«˜ä¸€å€ï¼Œå•å£°é“ä¹Ÿæé«˜è‡³åŒå£°é“äº†ã€‚ç»“åˆå‰é¢æåˆ°çš„SBR(é¢‘æ®µå¤åˆ¶)å’ŒPS(å‚æ•°ç«‹ä½“å£°ï¼‰æŠ€æœ¯çš„ç®€å•ä»‹ç»ï¼Œå¥½åƒè§‰å¾—è¿™æ ·æ˜¯æœ‰ç‚¹å„¿é“ç†çš„å“¦~~ ç”¨IPP exampleæä¾›çš„è§£ç å·¥å…·simple_playerç®€å•è¯•äº†ä¸‹ï¼Œå¯¹äºŽ44.1khzï¼Œstereoçš„HEv2-AACçš„.mp4ç æµï¼Œç»è¿‡extractå‡º22.05KHZï¼Œmono çš„AAC(ADTS)åŽï¼Œå†ä½¿ç”¨simple_playerè¿›è¡ŒéŸ³é¢‘è§£ç æµ‹è¯•ï¼Œè§£å®ŒåŽï¼Œæžœç„¶å‘çŽ°åˆæ¢å¤äº†44.1khzå’Œstereoã€‚ï¼ˆä½†ç›®å‰ä¹Ÿæµ‹è¯•äº†å¥½å‡ ç§extractå‡ºçš„HEå’ŒHEv2çš„aacç æµï¼Œæœ‰çš„èƒ½å°†sample rateå’Œchannel åˆdoubleå›žæ¥ï¼Œæœ‰çš„åˆä¸èƒ½ï¼Œè¿™ä¸ªå…·ä½“åŽŸå› æ˜¯ä¸æ˜¯ç”±äºŽIpp exampleæä¾›çš„è§£ç å™¨çš„é—®é¢˜è¿˜ä¸ç¡®å®šï¼‰ã€‚ å¦å¤–ï¼Œç”¨simple_playerå¦‚æžœç›´æŽ¥decoderç¼–ç å‡ºçš„ç»è¿‡å°è£…çš„.mp4æ ¼å¼çš„AACéŸ³é¢‘çš„è¯ï¼Œå‘çŽ°ï¼šå…¶å®ƒéƒ½æ­£å¸¸ï¼ŒåªAAC-HEv2æ ¼å¼çš„.mp4éŸ³é¢‘è§£ç åŽå˜æˆäº†å•å£°é“ã€‚éš¾é“æ˜¯è§£ç å™¨ä¸­çš„PS toolsæ²¡èƒ½å‘æŒ¥ä½œç”¨ï¼Ÿåˆæ­¥ä¼°è®¡åº”è¯¥æ˜¯IPP çš„é‚£ä¸ªå°è§£ç å™¨çš„é—®é¢˜å§ã€‚ å…³äºŽADTS&amp;ADIFä¸Šé¢è¯´åˆ°äº†ADTSå¤´æ ¼å¼çš„AACã€‚å…¶å®žï¼ŒAACçš„éŸ³é¢‘æ–‡ä»¶æ ¼å¼æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š ADIFï¼šAudio Data Interchange Format éŸ³é¢‘æ•°æ®äº¤æ¢æ ¼å¼ã€‚è¿™ç§æ ¼å¼çš„ç‰¹å¾æ˜¯å¯ä»¥ç¡®å®šçš„æ‰¾åˆ°è¿™ä¸ªéŸ³é¢‘æ•°æ®çš„å¼€å§‹ï¼Œä¸éœ€è¿›è¡Œåœ¨éŸ³é¢‘æ•°æ®æµä¸­é—´å¼€å§‹çš„è§£ç ï¼Œå³å®ƒçš„è§£ç å¿…é¡»åœ¨æ˜Žç¡®å®šä¹‰çš„å¼€å§‹å¤„è¿›è¡Œã€‚æ•…è¿™ç§æ ¼å¼å¸¸ç”¨åœ¨ç£ç›˜æ–‡ä»¶ä¸­ã€‚ ADTSï¼šAudio Data Transport Stream éŸ³é¢‘æ•°æ®ä¼ è¾“æµã€‚è¿™ç§æ ¼å¼çš„ç‰¹å¾æ˜¯å®ƒæ˜¯ä¸€ä¸ªæœ‰åŒæ­¥å­—çš„æ¯”ç‰¹æµï¼Œè§£ç å¯ä»¥åœ¨è¿™ä¸ªæµä¸­ä»»ä½•ä½ç½®å¼€å§‹ã€‚å®ƒçš„ç‰¹å¾ç±»ä¼¼äºŽmp3æ•°æ®æµæ ¼å¼ã€‚ ç®€å•è¯´ï¼ŒADTSå¯ä»¥åœ¨ä»»æ„å¸§è§£ç ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ¯ä¸€å¸§éƒ½æœ‰å¤´ä¿¡æ¯ã€‚ADIFåªæœ‰ä¸€ä¸ªç»Ÿä¸€çš„å¤´ï¼Œæ‰€ä»¥å¿…é¡»å¾—åˆ°æ‰€æœ‰çš„æ•°æ®åŽè§£ç ã€‚ä¸”è¿™ä¸¤ç§çš„headerçš„æ ¼å¼ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå…·ä½“çš„ç»„ç»‡ç»“æž„åœ¨è¿™é‡Œå°±ä¸è¯¦è¯´äº†ã€‚ å‚è€ƒ: AACçš„å„ç§è§„æ ¼ é—®é¢˜åŽŸå› åˆ†æžé¦–å…ˆBufferOverFlowExceptioné—®é¢˜,ç”±äºŽéŸ³é¢‘é‡‡ç”¨AAC-HEå¯¼è‡´MediaExtractorè§£æžå‡ºçš„éŸ³é¢‘é‡‡æ ·çŽ‡ä¸ºæœ¬èº«é‡‡æ ·çŽ‡çš„ä¸€åŠ,åŒæ—¶åˆ›å»ºå‡ºçš„è§£ç OutputBufferçš„å¤§å°æ˜¯ç¼–ç InputBufferçš„2å€,è€Œmedia-for-mobileå¼€æºé¡¹ç›®ç›´æŽ¥å°†ä»Žè§£ç å™¨OutputBufferå–å‡ºçš„æ•°æ®å¡žå…¥ç¼–ç å™¨InputBufferä¸­,2å€çš„æ•°æ®æ”¾å…¥ä¸€å€çš„Bufferå¯¼è‡´æº¢å‡º,æš‚æ—¶çš„è§£å†³åŠžæ³•æ‰‹åŠ¨æŒ‡å®šç¼–ç å™¨InputBuffer max-sizeä¸ºä¸€ä¸ªè¾ƒå¤§å€¼(10*1024).åŒæ—¶,ç”±äºŽMediaExtractorä¸èƒ½èŽ·å–æ­£ç¡®çš„audio profile,ä¹Ÿæ— æ³•ç¡®è®¤èŽ·å–åˆ°çš„é‡‡æ ·çŽ‡æ˜¯å¦ä¸æ­£ç¡®é‡‡æ ·çŽ‡çš„ä¸€åŠ,æ‰€ä»¥é‡‡ç”¨ffmpegæŽ¥å£èŽ·å–profile,ä½†æ˜¯ffmpegè°ƒç”¨avcodec_open2èŽ·å–åˆ°çš„profileä¸º-99,è€Œä¸”é‡‡æ ·çŽ‡ä¾ç„¶ä¸ºæ­£å¸¸é‡‡æ ·çŽ‡ä¸€åŠ,åªæœ‰åœ¨è§£ç ä¸€å¸§éŸ³é¢‘åŽæ‰èƒ½å¾—åˆ°æ­£ç¡®çš„profileä¸Žé‡‡æ ·çŽ‡. å…¶æ¬¡,è½¬ç è¿›åº¦ä¸å¢žåŠ çš„é—®é¢˜,ä¸»è¦æ˜¯Highçš„H264è§†é¢‘,media-for-mobileä½¿ç”¨ä¸€ä¸ªMediaExtractorä¸€æ¬¡æŠ½å–éŸ³è§†é¢‘å¸§,å¦‚æžœæ˜¯éŸ³é¢‘åˆ™äº¤éŸ³é¢‘è§£ç å™¨,å¦‚æžœä¸ºè§†é¢‘åˆ™äº¤è§†é¢‘è§£ç å™¨,è§£ç åŽå°†è§£ç å¸§è½¬äº¤ç¼–ç å™¨,ç¼–ç åŽå°†æ•°æ®å†™å…¥MediaMuxer,å°†æ•°æ®å†™å…¥MediaMuxerçš„å‰ææ˜¯åŠç”¨è¿‡addTrack,å°†éŸ³è§†é¢‘trackåŠ å…¥åˆ°Muxerä¸­,è€ŒaddTrackéœ€è¦åœ¨éŸ³è§†é¢‘è§£ç è‹¥å¹²å¸§åŽäº§ç”ŸINFO_OUTPUT_FORMAT_CHANGED,è‹¥æ²¡æœ‰addTrackä¼šå¯¼è‡´ç¼–ç åŽæ•°æ®å¦‚æ³•å†™å…¥Muxer,å¡æ­»ç¼–ç å™¨,Baselineè§†é¢‘åªéœ€è¦å°‘é‡å¸§å°±å¯ä»¥äº§ç”ŸINFO_OUTPUT_FORMAT_CHANGED,ä½†Highè§†é¢‘äº§ç”ŸINFO_OUTPUT_FORMAT_CHANGEDéœ€è¦æ›´å¤šçš„å¸§,è€Œmedia-for-mobileä¸­,MediaExtractoré¦–å…ˆä¸€ç›´èŽ·å–åˆ°çš„æ˜¯éŸ³é¢‘æ•°æ®,éŸ³é¢‘ä¸€ç›´è§£ç ç¼–ç ,ä½†æ˜¯è¾“å‡ºçš„muxeræ—¶,videotrackæœªè¢«æ·»åŠ ,æ‰€ä»¥æ— æ³•å°†éŸ³é¢‘ç¼–ç å™¨çš„æ•°æ®å†™å…¥muxer,éŸ³é¢‘è§£ç å™¨è¢«å¡æ­»,è€Œmediasourceä¸€ç›´è¢«äº§ç”Ÿçš„audioæ•°æ®æ— æ³•è¢«æ¶ˆè´¹,æ— æ³•èŽ·å–åˆ°è§†é¢‘æ•°æ®å¯¼è‡´è§†é¢‘INFO_OUTPUT_FORMAT_CHANGEDä¸€ç›´æ— æ³•äº§ç”Ÿ,æœ€ç»ˆäº§ç”Ÿæ­»é”,å¯¼è‡´audioç­‰å¾…videoçš„INFO_OUTPUT_FORMAT_CHANGED,videoç­‰å¾…audioè¢«è¯»å®ŒåŽè¯»åˆ°videoè§£ç äº§ç”ŸINFO_OUTPUT_FORMAT_CHANGED. æœ€åŽå°†audioå’Œvideoä½¿ç”¨ä¸¤ä¸ªMediaExtractorå„è¯»å–å„è‡ªå†…å®¹.]]></content>
      <categories>
        <category>media</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>éŸ³è§†é¢‘</tag>
        <tag>tips</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[androidè‡ªåŠ¨åŒ–æµ‹è¯•(ä¸€):UiAutomatorå®˜æ–¹ä»‹ç»]]></title>
    <url>%2F2017%2F08%2F30%2Fat-android-start%2F</url>
    <content type="text"><![CDATA[äº†è§£androidæµ‹è¯•éœ€è¦æŸ¥è¯¢androidå®˜æ–¹æ–‡æ¡£,androidå®˜æ–¹åŸ¹è®­æ•™ç¨‹Getting Started with Testingä»‹ç»äº†androidæä¾›çš„æµ‹è¯•ç±»åž‹,æµ‹è¯•æŽ¥å£ç­‰,ç›¸è¾ƒä¸Žç½‘ä¸Šæ€»ç»“çš„androidè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æž¶,å®˜æ–¹æ–‡æ¡£æ˜¾ç„¶åˆ†ç±»æ›´åˆç†,å®šä½æ›´å‡†ç¡®. ä¸¤ç§æµ‹è¯•ç±»åž‹åœ¨ä½¿ç”¨Android Studioåˆ›å»ºæ¨¡å—æ—¶ä¼šåœ¨srcä¸‹ç”ŸæˆandroidTestå’Œtestä¸¤ä¸ªç”¨äºŽæµ‹è¯•çš„çš„ç›®å½•,å¯¹åº”ä¸‹é¢ä¸¤ç§æµ‹è¯•ç±»åž‹. æœ¬åœ°å•å…ƒæµ‹è¯•(Local unit tests)ä½äºŽmodule-name/src/test/java/.ä¸‹,è¿è¡Œåœ¨PCç«¯æœ¬åœ°çš„JVMè™šæ‹Ÿæœºä¸Š,å¹¶ä¸”ä¸èƒ½è®¿é—®Androidæ¡†æž¶çš„æŽ¥å£. å‚è€ƒBuilding Local Tests è®¾å¤‡åŒ–æµ‹è¯•ä½äºŽmodule-name/src/androidTest/java/.ä¸‹,å¿…é¡»è¿è¡Œåœ¨Androidç‰©ç†è®¾å¤‡å’Œè™šæ‹Ÿæœºä¸Š. å‚è€ƒBuilding Instrumented Unit Tests Instrumented unit tests are tests that run on physical devices and emulators, and they can take advantage of the Android framework APIs and supporting APIs, such as the Android Testing Support Library. You should create instrumented unit tests if your tests need access to instrumentation information (such as the target appâ€™s Context) or if they require the real implementation of an Android framework component (such as a Parcelable or SharedPreferences object). Using instrumented unit tests also helps to reduce the effort required to write and maintain mock code. You are still free to use a mocking framework, if you choose, to simulate any dependency relationships. è®¾å¤‡åŒ–å•å…ƒæµ‹è¯•åˆ†ä¸º: è®¾å¤‡åŒ–å•å…ƒæµ‹è¯•(Instrumented Unit Test):Building Instrumented Unit Tests: Build complex unit tests with Android dependencies that cannot be satisfied with mock objects. ç»„ä»¶é›†æˆæµ‹è¯•:Automating User Interface Tests: Create tests to verify that the user interface behaves correctly for user interactions within a single app or for interactions across multiple apps. appé›†æˆæµ‹è¯•:Testing App Component Integrations: Verify the behavior of components that users do not directly interact with, such as a Service or aContent Provider.]]></content>
      <categories>
        <category>autotest</category>
      </categories>
      <tags>
        <tag>autotest</tag>
        <tag>android</tag>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[androidè‡ªåŠ¨åŒ–æµ‹è¯•(N):UiAutomatorå®˜æ–¹ä»‹ç»]]></title>
    <url>%2F2017%2F08%2F30%2Fat-android-uiautomator-official%2F</url>
    <content type="text"><![CDATA[Automating User Interface TestsUser interface (UI) testing lets you ensure that your app meets its functional requirements and achieves a high standard of quality such that it is more likely to be successfully adopted by users. One approach to UI testing is to simply have a human tester perform a set of user operations on the target app and verify that it is behaving correctly. However, this manual approach can be time-consuming, tedious, and error-prone. A more efficient approach is to write your UI tests such that user actions are performed in an automated way. The automated approach allows you to run your tests quickly and reliably in a repeatable manner. Note: It is strongly encouraged that you use Android Studio for building your test apps, because it provides project setup, library inclusion, and packaging conveniences. This class assumes you are using Android Studio. To automate UI tests with Android Studio, you implement your test code in a separate Android test folder (src/androidTest/java). The Android Plug-in for Gradle builds a test app based on your test code, then loads the test app on the same device as the target app. In your test code, you can use UI testing frameworks to simulate user interactions on the target app, in order to perform testing tasks that cover specific usage scenarios. For testing Android apps, you typically create these types of automated UI tests: UI tests that span a single app: This type of test verifies that the target app behaves as expected when a user performs a specific action or enters a specific input in its activities. It allows you to check that the target app returns the correct UI output in response to user interactions in the appâ€™s activities. UI testing frameworks like Espresso allow you to programmatically simulate user actions and test complex intra-app user interactions. UI tests that span multiple apps: This type of test verifies the correct behavior of interactions between different user apps or between user apps and system apps. For example, you might want to test that your camera app shares images correctly with a 3rd-party social media app, or with the default Android Photos app. UI testing frameworks that support cross-app interactions, such as UI Automator, allow you to create tests for such scenarios. The lessons in this class teach you how to use the tools and APIs in the Android Testing Support Library to build these types of automated tests. Before you begin building tests using these APIs, you must install the Android Testing Support Library, as described in Downloading the Android Testing Support Library. UI TestingIn addition to unit testing the individual components that make up your Android application (such as activities, services, and content providers), it is also important that you test the behavior of your applicationâ€™s user interface (UI) when it is running on a device. UI testing ensures that your application returns the correct UI output in response to a sequence of user actions on a device, such as entering keyboard input or pressing toolbars, menus, dialogs, images, and other UI controls. Functional or black-box UI testing does not require testers to know the internal implementation details of the app, only its expected output when a user performs a specific action or enters a specific input. This approach allows for better separation of development and testing roles in your organization. One common approach to UI testing is to run tests manually and verify that the app is behaving as expected. However, this approach can be time-consuming, tedious, and error-prone. A more efficient and reliable approach is to automate the UI testing with a software testing framework. Automated testing involves creating programs to perform testing tasks (test cases) to cover specific usage scenarios, and then using the testing framework to run the test cases automatically and in a repeatable manner. Overviewhe Android SDK provides the following tools to support automated, functional UI testing on your application: uiautomatorviewer - A GUI tool to scan and analyze the UI components of an Android application. uiautomator - A Java library containing APIs to create customized functional UI tests, and an execution engine to automate and run the tests. To use these tools, you must have the following versions of the Android development tools installed: Android SDK Tools, Revision 21 or higher Android SDK Platform, API 16 or higher Workflow for the the uiautomator testing framework Hereâ€™s a short overview of the steps required to automate UI testing: Prepare to test by installing the app on a test device, analyzing the appâ€™s UI components, and ensuring that your application is accessible by the test automation framework. Create automated tests to simulate specific user interactions on your application. Compile your test cases into a JAR file and install it on your test device along with your app. Run the tests and view the test results. Correct any bugs or defects discovered in testing. Analyzing Your Applicationâ€™s UIBefore you start writing your test cases, itâ€™s helpful to familiarize yourself with the UI components (including the views and controls) of the targeted application. You can use the uiautomatorviewer tool to take a snapshot of the foreground UI screen on any Android device that is connected to your development machine. The uiautomatorviewer tool provides a convenient visual interface to inspect the layout hierarchy and view the properties of the individual UI components that are displayed on the test device. Using this information, you can later create uiautomator tests with selector objects that target specific UI components to test. To analyze the UI components of the application that you want to test: Connect your Android device to your development machine. Open a terminal window and navigate to /tools/. Run the tool with this command: 1$ uiautomatorviewer To capture a screen for analysis, click the Device Screenshot button in the GUI of the uiautomatorviewer tool. Note: If you have more than one device connected, specify the device for screen capture by setting the ANDROID_SERIAL environment variable: a. Find the serial numbers for your connected devices by running this command: 123$ adb devices``` b. Set the ANDROID_SERIAL environment variable to select the device to test: #In Windows: set ANDROID_SERIAL= #In UNIX: export ANDROID_SERIAL= 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657If you are connected to only a single device, you do not need to set the ANDROID_SERIAL environment variable.5. View the UI properties for your application:- Hover over the snapshot in the left-hand panel to see the UI components identified by the uiautomatorviewer tool. You can view the componentâ€™s properties listed in the lower right-hand panel, and the layout hierarchy in the upper right-hand panel.- Optionally, click on the Toggle NAF Nodes button to see UI components that are not accessible to the uiautomator testing framework. Only limited information may be available for these components.#### Preparing to TestBefore using the uiautomator testing framework, complete these pre-flight tasks:##### Load the application to a deviceIf you are reading this document, chances are that the Android application that you want to test has not been published yet. If you have a copy of the APK file, you can install the APK onto a test device by using the adb tool. To learn how to install an APK file using the adb tool, see the [adb](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/adb.html#move) documentation.##### Identify the applicationâ€™s UI componentsBefore writing your `uiautomator` tests, first identify the UI components in the application that you want to test. Typically, good candidates for testing are UI components that are visible and that users can interact with. The UI components should also have visible text labels, `android:contentDescription` values, or both.You can inspect the visible screen objects in an application conveniently by using the `uiautomatorviewer` tool. For more information about how to analyze an application screen with this tool, see the section [Analyzing Your Applicationâ€™s UI](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/testing/testing_ui.html#uianalaysis). For more information about the common types of UI components provided by Android, see [User Interface](https://stuff.mit.edu/afs/sipb/project/android/docs/guide/topics/ui/index.html).##### Ensure that the application is accessibleThis step is required because the `uiautomator` tool depends on the accessibility features of the Android framework to execute your functional UI tests. You should include these minimum optimizations to support the `uiautomator` tool:- Use the `android:contentDescription` attribute to label the `ImageButton`, `ImageView`, `CheckBox` and other user interface controls.- Provide an `android:hint` attribute instead of a content description for `EditText` fields- Associate an `android:hint` attribute with any graphical icons used by controls that provide feedback to the user (for example, status or state information).- Make sure that all the user interface elements are accessible with a directional controller, such as a trackball or D-pad.- Use the `uiautomatorviewer` tool to ensure that the UI component is accessible to the testing framework. You can also test the application by turning on accessibility services like TalkBack and Explore by Touch, and try using your application using only directional controls.For more information about implementing and testing accessibility, see [Making Applications Accessible](https://stuff.mit.edu/afs/sipb/project/android/docs/guide/topics/ui/accessibility/apps.html).&gt; Note: To identify the non-accessible components in the UI, click on the Toggle NAF Nodes option in the `uiautomatorviewer` tool.Generally, Android application developers get accessibility support for free, courtesy of the `View` and `ViewGroup` classes. However, some applications use custom view components to provide a richer user experience. Such custom components won&apos;t get the accessibility support that is provided by the standard Android UI components. If this applies to your application, ensure that the application developer exposes the custom drawn UI components to Android accessibility services, by implementing the `AccessibilityNodeProvider` class. For more information about making custom view components accessible, see [Making Applications Accessible](https://stuff.mit.edu/afs/sipb/project/android/docs/guide/topics/ui/accessibility/apps.html#custom-views).##### Configure your development environmentIf you&apos;re developing in Eclipse, the Android SDK provides additional tools that help you write test cases using `uiautomator` and buiild your JAR file. In order to set up Eclipse to assist you, you need to create a project that includes the `uiautomator` client library, along with the Android SDK library. To configure Eclipse:1. Create a new Java project in Eclipse, and give your project a name that is relevant to the tests youâ€™re about to create (for example, &quot;MyAppNameTests&quot;). In the project, you will create the test cases that are specific to the application that you want to test.2. From the Project Explorer, right-click on the new project that you created, then select Properties &gt; Java Build Path, and do the following: - Click Add Library &gt; JUnit then select JUnit3 to add JUnit support. - Click Add External JARs... and navigate to the SDK directory. Under the platforms directory, select the latest SDK version and add both the uiautomator.jar and android.jar files.If you did not configure Eclipse as your development environment, make sure that the `uiautomator.jar` and `android.jar` files from the `&lt;android-sdk&gt;/platforms/&lt;sdk&gt;` directory are in your Java class path.Once you have completed these prerequisite tasks, you&apos;re almost ready to start creating your `uiautomator` tests.#### Creating uiautomator TestsTo build a test that runs in the `uiautomator` framework, create a test case that extends the `UiAutomatorTestCase` class. In Eclipse, the test case file goes under the `src` directory in your project. Later, you will build the test case as a JAR file, then copy this file to the test device. The test JAR file is not an APK file and resides separately from the application that you want to test on the device.Because the `UiAutomatorTestCase` class extends `junit.framework.TestCase`, you can use the `JUnit` Assert class to test that UI components in the app return the expected results. To learn more about JUnit, you can read the documentation on the `junit.org` home page.The first thing your test case should do is access the device that contains the target app. Itâ€™s also good practice to start the test from the Home screen of the device. From the Home screen (or some other starting location youâ€™ve chosen in the target app), you can use the classes provided by the `uiautomator` API to simulate user actions and to test specific UI components. For an example of how to put together a `uiautomator` test case, see the sample test case.##### uiautomator APIThe `uiautomator` API is bundled in the `uiautomator.jar` file under the `&lt;android-sdk&gt;/platforms/` directory. The API includes these key classes that allow you to capture and manipulate UI components on the target app:- [UiDevice](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiDevice.html)Represents the device state. In your tests, you can call methods on the UiDevice instance to check for the state of various properties, such as current orientation or display size. Your tests also can use the UiDevice instance to perform device level actions, such as forcing the device into a specific rotation, pressing the d-pad hardware button, or pressing the Home and Menu buttons.To get an instance of UiDevice and simulate a Home button press: getUiDevice().pressHome(); 12- [UiSelector](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiSelector.html)Represents a search criteria to query and get a handle on specific elements in the currently displayed UI. If more than one matching element is found, the first matching element in the layout hierarchy is returned as the target UiObject. When constructing a UiSelector, you can chain together multiple properties to refine your search. If no matching UI element is found, a `UiAutomatorObjectNotFoundException` is thrown. You can use the childSelector() method to nest multiple UiSelector instances. For example, the following code example shows how to specify a search to find the first ListView in the currently displayed UI, then search within that ListView to find a UI element with the text property Apps. UiObject appItem = new UiObject(new UiSelector() .className(â€œandroid.widget.ListViewâ€).instance(1) .childSelector(new UiSelector().text(â€œAppsâ€))); 1234- [UiObject](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiObject.html)Represents a UI element. To create a UiObject instance, use a UiSelector that describes how to search for, or select, the UI element.The following code example shows how to construct UiObject instances that represent a Cancel button and a OK button in your application. UiObject cancelButton = new UiObject(new UiSelector().text(â€œCancelâ€)); UiObject okButton = new UiObject(new UiSelector().text(â€œOKâ€)); 12You can reuse the UiObject instances that you have created in other parts of your app testing, as needed. Note that the `uiautomator` test framework searches the current display for a match every time your test uses a UiObject instance to click on a UI element or query a property.In the following code example, the `uiautomator` test framework searches for a UI element with the text property OK. If a match is found and if the element is enabled, the framework simulates a user click action on the element. if(okButton.exists() &amp;&amp; okButton.isEnabled()) { okButton.click(); } 1You can also restrict the search to find only elements of a specific class. For example, to find matches of the Button class: UiObject cancelButton = new UiObject(new UiSelector().text(â€œCancelâ€) .className(â€œandroid.widget.Buttonâ€)); UiObject okButton = new UiObject(new UiSelector().text(â€œOKâ€) .className(â€œandroid.widget.Buttonâ€)); 12- [UiCollection](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiCollection.html)Represents a collection of items, for example songs in a music album or a list of emails in an inbox. Similar to a UiObject, you construct a UiCollection instance by specifying a UiSelector. The UiSelector for a UiCollection should search for a UI element that is a container or wrapper of other child UI elements (such as a layout view that contains child UI elements). For example, the following code snippet shows how to construct a UiCollection to represent a video album that is displayed within a FrameLayout: UiCollection videos = new UiCollection(new UiSelector() .className(â€œandroid.widget.FrameLayoutâ€)); 1If the videos are listed within a LinearLayout view, and you want to to retrieve the number of videos in this collection: int count = videos.getChildCount(new UiSelector() .className(â€œandroid.widget.LinearLayoutâ€)); 1If you want to find a specific video that is labeled with the text element Cute Baby Laughing from the collection and simulate a user-click on the video: UiObject video = videos.getChildByText(new UiSelector() .className(â€œandroid.widget.LinearLayoutâ€), â€œCute Baby Laughingâ€); video.click(); 12Similarly, you can simulate other user actions on the UI object. For example, if you want to simulate selecting a checkbox that is associated with the video: UiObject checkBox = video.getChild(new UiSelector() .className(â€œandroid.widget.Checkboxâ€)); if(!checkBox.isSelected()) checkbox.click(); 123- [UiScrollable](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/UiScrollable.html)Represents a scrollable collection of UI elements. You can use the UiScrollable class to simulate vertical or horizontal scrolling across a display. This technique is helpful when a UI element is positioned off-screen and you need to scroll to bring it into view.For example, the following code shows how to simulate scrolling down the Settings menu and clicking on an About tablet option: UiScrollable settingsItem = new UiScrollable(new UiSelector() .className(â€œandroid.widget.ListViewâ€)); UiObject about = settingsItem.getChildByText(new UiSelector() .className(â€œandroid.widget.LinearLayoutâ€), â€œAbout tabletâ€); about.click() 1234For more information about these APIs, see the uiautomator reference.##### A sample uiautomator test caseThe following code example shows a simple test case which simulates a user bringing up the Settings app in a stock Android device. The test case mimics all the steps that a user would typically take to perform this task, including opening the Home screen, launching the All Apps screen, scrolling to the Settings app icon, and clicking on the icon to enter the Settings app. package com.uia.example.my; // Import the uiautomator libraries import com.android.uiautomator.core.UiObject; import com.android.uiautomator.core.UiObjectNotFoundException; import com.android.uiautomator.core.UiScrollable; import com.android.uiautomator.core.UiSelector; import com.android.uiautomator.testrunner.UiAutomatorTestCase; public class LaunchSettings extends UiAutomatorTestCase { public void testDemo() throws UiObjectNotFoundException { // Simulate a short press on the HOME button. getUiDevice().pressHome(); // Weâ€™re now in the home screen. Next, we want to simulate // a user bringing up the All Apps screen. // If you use the uiautomatorviewer tool to capture a snapshot // of the Home screen, notice that the All Apps buttonâ€™s // content-description property has the value â€œAppsâ€. We can // use this property to create a UiSelector to find the button. UiObject allAppsButton = new UiObject(new UiSelector() .description(&quot;Apps&quot;)); // Simulate a click to bring up the All Apps screen. allAppsButton.clickAndWaitForNewWindow(); // In the All Apps screen, the Settings app is located in // the Apps tab. To simulate the user bringing up the Apps tab, // we create a UiSelector to find a tab with the text // label â€œAppsâ€. UiObject appsTab = new UiObject(new UiSelector() .text(&quot;Apps&quot;)); // Simulate a click to enter the Apps tab. appsTab.click(); // Next, in the apps tabs, we can simulate a user swiping until // they come to the Settings app icon. Since the container view // is scrollable, we can use a UiScrollable object. UiScrollable appViews = new UiScrollable(new UiSelector() .scrollable(true)); // Set the swiping mode to horizontal (the default is vertical) appViews.setAsHorizontalList(); // Create a UiSelector to find the Settings app and simulate // a user click to launch the app. UiObject settingsApp = appViews.getChildByText(new UiSelector() .className(android.widget.TextView.class.getName()), &quot;Settings&quot;); settingsApp.clickAndWaitForNewWindow(); // Validate that the package name is the expected one UiObject settingsValidation = new UiObject(new UiSelector() .packageName(&quot;com.android.settings&quot;)); assertTrue(&quot;Unable to detect Settings&quot;, settingsValidation.exists()); }} 1234#### Building and Deploying Your uiautomator Tests1. Once you have coded your test, follow these steps to build and deploy your test JAR to your target Android test device:Create the required build configuration files to build the output JAR. To generate the build configuration files, open a terminal and run the following command: /tools/android create uitest-project -n -t 1 -p 12345The &lt;name&gt; is the name of the project that contains your uiautomator test source files, and the &lt;path&gt; is the path to the corresponding project directory.2. From the command line, set the ANDROID_HOME variable:- In Windows:`set ANDROID_HOME=&lt;path_to_your_sdk&gt;`- In UNIX:`export ANDROID_HOME=&lt;path_to_your_sdk&gt;`3. Go to the project directory where your build.xml file is located and build your test JAR. ant build 14. Deploy your generated test JAR file to the test device by using the adb push command: adb push /data/local/tmp/ 1Hereâ€™s an example: adb push ~/dev/workspace/LaunchSettings/bin/LaunchSettings.jar /data/local/tmp/ 123#### Running uiautomator TestsHereâ€™s an example of how to run a test that is implemented in the `LaunchSettings.jar` file. The tests are bundled in the `com.uia.example.my` package: adb shell uiautomator runtest LaunchSettings.jar -c com.uia.example.my.LaunchSettings 123456789101112131415To learn more about the syntax, subcommands, and options for uiautomator, see the [uiautomator](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/index.html) reference.#### Best PracticesHere are some best practices for functional UI testing with the uiautomator framework:- Ensure that you validate the same UI functions on your application across the various types of devices that your application might run on (for example, devices with different screen densities).- You should also test your UI against common scenarios such as in-coming phone calls, network interruptions, and user-initiated switching to other applications on the device.### [uiautomator tools](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/help/uiautomator/index.html)The uiautomator testing framework lets you test your user interface (UI) efficiently by creating automated functional UI testcases that can be run against your app on one or more devices.For more information on testing with the uiautomator framework, see [UI Testing](https://stuff.mit.edu/afs/sipb/project/android/docs/tools/testing/testing_ui.html).#### SyntaxTo run your testcases on the target device, you can use the `adb shell` command to invoke the `uiautomator` tool. The syntax is: adb shell uiautomator runtest -c [options] 1Hereâ€™s an example: adb shell uiautomator runtest LaunchSettings.jar -c com.uia.example.my.LaunchSettings ``` Command-line OptionsThe following table describes the subcommands and options for uiautomator. Table 1. Command-line options for uiautomator Subcommand Option Description runtest &lt;jar&gt; Required. The argument is the name of one or more JAR files that you deployed to the target device which contain your uiautomator testcases. You can list more than one JAR file by using a space as a separator. -c &lt;test_class_or_method&gt; Required. The argument is a list of one or more specific test classes or test methods from the JARs that you want uiautomator to run.Each class or method must be fully qualified with the package name, in one of these formats: package_name.class_name package_name.class_name#method_name You can list multiple classes or methods by using a space as a separator. â€“nohup Runs the test to completion on the device even if its parent process is terminated (for example, if the device is disconnected). -e Specify other name-value pairs to be passed to test classes. May be repeated.Note: The -e options cannot be combined; you must prefix each option with a separate -e flag. -e debug [true false] Wait for debugger to connect before starting. dump [file] Generate an XML file with a dump of the current UI hierarchy. If a filepath is not specified, by default, the generated dump file is stored on the device in this location /storage/sdcard0/window_dump.xml. events Prints out accessibility events to the console until the connection to the device is terminated UiAutomation apiClass for interacting with the deviceâ€™s UI by simulation user actions and introspection of the screen content. It relies on the platform accessibility APIs to introspect the screen and to perform some actions on the remote view tree. It also allows injecting of arbitrary raw input events simulating user interaction with keyboards and touch devices. One can think of a UiAutomation as a special type of AccessibilityService which does not provide hooks for the service life cycle and exposes other APIs that are useful for UI test automation. è¿™æ˜¯ä¸€ä¸ªé€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œæ¥ä¸Žè®¾å¤‡ç”¨æˆ·ç•Œé¢äº¤äº’ä»¥åŠèŽ·å–å±å¹•å†…å®¹çš„ç±»ã€‚å®ƒä¾èµ–äºŽå¹³å°çš„è¾…åŠ©åŠŸèƒ½APIsæ¥åœ¨è¿œç¨‹çš„æŽ§ä»¶æ ‘ä¸ŠèŽ·å–å±å¹•å†…å®¹ä»¥åŠæ‰§è¡Œä¸€äº›æ“ä½œã€‚åŒæ—¶å®ƒä¹Ÿå…è®¸é€šè¿‡æ³¨å…¥åŽŸç”Ÿäº‹ä»¶(è¯‘è€…æ³¨:æŒ‡çš„å°±æ˜¯InputEvent. KeyEventä¹Ÿæ˜¯ç»§æ‰¿äºŽInputEventçš„ï¼Œæ‰€ä»¥è¯´å®ƒæ˜¯åŽŸç”Ÿäº‹ä»¶)æ¥æ¨¡æ‹Ÿç”¨æˆ·çš„æŒ‰é”®å’Œè§¦å±æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºUiAutomationå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šç±»åž‹çš„AccessibilityService,å…¶æ—¢ä¸ä¼šä¸ºæŽ§åˆ¶æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸè€Œæä¾›é’©å­å‡½æ•°ï¼Œä¹Ÿä¸ä¼šæš´éœ²ä»»ä½•å…¶ä»–å¯ä»¥ç›´æŽ¥ç”¨äºŽç”¨æˆ·ç•Œé¢æµ‹è¯•è‡ªåŠ¨åŒ–çš„APIs. The APIs exposed by this class are low-level to maximize flexibility when developing UI test automation tools and libraries. Generally, a UiAutomation client should be using a higher-level library or implement high-level functions. For example, performing a tap on the screen requires construction and injecting of a touch down and up events which have to be delivered to the system by a call to injectInputEvent(InputEvent, boolean). è¿™ä¸ªç±»æš´éœ²å‡ºæ¥çš„APIsæ˜¯å¾ˆä½Žå±‚çš„ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†åœ¨å¼€å‘ç”¨æˆ·ç•Œé¢æµ‹è¯•è‡ªåŠ¨åŒ–æ¡†æž¶å’Œåº“æ—¶æä¾›æœ€å¤§çš„å¼¹æ€§ã€‚æ€»çš„æ¥è¯´ï¼Œä¸€ä¸ªUiAutomationå®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨ä¸€äº›ï¼ˆåŸºäºŽUiAutomationçš„)æ›´é«˜å±‚æ¬¡çš„åº“æˆ–è€…å®žçŽ°æ›´é«˜å±‚æ¬¡çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç”¨æˆ·åœ¨å±å¹•ä¸Šçš„ç‚¹å‡»äº‹ä»¶éœ€è¦æž„é€ å¹¶æ³¨å…¥ä¸€ä¸ªæŒ‰ä¸‹å’Œä¸€ä¸ªå¼¹èµ·äº‹ä»¶ï¼Œç„¶åŽå¿…é¡»è°ƒç”¨UiAutomationçš„ä¸€ä¸ªinjectInputEvent(InputEvent, boolean)çš„è°ƒç”¨æ¥å‘é€ç»™æ“ä½œç³»ç»Ÿã€‚ The APIs exposed by this class operate across applications enabling a client to write tests that cover use cases spanning over multiple applications. For example, going to the settings application to change a setting and then interacting with another application whose behavior depends on that setting. è¿™ä¸ªç±»æš´éœ²å‡ºæ¥çš„APIså¯ä»¥è·¨åº”ç”¨ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥ç¼–å†™å¯ä»¥è·¨è¶Šå¤šä¸ªåº”ç”¨çš„æµ‹è¯•ç”¨ä¾‹è„šæœ¬äº†ã€‚æ¯”å¦‚ï¼Œæ‰“å¼€ç³»ç»Ÿçš„è®¾ç½®åº”ç”¨åŽ»ä¿®æ”¹ä¸€äº›è®¾ç½®ç„¶åŽå†ä¸Žå¦å¤–ä¸€ä¸ªä¾èµ–äºŽè¯¥è®¾ç½®çš„åº”ç”¨è¿›è¡Œäº¤äº’ï¼ˆè¯‘è€…æ³¨ï¼šè¿™ä¸ªåœ¨instrumentationè¿™ä¸ªæ¡†æž¶å¯ä»¥åšä¸åˆ°çš„ï¼‰]]></content>
      <categories>
        <category>autotest</category>
      </categories>
      <tags>
        <tag>autotest</tag>
        <tag>android</tag>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[androidè‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹(N):æµ‹è¯•æ”¯æŒåº“]]></title>
    <url>%2F2017%2F08%2F30%2Fat-android-support-library%2F</url>
    <content type="text"><![CDATA[Androidå®˜æ–¹æ–‡æ¡£-æµ‹è¯•æ”¯æŒåº“ Android æµ‹è¯•æ”¯æŒåº“æä¾›äº†å¤§é‡ç”¨äºŽæµ‹è¯• Android åº”ç”¨çš„æ¡†æž¶ã€‚æ­¤åº“æä¾›äº†ä¸€ç»„ APIï¼Œè®©æ‚¨å¯ä»¥ä¸ºåº”ç”¨å¿«é€Ÿæž„å»ºä½•è¿è¡Œæµ‹è¯•ä»£ç ï¼ŒåŒ…æ‹¬ JUnit 4 å’ŒåŠŸèƒ½æ€§ç”¨æˆ·ç•Œé¢ (UI) æµ‹è¯•ã€‚æ‚¨å¯ä»¥ä»Ž Android Studio IDE æˆ–å‘½ä»¤è¡Œè¿è¡Œä½¿ç”¨è¿™äº› API åˆ›å»ºçš„æµ‹è¯•ã€‚ Android æµ‹è¯•æ”¯æŒåº“é€šè¿‡ Android SDK ç®¡ç†å™¨æä¾›ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æµ‹è¯•æ”¯æŒåº“è®¾ç½® æœ¬é¡µä»‹ç»äº† Android æµ‹è¯•æ”¯æŒåº“æä¾›äº†å“ªäº›å·¥å…·ã€å¦‚ä½•åœ¨æµ‹è¯•çŽ¯å¢ƒä¸­ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œä»¥åŠåº“ç‰ˆæœ¬çš„ç›¸å…³ä¿¡æ¯ã€‚ æµ‹è¯•æ”¯æŒåº“åŠŸèƒ½Android æµ‹è¯•æ”¯æŒåº“åŒ…æ‹¬ä»¥ä¸‹è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼š AndroidJUnitRunnerï¼šé€‚ç”¨äºŽ Android ä¸”ä¸Ž JUnit 4 å…¼å®¹çš„æµ‹è¯•è¿è¡Œå™¨ Espressoï¼šUI æµ‹è¯•æ¡†æž¶ï¼›é€‚åˆåº”ç”¨ä¸­çš„åŠŸèƒ½æ€§ UI æµ‹è¯• UI Automatorï¼šUI æµ‹è¯•æ¡†æž¶ï¼›é€‚åˆè·¨ç³»ç»Ÿå’Œå·²å®‰è£…åº”ç”¨çš„è·¨åº”ç”¨åŠŸèƒ½æ€§ UI æµ‹è¯• AndroidJUnitRunnerAndroidJUnitRunner ç±»æ˜¯ä¸€ä¸ª JUnit æµ‹è¯•è¿è¡Œå™¨ï¼Œå¯è®©æ‚¨åœ¨ Android è®¾å¤‡ä¸Šè¿è¡Œ JUnit 3 æˆ– JUnit 4 æ ·å¼æµ‹è¯•ç±»ï¼ŒåŒ…æ‹¬ä½¿ç”¨ Espresso å’Œ UI Automator æµ‹è¯•æ¡†æž¶çš„è®¾å¤‡ã€‚æµ‹è¯•è¿è¡Œå™¨å¯ä»¥å°†æµ‹è¯•è½¯ä»¶åŒ…å’Œè¦æµ‹è¯•çš„åº”ç”¨åŠ è½½åˆ°è®¾å¤‡ã€è¿è¡Œæµ‹è¯•å¹¶æŠ¥å‘Šæµ‹è¯•ç»“æžœã€‚æ­¤ç±»å°†æ›¿æ¢ InstrumentationTestRunner ç±»ï¼ŒåŽè€…ä»…æ”¯æŒ JUnit 3 æµ‹è¯•ã€‚ æ­¤æµ‹è¯•è¿è¡Œå™¨çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š JUnit æ”¯æŒ è®¿é—®ä»ªå™¨ä¿¡æ¯ æµ‹è¯•ç­›é€‰ æµ‹è¯•åˆ†ç‰‡ è¦æ±‚ Android 2.2ï¼ˆAPI çº§åˆ« 8ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ JUnit æ”¯æŒæµ‹è¯•è¿è¡Œå™¨ä¸Ž JUnit 3 å’Œ JUnit 4ï¼ˆæœ€é«˜ç‰ˆæœ¬ä¸º JUnit 4.10ï¼‰æµ‹è¯•å…¼å®¹ã€‚ä¸è¿‡ï¼Œè¯·å‹¿åœ¨åŒä¸€è½¯ä»¶åŒ…ä¸­æ··ç”¨ JUnit 3 å’Œ JUnit 4 æµ‹è¯•ä»£ç ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ„å¤–ç»“æžœã€‚å¦‚æžœè¦åˆ›å»ºä¸€ä¸ª JUnit 4 ä»ªå™¨æµ‹è¯•ç±»ä»¥åœ¨è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œï¼Œåˆ™æµ‹è¯•ç±»å¿…é¡»ä»¥ @RunWith(AndroidJUnit4.class) æ³¨è§£ä½œä¸ºå‰ç¼€ã€‚ ä»¥ä¸‹ä»£ç æ®µæ˜¾ç¤ºäº†å¦‚ä½•ç¼–å†™ JUnit 4 ä»ªå™¨æµ‹è¯•æ¥éªŒè¯ CalculatorActivity ç±»ä¸­çš„ add æ“ä½œæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ 1234567891011121314151617181920212223242526272829import android.support.test.runner.AndroidJUnit4;import android.support.test.runner.AndroidJUnitRunner;import android.test.ActivityInstrumentationTestCase2;@RunWith(AndroidJUnit4.class)public class CalculatorInstrumentationTest extends ActivityInstrumentationTestCase2&lt;CalculatorActivity&gt; &#123; @Before public void setUp() throws Exception &#123; super.setUp(); // Injecting the Instrumentation instance is required // for your test to run with AndroidJUnitRunner. injectInstrumentation(InstrumentationRegistry.getInstrumentation()); mActivity = getActivity(); &#125; @Test public void typeOperandsAndPerformAddOperation() &#123; // Call the CalculatorActivity add() method and pass in some operand values, then // check that the expected value is returned. &#125; @After public void tearDown() throws Exception &#123; super.tearDown(); &#125;&#125; è®¿é—®ä»ªå™¨ä¿¡æ¯æ‚¨å¯ä»¥ä½¿ç”¨ InstrumentationRegistry ç±»è®¿é—®ä¸Žæµ‹è¯•è¿è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚æ­¤ç±»åŒ…æ‹¬ Instrumentation å¯¹è±¡ã€ç›®æ ‡åº”ç”¨ Context å¯¹è±¡ã€æµ‹è¯•åº”ç”¨ Context å¯¹è±¡ï¼Œä»¥åŠä¼ é€’åˆ°æµ‹è¯•ä¸­çš„å‘½ä»¤è¡Œå‚æ•°ã€‚ä½¿ç”¨ UI Automator æ¡†æž¶ç¼–å†™æµ‹è¯•æˆ–ç¼–å†™ä¾èµ–äºŽ Instrumentation æˆ– Context å¯¹è±¡çš„æµ‹è¯•æ—¶ï¼Œæ­¤æ•°æ®éžå¸¸æœ‰ç”¨ã€‚ æµ‹è¯•ç­›é€‰åœ¨ JUnit 4.x æµ‹è¯•ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ³¨è§£å¯¹æµ‹è¯•è¿è¡Œè¿›è¡Œé…ç½®ã€‚æ­¤åŠŸèƒ½å¯å°†å‘æµ‹è¯•ä¸­æ·»åŠ æ ·æ¿æ–‡ä»¶å’Œæ¡ä»¶ä»£ç çš„éœ€æ±‚é™è‡³æœ€ä½Žã€‚é™¤äº† JUnit 4 æ”¯æŒçš„æ ‡å‡†æ³¨è§£å¤–ï¼Œæµ‹è¯•è¿è¡Œå™¨è¿˜æ”¯æŒ Android ç‰¹å®šçš„æ³¨è§£ï¼ŒåŒ…æ‹¬ï¼š @RequiresDeviceï¼šæŒ‡å®šæµ‹è¯•ä»…åœ¨ç‰©ç†è®¾å¤‡è€Œä¸åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œã€‚ @SdkSupressï¼šç¦æ­¢åœ¨ä½ŽäºŽç»™å®šçº§åˆ«çš„ Android API çº§åˆ«ä¸Šè¿è¡Œæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œè¦ç¦æ­¢åœ¨ä½ŽäºŽ 18 çš„æ‰€æœ‰ API çº§åˆ«ä¸Šè¿è¡Œæµ‹è¯•ï¼Œè¯·ä½¿ç”¨æ³¨è§£ - - @SDKSupress(minSdkVersion=18)ã€‚ @SmallTestã€@MediumTest å’Œ @LargeTestï¼šæŒ‡å®šæµ‹è¯•çš„è¿è¡Œæ—¶é•¿ä»¥åŠè¿è¡Œé¢‘çŽ‡ã€‚æµ‹è¯•åˆ†ç‰‡æµ‹è¯•è¿è¡Œå™¨æ”¯æŒå°†å•ä¸€æµ‹è¯•å¥—ä»¶æ‹†åˆ†æˆå¤šä¸ªç¢Žç‰‡ï¼Œå› æ­¤æ‚¨å¯ä»¥å°†å±žäºŽåŒä¸€ç¢Žç‰‡çš„æµ‹è¯•ä½œä¸ºä¸€ä¸ªç»„åœ¨åŒä¸€ Instrumentation å®žä¾‹ä¸‹è¿è¡Œã€‚æ¯ä¸ªåˆ†ç‰‡ç”±ä¸€ä¸ªç´¢å¼•å·è¿›è¡Œæ ‡è¯†ã€‚è¿è¡Œæµ‹è¯•æ—¶ï¼Œä½¿ç”¨ -e numShards é€‰é¡¹æŒ‡å®šè¦åˆ›å»ºçš„ç‹¬ç«‹åˆ†ç‰‡æ•°é‡ï¼Œå¹¶ä½¿ç”¨ -e shardIndex é€‰é¡¹æŒ‡å®šè¦è¿è¡Œå“ªä¸ªåˆ†ç‰‡ã€‚ ä¾‹å¦‚ï¼Œè¦å°†æµ‹è¯•å¥—ä»¶æ‹†åˆ†æˆ 10 ä¸ªåˆ†ç‰‡ï¼Œä¸”ä»…è¿è¡Œç¬¬äºŒä¸ªç¢Žç‰‡ä¸­çš„æµ‹è¯•ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š adb shell am instrument -w -e numShards 10 -e shardIndex 2 è¦è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨æ­¤æµ‹è¯•è¿è¡Œå™¨ï¼Œè¯·å‚é˜… API å‚è€ƒã€‚ EspressoEspresso æµ‹è¯•æ¡†æž¶æä¾›äº†ä¸€ç»„ API æ¥æž„å»º UI æµ‹è¯•ï¼Œç”¨äºŽæµ‹è¯•åº”ç”¨ä¸­çš„ç”¨æˆ·æµã€‚åˆ©ç”¨è¿™äº› APIï¼Œæ‚¨å¯ä»¥ç¼–å†™ç®€æ´ã€è¿è¡Œå¯é çš„è‡ªåŠ¨åŒ– UI æµ‹è¯•ã€‚Espresso éžå¸¸é€‚åˆç¼–å†™ç™½ç›’è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå…¶ä¸­æµ‹è¯•ä»£ç å°†åˆ©ç”¨æ‰€æµ‹è¯•åº”ç”¨çš„å®žçŽ°ä»£ç è¯¦æƒ…ã€‚ Espresso æµ‹è¯•æ¡†æž¶çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š çµæ´»çš„ APIï¼Œç”¨äºŽç›®æ ‡åº”ç”¨ä¸­çš„è§†å›¾å’Œé€‚é…å™¨åŒ¹é…ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è§†å›¾åŒ¹é…ã€‚ ä¸€ç»„ä¸°å¯Œçš„æ“ä½œ APIï¼Œç”¨äºŽè‡ªåŠ¨åŒ– UI äº¤äº’ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ“ä½œ APIã€‚ UI çº¿ç¨‹åŒæ­¥ï¼Œç”¨äºŽæå‡æµ‹è¯•å¯é æ€§ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… UI çº¿ç¨‹åŒæ­¥ã€‚ è¦æ±‚ Android 2.2ï¼ˆAPI çº§åˆ« 8ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ è§†å›¾åŒ¹é…åˆ©ç”¨ Espresso.onView() æ–¹æ³•ï¼Œæ‚¨å¯ä»¥è®¿é—®ç›®æ ‡åº”ç”¨ä¸­çš„ UI ç»„ä»¶å¹¶ä¸Žä¹‹äº¤äº’ã€‚æ­¤æ–¹æ³•æŽ¥å— Matcher å‚æ•°å¹¶æœç´¢è§†å›¾å±‚æ¬¡ç»“æž„ï¼Œä»¥æ‰¾åˆ°ç¬¦åˆç»™å®šæ¡ä»¶çš„ç›¸åº” View å®žä¾‹ã€‚æ‚¨å¯ä»¥é€šè¿‡æŒ‡å®šä»¥ä¸‹æ¡ä»¶æ¥ä¼˜åŒ–æœç´¢ï¼š è§†å›¾çš„ç±»åç§° è§†å›¾çš„å†…å®¹æè¿° è§†å›¾çš„ R.id åœ¨è§†å›¾ä¸­æ˜¾ç¤ºçš„æ–‡æœ¬ ä¾‹å¦‚ï¼Œè¦æ‰¾åˆ° ID å€¼ä¸º my_button çš„æŒ‰é’®ï¼Œå¯ä»¥æŒ‡å®šå¦‚ä¸‹åŒ¹é…å™¨ï¼š1onView(withId(R.id.my_button)); å¦‚æžœæœç´¢æˆåŠŸï¼ŒonView() æ–¹æ³•å°†è¿”å›žä¸€ä¸ªå¼•ç”¨ï¼Œè®©æ‚¨å¯ä»¥æ‰§è¡Œç”¨æˆ·æ“ä½œå¹¶åŸºäºŽç›®æ ‡è§†å›¾å¯¹æ–­è¨€è¿›è¡Œæµ‹è¯•ã€‚ é€‚é…å™¨åŒ¹é…åœ¨ AdapterView å¸ƒå±€ä¸­ï¼Œå¸ƒå±€åœ¨è¿è¡Œæ—¶ç”±å­è§†å›¾åŠ¨æ€å¡«å……ã€‚å¦‚æžœç›®æ ‡è§†å›¾ä½äºŽæŸä¸ªå¸ƒå±€å†…éƒ¨ï¼Œè€Œè¯¥å¸ƒå±€æ˜¯ä»Ž AdapterViewï¼ˆä¾‹å¦‚ ListView æˆ– GridViewï¼‰æ´¾ç”Ÿå‡ºçš„å­ç±»ï¼Œåˆ™ onView() æ–¹æ³•å¯èƒ½æ— æ³•å·¥ä½œï¼Œå› ä¸ºåªæœ‰å¸ƒå±€è§†å›¾çš„å­é›†ä¼šåŠ è½½åˆ°å½“å‰è§†å›¾å±‚æ¬¡ç»“æž„ä¸­ã€‚ å› æ­¤ï¼Œè¯·ä½¿ç”¨ Espresso.onData() æ–¹æ³•è®¿é—®ç›®æ ‡è§†å›¾å…ƒç´ ã€‚Espresso.onData() æ–¹æ³•å°†è¿”å›žä¸€ä¸ªå¼•ç”¨ï¼Œè®©æ‚¨å¯ä»¥æ‰§è¡Œç”¨æˆ·æ“ä½œå¹¶æ ¹æ® AdapterView ä¸­çš„å…ƒç´ å¯¹æ–­è¨€è¿›è¡Œæµ‹è¯•ã€‚ æ“ä½œ APIé€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ ¹æ®åº”ç”¨çš„ç”¨æˆ·ç•Œé¢æ‰§è¡ŒæŸäº›ç”¨æˆ·äº¤äº’æ¥æµ‹è¯•åº”ç”¨ã€‚å€ŸåŠ© ViewActions APIï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å®žçŽ°è¿™äº›æ“ä½œçš„è‡ªåŠ¨åŒ–ã€‚æ‚¨å¯ä»¥æ‰§è¡Œå¤šç§ UI äº¤äº’ï¼Œä¾‹å¦‚ï¼š è§†å›¾ç‚¹å‡» æ»‘åŠ¨ æŒ‰ä¸‹æŒ‰é”®å’ŒæŒ‰é’® é”®å…¥æ–‡æœ¬ æ‰“å¼€é“¾æŽ¥ ä¾‹å¦‚ï¼Œè¦æ¨¡æ‹Ÿè¾“å…¥å­—ç¬¦ä¸²å€¼å¹¶æŒ‰ä¸‹æŒ‰é’®ä»¥æäº¤è¯¥å€¼ï¼Œæ‚¨å¯ä»¥åƒä¸‹é¢ä¸€æ ·ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ã€‚ViewInteraction.perform() å’Œ DataInteraction.perform() æ–¹æ³•é‡‡ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª ViewAction å‚æ•°ï¼Œå¹¶ä»¥æä¾›çš„é¡ºåºè¿è¡Œæ“ä½œã€‚123456// Type text into an EditText view, then close the soft keyboardonView(withId(R.id.editTextUserInput)) .perform(typeText(STRING_TO_BE_TYPED), closeSoftKeyboard());// Press the button to submit the text changeonView(withId(R.id.changeTextBt)).perform(click()); UI çº¿ç¨‹åŒæ­¥ç”±äºŽè®¡æ—¶é—®é¢˜ï¼ŒAndroid è®¾å¤‡ä¸Šçš„æµ‹è¯•å¯èƒ½éšæœºå¤±è´¥ã€‚æ­¤æµ‹è¯•é—®é¢˜ç§°ä¸ºæµ‹è¯•ä¸ç¨³å®šã€‚åœ¨ Espresso ä¹‹å‰ï¼Œè§£å†³æ–¹æ³•æ˜¯åœ¨æµ‹è¯•ä¸­æ’å…¥è¶³å¤Ÿé•¿çš„ä¼‘çœ æˆ–è¶…æ—¶æœŸæˆ–æ·»åŠ ä»£ç ï¼Œä»¥ä¾¿é‡è¯•å¤±è´¥çš„æ“ä½œã€‚Espresso æµ‹è¯•æ¡†æž¶å¯ä»¥å¤„ç† Instrumentation ä¸Ž UI çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼›è¿™å°±æ¶ˆé™¤äº†å¯¹ä¹‹å‰çš„è®¡æ—¶è§£å†³æ–¹æ³•çš„éœ€æ±‚ï¼Œå¹¶ç¡®ä¿æµ‹è¯•æ“ä½œä¸Žæ–­è¨€æ›´å¯é åœ°è¿è¡Œã€‚ è¦è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨ Espressoï¼Œè¯·å‚é˜… API å‚è€ƒå’Œæµ‹è¯•å•ä¸ªåº”ç”¨çš„ UI åŸ¹è®­ã€‚ UI AutomatorUI Automator æµ‹è¯•æ¡†æž¶æä¾›äº†ä¸€ç»„ API æ¥æž„å»º UI æµ‹è¯•ï¼Œç”¨äºŽåœ¨ç”¨æˆ·åº”ç”¨å’Œç³»ç»Ÿåº”ç”¨ä¸­æ‰§è¡Œäº¤äº’ã€‚åˆ©ç”¨ UI Automator APIï¼Œæ‚¨å¯ä»¥æ‰§è¡Œåœ¨æµ‹è¯•è®¾å¤‡ä¸­æ‰“å¼€â€œè®¾ç½®â€èœå•æˆ–åº”ç”¨å¯åŠ¨å™¨ç­‰æ“ä½œã€‚UI Automator æµ‹è¯•æ¡†æž¶éžå¸¸é€‚åˆç¼–å†™é»‘ç›’è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå…¶ä¸­çš„æµ‹è¯•ä»£ç ä¸ä¾èµ–äºŽç›®æ ‡åº”ç”¨çš„å†…éƒ¨å®žçŽ°è¯¦æƒ…ã€‚ UI Automator æµ‹è¯•æ¡†æž¶çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š ç”¨äºŽæ£€æŸ¥å¸ƒå±€å±‚æ¬¡ç»“æž„çš„æŸ¥çœ‹å™¨ã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… UI Automator æŸ¥çœ‹å™¨ã€‚ åœ¨ç›®æ ‡è®¾å¤‡ä¸Šæ£€ç´¢çŠ¶æ€ä¿¡æ¯å¹¶æ‰§è¡Œæ“ä½œçš„ APIã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…è®¿é—®è®¾å¤‡çŠ¶æ€ã€‚ æ”¯æŒè·¨åº”ç”¨ UI æµ‹è¯•çš„ APIã€‚å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… UI Automator APIã€‚ è¦æ±‚ Android 4.3ï¼ˆAPI çº§åˆ« 18ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ UI Automator æŸ¥çœ‹å™¨uiautomatorviewer å·¥å…·æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ GUIï¼Œå¯ä»¥æ‰«æå’Œåˆ†æž Android è®¾å¤‡ä¸Šå½“å‰æ˜¾ç¤ºçš„ UI ç»„ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤å·¥å…·æ£€æŸ¥å¸ƒå±€å±‚æ¬¡ç»“æž„ï¼Œå¹¶æŸ¥çœ‹åœ¨è®¾å¤‡å‰å°æ˜¾ç¤ºçš„ UI ç»„ä»¶å±žæ€§ã€‚åˆ©ç”¨æ­¤ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ UI Automatorï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡åˆ›å»ºä¸Žç‰¹å®šå¯è§å±žæ€§åŒ¹é…çš„ UI é€‰æ‹©å™¨ï¼‰åˆ›å»ºæŽ§åˆ¶æ›´åŠ ç²¾ç¡®çš„æµ‹è¯•ã€‚ uiautomatorviewer å·¥å…·ä½äºŽ &lt;android-sdk&gt;/tools/ç›®å½•ä¸­ã€‚ è®¿é—®è®¾å¤‡çŠ¶æ€UI Automator æµ‹è¯•æ¡†æž¶æä¾›äº†ä¸€ä¸ª UiDevice ç±»ï¼Œç”¨äºŽåœ¨ç›®æ ‡åº”ç”¨è¿è¡Œçš„è®¾å¤‡ä¸Šè®¿é—®å’Œæ‰§è¡Œæ“ä½œã€‚æ‚¨å¯ä»¥è°ƒç”¨å…¶æ–¹æ³•æ¥è®¿é—®è®¾å¤‡å±žæ€§ï¼Œå¦‚å½“å‰å±å¹•æ–¹å‘æˆ–æ˜¾ç¤ºå°ºå¯¸ã€‚UiDevice ç±»è¿˜å¯ç”¨äºŽæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š æ›´æ”¹è®¾å¤‡æ—‹è½¬ æŒ‰ D-pad æŒ‰é’® æŒ‰â€œè¿”å›žâ€ã€â€œä¸»å±å¹•â€æˆ–â€œèœå•â€æŒ‰é’® æ‰“å¼€é€šçŸ¥æ  å¯¹å½“å‰çª—å£è¿›è¡Œå±å¹•æˆªå›¾ ä¾‹å¦‚ï¼Œè¦æ¨¡æ‹ŸæŒ‰ä¸‹â€œä¸»å±å¹•â€æŒ‰é’®ï¼Œè¯·è°ƒç”¨ UiDevice.pressHome() æ–¹æ³•ã€‚ UI Automator APIåˆ©ç”¨ UI Automator APIï¼Œæ‚¨å¯ä»¥ç¼–å†™ç¨³å¥å¯é çš„æµ‹è¯•ï¼Œè€Œæ— éœ€äº†è§£ç›®æ ‡åº”ç”¨çš„å®žçŽ°è¯¦æƒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº› API åœ¨å¤šä¸ªåº”ç”¨ä¸­æ•èŽ·å’Œæ“ä½œ UI ç»„ä»¶ï¼š UiCollectionï¼šæžšä¸¾å®¹å™¨çš„ UI å…ƒç´ ä»¥ä¾¿è®¡ç®—å­å…ƒç´ ä¸ªæ•°ï¼Œæˆ–è€…é€šè¿‡å¯è§çš„æ–‡æœ¬æˆ–å†…å®¹æè¿°å±žæ€§æ¥æŒ‡ä»£å­å…ƒç´ ã€‚ UiObjectï¼šè¡¨ç¤ºè®¾å¤‡ä¸Šå¯è§çš„ UI å…ƒç´ ã€‚ UiScrollableï¼šä¸ºåœ¨å¯æ»šåŠ¨ UI å®¹å™¨ä¸­æœç´¢é¡¹ç›®æä¾›æ”¯æŒã€‚ UiSelectorï¼šè¡¨ç¤ºåœ¨è®¾å¤‡ä¸ŠæŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡ UI å…ƒç´ ã€‚ Configuratorï¼šå…è®¸æ‚¨è®¾ç½®è¿è¡Œ UI Automator æµ‹è¯•æ‰€éœ€çš„å…³é”®å‚æ•°ã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•ç¼–å†™å¯åœ¨è®¾å¤‡ä¸­è°ƒç”¨é»˜è®¤åº”ç”¨å¯åŠ¨å™¨çš„æµ‹è¯•è„šæœ¬ï¼š12345678910111213// Initialize UiDevice instancemDevice = UiDevice.getInstance(getInstrumentation());// Perform a short press on the HOME buttonmDevice.pressHome();// Bring up the default launcher by searching for// a UI component that matches the content-description for the launcher buttonUiObject allAppsButton = mDevice .findObject(new UiSelector().description(&quot;Apps&quot;));// Perform a click on the button to bring up the launcherallAppsButton.clickAndWaitForNewWindow(); è¦è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨ UI Automatorï¼Œè¯·å‚é˜… API å‚è€ƒå’Œæµ‹è¯•å¤šä¸ªåº”ç”¨çš„ UI åŸ¹è®­ã€‚ æµ‹è¯•æ”¯æŒåº“è®¾ç½®Android æµ‹è¯•æ”¯æŒåº“è½¯ä»¶åŒ…åœ¨æœ€æ–°ç‰ˆæœ¬çš„ Android æ”¯æŒå­˜å‚¨åº“ä¸­æä¾›ï¼ŒåŽè€…å¯ä½œä¸ºè¾…åŠ©ç»„ä»¶é€šè¿‡ Android SDK ç®¡ç†å™¨ä¸‹è½½ã€‚ è¦é€šè¿‡ SDK ç®¡ç†å™¨ä¸‹è½½ Android æ”¯æŒå­˜å‚¨åº“ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š å¯åŠ¨ Android SDK ç®¡ç†å™¨ã€‚ åœ¨ SDK ç®¡ç†å™¨çª—å£ä¸­ï¼Œæ»šåŠ¨åˆ° Packages åˆ—è¡¨æœ«å°¾ï¼Œæ‰¾åˆ° Extras æ–‡ä»¶å¤¹å¹¶å±•å¼€ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰ä»¥æ˜¾ç¤ºå…¶å†…å®¹ã€‚ é€‰æ‹© Android Support Repository é¡¹ã€‚ ç‚¹å‡» Install packagesâ€¦ æŒ‰é’®ã€‚ ä¸‹è½½åŽï¼Œæ­¤å·¥å…·ä¼šå°†æ”¯æŒå­˜å‚¨åº“æ–‡ä»¶å®‰è£…åˆ°æ‚¨çŽ°æœ‰çš„ Android SDK ç›®å½•ä¸­ã€‚åº“æ–‡ä»¶ä½äºŽ SDK çš„ä»¥ä¸‹å­ç›®å½•ä¸­ï¼š&lt;sdk&gt;/extras/android/m2repository ç›®å½•ã€‚ Android æµ‹è¯•æ”¯æŒåº“çš„ç±»ä½äºŽ android.support.test è½¯ä»¶åŒ…ä¸­ã€‚ è¦åœ¨ Gradle é¡¹ç›®ä¸­ä½¿ç”¨ Android æµ‹è¯•æ”¯æŒåº“ï¼Œè¯·åœ¨ build.gradle æ–‡ä»¶ä¸­æ·»åŠ è¿™äº›ä¾èµ–å…³ç³»ï¼š 123456789dependencies &#123; androidTestCompile &apos;com.android.support.test:runner:0.4&apos; // Set this dependency to use JUnit 4 rules androidTestCompile &apos;com.android.support.test:rules:0.4&apos; // Set this dependency to build and run Espresso tests androidTestCompile &apos;com.android.support.test.espresso:espresso-core:2.2.1&apos; // Set this dependency to build and run UI Automator tests androidTestCompile &apos;com.android.support.test.uiautomator:uiautomator-v18:2.1.2&apos;&#125; è¦å°† AndroidJUnitRunner è®¾ç½®ä¸º Gradle é¡¹ç›®ä¸­çš„é»˜è®¤æµ‹è¯•ä»ªå™¨è¿è¡Œå™¨ï¼Œè¯·åœ¨ build.gradle æ–‡ä»¶ä¸­æŒ‡å®šæ­¤ä¾èµ–å…³ç³»ï¼š `` android { defaultConfig { testInstrumentationRunner â€œandroid.support.test.runner.AndroidJUnitRunnerâ€ } } ```]]></content>
      <categories>
        <category>autotest</category>
      </categories>
      <tags>
        <tag>autotest</tag>
        <tag>android</tag>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[androidè‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹(N):adbå·¥å…·]]></title>
    <url>%2F2017%2F08%2F29%2Fat-android-adb%2F</url>
    <content type="text"><![CDATA[Androidæ‰‹æœºè‡ªåŠ¨åŒ–æµ‹è¯•è¿‡ç¨‹ç¦»ä¸å¼€adbå·¥å…·,ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„adbå‘½ä»¤. 1. adb forwardå‘½ä»¤ç¤ºä¾‹: 1adb forward tcp:8000 tcp:9000 ä½œç”¨: æŠŠPCç«¯8000ç«¯å£çš„æ•°æ®, è½¬å‘åˆ°Androidç«¯çš„9000ç«¯å£ä¸Š,PCç«¯çš„8000ç«¯å£ä¼šè¢« adb ç›‘å¬, è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åªéœ€è¦å¾€8000ç«¯å£å†™æ•°æ®, è¿™ä¸ªæ•°æ®å°±ä¼šå‘é€åˆ°æ‰‹æœºç«¯çš„9000ç«¯å£ä¸Š. 2. adb connectå‘½ä»¤ç¤ºä¾‹: 1adb connect + IP ä½œç”¨: é€šè¿‡æ— çº¿ç½‘ç»œåœ¨PCç«¯adbè¿žæŽ¥æ‰‹æœºç«¯ æ³¨æ„: è¦é“¾æŽ¥çš„IP ï¼Œå¿…é¡»å’Œè‡ªå·±çš„PCçš„ç½‘ç»œåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œadb ä¸èƒ½è·¨å±€åŸŸç½‘é“¾æŽ¥è®¾å¤‡ å¦‚æžœé€šè¿‡usbé“¾æŽ¥Androidè®¾å¤‡ï¼Œé€šè¿‡adb devices å¯ä»¥çœ‹è§è®¾å¤‡åˆ—è¡¨ï¼Œä½†æ˜¯ä½¿ç”¨ä¸äº†ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„å‘½ä»¤è¯´æ˜Žæ‰‹æœºç«¯çš„æœåŠ¡æœªå¼€å¯,éœ€è¦è¿žæŽ¥usbå¼€å¯æ‰‹æœºæœåŠ¡,é»˜è®¤ç«¯å£5555:adb tcpip 5555,å¼€å¯åŽæ‹”æŽ‰usbé€šè¿‡adb connect 192.168.0.101:5555å³å¯è¿žæŽ¥]]></content>
      <categories>
        <category>autotest</category>
      </categories>
      <tags>
        <tag>autotest</tag>
        <tag>android</tag>
        <tag>tools</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RecyclerViewå®žçŽ°å•é€‰åˆ—è¡¨]]></title>
    <url>%2F2017%2F08%2F24%2Ftips-recyclerview-selectable%2F</url>
    <content type="text"><![CDATA[å¸¸è§„æ–¹æ³•ï¼š åœ¨Javabeané‡Œå¢žåŠ ä¸€ä¸ªboolean isSelectedå­—æ®µï¼Œ å¹¶åœ¨Adapteré‡Œæ ¹æ®è¿™ä¸ªå­—æ®µçš„å€¼è®¾ç½®â€œCheckBoxâ€çš„é€‰ä¸­çŠ¶æ€ã€‚ åœ¨æ¯æ¬¡é€‰ä¸­ä¸€ä¸ªæ–°ä¼˜æƒ åˆ¸æ—¶ï¼Œæ”¹å˜æ•°æ®æºé‡Œçš„isSelectedå­—æ®µï¼Œ å¹¶notifyDataSetChanged()åˆ·æ–°æ•´ä¸ªåˆ—è¡¨ã€‚ è¿™æ ·å®žçŽ°èµ·æ¥å¾ˆç®€å•ï¼Œä»£ç é‡ä¹Ÿå¾ˆå°‘ï¼Œå”¯ä¸€ä¸è¶³çš„åœ°æ–¹å°±æ˜¯æ€§èƒ½æœ‰æŸè€—ï¼Œä¸æ˜¯æœ€ä¼˜é›…ã€‚ Soä½œä¸ºä¸€ä¸ªæœ‰è¿½æ±‚ ä»Šå¤©æ¯”è¾ƒé—² çš„ç¨‹åºå‘˜ï¼Œæˆ‘å†³å¿ƒåˆ†äº«ä¸€æ³¢ä¼˜é›…æ–¹æ¡ˆã€‚ æœ¬æ–‡ä¼šåˆ—ä¸¾åˆ†æžä¸€ä¸‹åœ¨ListViewå’ŒRecyclerViewä¸­, åˆ—è¡¨å®žçŽ°å•é€‰çš„å‡ ç§æ–¹æ¡ˆï¼Œå¹¶æŽ¨èé‡‡ç”¨å®šå‘åˆ·æ–° éƒ¨åˆ†ç»‘å®šçš„æ–¹æ¡ˆï¼Œå› ä¸ºæ›´é«˜æ•ˆandä¼˜é›… 1å¸¸è§„æ–¹æ¡ˆ:å¸¸è§„æ–¹æ¡ˆ è¯·å…‰é€Ÿé˜…è¯»ï¼Œç›´æŽ¥ä¸Šç ï¼š Beanç»“æž„ï¼š 1234567public class TestBean extends SelectedBean &#123; private String name; public TestBean(String name,boolean isSelected) &#123; this.name = name; setSelected(isSelected); &#125;&#125; æˆ‘é¡¹ç›®é‡Œæœ‰å¥½å¤šå•é€‰éœ€æ±‚ï¼Œæ‡’å¾—å†™isSelectedå­—æ®µï¼Œæ‰€ä»¥å¼„äº†ä¸ªçˆ¶ç±»ä¾›å­ç±»ç»§æ‰¿ã€‚ 123456789public class SelectedBean &#123; private boolean isSelected; public boolean isSelected() &#123; return isSelected; &#125; public void setSelected(boolean selected) &#123; isSelected = selected; &#125;&#125; Acitivity å’ŒAdapterå…¶ä»–æ–¹æ³•éƒ½æ˜¯æœ€æ™®é€šçš„ä¸å†èµ˜è¿°ã€‚ Adapterçš„onBindViewHolder()å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829Log.d(&quot;TAG&quot;, &quot;onBindViewHolder() called with: holder = [&quot; + holder + &quot;], position = [&quot; + position + &quot;]&quot;); holder.ivSelect.setSelected(mDatas.get(position).isSelected());//â€œCheckBoxâ€ holder.tvCoupon.setText(mDatas.get(position).getName());//TextView holder.ivSelect.setOnClickListener(new View.OnClickListener() &#123; @Override public void onClick(View view) &#123; //å®žçŽ°å•é€‰ï¼Œç¬¬ä¸€ç§æ–¹æ³•ï¼Œååˆ†ç®€å•ï¼Œ Lv Rvé€šç”¨,å› ä¸ºå®ƒä»¬éƒ½æœ‰notifyDataSetChanged()æ–¹æ³• // æ¯æ¬¡ç‚¹å‡»æ—¶ï¼Œå…ˆå°†æ‰€æœ‰çš„selectedè®¾ä¸ºfalseï¼Œå¹¶ä¸”å°†å½“å‰ç‚¹å‡»çš„item è®¾ä¸ºtrueï¼Œ åˆ·æ–°æ•´ä¸ªè§†å›¾ for (TestBean data : mDatas) &#123; data.setSelected(false); &#125; mDatas.get(position).setSelected(true); notifyDataSetChanged(); &#125; &#125;);ViewHolderï¼š public static class CouponVH extends RecyclerView.ViewHolder &#123; private ImageView ivSelect; private TextView tvCoupon; public CouponVH(View itemView) &#123; super(itemView); ivSelect = (ImageView) itemView.findViewById(R.id.ivSelect); tvCoupon = (TextView) itemView.findViewById(R.id.tvCoupon); &#125; &#125; æ–¹æ¡ˆä¼˜ç‚¹ï¼šç®€å•ç²—æš´ æ–¹æ¡ˆç¼ºç‚¹ï¼š å…¶å®žéœ€è¦ä¿®æ”¹çš„Itemåªæœ‰ä¸¤é¡¹ï¼š ä¸€ä¸ªå½“å‰å¤„äºŽé€‰ä¸­çŠ¶æ€çš„Item-&gt;æ™®é€šçŠ¶æ€ å†å°†å½“å‰æ‰‹æŒ‡ç‚¹å‡»çš„è¿™ä¸ªItem-&gt;é€‰ä¸­çŠ¶æ€ ä½†é‡‡ç”¨æ™®é€šæ–¹æ¡ˆï¼Œåˆ™ä¼šåˆ·æ–°æ•´ä¸ªä¸€å±å¯è§çš„Itemï¼Œé‡èµ°ä»–ä»¬çš„getView()/onBindViewHolder()æ–¹æ³•ã€‚ å…¶å®žä¸€ä¸ªå±å¹•ä¸€èˆ¬æœ€å¤šå¯è§10+ä¸ªItemï¼ŒéåŽ†ä¸€éä¹Ÿæ— ä¼¤å¤§é›…ã€‚ ä½†å’±ä»¬è¿˜æ˜¯è¦æœ‰è¿½æ±‚ä¼˜é›…çš„å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚ 2 åˆ©ç”¨Rvçš„notifyItemChanged()å®šå‘åˆ·æ–°:æœ¬æ–¹æ¡ˆå¯ä»¥ä¸­é€Ÿé˜…è¯» æœ¬æ–¹æ¡ˆéœ€è¦åœ¨Adapteré‡Œæ–°å¢žä¸€ä¸ªå­—æ®µï¼š 1private int mSelectedPos = -1;//å®žçŽ°å•é€‰ æ–¹æ³•äºŒï¼Œå˜é‡ä¿å­˜å½“å‰é€‰ä¸­çš„position åœ¨è®¾ç½®æ•°æ®é›†æ—¶(æž„é€ å‡½æ•°ï¼ŒsetData()æ–¹æ³•ç­‰ï¼š)ï¼Œåˆå§‹åŒ– mSelectedPos çš„å€¼ã€‚ 123456//å®žçŽ°å•é€‰æ–¹æ³•äºŒï¼š è®¾ç½®æ•°æ®é›†æ—¶ï¼Œæ‰¾åˆ°é»˜è®¤é€‰ä¸­çš„posfor (int i = 0; i &lt; mDatas.size(); i++) &#123; if (mDatas.get(i).isSelected()) &#123; mSelectedPos = i; &#125;&#125; onClické‡Œä»£ç å¦‚ä¸‹ï¼š 1234567891011//å®žçŽ°å•é€‰æ–¹æ³•äºŒï¼š notifyItemChanged() å®šå‘åˆ·æ–°ä¸¤ä¸ªè§†å›¾//å¦‚æžœå‹¾é€‰çš„ä¸æ˜¯å·²ç»å‹¾é€‰çŠ¶æ€çš„Itemif (mSelectedPos!=position)&#123; //å…ˆå–æ¶ˆä¸Šä¸ªitemçš„å‹¾é€‰çŠ¶æ€ mDatas.get(mSelectedPos).setSelected(false); notifyItemChanged(mSelectedPos); //è®¾ç½®æ–°Itemçš„å‹¾é€‰çŠ¶æ€ mSelectedPos = position; mDatas.get(mSelectedPos).setSelected(true); notifyItemChanged(mSelectedPos);&#125; æœ¬æ–¹æ¡ˆç”±äºŽè°ƒç”¨äº†notifyItemChanged()ï¼Œæ‰€ä»¥è¿˜ä¼šä¼´æœ‰â€œç™½å…‰ä¸€é—ªâ€çš„åŠ¨ç”»ã€‚ æ–¹æ¡ˆä¼˜ç‚¹ï¼š æœ¬æ–¹æ¡ˆï¼Œè¾ƒä¼˜é›…äº†ï¼Œä¸ä¼šé‡èµ°ä¸€å±å¯è§çš„Itemçš„getView()/onBindViewHolder()æ–¹æ³•ï¼Œ ä½†ä»ç„¶ä¼šé‡èµ°éœ€è¦ä¿®æ”¹çš„ä¸¤ä¸ªItemçš„getView()/onBindViewHolder()æ–¹æ³•ï¼Œ æ–¹æ¡ˆç¼ºç‚¹ï¼š æˆ‘ä»¬å®žé™…ä¸Šéœ€è¦ä¿®æ”¹çš„ï¼Œåªæ˜¯é‡Œé¢â€œCheckBoxâ€çš„å€¼ï¼Œ æŒ‰ç…§åœ¨DiffUtilä¸€æ–‡å­¦ä¹ åˆ°çš„å§¿åŠ¿ï¼Œæœ¯è¯­åº”è¯¥æ˜¯â€œPartial bind â€œï¼Œ ï¼ˆå®‰åˆ©æ—¶é—´,æ²¡å¬è¿‡DiffUtilå’ŒPartial bindçš„ æˆ³-&gt;ï¼šã€Androidã€‘è¯¦è§£7.0å¸¦æ¥çš„æ–°å·¥å…·ç±»ï¼šDiffUtilï¼‰ æˆ‘ä»¬éœ€è¦çš„åªæ˜¯éƒ¨åˆ†ç»‘å®šã€‚ ä¸€ä¸ªç–‘ç‚¹ï¼š ä½¿ç”¨æ–¹æ³•2 åœ¨ç¬¬ä¸€æ¬¡é€‰ä¸­å…¶ä»–Itemæ—¶ï¼Œåˆ‡æ¢selectedçŠ¶æ€æ—¶ï¼Œ æŸ¥çœ‹logï¼Œå¹¶ä¸æ˜¯åªé‡èµ°äº†æ–°æ—§Itemçš„onBindViewHolder()æ–¹æ³•ï¼Œè¿˜èµ°äº†ä¸¤ä¸ªæ ¹æœ¬ä¸åœ¨å±å¹•èŒƒå›´é‡Œçš„Itemçš„onBindViewHolder()æ–¹æ³•ï¼Œ å¦‚ï¼Œæœ¬ä¾‹ä¸­ åœ¨è¿˜æœ‰item 0-3 åœ¨å±å¹•é‡Œï¼Œé»˜è®¤å‹¾é€‰item1ï¼Œæˆ‘é€‰ä¸­item0åŽï¼Œlogæ˜¾ç¤ºpostion 4,5,0,1 ä¾æ¬¡æ‰§è¡Œäº†onBindViewHolder()æ–¹æ³•ã€‚ ä½†æ˜¯å†æ¬¡åˆ‡æ¢å…¶ä»–Itemæ—¶ï¼Œ ä¼šç¬¦åˆé¢„æœŸï¼šåªèµ°éœ€è¦ä¿®æ”¹çš„ä¸¤ä¸ªItemçš„getView()/onBindViewHolder()æ–¹æ³•ã€‚ åŽŸå› æœªçŸ¥ï¼Œæœ‰æœ‹å‹çŸ¥é“çƒ¦è¯·å‘ŠçŸ¥ï¼Œå¤šè°¢ã€‚ 3 Rv å®žçŽ°éƒ¨åˆ†ç»‘å®šï¼ˆæŽ¨èï¼‰:åˆ©ç”¨RecyclerViewçš„ findViewHolderForLayoutPosition()æ–¹æ³•ï¼ŒèŽ·å–æŸä¸ªpostionçš„ViewHolderï¼ŒæŒ‰ç…§æºç é‡Œè¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šï¼Œå®ƒå¯èƒ½è¿”å›žnullã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ³¨æ„åˆ¤ç©ºï¼Œï¼ˆç©ºå³åœ¨å±å¹•ä¸å¯è§ï¼‰ã€‚ ä¸Žæ–¹æ³•2åªæœ‰onClické‡Œçš„ä»£ç ä¸ä¸€æ ·ï¼Œæ ¸å¿ƒè¿˜æ˜¯åˆ©ç”¨mSelectedPos å­—æ®µæžäº‹æƒ…ã€‚ 1234567891011121314//å®žçŽ°å•é€‰æ–¹æ³•ä¸‰ï¼š RecyclerViewå¦ä¸€ç§å®šå‘åˆ·æ–°æ–¹æ³•ï¼šä¸ä¼šæœ‰ç™½å…‰ä¸€é—ªåŠ¨ç”» ä¹Ÿä¸ä¼šé‡å¤onBindVIewHolderCouponVH couponVH = (CouponVH) mRv.findViewHolderForLayoutPosition(mSelectedPos);if (couponVH != null) &#123;//è¿˜åœ¨å±å¹•é‡Œ couponVH.ivSelect.setSelected(false);&#125;else &#123; //add by 2016 11 22 for ä¸€äº›æžç«¯æƒ…å†µï¼Œholderè¢«ç¼“å­˜åœ¨Recyclerçš„cacheViewé‡Œï¼Œ //æ­¤æ—¶æ‹¿ä¸åˆ°ViewHolderï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šå›žè°ƒonBindViewHolderæ–¹æ³•ã€‚æ‰€ä»¥addä¸€ä¸ªå¼‚å¸¸å¤„ç† notifyItemChanged(mSelectedPos);&#125;mDatas.get(mSelectedPos).setSelected(false);//ä¸ç®¡åœ¨ä¸åœ¨å±å¹•é‡Œ éƒ½éœ€è¦æ”¹å˜æ•°æ®//è®¾ç½®æ–°Itemçš„å‹¾é€‰çŠ¶æ€mSelectedPos = position;mDatas.get(mSelectedPos).setSelected(true);holder.ivSelect.setSelected(true); æ–¹æ¡ˆä¼˜ç‚¹ï¼š å®šå‘åˆ·æ–°ä¸¤ä¸ªItemï¼Œåªä¿®æ”¹å¿…è¦çš„éƒ¨åˆ†ï¼Œä¸ä¼šé‡èµ°onBindViewHolder()ï¼Œå±žäºŽæ‰‹åŠ¨éƒ¨åˆ†ç»‘å®šã€‚ä»£ç é‡ä¹Ÿé€‚ä¸­ï¼Œä¸å¤šã€‚ æ–¹æ¡ˆç¼ºç‚¹ï¼š æ²¡æœ‰ç™½å…‰ä¸€é—ªåŠ¨ç”»ï¼Ÿï¼Ÿï¼Ÿï¼ˆå¦‚æžœè¿™ç®—ç¼ºç‚¹ï¼‰ 4 Rv åˆ©ç”¨payloadså®žçŽ°éƒ¨åˆ†ç»‘å®š(ä¸æŽ¨è):æœ¬æ–¹æ¡ˆå±žäºŽå¼€æ‹“æ€ç»´ï¼Œæ˜¯åœ¨æ–¹æ¡ˆ2çš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨payloadså’ŒnotifyItemChanged(int position, Object payload)æžäº‹æƒ…ã€‚ ä¸çŸ¥é“payloadsæ˜¯ä»€ä¹ˆçš„ï¼Œçœ‹ä¸æ‡‚æ­¤æ–¹æ¡ˆçš„ï¼Œæˆ‘åˆè¦å®‰åˆ©ï¼šï¼ˆæˆ³-&gt;ï¼šã€Androidã€‘è¯¦è§£7.0å¸¦æ¥çš„æ–°å·¥å…·ç±»ï¼šDiffUtilï¼‰ onClickä»£ç å¦‚ä¸‹ï¼š 123456789101112131415//å®žçŽ°å•é€‰æ–¹æ³•å››ï¼šif (mSelectedPos != position) &#123; //å…ˆå–æ¶ˆä¸Šä¸ªitemçš„å‹¾é€‰çŠ¶æ€ mDatas.get(mSelectedPos).setSelected(false); //ä¼ é€’ä¸€ä¸ªpayload Bundle payloadOld = new Bundle(); payloadOld.putBoolean(&quot;KEY_BOOLEAN&quot;, false); notifyItemChanged(mSelectedPos, payloadOld); //è®¾ç½®æ–°Itemçš„å‹¾é€‰çŠ¶æ€ mSelectedPos = position; mDatas.get(mSelectedPos).setSelected(true); Bundle payloadNew = new Bundle(); payloadNew.putBoolean(&quot;KEY_BOOLEAN&quot;, true); notifyItemChanged(mSelectedPos, payloadNew);&#125; éœ€è¦é‡å†™ä¸‰å‚æ•°çš„onBindViewHolder() æ–¹æ³•ï¼š 123456789101112@Overridepublic void onBindViewHolder(CouponVH holder, int position, List&lt;Object&gt; payloads) &#123; if (payloads.isEmpty()) &#123; onBindViewHolder(holder, position); &#125; else &#123; Bundle payload = (Bundle) payloads.get(0); if (payload.containsKey(&quot;KEY_BOOLEAN&quot;)) &#123; boolean aBoolean = payload.getBoolean(&quot;KEY_BOOLEAN&quot;); holder.ivSelect.setSelected(aBoolean); &#125; &#125;&#125; æ–¹æ¡ˆä¼˜ç‚¹ï¼š åŒæ–¹æ³•3 æ–¹æ¡ˆç¼ºç‚¹ï¼š ä»£ç é‡å¤šï¼Œå®žçŽ°æ•ˆæžœå’Œæ–¹æ³•ä¸‰ä¸€æ ·ï¼Œä»…åšå¼€æ‹“æ€ç»´ç”¨ï¼Œæ‰€ä»¥é€‰æ‹©æ–¹æ³•ä¸‰ã€‚ ä½œè€…ï¼šå¼ æ—­ç«¥ é“¾æŽ¥ï¼šhttp://www.jianshu.com/p/1ac13f74da63 ä¾†æºï¼šç®€ä¹¦]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>tips</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Android Activityä»»åŠ¡å’Œè¿”å›žæ ˆ]]></title>
    <url>%2F2017%2F08%2F24%2Ftips-activity-stack%2F</url>
    <content type="text"><![CDATA[é—®é¢˜:å®žä¾‹åŒ–launcher activity è¿™ä¸ªé—®é¢˜è¡¨çŽ°: åœ¨package installers å®‰è£…ç•Œé¢å®‰è£…å®Œä¸€ä¸ªåº”ç”¨åŽï¼Œç›´æŽ¥æ‰“å¼€appï¼Œç„¶åŽè¿›å…¥äº† Activity_1, æ­¤æ—¶å†é€šè¿‡æ­¤activityç”¨startActivity(intent)çš„æ–¹æ³•æ‰“å¼€ Activity_2. ç„¶åŽæŒ‰homeé”®è¿”å›žæ¡Œé¢ï¼Œåœ¨æ¡Œé¢ç‚¹å‡»appå›¾æ ‡è¿›å…¥ï¼Œä½ è§‰å¾—åº”è¯¥è¿›å…¥çš„æ˜¯ Activity_2 ï¼Œå®žé™…ä¸Šå´æ˜¯launcher Activity_1 . ç„¶è€Œè¿˜æ²¡å®Œï¼Œè¿™æ—¶å€™ä½ æŒ‰ back è¿”å›žé”®ï¼Œä¼šå‘çŽ°è¿”å›žåˆ°äº†ä¹‹å‰æ‰“å¼€çš„ Activity_2ï¼Œå†æŒ‰è¿”å›žï¼Œåˆå‡ºçŽ° launcherActivity_1. ä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿé‡å¤å®žä¾‹åŒ–äº†Activity_1. é€€å‡ºappåŽå†æ¬¡ç‚¹å‡»æ¡Œé¢å›¾æ ‡è¿›å…¥ï¼Œåå¤è¯•éªŒï¼Œæ²¡æœ‰å†å‡ºçŽ°è¿™ä¸ªé—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªé—®é¢˜ï¼ˆbug ï¼Ÿï¼‰åªå‡ºçŽ°åœ¨æ“ä½œæ­¥éª¤ï¼ˆ1ï¼‰åŽæ‰ä¼šäº§ç”Ÿ. ä»¥ä¸Šé—®é¢˜æˆ‘åœ¨ä¸€äº›çŸ¥ååŽ‚å•†çš„app ä¸Šå‘çŽ°ä¹Ÿå­˜åœ¨è¿™ä¸ªBUG ï¼š ç™¾åº¦äº‘ é™Œé™Œ åŽ»å“ªå„¿æ—…è¡Œ â€¦QQæ²¡æœ‰å‡ºçŽ°è¿™ä¸ªé—®é¢˜ å¦å¤–ï¼Œå¦‚æžœä»¥rootæ–¹å¼é™é»˜å®‰è£…çš„è¯ä¸ä¼šå‡ºçŽ°è¿™ä¸ªé—®é¢˜ï¼Œåœ¨eclipseé‡Œç›´æŽ¥å‘å¸ƒåˆ°æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œä¹Ÿæ²¡æœ‰å‡ºçŽ°è¿™ä¸ªé—®é¢˜ è§£å†³æ–¹æ¡ˆ: åœ¨super.onCreate(â€¦)æ–¹æ³•ä¹‹åŽæ’å…¥ä»£ç ï¼š 123456789if(!this.isTaskRoot()) &#123; //åˆ¤æ–­è¯¥Activityæ˜¯ä¸æ˜¯ä»»åŠ¡ç©ºé—´çš„æºActivityï¼Œâ€œéžâ€ä¹Ÿå°±æ˜¯è¯´æ˜¯è¢«ç³»ç»Ÿé‡æ–°å®žä¾‹åŒ–å‡ºæ¥ //å¦‚æžœä½ å°±æ”¾åœ¨launcher Activityä¸­è¯ï¼Œè¿™é‡Œå¯ä»¥ç›´æŽ¥returnäº† Intent mainIntent=getIntent(); String action=mainIntent.getAction(); if(mainIntent.hasCategory(Intent.CATEGORY_LAUNCHER) &amp;&amp; action.equals(Intent.ACTION_MAIN)) &#123; finish(); return;//finish()ä¹‹åŽè¯¥æ´»åŠ¨ä¼šç»§ç»­æ‰§è¡ŒåŽé¢çš„ä»£ç ï¼Œä½ å¯ä»¥logCatéªŒè¯ï¼ŒåŠ returné¿å…å¯èƒ½çš„exception &#125; &#125; æ¥æºgoogle ï¼š https://code.google.com/p/android/issues/detail?id=14262 https://code.google.com/p/android/issues/detail?id=2373#c40 è¿˜æœ‰å¦ä¸€ç§æ–¹æ¡ˆï¼š http://stackoverflow.com/questions/3042420/home-key-press-behaviour/4782423#4782423 ä»¥ä¸‹å¼•ç”¨è‡ªgoogleå®˜æ–¹æ–‡æ¡£ åº”ç”¨é€šå¸¸åŒ…å«å¤šä¸ª Activityã€‚æ¯ä¸ª Activity å‡åº”å›´ç»•ç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„ç‰¹å®šæ“ä½œè®¾è®¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯åŠ¨å…¶ä»– Activityã€‚ ä¾‹å¦‚ï¼Œç”µå­é‚®ä»¶åº”ç”¨å¯èƒ½æœ‰ä¸€ä¸ª Activity æ˜¾ç¤ºæ–°é‚®ä»¶çš„åˆ—è¡¨ã€‚ç”¨æˆ·é€‰æ‹©æŸé‚®ä»¶æ—¶ï¼Œä¼šæ‰“å¼€ä¸€ä¸ªæ–° Activity ä»¥æŸ¥çœ‹è¯¥é‚®ä»¶ã€‚ ä¸€ä¸ª Activity ç”šè‡³å¯ä»¥å¯åŠ¨è®¾å¤‡ä¸Šå…¶ä»–åº”ç”¨ä¸­å­˜åœ¨çš„ Activityã€‚ä¾‹å¦‚ï¼Œå¦‚æžœåº”ç”¨æƒ³è¦å‘é€ç”µå­é‚®ä»¶ï¼Œåˆ™å¯å°† Intent å®šä¹‰ä¸ºæ‰§è¡Œâ€œå‘é€â€æ“ä½œå¹¶åŠ å…¥ä¸€äº›æ•°æ®ï¼Œå¦‚ç”µå­é‚®ä»¶åœ°å€å’Œç”µå­é‚®ä»¶ã€‚ ç„¶åŽï¼Œç³»ç»Ÿå°†æ‰“å¼€å…¶ä»–åº”ç”¨ä¸­å£°æ˜Žè‡ªå·±å¤„ç†æ­¤ç±» Intent çš„ Activityã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒIntent æ˜¯è¦å‘é€ç”µå­é‚®ä»¶ï¼Œå› æ­¤å°†å¯åŠ¨ç”µå­é‚®ä»¶åº”ç”¨çš„â€œæ’°å†™â€Activityï¼ˆå¦‚æžœå¤šä¸ª Activity æ”¯æŒç›¸åŒ Intentï¼Œåˆ™ç³»ç»Ÿä¼šè®©ç”¨æˆ·é€‰æ‹©è¦ä½¿ç”¨çš„ Activityï¼‰ã€‚å‘é€ç”µå­é‚®ä»¶æ—¶ï¼ŒActivity å°†æ¢å¤ï¼Œçœ‹èµ·æ¥å¥½åƒç”µå­é‚®ä»¶ Activity æ˜¯æ‚¨çš„åº”ç”¨çš„ä¸€éƒ¨åˆ†ã€‚ å³ä½¿è¿™ä¸¤ä¸ª Activity å¯èƒ½æ¥è‡ªä¸åŒçš„åº”ç”¨ï¼Œä½†æ˜¯ Android ä»ä¼šå°† Activity ä¿ç•™åœ¨ç›¸åŒçš„ä»»åŠ¡ä¸­ï¼Œä»¥ç»´æŠ¤è¿™ç§æ— ç¼çš„ç”¨æˆ·ä½“éªŒã€‚ ä»»åŠ¡æ˜¯æŒ‡åœ¨æ‰§è¡Œç‰¹å®šä½œä¸šæ—¶ä¸Žç”¨æˆ·äº¤äº’çš„ä¸€ç³»åˆ— Activityã€‚ è¿™äº› Activity æŒ‰ç…§å„è‡ªçš„æ‰“å¼€é¡ºåºæŽ’åˆ—åœ¨å †æ ˆï¼ˆå³è¿”å›žæ ˆï¼‰ä¸­ã€‚ è®¾å¤‡ä¸»å±å¹•æ˜¯å¤§å¤šæ•°ä»»åŠ¡çš„èµ·ç‚¹ã€‚å½“ç”¨æˆ·è§¦æ‘¸åº”ç”¨å¯åŠ¨å™¨ä¸­çš„å›¾æ ‡ï¼ˆæˆ–ä¸»å±å¹•ä¸Šçš„å¿«æ·æ–¹å¼ï¼‰æ—¶ï¼Œè¯¥åº”ç”¨çš„ä»»åŠ¡å°†å‡ºçŽ°åœ¨å‰å°ã€‚ å¦‚æžœåº”ç”¨ä¸å­˜åœ¨ä»»åŠ¡ï¼ˆåº”ç”¨æœ€è¿‘æœªæ›¾ä½¿ç”¨ï¼‰ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œå¹¶ä¸”è¯¥åº”ç”¨çš„â€œä¸»â€Activity å°†ä½œä¸ºå †æ ˆä¸­çš„æ ¹ Activity æ‰“å¼€ã€‚ å½“å‰ Activity å¯åŠ¨å¦ä¸€ä¸ª Activity æ—¶ï¼Œè¯¥æ–° Activity ä¼šè¢«æŽ¨é€åˆ°å †æ ˆé¡¶éƒ¨ï¼Œæˆä¸ºç„¦ç‚¹æ‰€åœ¨ã€‚ å‰ä¸€ä¸ª Activity ä»ä¿ç•™åœ¨å †æ ˆä¸­ï¼Œä½†æ˜¯å¤„äºŽåœæ­¢çŠ¶æ€ã€‚Activity åœæ­¢æ—¶ï¼Œç³»ç»Ÿä¼šä¿æŒå…¶ç”¨æˆ·ç•Œé¢çš„å½“å‰çŠ¶æ€ã€‚ ç”¨æˆ·æŒ‰â€œè¿”å›žâ€æŒ‰é’®æ—¶ï¼Œå½“å‰ Activity ä¼šä»Žå †æ ˆé¡¶éƒ¨å¼¹å‡ºï¼ˆActivity è¢«é”€æ¯ï¼‰ï¼Œè€Œå‰ä¸€ä¸ª Activity æ¢å¤æ‰§è¡Œï¼ˆæ¢å¤å…¶ UI çš„å‰ä¸€çŠ¶æ€ï¼‰ã€‚ å †æ ˆä¸­çš„ Activity æ°¸è¿œä¸ä¼šé‡æ–°æŽ’åˆ—ï¼Œä»…æŽ¨å…¥å’Œå¼¹å‡ºå †æ ˆï¼šç”±å½“å‰ Activity å¯åŠ¨æ—¶æŽ¨å…¥å †æ ˆï¼›ç”¨æˆ·ä½¿ç”¨â€œè¿”å›žâ€æŒ‰é’®é€€å‡ºæ—¶å¼¹å‡ºå †æ ˆã€‚ å› æ­¤ï¼Œè¿”å›žæ ˆä»¥â€œåŽè¿›å…ˆå‡ºâ€å¯¹è±¡ç»“æž„è¿è¡Œã€‚ å›¾ 1 é€šè¿‡æ—¶é—´çº¿æ˜¾ç¤º Activity ä¹‹é—´çš„è¿›åº¦ä»¥åŠæ¯ä¸ªæ—¶é—´ç‚¹çš„å½“å‰è¿”å›žæ ˆï¼Œç›´è§‚å‘ˆçŽ°äº†è¿™ç§è¡Œä¸ºã€‚ å›¾ 1. æ˜¾ç¤ºä»»åŠ¡ä¸­çš„æ¯ä¸ªæ–° Activity å¦‚ä½•å‘è¿”å›žæ ˆæ·»åŠ é¡¹ç›®ã€‚ ç”¨æˆ·æŒ‰â€œè¿”å›žâ€æŒ‰é’®æ—¶ï¼Œå½“å‰ Activity éšå³è¢«é”€æ¯ï¼Œè€Œå‰ä¸€ä¸ª Activity æ¢å¤æ‰§è¡Œã€‚ å¦‚æžœç”¨æˆ·ç»§ç»­æŒ‰â€œè¿”å›žâ€ï¼Œå †æ ˆä¸­çš„ç›¸åº” Activity å°±ä¼šå¼¹å‡ºï¼Œä»¥æ˜¾ç¤ºå‰ä¸€ä¸ª Activityï¼Œç›´åˆ°ç”¨æˆ·è¿”å›žä¸»å±å¹•ä¸ºæ­¢ï¼ˆæˆ–è€…ï¼Œè¿”å›žä»»åŠ¡å¼€å§‹æ—¶æ­£åœ¨è¿è¡Œçš„ä»»æ„ Activityï¼‰ã€‚ å½“æ‰€æœ‰ Activity å‡ä»Žå †æ ˆä¸­ç§»é™¤åŽï¼Œä»»åŠ¡å³ä¸å¤å­˜åœ¨ã€‚ ä»»åŠ¡æ˜¯ä¸€ä¸ªæœ‰æœºæ•´ä½“ï¼Œå½“ç”¨æˆ·å¼€å§‹æ–°ä»»åŠ¡æˆ–é€šè¿‡â€œä¸»é¡µâ€æŒ‰é’®è½¬åˆ°ä¸»å±å¹•æ—¶ï¼Œå¯ä»¥ç§»åŠ¨åˆ°â€œåŽå°â€ã€‚ å°½ç®¡åœ¨åŽå°æ—¶ï¼Œè¯¥ä»»åŠ¡ä¸­çš„æ‰€æœ‰ Activity å…¨éƒ¨åœæ­¢ï¼Œä½†æ˜¯ä»»åŠ¡çš„è¿”å›žæ ˆä»æ—§ä¸å˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å¦ä¸€ä¸ªä»»åŠ¡å‘ç”Ÿæ—¶ï¼Œè¯¥ä»»åŠ¡ä»…ä»…å¤±åŽ»ç„¦ç‚¹è€Œå·²ï¼Œå¦‚å›¾ 2 ä¸­æ‰€ç¤ºã€‚ç„¶åŽï¼Œä»»åŠ¡å¯ä»¥è¿”å›žåˆ°â€œå‰å°â€ï¼Œç”¨æˆ·å°±èƒ½å¤Ÿå›žåˆ°ç¦»å¼€æ—¶çš„çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾å½“å‰ä»»åŠ¡ï¼ˆä»»åŠ¡ Aï¼‰çš„å †æ ˆä¸­æœ‰ä¸‰ä¸ª Activityï¼Œå³å½“å‰ Activity ä¸‹æ–¹è¿˜æœ‰ä¸¤ä¸ª Activityã€‚ ç”¨æˆ·å…ˆæŒ‰â€œä¸»é¡µâ€æŒ‰é’®ï¼Œç„¶åŽä»Žåº”ç”¨å¯åŠ¨å™¨å¯åŠ¨æ–°åº”ç”¨ã€‚ æ˜¾ç¤ºä¸»å±å¹•æ—¶ï¼Œä»»åŠ¡ A è¿›å…¥åŽå°ã€‚æ–°åº”ç”¨å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šä½¿ç”¨è‡ªå·±çš„ Activity å †æ ˆä¸ºè¯¥åº”ç”¨å¯åŠ¨ä¸€ä¸ªä»»åŠ¡ï¼ˆä»»åŠ¡ Bï¼‰ã€‚ä¸Žè¯¥åº”ç”¨äº¤äº’ä¹‹åŽï¼Œç”¨æˆ·å†æ¬¡è¿”å›žä¸»å±å¹•å¹¶é€‰æ‹©æœ€åˆå¯åŠ¨ä»»åŠ¡ A çš„åº”ç”¨ã€‚çŽ°åœ¨ï¼Œä»»åŠ¡ A å‡ºçŽ°åœ¨å‰å°ï¼Œå…¶å †æ ˆä¸­çš„æ‰€æœ‰ä¸‰ä¸ª Activity ä¿æŒä¸å˜ï¼Œè€Œä½äºŽå †æ ˆé¡¶éƒ¨çš„ Activity åˆ™ä¼šæ¢å¤æ‰§è¡Œã€‚ æ­¤æ—¶ï¼Œç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡è½¬åˆ°ä¸»å±å¹•å¹¶é€‰æ‹©å¯åŠ¨è¯¥ä»»åŠ¡çš„åº”ç”¨å›¾æ ‡ï¼ˆæˆ–è€…ï¼Œé€šè¿‡ä»Žæ¦‚è§ˆå±å¹•é€‰æ‹©è¯¥åº”ç”¨çš„ä»»åŠ¡ï¼‰åˆ‡æ¢å›žä»»åŠ¡ Bã€‚è¿™æ˜¯ Android ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå¤šä»»åŠ¡ç¤ºä¾‹ã€‚ å›¾ 2. ä¸¤ä¸ªä»»åŠ¡ï¼šä»»åŠ¡ B åœ¨å‰å°æŽ¥æ”¶ç”¨æˆ·äº¤äº’ï¼Œè€Œä»»åŠ¡ A åˆ™åœ¨åŽå°ç­‰å¾…æ¢å¤ã€‚ æ³¨ï¼šåŽå°å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æžœç”¨æˆ·åŒæ—¶è¿è¡Œå¤šä¸ªåŽå°ä»»åŠ¡ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¼šå¼€å§‹é”€æ¯åŽå° Activityï¼Œä»¥å›žæ”¶å†…å­˜èµ„æºï¼Œä»Žè€Œå¯¼è‡´ Activity çŠ¶æ€ä¸¢å¤±ã€‚è¯·å‚é˜…ä¸‹é¢æœ‰å…³ Activity çŠ¶æ€çš„éƒ¨åˆ†ã€‚ ç”±äºŽè¿”å›žæ ˆä¸­çš„ Activity æ°¸è¿œä¸ä¼šé‡æ–°æŽ’åˆ—ï¼Œå› æ­¤å¦‚æžœåº”ç”¨å…è®¸ç”¨æˆ·ä»Žå¤šä¸ª Activity ä¸­å¯åŠ¨ç‰¹å®š Activityï¼Œåˆ™ä¼šåˆ›å»ºè¯¥ Activity çš„æ–°å®žä¾‹å¹¶æŽ¨å…¥å †æ ˆä¸­ï¼ˆè€Œä¸æ˜¯å°† Activity çš„ä»»ä¸€å…ˆå‰å®žä¾‹ç½®äºŽé¡¶éƒ¨ï¼‰ã€‚ å› æ­¤ï¼Œåº”ç”¨ä¸­çš„ä¸€ä¸ª Activity å¯èƒ½ä¼šå¤šæ¬¡å®žä¾‹åŒ–ï¼ˆå³ä½¿ Activity æ¥è‡ªä¸åŒçš„ä»»åŠ¡ï¼‰ï¼Œå¦‚å›¾ 3 æ‰€ç¤ºã€‚å› æ­¤ï¼Œå¦‚æžœç”¨æˆ·ä½¿ç”¨â€œè¿”å›žâ€æŒ‰é’®å‘åŽå¯¼èˆªï¼Œåˆ™ä¼šæŒ‰ Activity æ¯ä¸ªå®žä¾‹çš„æ‰“å¼€é¡ºåºæ˜¾ç¤ºè¿™äº›å®žä¾‹ï¼ˆæ¯ä¸ªå®žä¾‹çš„ UI çŠ¶æ€å„ä¸ç›¸åŒï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æžœæ‚¨ä¸å¸Œæœ› Activity å¤šæ¬¡å®žä¾‹åŒ–ï¼Œåˆ™å¯ä¿®æ”¹æ­¤è¡Œä¸ºã€‚ å…·ä½“æ“ä½œæ–¹æ³•å°†åœ¨åŽé¢çš„ç®¡ç†ä»»åŠ¡éƒ¨åˆ†ä¸­è®¨è®ºã€‚ å›¾ 3. ä¸€ä¸ª Activity å°†å¤šæ¬¡å®žä¾‹åŒ–ã€‚ Activity å’Œä»»åŠ¡çš„é»˜è®¤è¡Œä¸ºæ€»ç»“å¦‚ä¸‹ï¼š å½“ Activity A å¯åŠ¨ Activity B æ—¶ï¼ŒActivity A å°†ä¼šåœæ­¢ï¼Œä½†ç³»ç»Ÿä¼šä¿ç•™å…¶çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œæ»šåŠ¨ä½ç½®å’Œå·²è¾“å…¥è¡¨å•ä¸­çš„æ–‡æœ¬ï¼‰ã€‚å¦‚æžœç”¨æˆ·åœ¨å¤„äºŽ Activity B æ—¶æŒ‰â€œè¿”å›žâ€æŒ‰é’®ï¼Œåˆ™ Activity A å°†æ¢å¤å…¶çŠ¶æ€ï¼Œç»§ç»­æ‰§è¡Œã€‚ ç”¨æˆ·é€šè¿‡æŒ‰â€œä¸»é¡µâ€æŒ‰é’®ç¦»å¼€ä»»åŠ¡æ—¶ï¼Œå½“å‰ Activity å°†åœæ­¢ä¸”å…¶ä»»åŠ¡ä¼šè¿›å…¥åŽå°ã€‚ ç³»ç»Ÿå°†ä¿ç•™ä»»åŠ¡ä¸­æ¯ä¸ª Activity çš„çŠ¶æ€ã€‚å¦‚æžœç”¨æˆ·ç¨åŽé€šè¿‡é€‰æ‹©å¼€å§‹ä»»åŠ¡çš„å¯åŠ¨å™¨å›¾æ ‡æ¥æ¢å¤ä»»åŠ¡ï¼Œåˆ™ä»»åŠ¡å°†å‡ºçŽ°åœ¨å‰å°å¹¶æ¢å¤æ‰§è¡Œå †æ ˆé¡¶éƒ¨çš„ Activityã€‚ å¦‚æžœç”¨æˆ·æŒ‰â€œè¿”å›žâ€æŒ‰é’®ï¼Œåˆ™å½“å‰ Activity ä¼šä»Žå †æ ˆå¼¹å‡ºå¹¶è¢«é”€æ¯ã€‚ å †æ ˆä¸­çš„å‰ä¸€ä¸ª Activity æ¢å¤æ‰§è¡Œã€‚é”€æ¯ Activity æ—¶ï¼Œç³»ç»Ÿä¸ä¼šä¿ç•™è¯¥ Activity çš„çŠ¶æ€ã€‚ å³ä½¿æ¥è‡ªå…¶ä»–ä»»åŠ¡ï¼ŒActivity ä¹Ÿå¯ä»¥å¤šæ¬¡å®žä¾‹åŒ–ã€‚ ä¿å­˜ Activity çŠ¶æ€æ­£å¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œå½“ Activity åœæ­¢æ—¶ï¼Œç³»ç»Ÿçš„é»˜è®¤è¡Œä¸ºä¼šä¿ç•™å…¶çŠ¶æ€ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå½“ç”¨æˆ·å¯¼èˆªå›žåˆ°ä¸Šä¸€ä¸ª Activity æ—¶ï¼Œå…¶ç”¨æˆ·ç•Œé¢ä¸Žç”¨æˆ·ç¦»å¼€æ—¶ä¸€æ ·ã€‚ ä½†æ˜¯ï¼Œåœ¨ Activity è¢«é”€æ¯ä¸”å¿…é¡»é‡å»ºæ—¶ï¼Œæ‚¨å¯ä»¥è€Œä¸”åº”å½“ä¸»åŠ¨ä½¿ç”¨å›žè°ƒæ–¹æ³•ä¿ç•™ Activity çš„çŠ¶æ€ã€‚ ç³»ç»Ÿåœæ­¢æ‚¨çš„ä¸€ä¸ª Activity æ—¶ï¼ˆä¾‹å¦‚ï¼Œæ–° Activity å¯åŠ¨æˆ–ä»»åŠ¡è½¬åˆ°å‰å°ï¼‰ï¼Œå¦‚æžœç³»ç»Ÿéœ€è¦å›žæ”¶ç³»ç»Ÿå†…å­˜èµ„æºï¼Œåˆ™å¯èƒ½ä¼šå®Œå…¨é”€æ¯è¯¥ Activityã€‚ å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæœ‰å…³è¯¥ Activity çŠ¶æ€çš„ä¿¡æ¯å°†ä¼šä¸¢å¤±ã€‚å¦‚æžœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œç³»ç»Ÿä»ä¼šçŸ¥é“è¯¥ Activity å­˜åœ¨äºŽè¿”å›žæ ˆä¸­ï¼Œä½†æ˜¯å½“è¯¥ Activity è¢«ç½®äºŽå †æ ˆé¡¶éƒ¨æ—¶ï¼Œç³»ç»Ÿä¸€å®šä¼šé‡å»º Activityï¼ˆè€Œä¸æ˜¯æ¢å¤ Activityï¼‰ã€‚ ä¸ºäº†é¿å…ç”¨æˆ·çš„å·¥ä½œä¸¢å¤±ï¼Œæ‚¨åº”ä¸»åŠ¨é€šè¿‡åœ¨ Activity ä¸­å®žçŽ° onSaveInstanceState() å›žè°ƒæ–¹æ³•æ¥ä¿ç•™å·¥ä½œã€‚ å¦‚éœ€äº†è§£æœ‰å…³å¦‚ä½•ä¿å­˜ Activity çŠ¶æ€çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Activity æ–‡æ¡£ã€‚ ç®¡ç†ä»»åŠ¡Android ç®¡ç†ä»»åŠ¡å’Œè¿”å›žæ ˆçš„æ–¹å¼ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œå³ï¼šå°†æ‰€æœ‰è¿žç»­å¯åŠ¨çš„ Activity æ”¾å…¥åŒä¸€ä»»åŠ¡å’Œâ€œåŽè¿›å…ˆå‡ºâ€å †æ ˆä¸­ï¼‰éžå¸¸é€‚ç”¨äºŽå¤§å¤šæ•°åº”ç”¨ï¼Œè€Œæ‚¨ä¸å¿…æ‹…å¿ƒ Activity å¦‚ä½•ä¸Žä»»åŠ¡å…³è”æˆ–è€…å¦‚ä½•å­˜åœ¨äºŽè¿”å›žæ ˆä¸­ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯èƒ½ä¼šå†³å®šè¦ä¸­æ–­æ­£å¸¸è¡Œä¸ºã€‚ ä¹Ÿè®¸æ‚¨å¸Œæœ›åº”ç”¨ä¸­çš„ Activity åœ¨å¯åŠ¨æ—¶å¼€å§‹æ–°ä»»åŠ¡ï¼ˆè€Œä¸æ˜¯æ”¾ç½®åœ¨å½“å‰ä»»åŠ¡ä¸­ï¼‰ï¼›æˆ–è€…ï¼Œå½“å¯åŠ¨ Activity æ—¶ï¼Œæ‚¨å¸Œæœ›å°†å…¶çŽ°æœ‰å®žä¾‹ä¸Šç§»ä¸€å±‚ï¼ˆè€Œä¸æ˜¯åœ¨è¿”å›žæ ˆçš„é¡¶éƒ¨åˆ›å»ºæ–°å®žä¾‹ï¼‰ï¼›æˆ–è€…ï¼Œæ‚¨å¸Œæœ›åœ¨ç”¨æˆ·ç¦»å¼€ä»»åŠ¡æ—¶ï¼Œæ¸…é™¤è¿”å›žæ ˆä¸­é™¤æ ¹ Activity ä»¥å¤–çš„æ‰€æœ‰å…¶ä»– Activityã€‚ é€šè¿‡ä½¿ç”¨ æ¸…å•æ–‡ä»¶å…ƒç´ ä¸­çš„å±žæ€§å’Œä¼ é€’ç»™ startActivity() çš„ Intent ä¸­çš„æ ‡å¿—ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œæ‰€æœ‰è¿™äº›æ“ä½œä»¥åŠå…¶ä»–æ“ä½œã€‚ åœ¨è¿™ä¸€æ–¹é¢ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨çš„ä¸»è¦ å±žæ€§åŒ…æ‹¬ï¼š taskAffinity launchMode allowTaskReparenting clearTaskOnLaunch alwaysRetainTaskState finishOnTaskLaunch æ‚¨å¯ä»¥ä½¿ç”¨çš„ä¸»è¦ Intent æ ‡å¿—åŒ…æ‹¬ï¼š FLAG_ACTIVITY_NEW_TASK FLAG_ACTIVITY_CLEAR_TOP FLAG_ACTIVITY_SINGLE_TOP åœ¨ä¸‹æ–‡ä¸­ï¼Œæ‚¨å°†äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›æ¸…å•æ–‡ä»¶å±žæ€§å’Œ Intent æ ‡å¿—å®šä¹‰ Activity ä¸Žä»»åŠ¡çš„å…³è”æ–¹å¼ï¼Œä»¥åŠ Activity åœ¨è¿”å›žæ ˆä¸­çš„è¡Œä¸ºæ–¹å¼ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å•ç‹¬ä»‹ç»äº†æœ‰å…³å¦‚ä½•åœ¨æ¦‚è§ˆå±å¹•ä¸­æ˜¾ç¤ºå’Œç®¡ç†ä»»åŠ¡ä¸Ž Activity çš„æ³¨æ„äº‹é¡¹ã€‚ å¦‚éœ€äº†è§£è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ¦‚è§ˆå±å¹•ã€‚ é€šå¸¸ï¼Œæ‚¨åº”è¯¥å…è®¸ç³»ç»Ÿå®šä¹‰ä»»åŠ¡å’Œ Activity åœ¨æ¦‚è§ˆå±å¹•ä¸­çš„æ˜¾ç¤ºæ–¹æ³•ï¼Œå¹¶ä¸”æ— éœ€ä¿®æ”¹æ­¤è¡Œä¸ºã€‚ æ³¨æ„ï¼šå¤§å¤šæ•°åº”ç”¨éƒ½ä¸å¾—ä¸­æ–­ Activity å’Œä»»åŠ¡çš„é»˜è®¤è¡Œä¸ºï¼š å¦‚æžœç¡®å®šæ‚¨çš„ Activity å¿…é¡»ä¿®æ”¹é»˜è®¤è¡Œä¸ºï¼Œå½“ä½¿ç”¨â€œè¿”å›žâ€æŒ‰é’®ä»Žå…¶ä»– Activity å’Œä»»åŠ¡å¯¼èˆªå›žåˆ°è¯¥ Activity æ—¶ï¼Œè¯·åŠ¡å¿…è¦è°¨æ…Žå¹¶ç¡®ä¿åœ¨å¯åŠ¨æœŸé—´æµ‹è¯•è¯¥ Activity çš„å¯ç”¨æ€§ã€‚è¯·ç¡®ä¿æµ‹è¯•å¯¼èˆªè¡Œä¸ºæ˜¯å¦æœ‰å¯èƒ½ä¸Žç”¨æˆ·çš„é¢„æœŸè¡Œä¸ºå†²çªã€‚ å®šä¹‰å¯åŠ¨æ¨¡å¼å¯åŠ¨æ¨¡å¼å…è®¸æ‚¨å®šä¹‰ Activity çš„æ–°å®žä¾‹å¦‚ä½•ä¸Žå½“å‰ä»»åŠ¡å…³è”ã€‚ æ‚¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹æ³•å®šä¹‰ä¸åŒçš„å¯åŠ¨æ¨¡å¼ï¼š ä½¿ç”¨æ¸…å•æ–‡ä»¶ åœ¨æ¸…å•æ–‡ä»¶ä¸­å£°æ˜Ž Activity æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡å®š Activity åœ¨å¯åŠ¨æ—¶åº”è¯¥å¦‚ä½•ä¸Žä»»åŠ¡å…³è”ã€‚ ä½¿ç”¨ Intent æ ‡å¿— è°ƒç”¨ startActivity() æ—¶ï¼Œå¯ä»¥åœ¨ Intent ä¸­åŠ å…¥ä¸€ä¸ªæ ‡å¿—ï¼Œç”¨äºŽå£°æ˜Žæ–° Activity å¦‚ä½•ï¼ˆæˆ–æ˜¯å¦ï¼‰ä¸Žå½“å‰ä»»åŠ¡å…³è”ã€‚ å› æ­¤ï¼Œå¦‚æžœ Activity A å¯åŠ¨ Activity Bï¼Œåˆ™ Activity B å¯ä»¥åœ¨å…¶æ¸…å•æ–‡ä»¶ä¸­å®šä¹‰å®ƒåº”è¯¥å¦‚ä½•ä¸Žå½“å‰ä»»åŠ¡å…³è”ï¼ˆå¦‚æžœå¯èƒ½ï¼‰ï¼Œå¹¶ä¸” Activity A è¿˜å¯ä»¥è¯·æ±‚ Activity B åº”è¯¥å¦‚ä½•ä¸Žå½“å‰ä»»åŠ¡å…³è”ã€‚å¦‚æžœè¿™ä¸¤ä¸ª Activity å‡å®šä¹‰ Activity B åº”è¯¥å¦‚ä½•ä¸Žä»»åŠ¡å…³è”ï¼Œåˆ™ Activity A çš„è¯·æ±‚ï¼ˆå¦‚ Intent ä¸­æ‰€å®šä¹‰ï¼‰ä¼˜å…ˆçº§è¦é«˜äºŽ Activity B çš„è¯·æ±‚ï¼ˆå¦‚å…¶æ¸…å•æ–‡ä»¶ä¸­æ‰€å®šä¹‰ï¼‰ã€‚ æ³¨ï¼šæŸäº›é€‚ç”¨äºŽæ¸…å•æ–‡ä»¶çš„å¯åŠ¨æ¨¡å¼ä¸å¯ç”¨ä½œ Intent æ ‡å¿—ï¼ŒåŒæ ·ï¼ŒæŸäº›å¯ç”¨ä½œ Intent æ ‡å¿—çš„å¯åŠ¨æ¨¡å¼æ— æ³•åœ¨æ¸…å•æ–‡ä»¶ä¸­å®šä¹‰ã€‚ ä½¿ç”¨æ¸…å•æ–‡ä»¶åœ¨æ¸…å•æ–‡ä»¶ä¸­å£°æ˜Ž Activity æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ å…ƒç´ çš„ launchMode å±žæ€§æŒ‡å®š Activity åº”è¯¥å¦‚ä½•ä¸Žä»»åŠ¡å…³è”ã€‚ launchMode å±žæ€§æŒ‡å®šæœ‰å…³åº”å¦‚ä½•å°† Activity å¯åŠ¨åˆ°ä»»åŠ¡ä¸­çš„æŒ‡ä»¤ã€‚æ‚¨å¯ä»¥åˆ†é…ç»™ launchMode å±žæ€§çš„å¯åŠ¨æ¨¡å¼å…±æœ‰å››ç§ï¼š â€œstandardâ€ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ é»˜è®¤ã€‚ç³»ç»Ÿåœ¨å¯åŠ¨ Activity çš„ä»»åŠ¡ä¸­åˆ›å»º Activity çš„æ–°å®žä¾‹å¹¶å‘å…¶ä¼ é€ Intentã€‚Activity å¯ä»¥å¤šæ¬¡å®žä¾‹åŒ–ï¼Œè€Œæ¯ä¸ªå®žä¾‹å‡å¯å±žäºŽä¸åŒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸€ä¸ªä»»åŠ¡å¯ä»¥æ‹¥æœ‰å¤šä¸ªå®žä¾‹ã€‚ â€œsingleTopâ€ å¦‚æžœå½“å‰ä»»åŠ¡çš„é¡¶éƒ¨å·²å­˜åœ¨ Activity çš„ä¸€ä¸ªå®žä¾‹ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡è°ƒç”¨è¯¥å®žä¾‹çš„ onNewIntent() æ–¹æ³•å‘å…¶ä¼ é€ Intentï¼Œè€Œä¸æ˜¯åˆ›å»º Activity çš„æ–°å®žä¾‹ã€‚Activity å¯ä»¥å¤šæ¬¡å®žä¾‹åŒ–ï¼Œè€Œæ¯ä¸ªå®žä¾‹å‡å¯å±žäºŽä¸åŒçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸€ä¸ªä»»åŠ¡å¯ä»¥æ‹¥æœ‰å¤šä¸ªå®žä¾‹ï¼ˆä½†å‰ææ˜¯ä½äºŽè¿”å›žæ ˆé¡¶éƒ¨çš„ Activity å¹¶ä¸æ˜¯ Activity çš„çŽ°æœ‰å®žä¾‹ï¼‰ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾ä»»åŠ¡çš„è¿”å›žæ ˆåŒ…å«æ ¹ Activity A ä»¥åŠ Activity Bã€C å’Œä½äºŽé¡¶éƒ¨çš„ Dï¼ˆå †æ ˆæ˜¯ A-B-C-Dï¼›D ä½äºŽé¡¶éƒ¨ï¼‰ã€‚æ”¶åˆ°é’ˆå¯¹ D ç±» Activity çš„ Intentã€‚å¦‚æžœ D å…·æœ‰é»˜è®¤çš„ â€œstandardâ€ å¯åŠ¨æ¨¡å¼ï¼Œåˆ™ä¼šå¯åŠ¨è¯¥ç±»çš„æ–°å®žä¾‹ï¼Œä¸”å †æ ˆä¼šå˜æˆ A-B-C-D-Dã€‚ä½†æ˜¯ï¼Œå¦‚æžœ D çš„å¯åŠ¨æ¨¡å¼æ˜¯ â€œsingleTopâ€ï¼Œåˆ™ D çš„çŽ°æœ‰å®žä¾‹ä¼šé€šè¿‡ onNewIntent() æŽ¥æ”¶ Intentï¼Œå› ä¸ºå®ƒä½äºŽå †æ ˆçš„é¡¶éƒ¨ï¼›è€Œå †æ ˆä»ä¸º A-B-C-Dã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ”¶åˆ°é’ˆå¯¹ B ç±» Activity çš„ Intentï¼Œåˆ™ä¼šå‘å †æ ˆæ·»åŠ  B çš„æ–°å®žä¾‹ï¼Œå³ä¾¿å…¶å¯åŠ¨æ¨¡å¼ä¸º â€œsingleTopâ€ ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ æ³¨ï¼šä¸ºæŸä¸ª Activity åˆ›å»ºæ–°å®žä¾‹æ—¶ï¼Œç”¨æˆ·å¯ä»¥æŒ‰â€œè¿”å›žâ€æŒ‰é’®è¿”å›žåˆ°å‰ä¸€ä¸ª Activityã€‚ ä½†æ˜¯ï¼Œå½“ Activity çš„çŽ°æœ‰å®žä¾‹å¤„ç†æ–° Intent æ—¶ï¼Œåˆ™åœ¨æ–° Intent åˆ°è¾¾ onNewIntent() ä¹‹å‰ï¼Œç”¨æˆ·æ— æ³•æŒ‰â€œè¿”å›žâ€æŒ‰é’®è¿”å›žåˆ° Activity çš„çŠ¶æ€ã€‚ â€œsingleTaskâ€ ç³»ç»Ÿåˆ›å»ºæ–°ä»»åŠ¡å¹¶å®žä¾‹åŒ–ä½äºŽæ–°ä»»åŠ¡åº•éƒ¨çš„ Activityã€‚ä½†æ˜¯ï¼Œå¦‚æžœè¯¥ Activity çš„ä¸€ä¸ªå®žä¾‹å·²å­˜åœ¨äºŽä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡ä¸­ï¼Œåˆ™ç³»ç»Ÿä¼šé€šè¿‡è°ƒç”¨çŽ°æœ‰å®žä¾‹çš„ onNewIntent() æ–¹æ³•å‘å…¶ä¼ é€ Intentï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°å®žä¾‹ã€‚ä¸€æ¬¡åªèƒ½å­˜åœ¨ Activity çš„ä¸€ä¸ªå®žä¾‹ã€‚ æ³¨ï¼šå°½ç®¡ Activity åœ¨æ–°ä»»åŠ¡ä¸­å¯åŠ¨ï¼Œä½†æ˜¯ç”¨æˆ·æŒ‰â€œè¿”å›žâ€æŒ‰é’®ä»ä¼šè¿”å›žåˆ°å‰ä¸€ä¸ª Activityã€‚ â€œsingleInstanceâ€. ä¸Ž â€œsingleTaskâ€ ç›¸åŒï¼Œåªæ˜¯ç³»ç»Ÿä¸ä¼šå°†ä»»ä½•å…¶ä»– Activity å¯åŠ¨åˆ°åŒ…å«å®žä¾‹çš„ä»»åŠ¡ä¸­ã€‚è¯¥ Activity å§‹ç»ˆæ˜¯å…¶ä»»åŠ¡å”¯ä¸€ä»…æœ‰çš„æˆå‘˜ï¼›ç”±æ­¤ Activity å¯åŠ¨çš„ä»»ä½• Activity å‡åœ¨å•ç‹¬çš„ä»»åŠ¡ä¸­æ‰“å¼€ã€‚ æˆ‘ä»¬å†æ¥çœ‹å¦ä¸€ç¤ºä¾‹ï¼ŒAndroid æµè§ˆå™¨åº”ç”¨å£°æ˜Žç½‘ç»œæµè§ˆå™¨ Activity åº”å§‹ç»ˆåœ¨å…¶è‡ªå·±çš„ä»»åŠ¡ä¸­æ‰“å¼€ï¼ˆé€šè¿‡åœ¨ å…ƒç´ ä¸­æŒ‡å®š singleTask å¯åŠ¨æ¨¡å¼ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æžœæ‚¨çš„åº”ç”¨å‘å‡ºæ‰“å¼€ Android æµè§ˆå™¨çš„ Intentï¼Œåˆ™å…¶ Activity ä¸Žæ‚¨çš„åº”ç”¨ä½äºŽä¸åŒçš„ä»»åŠ¡ä¸­ã€‚ç›¸åï¼Œç³»ç»Ÿä¼šä¸ºæµè§ˆå™¨å¯åŠ¨æ–°ä»»åŠ¡ï¼Œæˆ–è€…å¦‚æžœæµè§ˆå™¨å·²æœ‰ä»»åŠ¡æ­£åœ¨åŽå°è¿è¡Œï¼Œåˆ™ä¼šå°†è¯¥ä»»åŠ¡ä¸Šç§»ä¸€å±‚ä»¥å¤„ç†æ–° Intentã€‚ æ— è®º Activity æ˜¯åœ¨æ–°ä»»åŠ¡ä¸­å¯åŠ¨ï¼Œè¿˜æ˜¯åœ¨ä¸Žå¯åŠ¨ Activity ç›¸åŒçš„ä»»åŠ¡ä¸­å¯åŠ¨ï¼Œç”¨æˆ·æŒ‰â€œè¿”å›žâ€æŒ‰é’®å§‹ç»ˆä¼šè½¬åˆ°å‰ä¸€ä¸ª Activityã€‚ ä½†æ˜¯ï¼Œå¦‚æžœå¯åŠ¨æŒ‡å®š singleTask å¯åŠ¨æ¨¡å¼çš„ Activityï¼Œåˆ™å½“æŸåŽå°ä»»åŠ¡ä¸­å­˜åœ¨è¯¥ Activity çš„å®žä¾‹æ—¶ï¼Œæ•´ä¸ªä»»åŠ¡éƒ½ä¼šè½¬ç§»åˆ°å‰å°ã€‚æ­¤æ—¶ï¼Œè¿”å›žæ ˆåŒ…æ‹¬ä¸Šç§»åˆ°å †æ ˆé¡¶éƒ¨çš„ä»»åŠ¡ä¸­çš„æ‰€æœ‰ Activityã€‚ å›¾ 4 æ˜¾ç¤ºäº†è¿™ç§æƒ…å†µã€‚ å›¾ 4. æ˜¾ç¤ºå¦‚ä½•å°†å¯åŠ¨æ¨¡å¼ä¸ºâ€œsingleTaskâ€çš„ Activity æ·»åŠ åˆ°è¿”å›žæ ˆã€‚ å¦‚æžœ Activity å·²ç»æ˜¯æŸä¸ªæ‹¥æœ‰è‡ªå·±çš„è¿”å›žæ ˆçš„åŽå°ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™æ•´ä¸ªè¿”å›žæ ˆä¹Ÿä¼šä¸Šç§»åˆ°å½“å‰ä»»åŠ¡çš„é¡¶éƒ¨ã€‚ å¦‚éœ€äº†è§£æœ‰å…³åœ¨æ¸…å•æ–‡ä»¶ä¸­ä½¿ç”¨å¯åŠ¨æ¨¡å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… å…ƒç´ æ–‡æ¡£ï¼Œå…¶ä¸­æ›´è¯¦ç»†åœ°è®¨è®ºäº† launchMode å±žæ€§å’Œå¯æŽ¥å—çš„å€¼ã€‚ æ³¨ï¼šä½¿ç”¨ launchMode å±žæ€§ä¸º Activity æŒ‡å®šçš„è¡Œä¸ºå¯ç”± Intent é™„å¸¦çš„ Activity å¯åŠ¨æ ‡å¿—æ›¿ä»£ï¼Œä¸‹æ–‡å°†å¯¹æ­¤è¿›è¡Œè®¨è®ºã€‚ ä½¿ç”¨ Intent æ ‡å¿—å¯åŠ¨ Activity æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ä¼ é€’ç»™ startActivity() çš„ Intent ä¸­åŠ å…¥ç›¸åº”çš„æ ‡å¿—ï¼Œä¿®æ”¹ Activity ä¸Žå…¶ä»»åŠ¡çš„é»˜è®¤å…³è”æ–¹å¼ã€‚å¯ç”¨äºŽä¿®æ”¹é»˜è®¤è¡Œä¸ºçš„æ ‡å¿—åŒ…æ‹¬ï¼š FLAG_ACTIVITY_NEW_TASK åœ¨æ–°ä»»åŠ¡ä¸­å¯åŠ¨ Activityã€‚å¦‚æžœå·²ä¸ºæ­£åœ¨å¯åŠ¨çš„ Activity è¿è¡Œä»»åŠ¡ï¼Œåˆ™è¯¥ä»»åŠ¡ä¼šè½¬åˆ°å‰å°å¹¶æ¢å¤å…¶æœ€åŽçŠ¶æ€ï¼ŒåŒæ—¶ Activity ä¼šåœ¨ onNewIntent() ä¸­æ”¶åˆ°æ–° Intentã€‚ æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œè¿™ä¼šäº§ç”Ÿä¸Ž â€œsingleTaskâ€launchMode å€¼ç›¸åŒçš„è¡Œä¸ºã€‚ FLAG_ACTIVITY_SINGLE_TOP å¦‚æžœæ­£åœ¨å¯åŠ¨çš„ Activity æ˜¯å½“å‰ Activityï¼ˆä½äºŽè¿”å›žæ ˆçš„é¡¶éƒ¨ï¼‰ï¼Œåˆ™ çŽ°æœ‰å®žä¾‹ä¼šæŽ¥æ”¶å¯¹ onNewIntent() çš„è°ƒç”¨ï¼Œè€Œä¸æ˜¯åˆ›å»º Activity çš„æ–°å®žä¾‹ã€‚ æ­£å¦‚å‰æ–‡æ‰€è¿°ï¼Œè¿™ä¼šäº§ç”Ÿä¸Ž â€œsingleTopâ€launchMode å€¼ç›¸åŒçš„è¡Œä¸ºã€‚ FLAG_ACTIVITY_CLEAR_TOP å¦‚æžœæ­£åœ¨å¯åŠ¨çš„ Activity å·²åœ¨å½“å‰ä»»åŠ¡ä¸­è¿è¡Œï¼Œåˆ™ä¼šé”€æ¯å½“å‰ä»»åŠ¡é¡¶éƒ¨çš„æ‰€æœ‰ Activityï¼Œå¹¶é€šè¿‡ onNewIntent() å°†æ­¤ Intent ä¼ é€’ç»™ Activity å·²æ¢å¤çš„å®žä¾‹ï¼ˆçŽ°åœ¨ä½äºŽé¡¶éƒ¨ï¼‰ï¼Œè€Œä¸æ˜¯å¯åŠ¨è¯¥ Activity çš„æ–°å®žä¾‹ã€‚ äº§ç”Ÿè¿™ç§è¡Œä¸ºçš„ launchMode å±žæ€§æ²¡æœ‰å€¼ã€‚ FLAG_ACTIVITY_CLEAR_TOP é€šå¸¸ä¸Ž FLAG_ACTIVITY_NEW_TASK ç»“åˆä½¿ç”¨ã€‚ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œé€šè¿‡è¿™äº›æ ‡å¿—ï¼Œå¯ä»¥æ‰¾åˆ°å…¶ä»–ä»»åŠ¡ä¸­çš„çŽ°æœ‰ Activityï¼Œå¹¶å°†å…¶æ”¾å…¥å¯ä»Žä¸­å“åº” Intent çš„ä½ç½®ã€‚ æ³¨ï¼šå¦‚æžœæŒ‡å®š Activity çš„å¯åŠ¨æ¨¡å¼ä¸º â€œstandardâ€ï¼Œåˆ™è¯¥ Activity ä¹Ÿä¼šä»Žå †æ ˆä¸­ç§»é™¤ï¼Œå¹¶åœ¨å…¶ä½ç½®å¯åŠ¨ä¸€ä¸ªæ–°å®žä¾‹ï¼Œä»¥ä¾¿å¤„ç†ä¼ å…¥çš„ Intentã€‚ è¿™æ˜¯å› ä¸ºå½“å¯åŠ¨æ¨¡å¼ä¸º â€œstandardâ€ æ—¶ï¼Œå°†å§‹ç»ˆä¸ºæ–° Intent åˆ›å»ºæ–°å®žä¾‹ã€‚ å¤„ç†å…³è”â€œå…³è”â€æŒ‡ç¤º Activity ä¼˜å…ˆå±žäºŽå“ªä¸ªä»»åŠ¡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒä¸€åº”ç”¨ä¸­çš„æ‰€æœ‰ Activity å½¼æ­¤å…³è”ã€‚ å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒä¸€åº”ç”¨ä¸­çš„æ‰€æœ‰ Activity ä¼˜å…ˆä½äºŽç›¸åŒä»»åŠ¡ä¸­ã€‚ ä¸è¿‡ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹ Activity çš„é»˜è®¤å…³è”ã€‚ åœ¨ä¸åŒåº”ç”¨ä¸­å®šä¹‰çš„ Activity å¯ä»¥å…±äº«å…³è”ï¼Œæˆ–è€…å¯ä¸ºåœ¨åŒä¸€åº”ç”¨ä¸­å®šä¹‰çš„ Activity åˆ†é…ä¸åŒçš„ä»»åŠ¡å…³è”ã€‚ å¯ä»¥ä½¿ç”¨ å…ƒç´ çš„ taskAffinity å±žæ€§ä¿®æ”¹ä»»ä½•ç»™å®š Activity çš„å…³è”ã€‚ taskAffinity å±žæ€§å–å­—ç¬¦ä¸²å€¼ï¼Œè¯¥å€¼å¿…é¡»ä¸åŒäºŽåœ¨ å…ƒç´ ä¸­å£°æ˜Žçš„é»˜è®¤è½¯ä»¶åŒ…åç§°ï¼Œå› ä¸ºç³»ç»Ÿä½¿ç”¨è¯¥åç§°æ ‡è¯†åº”ç”¨çš„é»˜è®¤ä»»åŠ¡å…³è”ã€‚ åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œå…³è”ä¼šèµ·ä½œç”¨ï¼š å¯åŠ¨ Activity çš„ Intent åŒ…å« FLAG_ACTIVITY_NEW_TASK æ ‡å¿—ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–° Activity ä¼šå¯åŠ¨åˆ°è°ƒç”¨ startActivity() çš„ Activity ä»»åŠ¡ä¸­ã€‚å®ƒå°†æŽ¨å…¥ä¸Žè°ƒç”¨æ–¹ç›¸åŒçš„è¿”å›žæ ˆã€‚ ä½†æ˜¯ï¼Œå¦‚æžœä¼ é€’ç»™ startActivity() çš„ Intent åŒ…å« FLAG_ACTIVITY_NEW_TASK æ ‡å¿—ï¼Œåˆ™ç³»ç»Ÿä¼šå¯»æ‰¾å…¶ä»–ä»»åŠ¡æ¥å‚¨å­˜æ–° Activityã€‚è¿™é€šå¸¸æ˜¯æ–°ä»»åŠ¡ï¼Œä½†æœªåšå¼ºåˆ¶è¦æ±‚ã€‚ å¦‚æžœçŽ°æœ‰ä»»åŠ¡ä¸Žæ–° Activity å…·æœ‰ç›¸åŒå…³è”ï¼Œåˆ™ä¼šå°† Activity å¯åŠ¨åˆ°è¯¥ä»»åŠ¡ä¸­ã€‚ å¦åˆ™ï¼Œå°†å¼€å§‹æ–°ä»»åŠ¡ã€‚ å¦‚æžœæ­¤æ ‡å¿—å¯¼è‡´ Activity å¼€å§‹æ–°ä»»åŠ¡ï¼Œä¸”ç”¨æˆ·æŒ‰â€œä¸»é¡µâ€æŒ‰é’®ç¦»å¼€ï¼Œåˆ™å¿…é¡»ä¸ºç”¨æˆ·æä¾›å¯¼èˆªå›žä»»åŠ¡çš„æ–¹å¼ã€‚ æœ‰äº›å®žä½“ï¼ˆå¦‚é€šçŸ¥ç®¡ç†å™¨ï¼‰å§‹ç»ˆåœ¨å¤–éƒ¨ä»»åŠ¡ä¸­å¯åŠ¨ Activityï¼Œè€Œä»Žä¸ä½œä¸ºå…¶è‡ªèº«çš„ä¸€éƒ¨åˆ†å¯åŠ¨ Activityï¼Œå› æ­¤å®ƒä»¬å§‹ç»ˆå°† FLAG_ACTIVITY_NEW_TASK æ”¾å…¥ä¼ é€’ç»™ startActivity() çš„ Intent ä¸­ã€‚è¯·æ³¨æ„ï¼Œå¦‚æžœ Activity èƒ½å¤Ÿç”±å¯ä»¥ä½¿ç”¨æ­¤æ ‡å¿—çš„å¤–éƒ¨å®žä½“è°ƒç”¨ï¼Œåˆ™ç”¨æˆ·å¯ä»¥é€šè¿‡ç‹¬ç«‹æ–¹å¼è¿”å›žåˆ°å¯åŠ¨çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨å¯åŠ¨å™¨å›¾æ ‡ï¼ˆä»»åŠ¡çš„æ ¹ Activity å…·æœ‰ CATEGORY_LAUNCHER Intent è¿‡æ»¤å™¨ï¼›è¯·å‚é˜…ä¸‹é¢çš„å¯åŠ¨ä»»åŠ¡éƒ¨åˆ†ï¼‰ã€‚ Activity å°†å…¶ allowTaskReparenting å±žæ€§è®¾ç½®ä¸º â€œtrueâ€ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒActivity å¯ä»¥ä»Žå…¶å¯åŠ¨çš„ä»»åŠ¡ç§»åŠ¨åˆ°ä¸Žå…¶å…·æœ‰å…³è”çš„ä»»åŠ¡ï¼ˆå¦‚æžœè¯¥ä»»åŠ¡å‡ºçŽ°åœ¨å‰å°ï¼‰ã€‚ æç¤ºï¼šå¦‚æžœä»Žç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œä¸€ä¸ª .apk æ–‡ä»¶åŒ…å«å¤šä¸ªâ€œåº”ç”¨â€ï¼Œåˆ™æ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨ taskAffinity å±žæ€§å°†ä¸åŒå…³è”åˆ†é…ç»™ä¸Žæ¯ä¸ªâ€œåº”ç”¨â€ç›¸å…³çš„ Activityã€‚ æ¸…ç†è¿”å›žæ ˆå¦‚æžœç”¨æˆ·é•¿æ—¶é—´ç¦»å¼€ä»»åŠ¡ï¼Œåˆ™ç³»ç»Ÿä¼šæ¸…é™¤æ‰€æœ‰ Activity çš„ä»»åŠ¡ï¼Œæ ¹ Activity é™¤å¤–ã€‚ å½“ç”¨æˆ·å†æ¬¡è¿”å›žåˆ°ä»»åŠ¡æ—¶ï¼Œä»…æ¢å¤æ ¹ Activityã€‚ç³»ç»Ÿè¿™æ ·åšçš„åŽŸå› æ˜¯ï¼Œç»è¿‡å¾ˆé•¿ä¸€æ®µæ—¶é—´åŽï¼Œç”¨æˆ·å¯èƒ½å·²ç»æ”¾å¼ƒä¹‹å‰æ‰§è¡Œçš„æ“ä½œï¼Œè¿”å›žåˆ°ä»»åŠ¡æ˜¯è¦å¼€å§‹æ‰§è¡Œæ–°çš„æ“ä½œã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‡ ä¸ª Activity å±žæ€§ä¿®æ”¹æ­¤è¡Œä¸ºï¼š alwaysRetainTaskState å¦‚æžœåœ¨ä»»åŠ¡çš„æ ¹ Activity ä¸­å°†æ­¤å±žæ€§è®¾ç½®ä¸º â€œtrueâ€ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿåˆšæ‰æ‰€è¿°çš„é»˜è®¤è¡Œä¸ºã€‚å³ä½¿åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´åŽï¼Œä»»åŠ¡ä»å°†æ‰€æœ‰ Activity ä¿ç•™åœ¨å…¶å †æ ˆä¸­ã€‚ clearTaskOnLaunch å¦‚æžœåœ¨ä»»åŠ¡çš„æ ¹ Activity ä¸­å°†æ­¤å±žæ€§è®¾ç½®ä¸º â€œtrueâ€ï¼Œåˆ™æ¯å½“ç”¨æˆ·ç¦»å¼€ä»»åŠ¡ç„¶åŽè¿”å›žæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šå°†å †æ ˆæ¸…é™¤åˆ°åªå‰©ä¸‹æ ¹ Activityã€‚ æ¢è€Œè¨€ä¹‹ï¼Œå®ƒä¸Ž alwaysRetainTaskState æ­£å¥½ç›¸åã€‚ å³ä½¿åªç¦»å¼€ä»»åŠ¡ç‰‡åˆ»æ—¶é—´ï¼Œç”¨æˆ·ä¹Ÿå§‹ç»ˆä¼šè¿”å›žåˆ°ä»»åŠ¡çš„åˆå§‹çŠ¶æ€ã€‚ finishOnTaskLaunch æ­¤å±žæ€§ç±»ä¼¼äºŽ clearTaskOnLaunchï¼Œä½†å®ƒå¯¹å•ä¸ª Activity èµ·ä½œç”¨ï¼Œè€Œéžæ•´ä¸ªä»»åŠ¡ã€‚ æ­¤å¤–ï¼Œå®ƒè¿˜æœ‰å¯èƒ½ä¼šå¯¼è‡´ä»»ä½• Activity åœæ­¢ï¼ŒåŒ…æ‹¬æ ¹ Activityã€‚ è®¾ç½®ä¸º â€œtrueâ€ æ—¶ï¼ŒActivity ä»æ˜¯ä»»åŠ¡çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä»…é™äºŽå½“å‰ä¼šè¯ã€‚å¦‚æžœç”¨æˆ·ç¦»å¼€ç„¶åŽè¿”å›žä»»åŠ¡ï¼Œåˆ™ä»»åŠ¡å°†ä¸å¤å­˜åœ¨ã€‚å¯åŠ¨ä»»åŠ¡é€šè¿‡ä¸º Activity æä¾›ä¸€ä¸ªä»¥ â€œandroid.intent.action.MAINâ€ ä¸ºæŒ‡å®šæ“ä½œã€ä»¥ â€œandroid.intent.category.LAUNCHERâ€ ä¸ºæŒ‡å®šç±»åˆ«çš„ Intent è¿‡æ»¤å™¨ï¼Œæ‚¨å¯ä»¥å°† Activity è®¾ç½®ä¸ºä»»åŠ¡çš„å…¥å£ç‚¹ã€‚ ä¾‹å¦‚ï¼š1234567&lt;activity ... &gt; &lt;intent-filter ... &gt; &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt; &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt; &lt;/intent-filter&gt; ...&lt;/activity&gt; æ­¤ç±» Intent è¿‡æ»¤å™¨ä¼šä½¿ Activity çš„å›¾æ ‡å’Œæ ‡ç­¾æ˜¾ç¤ºåœ¨åº”ç”¨å¯åŠ¨å™¨ä¸­ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿå¯åŠ¨ Activity å¹¶åœ¨å¯åŠ¨ä¹‹åŽéšæ—¶è¿”å›žåˆ°åˆ›å»ºçš„ä»»åŠ¡ä¸­ã€‚ ç¬¬äºŒä¸ªåŠŸèƒ½éžå¸¸é‡è¦ï¼šç”¨æˆ·å¿…é¡»èƒ½å¤Ÿåœ¨ç¦»å¼€ä»»åŠ¡åŽï¼Œå†ä½¿ç”¨æ­¤ Activity å¯åŠ¨å™¨è¿”å›žè¯¥ä»»åŠ¡ã€‚ å› æ­¤ï¼Œåªæœ‰åœ¨ Activity å…·æœ‰ ACTION_MAIN å’Œ CATEGORY_LAUNCHER è¿‡æ»¤å™¨æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨å°† Activity æ ‡è®°ä¸ºâ€œå§‹ç»ˆå¯åŠ¨ä»»åŠ¡â€çš„ä¸¤ç§å¯åŠ¨æ¨¡å¼ï¼Œå³ â€œsingleTaskâ€ å’Œ â€œsingleInstanceâ€ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åƒä¸€ä¸‹å¦‚æžœç¼ºå°‘è¿‡æ»¤å™¨ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼š Intent å¯åŠ¨ä¸€ä¸ª â€œsingleTaskâ€ Activityï¼Œä»Žè€Œå¯åŠ¨ä¸€ä¸ªæ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ç”¨æˆ·èŠ±äº†äº›æ—¶é—´å¤„ç†è¯¥ä»»åŠ¡ã€‚ç„¶åŽï¼Œç”¨æˆ·æŒ‰â€œä¸»é¡µâ€æŒ‰é’®ã€‚ ä»»åŠ¡çŽ°å·²å‘é€åˆ°åŽå°ï¼Œè€Œä¸”ä¸å¯è§ã€‚çŽ°åœ¨ï¼Œç”¨æˆ·æ— æ³•è¿”å›žåˆ°ä»»åŠ¡ï¼Œå› ä¸ºè¯¥ä»»åŠ¡æœªæ˜¾ç¤ºåœ¨åº”ç”¨å¯åŠ¨å™¨ä¸­ã€‚ å¦‚æžœæ‚¨å¹¶ä¸æƒ³ç”¨æˆ·èƒ½å¤Ÿè¿”å›žåˆ° Activityï¼Œå¯¹äºŽè¿™äº›æƒ…å†µï¼Œè¯·å°† å…ƒç´ çš„ finishOnTaskLaunch è®¾ç½®ä¸º â€œtrueâ€ï¼ˆè¯·å‚é˜…æ¸…ç†å †æ ˆï¼‰ã€‚ æœ‰å…³å¦‚ä½•åœ¨æ¦‚è§ˆå±å¹•ä¸­æ˜¾ç¤ºå’Œç®¡ç†ä»»åŠ¡ä¸Ž Activity çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ¦‚è§ˆå±å¹•ã€‚]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>tips</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[homeåŽä»Žserviceé‡æ–°å¯åŠ¨activityå»¶è¿Ÿé—®é¢˜]]></title>
    <url>%2F2017%2F08%2F24%2Ftips-starting-an-activity-from-a-service-after-home-button%2F</url>
    <content type="text"><![CDATA[é—®é¢˜: åœ¨Activityç•Œé¢ï¼ŒæŒ‰ä¸‹HOMEé”®åŽï¼Œç‚¹å‡»æ‚¬æµ®å±‚æŒ‰é’®ï¼Œå†å¯åŠ¨Activityï¼Œ Activityè¦å»¶æ—¶5SåŽæ‰å‡ºæ¥ã€‚ ç»éªŒè¯ï¼Œè¿™ä¸ªé—®é¢˜ä¸æ˜¯åº”ç”¨è‡ªèº«çš„BUGã€‚é‚£æ€•è¯¥Activityæ˜¯ç©ºçš„ï¼Œä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜ Androidä¸ºäº†é¿å…åº”ç”¨åœ¨æŒ‰ä¸‹HOMEé”®é€€å‡ºåŽè¿˜å¯ä»¥å¼ºåˆ¶æŠŠè‡ªå·±å¯åŠ¨ï¼Œç‰¹æ„åŠ çš„é™åˆ¶ã€‚ åœ¨çŽ°æœ‰çš„APIæƒ…å†µä¸‹ï¼Œä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé™¤éžä½ çš„åº”ç”¨æ˜¯ä¸€ä¸ªå¯åŠ¨å™¨ï¼ˆLauncherï¼‰ï¼Œ æ·»åŠ äº†home/ launcher intent filterã€‚å¦‚æžœä½ ä¸æ˜¯å¯åŠ¨å™¨ï¼Œåˆè¦ä»Žæ‚¬æµ®å±‚å¯åŠ¨ä¸€ä¸ªActivityï¼Œå°±æŠŠè¯¥Activityä¹Ÿæ”¹æˆæ‚¬æµ®å±‚å§ 1. ä¸ä»ŽåŽå°å¯åŠ¨ Activity å‡†åˆ™ï¼šåœ¨è°·æ­Œçš„ Android API Guides ä¸­ï¼Œç‰¹æ„æé†’å¼€å‘è€…ä¸è¦åœ¨åŽå°å¯åŠ¨ activityï¼ŒåŒ…æ‹¬åœ¨ Service å’Œ BroadcastReceiver ä¸­ï¼Œè¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†é¿å…åœ¨ç”¨æˆ·æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹çªç„¶ä¸­æ–­ç”¨æˆ·æ­£åœ¨è¿›è¡Œçš„å·¥ä½œï¼Œåœ¨ http://developer.android.com/guide/practices/seamlessness.html#interrupt ä¸­æœ‰å¦‚ä¸‹è§£é‡Šï¼š That is, donâ€™t call startActivity() from BroadcastReceivers or Services running in the background. Doing so will interrupt whatever application is currently running, and result in an annoyed user. Perhaps even worse, your Activity may become a â€œkeystroke banditâ€ and receive some of the input the user was in the middle of providing to the previous Activity. Depending on what your application does, this could be bad news. 2. éœ€è¦è¿åâ€œä¸ä»ŽåŽå°å¯åŠ¨ Activityâ€å‡†åˆ™çš„ç‰¹ä¾‹ï¼šç‰¹ä¾‹ï¼šå³ä¾¿å¦‚æ­¤ï¼Œæ‰‹æœºåŽ‚å•†çš„å¼€å‘è€…ä»¬åœ¨å¼€å‘åŸºäºŽç³»ç»Ÿçº§çš„åº”ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½ä»ç„¶éœ€è¦æœ‰ä»Ž Service æˆ– BroadcastReceiver ä¸­ startActivity çš„éœ€æ±‚ï¼Œå¾€å¾€è¿™æ ·çš„å‰ææ˜¯è¿žè¿™æ ·çš„ Service æˆ– BroadcastReceiver ä¹Ÿæ˜¯ç”±ç”¨æˆ·çš„æŸäº›æ“ä½œè€Œè§¦å‘çš„ï¼ŒService æˆ– BroadcastReceiver åªæ˜¯å……å½“äº†å³å°†å¯åŠ¨ activity ä¹‹å‰çš„ä¸€äº›ä»£ç†å‚æ•°æ£€æŸ¥å·¥ä½œä»¥ä¾¿å†³å®šæ˜¯å¦éœ€è¦ start è¯¥ activityã€‚ é™¤éžæ˜¯ä¸Šè¿°ç¬”è€…æ‰€è¿°çš„ç‰¹æ®Šæƒ…å†µï¼Œåº”ç”¨å¼€å‘è€…éƒ½åº”è¯¥éµå¾ª â€œä¸è¦ä»ŽåŽå°å¯åŠ¨ Activityâ€å‡†åˆ™ã€‚ ä¸€ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œç‰¹ä¾‹ä¸­æ‰€è¿°çš„æƒ…å†µè¿˜ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“é€šè¿‡ home é”®å°†å½“å‰ activity ç½®äºŽåŽå°æ—¶ï¼Œä»»ä½•åœ¨åŽå°startActivity çš„æ“ä½œéƒ½å°†ä¼šå»¶è¿Ÿ 5 ç§’ï¼Œé™¤éžè¯¥åº”ç”¨èŽ·å–äº† â€œandroid.permission.STOP_APP_SWITCHESâ€ æƒé™ã€‚ å…³äºŽå»¶è¿Ÿ 5 ç§’çš„æ“ä½œåœ¨ com.android.server.am.ActivityManagerService ä¸­çš„ stopAppSwitches() æ–¹æ³•ä¸­ï¼Œç³»ç»Ÿçº§çš„åº”ç”¨å½“èŽ·å–äº† â€œandroid.permission.STOP_APP_SWITCHESâ€ åŽå°†ä¸ä¼šè°ƒç”¨åˆ°è¿™ä¸ªæ–¹æ³•æ¥å»¶è¿Ÿé€šè¿‡åŽå°å¯åŠ¨ activity çš„æ“ä½œï¼Œäº‹å®žä¸Š android åŽŸç”Ÿçš„ Phone åº”ç”¨å°±æ˜¯è¿™æ ·çš„æƒ…å†µï¼Œå®ƒæ˜¯ä¸€ä¸ªèŽ·å–äº†â€android.permission.STOP_APP_SWITCHESâ€ æƒé™çš„ç³»ç»Ÿçº§åº”ç”¨ï¼Œå½“æœ‰æ¥ç”µæ—¶ï¼Œä¸€ä¸ªä»ŽåŽå°å¯åŠ¨çš„ activity å°†çªç„¶å‡ºçŽ°åœ¨ç”¨æˆ·çš„é¢å‰ï¼Œè­¦é†’ç”¨æˆ·æœ‰æ–°çš„æ¥ç”µï¼Œè¿™æ ·çš„è®¾è®¡æ˜¯åˆç†çš„ã€‚ æ‰€ä»¥ï¼Œå½“ä½ éœ€è¦å¼€å‘ç±»ä¼¼ Phone è¿™æ ·çš„åº”ç”¨æ—¶ï¼Œéœ€è¦åšå¦‚ä¸‹å·¥ä½œï¼š root ä½ çš„æ‰‹æœºï¼› åœ¨ AndroidManifest.xml ä¸­æ·»åŠ  â€œandroid.permission.STOP_APP_SWITCHESâ€ ç”¨æˆ·æƒé™ï¼› å°†ä½ å¼€å‘çš„åº”ç”¨ç¨‹åº push åˆ°æ‰‹æœºçš„ /system/app ç›®å½•ä¸­ã€‚ 3. å‚è€ƒèµ„æ–™ï¼šæ— ç¼çš„è®¾è®¡ä¹‹â€”â€”ä¸è¦ä¸­æ–­ä½ çš„ç”¨æˆ· stackoverflow ä¸­å…³äºŽåŽå° startActivity è¢«å»¶è¿Ÿ 5 ç§’çš„æŽ¢è®¨]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>tips</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linuxä¸‹Cå¼€å‘ä½¿ç”¨å°æŠ€å·§]]></title>
    <url>%2F2017%2F08%2F06%2Ftips-c-language%2F</url>
    <content type="text"><![CDATA[æž¶æž„ç±»Linux Cä»£ç å®žçŽ°ä¸»å‡½æ•°å‚æ•°é€‰é¡¹è§£æž1. æ‰‹åŠ¨è§£æžç‰ˆæœ¬ä½¿ç”¨argcã€argvï¼Œé€ä¸ªå­—ç¬¦æ¯”è¾ƒï¼Œå¾—åˆ°è¦æƒ³çš„å‚æ•°åå­—å³è¿›è¡Œåˆ¤æ–­ã€è§£æžã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;ctype.h&gt;int debug;void show_version(char* name)&#123; printf(&quot;%s by Late Lee, version: 1.0\n&quot;, name);&#125;void usage(char* name)&#123; show_version(name); printf(&quot; -h, --help short help\n&quot;); printf(&quot; -v, --version show version\n&quot;);&#125;int main(int argc, char *argv[])&#123; int i = 0; /* early check for debug and config parameter */ if (argc &gt; 1) &#123; for (i = 1; i &lt; argc; i++) &#123; if ((strcmp(argv[i], &quot;-D&quot;)==0) || (strcmp(argv[i], &quot;--debug&quot;)==0)) &#123; debug = 1; &#125; &#125; &#125; // /* parse parameters, maybe not the best way but... */ for (i = 1; i &lt; argc; i++) &#123; if (debug) printf(&quot;arg %d: \&quot;%s\&quot;\n&quot;,i,argv[i]); // help if ((strcmp(argv[i],&quot;-h&quot;)==0) || (strcmp(argv[i],&quot;--help&quot;)==0)) &#123; usage(argv[0]); return 0; &#125; // version else if ((strcmp(argv[i],&quot;-v&quot;)==0) || (strcmp(argv[i],&quot;--version&quot;)==0)) &#123; show_version(argv[0]); return 0; &#125; // debug else if ((strcmp(argv[i],&quot;-D&quot;)==0) || (strcmp(argv[i],&quot;--debug&quot;)==0)) &#123; debug=1; &#125; else if ((strcmp(argv[i],&quot;fpga&quot;)==0)) &#123; printf(&quot;test of fpga...\n&quot;); &#125; // string else if ((strcmp(argv[i],&quot;-i&quot;)==0) || (strcmp(argv[i],&quot;--iface&quot;)==0)) &#123; if (i+1&lt;argc) &#123; char interface[32] = &#123;0&#125;; strncpy(interface, argv[i+1], 32); if (debug) printf(&quot;Used interface: %s\n&quot;, interface); i++; continue; &#125; else &#123; printf(&quot;Error: Interface for -i missing.\n&quot;); return 1; &#125; &#125; // number else if ((strcmp(argv[i],&quot;-ru&quot;)==0) || (strcmp(argv[i],&quot;--rateunit&quot;))==0) &#123; if (i+1&lt;argc &amp;&amp; isdigit(argv[i+1][0])) &#123; int rateunit = 0; rateunit = atoi(argv[i+1]); if (rateunit &lt; 0 || rateunit &gt; 1) &#123; printf(&quot;Error: Invalid parameter \&quot;%d\&quot; for --rateunit.\n&quot;, rateunit); printf(&quot; Valid parameters:\n&quot;); printf(&quot; 0 - bytes\n&quot;); printf(&quot; 1 - bits\n&quot;); return 1; &#125; if (debug) printf(&quot;Rateunit changed: %d\n&quot;, rateunit); i++; continue; &#125; else &#123; &#125; &#125; // only one else if (strcmp(argv[i],&quot;--enable&quot;)==0) &#123; int enable = 0; enable = 1; &#125; else &#123; printf(&quot;Unknown parameter \&quot;%s\&quot;. Use --help for help.\n&quot;,argv[i]); return 1; &#125; &#125;&#125; 2. åˆ©ç”¨getoptå‡½æ•°å®Œæˆ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140/**è§£æžå‘½ä»¤é€‰é¡¹ç¤ºä¾‹#include &lt;unistd.h&gt;extern char *optarg; //é€‰é¡¹çš„å‚æ•°æŒ‡é’ˆextern int optind, //ä¸‹ä¸€æ¬¡è°ƒç”¨getoptçš„æ—¶ï¼Œä»Žoptindå­˜å‚¨çš„ä½ç½®å¤„é‡æ–°å¼€å§‹æ£€æŸ¥é€‰é¡¹ã€‚extern int opterr, //å½“opterr=0æ—¶ï¼Œgetoptä¸å‘stderrè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚extern int optopt; //å½“å‘½ä»¤è¡Œé€‰é¡¹å­—ç¬¦ä¸åŒ…æ‹¬åœ¨optstringä¸­æˆ–è€…é€‰é¡¹ç¼ºå°‘å¿…è¦çš„å‚æ•°æ—¶ï¼Œè¯¥é€‰é¡¹å­˜å‚¨åœ¨optoptä¸­ï¼Œgetoptè¿”å›ž&apos;ï¼Ÿâ€™ã€int getopt(int argc, char * const argv[], const char *optstring);ä½¿ç”¨ï¼š$ ./a.out -Wall -o hello.c*/#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;stdarg.h&gt;int debug_level = 0;#define _AUTHOR &quot;Late Lee&quot;#define _VERSION_STR &quot;1.0&quot;#define _DATE &quot;&quot;// é»˜è®¤æ‰“å°errorç­‰çº§enum&#123; MSG_ERROR = 0, MSG_WARNING, MSG_INFO, MSG_DEBUG, MSG_MSGDUMP, MSG_EXCESSIVE,&#125;;void ll_printf(int level, const char *fmt, ...) __attribute__ ((format (printf, 2, 3)));void ll_printf(int level, const char *fmt, ...)&#123; va_list ap; va_start(ap, fmt); if (debug_level &gt;= level) &#123;#ifdef CONFIG_DEBUG_SYSLOG if (wpa_debug_syslog) &#123; vsyslog(syslog_priority(level), fmt, ap); &#125; else &#123;#endif /* CONFIG_DEBUG_SYSLOG */ //debug_print_timestamp();#ifdef CONFIG_DEBUG_FILE if (out_file) &#123; vfprintf(out_file, fmt, ap); fprintf(out_file, &quot;\n&quot;); &#125; else &#123;#endif /* CONFIG_DEBUG_FILE */ vprintf(fmt, ap); printf(&quot;\n&quot;);#ifdef CONFIG_DEBUG_FILE &#125;#endif /* CONFIG_DEBUG_FILE */#ifdef CONFIG_DEBUG_SYSLOG &#125;#endif /* CONFIG_DEBUG_SYSLOG */ &#125; va_end(ap);&#125;void show_version(char* name)&#123; printf(&quot;%s by %s, version: %s\n&quot;, name, _AUTHOR, _VERSION_STR);&#125;void usage(char* name)&#123; show_version(name); printf(&quot; -h, short help\n&quot;); printf(&quot; -v, show version\n&quot;); printf(&quot; -d, debug level\n&quot;); exit(0);&#125;const char* my_opt = &quot;hOo:W:d:&quot;;int main(int argc, char *argv[])&#123; int c; const char* p1 = NULL; const char* p2 = NULL; const char* p3 = NULL; while(1) &#123; c = getopt(argc, argv, my_opt); printf(&quot;optind: %d\n&quot;, optind); if (c &lt; 0) &#123; break; &#125; printf(&quot;option char: %x %c\n&quot;, c, c); switch(c) &#123; case &apos;d&apos;: debug_level = atoi(optarg); printf(&quot;debug level: %d\n&quot;, debug_level); break; case &apos;O&apos;: printf(&quot;optimization flag is open.\n\n&quot;); break; case &apos;o&apos;: printf(&quot;the obj is: %s\n\n&quot;, optarg); p1 = optarg; break; case &apos;W&apos;: printf(&quot;optarg: %s\n\n&quot;, optarg); p2 = optarg; break; case &apos;:&apos;: fprintf(stderr, &quot;miss option char in optstring.\n&quot;); break; case &apos;?&apos;: case &apos;h&apos;: default: usage(argv[0]); break; //return 0; &#125; &#125; if (optind == 1) &#123; usage(argv[0]); &#125; ll_printf(MSG_ERROR, &quot;p1: %s p2: %s\n&quot;, p1, p2); return 0;&#125; ç½‘ç»œæ¨¡å—æ—¥å¿—æ¨¡å—è¯»å–é…ç½®æ–‡ä»¶æ¨¡å—å†…å­˜æ± æ¨¡å—ç¼“å­˜åº“æ¨¡å—æ–‡ä»¶ç³»ç»Ÿæ¨¡å—ç®¡ç†åŽå°æ¨¡å—æ•°æ®åº“æ¨¡å—æŠ€å·§ç±»Linuxç¨‹åºä¸­é¢„å®šä¹‰çš„å‡ ä¸ªè°ƒè¯•å®Linuxä¸‹Cè¯­è¨€ç¼–ç¨‹ä¸­æœ‰å‡ ä¸ªå¾ˆå®žç”¨çš„è°ƒè¯•å® 1__LINE__ __FILE__ __FUNCTION__ __TIME__ __DATA__ è¿™å‡ ä¸ªé¢„å®šä¹‰å®æ˜¯å±žäºŽANSIæ ‡å‡†çš„ï¼Œå†…ç½®äºŽç¼–è¯‘å™¨ï¼Œå…¨å±€æ€§çš„å˜é‡ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®žçŽ°ä»£ç è·Ÿè¸ªè°ƒè¯•ï¼Œä¸æ˜¯åœ¨å“ªä¸ªå¤´æ–‡ä»¶ä¸­åŒ…å«çš„ï¼Œè§ä¸‹ä¾‹ï¼š 1234567891011#include &lt;stdio.h&gt;int main()&#123; printf(&quot;The file is %s.\n&quot;,__FILE__); printf( &quot;The date is %s.\n&quot;, __DATE__ ); printf( &quot;The time is %s.\n&quot;, __TIME__ ); printf( &quot;This is line %d.\n&quot;, __LINE__ ); printf( &quot;This function is %s.\n&quot;, __FUNCTION__ ); return 0;&#125; è¿è¡Œç»“æžœ: 12345The file is macro.c.The date is Aug 24 2012.The time is 23:13:26.This is line 8.This function is main. line è¡Œæ•° æ–‡ä»¶åæŒ‡ä»¤å¯ä»¥æ”¹å˜å®ƒçš„å€¼ï¼Œç®€å•çš„è®²ï¼Œç¼–è¯‘æ—¶ï¼Œå®ƒä»¬åŒ…å«ç¨‹åºçš„å½“å‰è¡Œæ•°å’Œæ–‡ä»¶åã€‚ DATE å®æŒ‡ä»¤å«æœ‰å½¢å¼ä¸ºæœˆ/æ—¥/å¹´çš„ä¸²,è¡¨ç¤ºæºæ–‡ä»¶è¢«ç¿»è¯‘åˆ°ä»£ç æ—¶çš„æ—¥æœŸã€‚ TIME å®æŒ‡ä»¤åŒ…å«ç¨‹åºç¼–è¯‘çš„æ—¶é—´ã€‚æ—¶é—´ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå…¶å½¢å¼ä¸ºæ—¶ï¼šåˆ†ï¼šç§’ __func__ä»£è¡¨è¿™æ¡è¯­å¥æ‰€åœ¨çš„å‡½æ•°çš„å‡½æ•°å è”åˆä½“ç”¨é€”å­—èŠ‚åºæœ‰ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ï¼šå¤§ç«¯æ³•ï¼ˆbig endingï¼‰ï¼Œå°ç«¯æ³•ï¼ˆlittle endingï¼‰ã€‚ç½‘ç»œå­—èŠ‚åºé‡‡ç”¨çš„æ˜¯å¤§ç«¯æ³•ã€‚ä¸»æœºå­—èŠ‚åºä¸åŒçš„CPUé‡‡ç”¨çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä»£ç æ¥æŸ¥çœ‹è‡ªå·±ä¸»æœºçš„å­—èŠ‚åºã€‚ å¤§ç«¯æ³•ï¼šé«˜ä½å­—èŠ‚æŽ’æ”¾åœ¨å†…å­˜ä½Žåœ°å€ç«¯ï¼Œä½Žä½å­—èŠ‚æŽ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚ å°ç«¯æ³•ï¼šä½Žä½å­—èŠ‚æŽ’æ”¾åœ¨å†…å­˜çš„ä½Žåœ°å€ç«¯ï¼Œé«˜ä½å­—èŠ‚æŽ’æ”¾åœ¨å†…å­˜çš„é«˜åœ°å€ç«¯ã€‚ çœ‹ä¸€ä¸ªunsigned short æ•°æ®ï¼Œå®ƒå 2ä¸ªå­—èŠ‚ï¼Œç»™å®ƒèµ‹å€¼0x1234ã€‚ è‹¥é‡‡ç”¨çš„å¤§ç«¯æ³•ï¼Œåˆ™å…¶ä½Žåœ°å€ç«¯åº”è¯¥å­˜æ”¾çš„æ˜¯0x12ï¼› è‹¥é‡‡ç”¨çš„å°ç«¯æ³•ï¼Œåˆ™å…¶ä½Žåœ°å€ç«¯åº”è¯¥å­˜æ”¾çš„æ˜¯0x34ï¼› å¯ä»¥é€šè¿‡è”åˆä½“æ¥èŽ·å¾—å…¶é«˜ä½Žåœ°å€çš„æ•°æ®ã€‚æµ‹è¯•ä¸»æœºå­—èŠ‚åºçš„ä»£ç ï¼š123456789101112131415161718192021typedef union&#123; unsigned short value; unsigned char bytes[2];&#125;Test;int main(void)&#123; Test test_value; test_value.value = 0x1234; if(test_value.bytes[0] == 0x12 &amp;&amp; test_value.bytes[1] == 0x34) &#123; printf(&quot;big ending&quot;); &#125; else if(test_value.bytes[0] == 0x34 &amp;&amp; test_value.bytes[1] == 0x12) &#123; printf(&quot;little ending&quot;); &#125;else&#123; printf(&quot;use test_value error&quot;); &#125; return 0;&#125; å·¥å…·ç±»è‡ªå®šä¹‰æ—¥å¿—çš„è°ƒè¯•æ‰“å°ä¿¡æ¯12345678910111213141516171819202122232425#define TRACE_NONE 0#define TRACE_FATAL 1#define TRACE_ERROR 2#define TRACE_WARNING 3#define TRACE_INFO 4#define TRACE_DEBUG 5#define TRACE_LEN_MAX 64extern int *TraceLevel;extern char TraceName[TRACE_LEN_MAX + 1];#define Log(A, format,args...) \ ((TraceLevel == NULL || TraceName == NULL || *TraceLevel &lt; (A)) ? 0 : LogMsg(A, __FILE__, __LINE__, format, ##args))#define LogFatal(format,args...) \ Log(TRACE_FATAL, format, ##args)#define LogError(format,args...) \ Log(TRACE_ERROR, format, ##args)#define LogWarning(format,args...) \ Log(TRACE_WARNING, format, ##args)#define LogInfo(format,args...) \ Log(TRACE_INFO, format, ##args)#define LogDebug(format,args...) \ Log(TRACE_DEBUG, format, ##args) 12345678910111213141516171819202122232425262728293031int LogMsg(int level, const char *filename, int line, const char *fmt, ...)&#123; va_list ap; FILE *fp; char sLogFile[128 + 1]; char sCurrTime[6 + 1]; struct timeb tTimeB; char sMilliTM[4]; memset(sLogFile, 0, sizeof(sLogFile)); LogFile(sLogFile); GetTime_HHMMSS(sCurrTime); memset(&amp;tTimeB, 0, sizeof(tTimeB)); ftime(&amp;tTimeB); snprintf(sMilliTM, sizeof(sMilliTM), &quot;%03d&quot;, tTimeB.millitm); fp = fopen(sLogFile, &quot;a+&quot;); if (fp != (FILE*)NULL) &#123; fprintf(fp, &quot;[%08d][%.6s:%.3s][%16s][%04d][%7s]&quot;, getpid(), sCurrTime, sMilliTM, filename, line, g_LevelDsp[level]); va_start(ap, fmt); vfprintf(fp, fmt, ap); va_end(ap); fprintf(fp, &quot;\n&quot;); fflush(fp); fclose(fp); &#125; return 0;&#125; å†åœ¨åŽå°è¿›ç¨‹ä¸­è®¾ç½®TraceLevelå’ŒTraceNameå³å¯ã€‚ èŽ·å–å½“å‰ç³»ç»Ÿæ—¥æœŸã€æ—¶é—´12345678910111213141516171819202122232425/***************************************************************************** ** å‡½æ•°åç§°: GetDate ** åŠŸèƒ½æè¿°: å–å½“å‰ç³»ç»Ÿæ—¥æœŸ ** å½“å‰ç‰ˆæœ¬: 1.0.0.0 ** ä½œ è€…: ** ä¿® æ”¹ï¼š ** è¾“å…¥å‚æ•°: ** è¾“å‡ºå‚æ•°: char * psDate -- ç³»ç»Ÿæ—¥æœŸ, æ ¼å¼ä¸ºyyyymmdd ** è¿”å›žç»“æžœï¼šint 0 ---&gt; æˆåŠŸ ****************************************************************************/int GetDate(char * psDate)&#123; time_t nSeconds; struct tm * pTM; time(&amp;nSeconds); pTM = localtime(&amp;nSeconds); /* ç³»ç»Ÿæ—¥æœŸ, æ ¼å¼ï¼šYYYYMMDD */ sprintf( psDate,&quot;%04d%02d%02d&quot;, pTM-&gt;tm_year + 1900, pTM-&gt;tm_mon + 1,pTM-&gt;tm_mday ); return 0;&#125; 12345678910111213141516171819202122232425/***************************************************************************** ** å‡½æ•°åç§°: GetTime ** åŠŸèƒ½æè¿°: å–å½“å‰ç³»ç»Ÿæ—¶é—´ ** å½“å‰ç‰ˆæœ¬: 1.0.0.0 ** ä½œ è€…: ** ä¿® æ”¹ï¼š ** è¾“å…¥å‚æ•°: ** è¾“å‡ºå‚æ•°: char * psTime -- ç³»ç»Ÿæ—¶é—´, æ ¼å¼ä¸ºHHMMSS ** è¿”å›žç»“æžœï¼šint 0 ---&gt; æˆåŠŸ ****************************************************************************/int GetTime(char * psTime)&#123; time_t nSeconds; struct tm * pTM; time(&amp;nSeconds); pTM = localtime(&amp;nSeconds); /* ç³»ç»Ÿæ—¶é—´, æ ¼å¼ï¼šHHMMSS */ sprintf( psTime,&quot;%02d%02d%02d&quot;, pTM-&gt;tm_hour,pTM-&gt;tm_min, pTM-&gt;tm_sec); return 0;&#125; 1234567891011121314151617181920212223242526/***************************************************************************** ** å‡½æ•°åç§°: GetDateTime ** åŠŸèƒ½æè¿°: å–å½“å‰ç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´ ** å½“å‰ç‰ˆæœ¬: 1.0.0.0 ** ä½œ è€…: ** ä¿® æ”¹ï¼š ** è¾“å…¥å‚æ•°: ** è¾“å‡ºå‚æ•°: char * psDateTime -- ç³»ç»Ÿæ—¥æœŸæ—¶é—´, æ ¼å¼ä¸ºyyyymmddHHMMSS ** è¿”å›žç»“æžœï¼šint 0 ---&gt; æˆåŠŸ ****************************************************************************/int GetDateTime(char * psDateTime)&#123; time_t nSeconds; struct tm * pTM; time(&amp;nSeconds); pTM = localtime(&amp;nSeconds); /* ç³»ç»Ÿæ—¥æœŸå’Œæ—¶é—´, æ ¼å¼ï¼šyyyymmddHHMMSS */ sprintf( psDateTime,&quot;%04d%02d%02d%02d%02d%02d&quot;, pTM-&gt;tm_year + 1900, pTM-&gt;tm_mon + 1,pTM-&gt;tm_mday, pTM-&gt;tm_hour,pTM-&gt;tm_min, pTM-&gt;tm_sec ); return 0;&#125; è°ƒç”¨çš„æ—¶å€™å®šä¹‰ä¸€ä¸ªcharæ•°ç»„ï¼Œå¤§å°ä¸ºæ—¥æœŸçš„é•¿åº¦å¤§å°åŠ 1ï¼Œç„¶åŽç›´æŽ¥è°ƒç”¨ä¸Šé¢çš„å‡½æ•°ï¼Œå‚æ•°ä¸ºæ•°ç»„åå³å¯ã€‚ å½“ç„¶ï¼Œè¿˜æœ‰å…¶ä»–è®¸å¤šå…³äºŽæ—¥æœŸã€æ—¶é—´æ“ä½œçš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸åŒæ—¥æœŸã€æ—¶é—´æ ¼å¼é—´çš„è½¬æ¢ç­‰ã€‚]]></content>
      <categories>
        <category>language</category>
      </categories>
      <tags>
        <tag>tips</tag>
        <tag>language</tag>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[FQA]]></title>
    <url>%2F2017%2F07%2F25%2FFQA%2F</url>
    <content type="text"><![CDATA[sshè¿žæŽ¥æœåŠ¡å™¨å‡ºé”™12345678910111213@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED! @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!Someone could be eavesdropping on you right now (man-in-the-middle attack)!It is also possible that a host key has just been changed.The fingerprint for the RSA key sent by the remote host isda:f7:3e:ba:f7:00:e6:44:76:f2:58:6e:48:**.Please contact your system administrator.Add correct host key in /ç”¨æˆ·homeç›®å½•/.ssh/known_hosts to get rid of this message.Offending RSA key in /ç”¨æˆ·homeç›®å½•/.ssh/known_hosts:1RSA host key for ipåœ°å€ has changed and you have requested strict checking.Host key verification failed. å‡ºçŽ°è¿™ä¸ªé—®é¢˜çš„åŽŸå› æ˜¯,ç¬¬ä¸€æ¬¡ä½¿ç”¨SSHè¿žæŽ¥æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè®¤è¯ï¼Œå‚¨å­˜åœ¨å®¢æˆ·ç«¯çš„known_hostsä¸­. å¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æŸ¥çœ‹: 1ssh-keygen -l -f ~/.ssh/known_hosts ç”±äºŽæœåŠ¡å™¨é‡æ–°å®‰è£…ç³»ç»Ÿäº†ï¼Œæ‰€ä»¥ä¼šå‡ºçŽ°ä»¥ä¸Šé”™è¯¯ã€‚ è§£å†³åŠžæ³•: 1ssh-keygen -R æœåŠ¡å™¨ç«¯çš„ipåœ°å€ æˆ–è€…ç›´æŽ¥åœ¨known_hostsä¸­åˆ é™¤å¯¹åº”ipçš„è¡Œ]]></content>
  </entry>
  <entry>
    <title><![CDATA[Webrtcçº¿ç¨‹æ¨¡åž‹]]></title>
    <url>%2F2017%2F07%2F23%2Fwebrtc-source-thread%2F</url>
    <content type="text"><![CDATA[webrtcçš„baseçš„ threadï¼Œæ˜¯æˆ‘è§è¿‡çš„å°è£…æœ€å¸…çš„c++çº¿ç¨‹åº“ï¼Œæ ¹æ®æ¯”qtçš„è¿˜å¥½ç”¨,å‘ä¸ªä¾‹å­ç»™ä½  1234567891011121314151617181920212223242526 using namespace webrtc;using namespace rtc;//std::cout&lt;&lt;&quot;Thread::Current()ï¼š&quot; &lt;&lt; Thread::Current()-&gt;GetId();//Thread::Current()-&gt;Start(); ä¸èƒ½è°ƒç”¨startï¼Œå› ä¸ºä¸æ˜¯æˆ‘åˆ›å»ºçš„ï¼Œä»–å·²ç»å¼€å§‹äº† //Thread::Current()-&gt;Run(); //é˜»å¡žå½“å‰çº¿ç¨‹è¿›å…¥çº¿ç¨‹å¾ªçŽ¯Thread * thread = new Thread();//MyRunnable run;//thread-&gt;Start(&amp;run);//å¯ä»¥å¸¦ä¸€ä¸ªRunnableå‚æ•°è¿è¡Œ,è¿è¡Œå®Œå°±ç»“æŸï¼Œå¦åˆ™è¿è¡ŒThread::Runè¿›å…¥æ¶ˆæ¯å¾ªçŽ¯thread-&gt;Start();//std::cout &lt;&lt; &quot;Thread::Invoke()ï¼š&quot;&lt;&lt; thread-&gt;Invoke&lt;bool&gt;(RTC_FROM_HERE, &amp;task)&lt;&lt; &quot; at &quot; &lt;&lt; Thread::Current()-&gt;GetId() &lt;&lt; std::endl;thread-&gt;Post(RTC_FROM_HERE, Bind(task2));//å°†æœ€å¸¸ç”¨çš„auto handler= new MessageClient;//thread-&gt;PostAt(RTC_FROM_HERE, (int64_t)3000,handler);//thread-&gt;PostDelayed(RTC_FROM_HERE, (int64_t)5000, handler);//thread-&gt;Stop();Thread * thread2 = new Thread();thread2-&gt;Start();thread2-&gt;Post(RTC_FROM_HERE, Bind(task2));//å°†æœ€å¸¸ç”¨çš„//thread2-&gt;Invoke() éžå¸¸æœ‰ç”¨ï¼Œåœ¨ä»»ä½•åœ°æ–¹å¯ä»¥æŒ‡å®šæˆ‘çš„ä»£ç è¿è¡Œåœ¨æŸä¸ªçº¿ç¨‹//apiä¸‹çš„proxyæœºåˆ¶ï¼Œå®žé™…ä¸Šå°±æ˜¯è®¾ç½®è¦æ‰§è¡Œçš„çº¿ç¨‹ï¼Œç„¶åŽåŠ é”ç­‰å¾…çº¿ç¨‹æ‰§è¡Œç»“æžœã€‚è¿™æ˜¯æˆ‘è®¾è®¡å¯¹å¤–æŽ¥å£å¯ä»¥åœ¨ä»»ä½•çº¿ç¨‹è°ƒç”¨è€Œä¸å‡ºé”™çš„å¸¸ç”¨æ–¹æ³•//baseçš„asyncinvokerä¸Žproxyç±»ä¼¼çš„æœºåˆ¶ã€‚ æœ‰iosçš„gdcï¼Œandroidçš„handlerå¼‚æ›²åŒå·¥ å› ä¸ºç¼–å†™å¤æ‚ç¨³å®šçš„å¤šçº¿ç¨‹C++é¡¹ç›®å®žåœ¨å¤ªéš¾ï¼Œæ‰€ä»¥ä¸€ä¸ªå¥½çš„è·¨å¹³å°C++åŸºç¡€åº“æ˜¯æˆ‘æœ€æ±‚çš„ç›®æ ‡,ç›®å‰æ¯”è¾ƒæ¬£èµçš„é¡¹ç›®æœ‰ï¼š Boost:å¤§è€Œå…¨ï¼Œç¼ºå°‘ä¸€äº›å¯ä»¥ç›´æŽ¥ä¸Šæ‰‹çš„ä¸œè¥¿å¦‚çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ™ºèƒ½æŒ‡é’ˆå¹¶éžçº¿ç¨‹å®‰å…¨ã€‚ QT coreï¼šéžå¸¸å¥½ C++11ï¼šä¹Ÿéœ€è¦çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ï¼Œçº¿ç¨‹å®‰å…¨æ™ºèƒ½æŒ‡é’ˆã€‚ chromiumçš„baseåº“ï¼šå¤ªå¤§äº† å½“æˆ‘çœ‹åˆ°webrtcçš„baseæ—¶ï¼Œéžå¸¸æƒŠè®¶çš„å‘çŽ°å®ƒæ­£æ˜¯æˆ‘æƒ³è¦çš„,ç‰¹ç‚¹ï¼š å°ï¼šåªæœ‰å‡ M çº¯ï¼šåŸºäºŽc++æ ‡å‡†åº“å’Œå„æ“ä½œç³»ç»Ÿsdk è·¨å¹³å° å¯¹æ™ºèƒ½æŒ‡é’ˆã€çº¿ç¨‹ã€socketå°è£…éžå¸¸å¥½ã€‚ ä¸æ–­æ›´æ–°ï¼ˆéœ€è¦ä¸€ç›´è·Ÿè¸ªå®˜æ–¹ä»£ç ï¼‰ ç§»æ¤å‡ºæ¥å•ç‹¬ä½¿ç”¨ï¼Œæ–¹æ¡ˆæœ‰ä¸‰ï¼š æŠŠæºç æ‹·è´å‡ºæ¥ç”¨é€šç”¨çš„ç¼–è¯‘å·¥å…·ï¼ˆmakefileï¼Œcmakeï¼Œqmakeï¼‰ç®¡ç†ã€‚ï¼ˆmakefileè¾ƒå¤æ‚ï¼Œcmakeç®€å•ï¼Œqmakeæœ€ç®€å•ï¼‰ æŠŠæºç æ‹·è´å‡ºæ¥ç”¨åŸºäºŽè‡ªå¸¦çš„gnç®¡ç† åœ¨webrtcé¡¹ç›®é‡Œé¢ç¼–è¯‘å’Œåˆå¹¶éœ€è¦çš„é™æ€åº“å’Œpdb å› ä¸ºgoogleå®˜æ–¹è¯´äº†ï¼šå¼•ç”¨è®¡æ•°+å¼•ç”¨è®¡æ•°çš„æ™ºèƒ½åŒ–ï¼ˆscoped_ref_ptrï¼‰+å¼±å¼•ç”¨å°±å¯ä»¥è§£å†³é—®é¢˜ã€‚ shared_pträ¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºshared_ptræœ‰ä¸¤ä¸ªæˆå‘˜ï¼šå¼•ç”¨è®¡æ•°ï¼Œå’Œæºå¯¹è±¡æŒ‡é’ˆã€‚æ²¡åŠžæ³•å¯¹ä¸¤ä¸ªæˆå‘˜åŒæ—¶å®žçŽ°åŽŸå­æ“ä½œã€‚ ä½†unique_ptræ˜¯ä¸ªå¥½ä¸œè¥¿ æ™ºèƒ½æŒ‡é’ˆçš„ä½¿ç”¨ï¼š ä¸ç”¨å†ä½¿ç”¨deleteã€‚ å°½é‡ä½¿ç”¨unique_ptrã€‚ å¤šä¸ªçº¿ç¨‹è¯»å†™åŒä¸€ä¸ª shared_ptr å¯¹è±¡ï¼Œé‚£ä¹ˆéœ€è¦åŠ é”ã€‚ shared_ptr å’Œweak_ptré…åˆè§£å†³å¾ªçŽ¯å¼•ç”¨çš„é—®é¢˜ã€‚ weak_ptrå¿…é¡»ï¼Œocï¼Œswiftçš„ViewControlerå’ŒæŽ§ä»¶éƒ½æ˜¯weakå…³ç³» å†…å­˜ç®¡ç†æ¨¡åž‹çš„ä¸‰ç§çº§åˆ«ï¼š 1 æ‰‹åŠ¨å†…å­˜ç®¡ç†(c/c++çš„mallocä¸Žfreeï¼Œnewä¸Ždelete)ï¼šå®¹æ˜“å‡ºé”™ã€‚ 2 è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼ˆocçš„arcï¼Œc++çš„æ™ºèƒ½æŒ‡é’ˆï¼Œscoped_ptrï¼‰ï¼šå­˜åœ¨å¾ªçŽ¯å¼•ç”¨é—®é¢˜ï¼Œé€šè¿‡ç¨‹åºå‘˜è‡ªå·±ç®¡ç†å¼ºå¼±å¼•ç”¨å…³ç³»è§£å†³ã€‚ 3 åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆå¦‚java,pythonï¼‰ï¼šåŽå°GCé™ä½Žäº†ç¨‹åºæ•ˆçŽ‡ï¼Œå¥½çš„ç¨‹åºå‘˜ä»ç„¶å¥½è€ƒè™‘javaçš„å¼ºå¼•ç”¨[è¡¨æƒ…]å¼•ç”¨/è½¯å¼•ç”¨/ 3 çº¿ç¨‹æ¨¡åž‹ 1 ç”Ÿäº§è€…æ¶ˆè´¹æ¨¡åž‹ï¼ˆmutexï¼Œconditionï¼‰ï¼šæœ€æœ€å¸¸ç”¨çš„æ¨¡åž‹ã€‚ 2 çº¿ç¨‹æ± æ¨¡åž‹ï¼šè§£å†³å¤§é‡è¯·æ±‚åˆ†é…å¤ªå¤šçº¿ç¨‹çš„é—®é¢˜ã€‚æ¯”å¦‚ä¸€ä¸ªandroidå’Œiosçš„appï¼Œhttpè¯·æ±‚ä¼šå¾ˆå¤šå¾ˆå¤šã€‚ 3 (ç€é‡å¼ºè°ƒï¼‰ä¸²è¡Œæ¨¡åž‹ï¼šiosæœ‰GCD(Grand Central Dispatchï¼Œglobal queueæ˜¯çº¿ç¨‹æ± ï¼‰ï¼Œandroidæœ‰looperï¼Œ win32æœ‰PostMessageï¼Œboostæœ‰strand è¯»å†™é”ï¼šç‰¹åˆ«åªæœ‰å†™æ‰ä¼šä¸å®‰å…¨çš„æƒ…å†µã€‚ å†ç»“åˆå…¶ä»–çš„æ‰‹æ®µä¼šè®©ç¨‹åºç®€æ´ä¼˜ç¾Žæ˜“è¯»ï¼šjavaçš„handlerï¼Œocçš„delegateå’Œblockã€swiftçš„é—­åŒ…ï¼Œmvcæ¨¡å¼ ï¼Œc++çš„function/bind/lambdaï¼Œpythonå’Œjavascriptçš„function è€Œä¸²è¡Œæ¨¡åž‹å°±æˆäº†è§£å†³è¿™ç±»å¤šçº¿ç¨‹é—®é¢˜çš„é¦–é€‰ï¼Œå°±æ˜¯çº¿ç¨‹æ¶ˆæ¯æ¨¡åž‹ã€‚ åœ¨android ç³»ç»Ÿé‡Œé¢ï¼Œæ— æ•°è¿™æ ·çš„ä¾‹å­ã€‚ æ¨¡å—å¤„ç†çº¿ç¨‹Callæž„é€ æ–¹æ³•ä¸­åˆ›å»ºmodule_process_threadä¸Žpacer_threadä¸¤ä¸ªProcessThread.æŽ¥ç€ä¸ºmodule_process_threadæ³¨å†ŒCallStats, ReceiveSideCongestionController, SendSideCongestionControlleræ¨¡å—,ä¸ºpacer_threadæ³¨å†ŒPacedSender, RemoteBitrateEstimatoræ¨¡å—. Call::CreateVideoSendStreamåˆ›å»ºVideoSendStreamæ—¶,å°†module_process_threadåšæž„é€ å‚æ•°ä¼ å…¥,è°ƒç”¨RegisterProcessThreadæ–¹æ³•,æ³¨å†Œæ‰€æœ‰çš„rtc_rtcpæ¨¡å—åˆ°module_process_threadçº¿ç¨‹.åŒæ ·çš„ä¸ºVideoReceiveStreamä¸­è®¾ç½®.]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AndroidStudioå¸¸è§é—®é¢˜]]></title>
    <url>%2F2017%2F07%2F23%2Ftips-androidstudio%2F</url>
    <content type="text"><![CDATA[å¦‚ä½•è§£å†³Unsupported major.minor version 52.0é—®é¢˜ï¼Ÿ http://www.jianshu.com/p/5eebd3c609d6 è¿è¡Œ./gradlew :PandaAndroidDemo:releaseå‡ºçŽ°å¦‚ä¸‹é”™è¯¯ï¼š 12345678910111213FAILURE: Build failed with an exception.* Where:Build file &apos;/Users/shitianci/work/Lab/panda.android/PandaAndroidDemo/build.gradle&apos; line: 1* What went wrong:A problem occurred evaluating project &apos;:PandaAndroidDemo&apos;.&gt; java.lang.UnsupportedClassVersionError: com/android/build/gradle/AppPlugin : Unsupported major.minor version 52.0* Try:Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.BUILD FAILED ç›´æŽ¥ç‚¹å‡» runæŒ‰é’® æˆ–è€… Buildâ†’Generate Build APK å´è¿è¡Œæ­£å¸¸ã€‚ è¿™é‡Œé¢æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š ä¸ºä»€ä¹ˆå‡ºçŽ°Unsupported major.minor version 52.0ï¼Ÿ ä¸ºä»€ä¹ˆgradleå‘½ä»¤å’Œandroid studioæŒ‰é’®è¿è¡Œç»“æžœä¸ä¸€æ ·ï¼Ÿ é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆå‡ºçŽ°Unsupported major.minor version 52.0ï¼Ÿåœ¨ç½‘ä¸Šæ‰¾äº†ä¸€åœˆï¼Œæœ€åŽåœ¨stackoverflowæ‰¾åˆ°äº†æœ¬è´¨åŽŸå›  12345You get this error because a Java 7 VM tries to load a class compiled for Java 8Java 8 has the class file version 52.0 but a Java 7 VM can only load class files up to version 51.0In your case the Java 7 VM is your gradle build and the class is com.android.build.gradle.AppPlugin ç®€å•æ¥è¯´ï¼Œå°±æ˜¯javaçš„ç¼–è¯‘çŽ¯å¢ƒç‰ˆæœ¬å¤ªä½Žï¼Œjava 8 class fileçš„ç‰ˆæœ¬æ˜¯52ï¼ŒJava 7è™šæ‹Ÿæœºåªèƒ½æ”¯æŒåˆ°51ã€‚æ‰€ä»¥éœ€è¦å‡çº§åˆ°java 8 vmæ‰è¡Œã€‚ é—®é¢˜äºŒï¼šä¸ºä»€ä¹ˆgradleå‘½ä»¤å’Œandroid studioæŒ‰é’®è¿è¡Œç»“æžœä¸ä¸€æ ·ï¼Ÿä»Žé—®é¢˜1æ¥çœ‹ï¼Œè‚¯å®šAndroid StudioæŒ‰é’®è°ƒç”¨çš„æ˜¯java 8 vmï¼Œæ‰€ä»¥æŸ¥æ‰¾ä¸€ä¸‹ç³»ç»Ÿé…ç½®ï¼Œæœ€ç»ˆåœ¨Project Structureæ‰¾åˆ°äº†å¦‚ä¸‹è®¾ç½®ï¼š Android Studio 2.2.2ä½¿ç”¨äº†è‡ªå¸¦çš„JDKçŽ¯å¢ƒï¼Œå…¶åœ°å€ä¸º 1/Applications/Android Studio.app/Contents/jre/jdk/Contents/Home è€Œgradleå‘½ä»¤çš„æ‰§è¡ŒçŽ¯å¢ƒæ˜¯åœ¨gradle.propertiesé…ç½®çš„ï¼Œå…¶æŒ‡å‘ä¸ºï¼š 1org.gradle.java.home=/Library/Java/JavaVirtualMachines/jdk1.7.0_71.jdk/Contents/home å°†å…¶ä¿®æ”¹ä¸ºï¼š 1org.gradle.java.home=/Applications/Android Studio.app/Contents/jre/jdk/Contents/Home INSTALL_PARSE_FAILED_NO_CERTIFICATESå®‰è£…é—®é¢˜Android studio æ›´æ–°åˆ°25åŽæ‰“åŒ…é—®é¢˜ï¼Œæ‰“åŒ…åŽçš„åº”ç”¨å®‰è£…æç¤ºï¼šINSTALL_PARSE_FAILED_NO_CERTIFICATES Android N å¼•å…¥ä¸€é¡¹æ–°çš„åº”ç”¨ç­¾åæ–¹æ¡ˆ APK Signature Scheme v2ï¼Œå®ƒèƒ½æä¾›æ›´å¿«çš„åº”ç”¨å®‰è£…æ—¶é—´å’Œæ›´å¤šé’ˆå¯¹æœªæŽˆæƒ APK æ–‡ä»¶æ›´æ”¹çš„ä¿æŠ¤ã€‚ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒAndroid Studio 2.2 å’Œ Android Gradle 2.2 æ’ä»¶ä¼šä½¿ç”¨ APK Signature Scheme v2 å’Œä¼ ç»Ÿç­¾åæ–¹æ¡ˆæ¥ç­¾ç½²æ‚¨çš„åº”ç”¨ã€‚ è„çš„è§£å†³æ–¹å¼ï¼šä½¿ç”¨v1æ‰“åŒ…]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>tips</tag>
        <tag>AndroidStudio</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RFC3550 RTPä¸­æ–‡ç‰ˆ]]></title>
    <url>%2F2017%2F07%2F22%2Fp-rfc-3550-zh%2F</url>
    <content type="text"><![CDATA[RFC3550 RTPï¼šå®žæ—¶åº”ç”¨ç¨‹åºä¼ è¾“åè®® æ‘˜è¦ æœ¬æ–‡æè¿°RTPï¼ˆreal-time transport protocolï¼‰ï¼Œå®žæ—¶ä¼ è¾“åè®®ã€‚RTPåœ¨å¤šç‚¹ä¼ é€ï¼ˆå¤šæ’­ï¼‰æˆ–å•ç‚¹ä¼ é€ï¼ˆå•æ’­ï¼‰çš„ç½‘ç»œæœåŠ¡ä¸Šï¼Œæä¾›ç«¯å¯¹ç«¯çš„ç½‘ç»œä¼ è¾“åŠŸèƒ½ï¼Œé€‚åˆåº”ç”¨ç¨‹åºä¼ è¾“å®žæ—¶æ•°æ®ï¼Œå¦‚ï¼šéŸ³é¢‘ï¼Œè§†é¢‘æˆ–è€…ä»¿çœŸæ•°æ®ã€‚RTPæ²¡æœ‰ä¸ºå®žæ—¶æœåŠ¡æä¾›èµ„æºé¢„ç•™çš„åŠŸèƒ½ï¼Œä¹Ÿä¸èƒ½ä¿è¯QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰ã€‚æ•°æ®ä¼ è¾“åŠŸèƒ½ç”±ä¸€ä¸ªæŽ§åˆ¶åè®®ï¼ˆRTCPï¼‰æ¥æ‰©å±•ï¼Œé€šè¿‡æ‰©å±•ï¼Œå¯ä»¥ç”¨ä¸€ç§æ–¹å¼å¯¹æ•°æ®ä¼ è¾“è¿›è¡Œç›‘æµ‹æŽ§åˆ¶ï¼Œè¯¥åè®®ï¼ˆRTCPï¼‰å¯ä»¥å‡çº§åˆ°å¤§åž‹çš„å¤šç‚¹ä¼ é€ï¼ˆå¤šæ’­ï¼‰ç½‘ç»œï¼Œå¹¶æä¾›æœ€å°é™åº¦çš„æŽ§åˆ¶å’Œé‰´åˆ«åŠŸèƒ½ã€‚RTPå’ŒRTCPè¢«è®¾è®¡æˆå’Œä¸‹é¢çš„ä¼ è¾“å±‚å’Œç½‘ç»œå±‚æ— å…³ã€‚åè®®æ”¯æŒRTPæ ‡å‡†çš„è½¬æ¢å™¨å’Œæ··åˆå™¨çš„ä½¿ç”¨ã€‚ æœ¬æ–‡çš„å¤§å¤šæ•°å†…å®¹å’Œæ—§ç‰ˆçš„RFC1889ç›¸åŒã€‚åœ¨çº¿è·¯é‡Œä¼ è¾“çš„æ•°æ®åŒ…æ ¼å¼æ²¡æœ‰æ”¹å˜ï¼Œå”¯ä¸€çš„æ”¹å˜æ˜¯ä½¿ç”¨åè®®çš„è§„åˆ™å’ŒæŽ§åˆ¶ç®—æ³•ã€‚ä¸ºäº†æœ€å°åŒ–ä¼ è¾“ï¼Œå‘é€RTCPæ•°æ®åŒ…æ—¶è¶…è¿‡äº†è®¾å®šçš„é€ŸçŽ‡ï¼Œè€Œåœ¨è¿™æ—¶ï¼Œå¾ˆå¤šçš„å‚ä¸Žè€…åŒæ—¶åŠ å…¥äº†ä¸€ä¸ªä¼šè¯ï¼Œåœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–°åŠ å…¥åˆ°ï¼ˆç”¨äºŽè®¡ç®—çš„å¯å‡çº§çš„ï¼‰è®¡æ—¶å™¨ç®—æ³•ä¸­çš„å…ƒç´ æ˜¯æœ€å¤§çš„æ”¹å˜ã€‚ ç›®å½•ï¼ˆTable of Contentsï¼‰ 1 å¼•è¨€ ï¼ˆIntroductionï¼‰ 1 1 æœ¯è¯­ï¼ˆTerminologyï¼‰ 2 RTPä½¿ç”¨åœºæ™¯ï¼ˆRTP Use Scenariosï¼‰ 2 1 ç®€å•å¤šæ’­éŸ³é¢‘ä¼šè®®ï¼ˆ Simple Multicast Audio Conferenceï¼‰ 2 2 éŸ³é¢‘å’Œè§†é¢‘ä¼šè®®ï¼ˆAudio and Video Conferenceï¼‰ 2 3 æ··é¢‘å™¨å’Œè½¬æ¢å™¨ï¼ˆMixers and Translatorsï¼‰ 2 4 åˆ†å±‚ç¼–ç ï¼ˆLayered Encodingsï¼‰ 3 å®šä¹‰ï¼ˆDefinitionsï¼‰ 4 å­—èŠ‚åºï¼Œæ ¡æ­£å’Œæ—¶é—´æ ¼å¼ï¼ˆByte Order, Alignment, and Time Formatï¼‰ 5 RTPæ•°æ®ä¼ è¾“åè®®ï¼ˆRTP Data Transfer Protocolï¼‰ 5 1 RTPå›ºå®šå¤´åŸŸï¼ˆRTP Fixed Header Fieldsï¼‰ 5 2 å¤šè·¯å¤ç”¨RTPä¼šè¯ï¼ˆMultiplexing RTP Sessionsï¼‰ 5 3 RTPå¤´çš„é…ç½®æ–‡ä»¶è¯¦ç»†å˜æ›´ï¼ˆProfile-Specific Modifications to the RTP Headerï¼‰ 5 3 1 RTPæŠ¥å¤´æ‰©å±•ï¼ˆRTP Header Extensionï¼‰ 6 RTPæŽ§åˆ¶åè®®ï¼ˆRTP Control Protocolï¼‰ â€“ RTCP 6 1 RTCPåŒ…æ ¼å¼ï¼ˆRTCP Packet Formatï¼‰ 6 2 RTCPä¼ è¾“é—´éš”ï¼ˆRTCP Transmission Intervalï¼‰ 6 2 1 ç»´æŠ¤ä¼šè¯æˆå‘˜æ•°ç›®ï¼ˆMaintaining the number of session membersï¼‰ 6 3 RTCPåŒ…çš„å‘é€ä¸ŽæŽ¥æ”¶è§„åˆ™ï¼ˆRTCP Packet Send and Receive Rulesï¼‰ 6 3 1 è®¡ç®—RTCPä¼ è¾“é—´éš”ï¼ˆComputing the RTCP Transmission Intervalï¼‰ 6 3 2 åˆå§‹åŒ–ï¼ˆInitializationï¼‰ 6 3 3 æŽ¥æ”¶RTPæˆ–RTCPï¼ˆéžBYE)åŒ…ï¼ˆReceiving an RTP or Non-BYE RTCP Packetï¼‰ 6 3 4 æŽ¥æ”¶RTCPï¼ˆBYEï¼‰åŒ…ï¼ˆReceiving an RTCP BYE Packetï¼‰ 6 3 5 SSRCè®¡æ—¶å¤±æ•ˆï¼ˆTiming Out an SSRCï¼‰ 6 3 6 å…³äºŽä¼ è¾“è®¡æ—¶å™¨çš„åˆ°æœŸï¼ˆExpiration of Transmission Timerï¼‰ 6 3 7 ä¼ è¾“ä¸€ä¸ª BYE åŒ…ï¼ˆTransmitting a BYE Packetï¼‰ 6 3 8 æ›´æ–°we_sentï¼ˆUpdating we_sentï¼‰ 6 3 9 åˆ†é…æºæè¿°å¸¦å®½ï¼ˆAllocation of Source Description Bandwidthï¼‰ 6 4 å‘é€æ–¹å’ŒæŽ¥æ”¶æ–¹æŠ¥å‘Šï¼ˆSender and Receiver Reportsï¼‰ 6 4 1 SRï¼šå‘é€æ–¹æŠ¥å‘Šçš„RTCPåŒ…ï¼ˆSR: Sender report RTCP packetï¼‰ 6 4 2 RRï¼šæŽ¥æ”¶æ–¹æŠ¥å‘Šçš„RTCPåŒ…ï¼ˆRR: Receiver Report RTCP Packetï¼‰ 6 4 3 æ‰©å±•å‘é€æ–¹å’ŒæŽ¥æ”¶æ–¹æŠ¥å‘Šï¼ˆExtending the Sender and Receiver Reports ï¼‰ 6 4 4 åˆ†æžå‘é€æ–¹å’ŒæŽ¥æ”¶æ–¹æŠ¥å‘Šï¼ˆAnalyzing Sender and Receiver Reports ï¼‰ 6 5 SDESï¼šæºæè¿°RTCPåŒ…ï¼ˆSDES: Source description RTCP packetï¼‰ 6 5 1 CNAMEï¼šè§„èŒƒç»ˆç«¯æ ‡è¯†ç¬¦çš„SDESæ•°æ®é¡¹(CNAME: Canonical End-Point Identifier SDES Itemï¼‰ 6 5 2 NAMEï¼šç”¨æˆ·åçš„SDESæ•°æ®é¡¹ï¼ˆNAME: User name SDES item) 6 5 3 EMAIL:ç”µå­é‚®ä»¶åœ°å€çš„SDESæ•°æ®é¡¹ï¼ˆEMAIL: Electronic Mail Address SDES Itemï¼‰ 6 5 4 PHONEï¼šç”µè¯å·ç çš„SDESæ•°æ®é¡¹ï¼ˆPHONE: Phone Number SDES Itemï¼‰ 6 5 5 LOC:åœ°ç†ç”¨æˆ·åœ°å€çš„SDESæ•°æ®é¡¹ï¼ˆLOC: Geographic User Location SDES Itemï¼‰ 6 5 6 TOOLï¼šåº”ç”¨ç¨‹åºæˆ–å·¥å…·åå­—çš„SDESæ•°æ®é¡¹ï¼ˆTOOL: Application or Tool Name SDES Itemï¼‰ 6 5 7 NOTEï¼šé€šçŸ¥/çŠ¶æ€çš„SDESæ•°æ®é¡¹ï¼ˆNOTE: Notice/Status SDES Itemï¼‰ 6 5 8 PRIV:ç§æœ‰æ‰©å±•çš„SDESæ•°æ®é¡¹ï¼ˆPRIV: Private Extensions SDES Itemï¼‰ 6 6 BYEï¼šGoodbye RTCPåŒ…ï¼ˆBYE: Goodbye RTCP packetï¼‰ 6 7 APP:å®šä¹‰åº”ç”¨ç¨‹åºçš„RTCPåŒ…ï¼ˆAPP: Application-Defined RTCP Packetï¼‰ 7 RTPè½¬æ¢å™¨å’Œæ··é¢‘å™¨ï¼ˆRTP Translators and Mixersï¼‰ 7 1 æ¦‚è¿°ï¼ˆGeneral Description ï¼‰ 7 2 åœ¨è½¬æ¢å™¨ä¸­çš„RTCPæ•°æ®å¤„ç†ï¼ˆRTCP Processing in Translatorsï¼‰ 7 3 åœ¨æ··é¢‘å™¨ä¸­çš„RTCPæ•°æ®å¤„ç†ï¼ˆRTCP Processing in Mixers ï¼‰ 7 4 çº§è”æ··é¢‘å™¨ï¼ˆCascaded Mixersï¼‰ 8 SSRCæ ‡è¯†ç¬¦çš„åˆ†é…å’Œä½¿ç”¨ï¼ˆSSRC Identifier Allocation and Useï¼‰ 8 1 å†²çªæ¦‚çŽ‡ï¼ˆProbability of Collision ï¼‰ 8 2 å†²çªè§£å†³å’Œå¾ªçŽ¯æ£€æµ‹ï¼ˆCollision Resolution and Loop Detectionï¼‰ 8 3 åœ¨åˆ†å±‚ç¼–ç ä¸­ä½¿ç”¨ï¼ˆUse with Layered Encodingsï¼‰ 9 å®‰å…¨ï¼ˆSecurity ï¼‰ 9 1 æœºå¯†æ€§ï¼ˆConfidentialityï¼‰ 9 2 èº«ä»½éªŒè¯å’Œæ¶ˆæ¯å®Œæ•´æ€§ï¼ˆAuthentication and Message Integrityï¼‰ 10 æ‹¥å¡žæŽ§åˆ¶ï¼ˆCongestion Controlï¼‰ 11 ç½‘ç»œå’Œä¼ è¾“åè®®ä¹‹ä¸Šçš„RTPï¼ˆRTP over Network and Transport Protocolsï¼‰ 12 åè®®å¸¸é‡æ‘˜è¦ï¼ˆSummary of Protocol Constantsï¼‰ 12 1 RTCP åŒ…ç±»åž‹ï¼ˆRTCP Packet Typesï¼‰ 12 2 SDES ç±»åž‹ï¼ˆSDES Typesï¼‰ 13 RTPæ¦‚å†µå’Œè´Ÿè½½æ ¼å¼è¯¦ç»†è¯´æ˜Ž ï¼ˆRTP Profiles and Payload Format Specificationsï¼‰ 14 å®‰å…¨è€ƒè™‘ï¼ˆSecurity Considerationsï¼‰ 15 IANAè€ƒè™‘ï¼ˆIANA Considerationsï¼‰ 16 çŸ¥è¯†äº§æƒå£°æ˜Žï¼ˆIntellectual Property Rights Statementï¼‰ 17 é¸£è°¢ï¼ˆAcknowledgmentsï¼‰ é™„å½• A ç®—æ³•ï¼ˆAlgorithmsï¼‰ é™„å½• A 1 RTPæ•°æ®å¤´æœ‰æ•ˆæ€§æ£€æŸ¥ï¼ˆRTP Data Header Validity Checks ï¼‰ é™„å½• A 2 RTCPæ•°æ®å¤´æœ‰æ•ˆæ€§æ£€æŸ¥ï¼ˆRTCP Header Validity Checksï¼‰ é™„å½• A 3 ç¡®å®šRTPåŒ…é¢„æœŸæ•°ç›®å’Œä¸¢å¤±æ•°ç›®ï¼ˆDetermining Number of Packets Expected and Lostï¼‰ é™„å½• A 4 ç”ŸæˆSDES RTCPåŒ…ï¼ˆGenerating RTCP SDES Packetsï¼‰ é™„å½• A 5 è§£æžRTCP SDESåŒ…ï¼ˆParsing RTCP SDES Packetsï¼‰ é™„å½• A 6 ç”Ÿæˆ32ä½éšæœºæ ‡è¯†ç¬¦ï¼ˆGenerating a Random 32-bit Identifier é™„å½• A 7 è®¡ç®—RTCPä¼ è¾“é—´éš”ï¼ˆComputing the RTCP Transmission Intervalï¼‰ é™„å½• A 8 ä¼°æµ‹ä¸¤æ¬¡åˆ°è¾¾é—´éš”çš„æŠ–åŠ¨ï¼ˆEstimating the Interarrival Jitterï¼‰ é™„å½• B ä¸ŽRFC1889ä¸åŒä¹‹å¤–ï¼ˆChanges from RFC 1889ï¼‰ å‚è€ƒä¹¦ç›®ï¼ˆReferencesï¼‰ æ ‡å‡†åŒ–å¼•ç”¨ï¼ˆNormative References ï¼‰ èµ„æ–™æ€§å¼•ç”¨ï¼ˆInformative Referencesï¼‰ ä½œè€…åœ°å€ å®Œæ•´çš„ç‰ˆæƒå£°æ˜Ž 1.ç»ªè®º æœ¬æ–‡è¯¦ç»†çš„ä»‹ç»å®žæ—¶ä¼ è¾“åè®®RTPï¼ŒRTPæä¾›å¸¦æœ‰å®žæ—¶ç‰¹æ€§çš„ç«¯å¯¹ç«¯æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä¼ è¾“çš„æ•°æ®å¦‚ï¼šäº¤äº’å¼çš„éŸ³é¢‘å’Œè§†é¢‘ã€‚é‚£äº›æœåŠ¡åŒ…æ‹¬æœ‰æ•ˆè½½è·ç±»åž‹å®šä¹‰ï¼Œåºåˆ—å·ï¼Œæ—¶é—´æˆ³å’Œä¼ è¾“ç›‘æµ‹æŽ§åˆ¶ã€‚åº”ç”¨ç¨‹åºåœ¨UDPä¸Šè¿è¡ŒRTPæ¥ä½¿ç”¨å®ƒçš„å¤šè·¯æŠ€æœ¯å’ŒchecksumæœåŠ¡ã€‚2ç§åè®®éƒ½æä¾›ä¼ è¾“åè®®çš„éƒ¨åˆ†åŠŸèƒ½ã€‚ä¸è¿‡ï¼ŒRTPå¯èƒ½è¢«å…¶ä»–é€‚å½“çš„ä¸‹å±‚ç½‘ç»œå’Œä¼ è¾“åè®®ä½¿ç”¨ï¼ˆè§11èŠ‚ï¼‰ã€‚å¦‚æžœä¸‹å±‚ç½‘ç»œæ”¯æŒï¼ŒRTPæ”¯æŒæ•°æ®ä½¿ç”¨å¤šæ’­åˆ†å‘æœºåˆ¶è½¬å‘åˆ°å¤šä¸ªç›®çš„åœ°ã€‚ æ³¨æ„RTPæœ¬èº«æ²¡æœ‰æä¾›ä»»ä½•çš„æœºåˆ¶æ¥ç¡®ä¿å®žæ—¶çš„ä¼ è¾“æˆ–å…¶ä»–çš„æœåŠ¡è´¨é‡ä¿è¯ï¼Œè€Œæ˜¯ç”±ä½Žå±‚çš„æœåŠ¡æ¥å®Œæˆã€‚å®ƒä¸ä¿è¯ä¼ è¾“æˆ–é˜²æ­¢ä¹±åºä¼ è¾“ï¼Œå®ƒä¸å‡å®šä¸‹å±‚ç½‘ç»œæ˜¯å¦å¯é ï¼Œæ˜¯å¦æŒ‰é¡ºåºä¼ é€æ•°æ®åŒ…ã€‚RTPåŒ…å«çš„åºåˆ—å·å…è®¸æŽ¥å—æ–¹é‡æž„å‘é€æ–¹çš„æ•°æ®åŒ…é¡ºåºï¼Œä½†åºåˆ—å·ä¹Ÿç”¨æ¥ç¡®å®šä¸€ä¸ªæ•°æ®åŒ…çš„æ­£ç¡®ä½ç½®ï¼Œä¾‹å¦‚ï¼Œåœ¨è§†é¢‘è§£ç çš„æ—¶å€™ä¸ç”¨æŒ‰é¡ºåºçš„å¯¹æ•°æ®åŒ…è¿›è¡Œè§£ç ã€‚ ä½†æ˜¯RTPåŽŸå…ˆçš„è®¾è®¡æ˜¯ç”¨æ¥æ»¡è¶³å¤šå‚ä¸Žè€…çš„å¤šåª’ä½“ä¼šè®®çš„éœ€è¦ï¼Œå®ƒæ²¡æœ‰é™å®šäºŽä¸“é—¨çš„åº”ç”¨ã€‚è¿žç»­æ•°æ®çš„å‚¨å­˜ï¼Œäº¤äº’åˆ†å¸ƒå¼ä»¿çœŸï¼ŒåŠ¨æ€æ ‡è®°ï¼Œä»¥åŠæŽ§åˆ¶å’Œæµ‹é‡åº”ç”¨ç¨‹åºä¹Ÿå¯èƒ½ä¼šé€‚åˆä½¿ç”¨RTPã€‚ è¯¥æ–‡æ¡£å®šä¹‰RTPï¼Œç”±2ä¸ªå¯†åˆ‡è”ç³»çš„éƒ¨åˆ†ç»„æˆï¼š â—‹å®žæ—¶ä¼ è¾“åè®®RTPï¼Œç”¨äºŽå®žæ—¶ä¼ è¾“æ•°æ®ã€‚ â—‹RTPæŽ§åˆ¶åè®®RTCPï¼Œç”¨äºŽç›‘æŽ§æœåŠ¡è´¨é‡å’Œä¼ è¾¾å…³äºŽåœ¨ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„ä¼šè®®ä¸­çš„å‚ä¸Žè€…çš„ä¿¡æ¯ã€‚åŽè€…å¯¹â€œå®½æ¾æŽ§åˆ¶â€çš„ä¼šè®®å¯èƒ½å·²ç»è¶³å¤Ÿï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¿…è¦åŽ»æ”¯æŒä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€æœ‰çš„é€šè®¯æŽ§åˆ¶æ¡ä»¶ã€‚è¿™ä¸ªåŠŸèƒ½å¯èƒ½å……åˆ†çš„æˆ–è€…éƒ¨åˆ†çš„è¢«ä¸€ä¸ªå•ç‹¬çš„ä¼šè®®æŽ§åˆ¶åè®®æ‰€åŒ…å«ï¼Œè¿™è¶…è¿‡äº†æœ¬æ–‡æ¡£çš„èŒƒå›´ã€‚ RTPè¡¨çŽ°äº†åè®®çš„ä¸€ç§æ–°çš„ç±»åž‹ï¼Œè¯¥ç±»åž‹ç”±Clarkå’ŒTennenhouseæå‡º[10]ï¼Œéµå¾ªåº”ç”¨çº§ï¼ˆframingï¼‰æ¡†æž¶å’Œï¼ˆintegrated layer processingï¼‰ç»Ÿä¸€å±‚å¤„ç†çš„åŽŸåˆ™ã€‚å°±æ˜¯è¯´ï¼ŒRTPè¢«è§„å®šä¸ºå¯æ‰©å±•çš„ï¼Œç”¨æ¥æä¾›ä¸€ä¸ªä¸“é—¨çš„åº”ç”¨ç¨‹åºéœ€è¦çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¼šç»å¸¸æ€§çš„è¢«å½’å¹¶åˆ°åº”ç”¨ç¨‹åºçš„å¤„ç†ä¸­ï¼Œè€Œä¸æ˜¯ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å±‚è¢«å®žçŽ°ã€‚RTPåªæ˜¯ä¸€ä¸ªæ•…æ„ä¸å®Œæˆçš„åè®®æ¡†æž¶ã€‚æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜Žé‚£äº›åŠŸèƒ½ï¼Œå¸Œæœ›è¿™äº›åŠŸèƒ½èƒ½å¤Ÿæ™®éè´¯ç©¿äºŽæ‰€æœ‰é€‚åˆä½¿ç”¨RTPçš„åº”ç”¨ç¨‹åºã€‚å’Œå¸¸è§„çš„åè®®ä¸åŒï¼Œé¢å¤–çš„åŠŸèƒ½å¯èƒ½é€šè¿‡å®Œå–„åè®®æœ¬èº«æˆ–è€…å¢žåŠ ä¸€ä¸ªå¯èƒ½éœ€è¦åˆ†æžçš„é€‰é¡¹æœºåˆ¶æ¥å¢žåŠ ï¼ŒRTPè¢«è§„å®šä¸ºå¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡ä¿®æ”¹å’Œ/æˆ–å¢žåŠ æ“ä½œï¼Œâ€œå‰ªè£â€åˆ°æŠ¥å¤´ã€‚å…·ä½“çš„ä¾‹å­è§5.3å’Œ6.4.3èŠ‚ã€‚ å› æ­¤ï¼Œé™¤äº†æœ¬æ–‡æ¡£ï¼Œç”¨äºŽä¸“é—¨åº”ç”¨ç¨‹åºçš„RTPå®Œæ•´çš„è¯´æ˜Žå°†è¿˜éœ€è¦ä¸€ä¸ªæˆ–è€…æ›´å¤šçš„åŒç±»æ–‡æ¡£ï¼ˆè§13èŠ‚ï¼‰ï¼š â—‹ ä¸€ä¸ªæ¡†æž¶ï¼ˆå¤§è‡´è½®å»“ï¼‰çš„è¯´æ˜Žæ–‡æ¡£ï¼Œè¯¥æ–‡æ¡£å®šä¹‰äº†ä¸€ç³»åˆ—çš„æœ‰æ•ˆè½½è·ç±»åž‹ç¼–ç å’Œå®ƒä»¬ä¸Žæœ‰æ•ˆè½½è·æ ¼å¼ä¹‹é—´çš„æ˜ å°„ï¼ˆä¾‹å¦‚ï¼Œåª’ä½“ç¼–ç ï¼‰ã€‚ä¸€ä¸ªæ¡†æž¶å¯èƒ½ä¹Ÿå®šä¹‰äº†åº”ç”¨ç¨‹åºå¯¹RTPçš„ä¸€äº›æ‰©å±•å’Œä¿®æ”¹ï¼Œè¯¦ç»†åˆ°ä¸€ä¸ªä¸“é—¨çš„ç±»ã€‚å…¸åž‹çš„æƒ…å†µï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå°†åœ¨ä¸€ä¸ªæ¡†æž¶ä¸‹è¿è¡Œã€‚ä¸€ä¸ªç”¨äºŽéŸ³é¢‘å’Œè§†é¢‘æ•°æ®çš„æ¡†æž¶å¯ä»¥åœ¨åŒç±»RFC3551[1]æ–‡æ¡£é‡Œæ‰¾åˆ°ã€‚ â—‹æœ‰æ•ˆè½½è·æ ¼å¼è¯´æ˜Žæ–‡æ¡£ï¼Œè¯¥æ–‡æ¡£å®šä¹‰äº†ä¸€ä¸ªåƒä¸€ä¸ªéŸ³é¢‘æˆ–è€…è§†é¢‘ç¼–ç çš„ç‰¹æ®Šè½½è·ï¼Œåœ¨RTPé‡Œæ˜¯å¦‚ä½•è¢«ä¼ è¾“çš„ã€‚ ä¸€ä¸ªå…³äºŽå®žæ—¶æœåŠ¡å’Œç®—æ³•å¦‚ä½•å®žçŽ°çš„è®¨è®ºå’Œå…³äºŽä¸€äº›RTPè®¾è®¡ç»“æžœçš„åŽå°è®¨è®ºèƒ½å¤Ÿåœ¨[11]ä¸­æ‰¾åˆ°ã€‚ 1.1æœ¯è¯­ åœ¨è¿™ä¸ªæ–‡æ¡£é‡Œçš„å…³é”®è¯â€œä¸€å®šè¦â€ï¼Œâ€œä¸€å®šä¸èƒ½â€ï¼Œâ€œå¿…éœ€çš„â€ï¼Œâ€œä¼šâ€ï¼Œâ€œä¸ä¼šâ€ï¼Œâ€œåº”è¯¥â€ï¼Œâ€œä¸åº”è¯¥â€ï¼Œâ€œæŽ¨èâ€ï¼Œâ€œå¯èƒ½â€å’Œâ€œå¯é€‰â€ å°†ä¼šåƒåœ¨BCP 14ï¼ˆBasic Control Programï¼ŒåŸºæœ¬æŽ§åˆ¶ç¨‹åºï¼‰ï¼ŒRFC2119[2]é‡Œæè¿°ä¸€æ ·çš„è§£é‡Šã€‚å¹¶æŒ‡å‡ºé€‚åˆRTPå®žçŽ°çš„éœ€è¦çš„çº§åˆ«ã€‚ 2 RTPä½¿ç”¨åœºæ™¯ï¼ˆRTP Use Scenariosï¼‰ 2.1 ç®€å•å¤šæ’­éŸ³é¢‘ä¼šè®®ï¼ˆ Simple Multicast Audio Conferenceï¼‰ 2.2 éŸ³é¢‘å’Œè§†é¢‘ä¼šè®®ï¼ˆAudio and Video Conferenceï¼‰ 2.3 æ··é¢‘å™¨å’Œè½¬æ¢å™¨ï¼ˆMixers and Translatorsï¼‰ 2.4 åˆ†å±‚ç¼–ç ï¼ˆLayered Encodingsï¼‰ ä»¥ä¸‹ç« èŠ‚æè¿°äº†ç”¨åˆ°RTPçš„ä¸€äº›æ–¹é¢ã€‚æ‰€ä¸¾ä¾‹å­ç”¨æ¥è¯´æ˜ŽRTPåº”ç”¨çš„åŸºæœ¬æ“ä½œï¼Œä½†RTPçš„ç”¨é€”ä¸é™äºŽæ­¤ã€‚åœ¨è¿™äº›ä¾‹å­ä¸­ï¼ŒRTPè¿è¡ŒäºŽIPå’ŒUDPä¹‹ä¸Šï¼Œå¹¶ä¸”éµå¾ªRFC3551æ‰€æè¿°çš„éŸ³é¢‘å’Œè§†é¢‘çš„é…ç½®æ–‡ä»¶ä¸­çš„çº¦å®šã€‚ 2.1 ç®€å•å¤šæ’­éŸ³é¢‘ä¼šè®®ï¼ˆSimple Multicast Audio Conferenceï¼‰ IETFçš„ä¸€ä¸ªå·¥ä½œç»„å¼€ä¼šè®¨è®ºæœ€æ–°åè®®è‰æ¡ˆæ—¶ï¼Œä½¿ç”¨Internetçš„IPå¤šæ’­æœåŠ¡æ¥è¿›è¡Œè¯­éŸ³é€šè®¯ã€‚å·¥ä½œç»„ä¸­å¿ƒåˆ†é…åˆ°ä¸€ä¸ªå¤šæ’­çš„ç»„åœ°å€å’Œä¸€å¯¹ç«¯å£ã€‚ä¸€ä¸ªç«¯å£ç”¨äºŽéŸ³é¢‘æ•°æ®ï¼Œå¦ä¸€ä¸ªç«¯å£ç”¨äºŽæŽ§åˆ¶ï¼ˆRTCPï¼‰æ•°æ®åŒ…ã€‚è¯¥åœ°å€å’Œç«¯å£ä¿¡æ¯å‘å¸ƒç»™é¢„å®šçš„å‚ä¸Žè€…ã€‚å¦‚æžœæœ‰ç§å¯†æ€§è¦æ±‚ï¼Œåˆ™å¯ç”¨ç« èŠ‚9.1ä¸­è¯´æ˜Žçš„æ–¹æ³•ï¼Œå¯¹æ•°æ®å’ŒæŽ§åˆ¶åŒ…è¿›è¡ŒåŠ å¯†ï¼Œè¿™æ—¶å°±éœ€è¦ç”Ÿæˆå’Œå‘å¸ƒåŠ å¯†å¯†é’¥ã€‚åˆ†é…å’Œå‘å¸ƒæœºåˆ¶çš„ç²¾ç¡®ç»†èŠ‚ä¸åœ¨RTPçš„è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚ æ¯ä¸ªä¸Žä¼šè€…æ‰€ä½¿ç”¨çš„éŸ³é¢‘ä¼šè®®åº”ç”¨ç¨‹åºï¼Œéƒ½ä»¥å°å—å½¢å¼ï¼ˆæ¯”æ–¹è¯´æŒç»­ï¼’ï¼ç§’æ—¶é—´ï¼‰æ¥å‘é€éŸ³é¢‘æ•°æ®ã€‚æ¯ä¸ªéŸ³é¢‘æ•°æ®å—éƒ½å‰å¯¼RTPæŠ¥å¤´ï¼›RTPæŠ¥å¤´å’Œæ•°æ®ä¾æ¬¡åŒ…å«åœ¨UDPåŒ…é‡Œã€‚RTPæŠ¥å¤´æŒ‡æ˜Žäº†å„ä¸ªåŒ…é‡ŒéŸ³é¢‘ç¼–ç çš„ç±»åž‹ï¼ˆå¦‚PCM,ADPCM,LPCï¼‰ï¼Œè¿™æ ·å‘é€æ–¹å¯ä»¥åœ¨ä¼šè®®è¿‡ç¨‹ä¸­æ”¹å˜ç¼–ç æ–¹å¼ï¼Œä»¥é€‚åº”çŠ¶å†µçš„å˜åŒ–ï¼Œä¾‹å¦‚ï¼Œè¦åŠ è¿›ä¸€ä¸ªä½Žå¸¦å®½æŽ¥å…¥çš„å‚ä¸Žè€…ï¼Œæˆ–æ˜¯è¦åº”ä»˜ç½‘ç»œæ‹¥å¡žã€‚ Internetï¼Œåƒå…¶ä»–çš„æŠ¥æ–‡åˆ†ç»„ç½‘ç»œä¸€æ ·ï¼Œå¶è€Œä¼šä¸¢å¤±å’Œé‡æŽ’åŒ…ï¼Œé€ æˆæ—¶é•¿ä¸ç­‰çš„å»¶è¿Ÿã€‚ä¸ºå¼¥è¡¥è¿™ä¸ªä¸è¶³ï¼ŒRTPæŠ¥å¤´é‡ŒåŒ…å«è®¡æ—¶ä¿¡æ¯å’Œä¸€ä¸ªåºåˆ—å·ï¼Œå…è®¸æŽ¥æ”¶æ–¹é‡å»ºæ¥è‡ªæºçš„è®¡æ—¶ä¿¡æ¯ï¼Œæ¯”å¦‚å‰æ–‡ä¾‹å­ä¸­éŸ³é¢‘å—ä»¥20sçš„é—´éš”åœ¨æ‰¬å£°å™¨ä¸­è¿žç»­æ’­æ”¾ã€‚ä¼šè®®ä¸­ï¼Œå¯¹æ¯ä¸ªRTPåŒ…çš„æº,å•ç‹¬åœ°å®žæ–½è®¡æ—¶é‡å»ºã€‚åºåˆ—å·è¿˜è¢«æŽ¥æ”¶æ–¹ç”¨æ¥è¯„ä¼°ä¸¢å¤±åŒ…æ•°ç›®ã€‚ ç”±äºŽä¼šè®®æœŸé—´ä¸æ–­æœ‰å·¥ä½œç»„æˆå‘˜åŠ å…¥æˆ–ç¦»å¼€ï¼Œå› æ­¤æœ‰å¿…è¦çŸ¥é“ä»»ä¸€æ—¶åˆ»çš„å®žé™…å‚ä¸Žè€…åŠä»–ä»¬æŽ¥æ”¶éŸ³é¢‘æ•°æ®çš„çŠ¶å†µå¥½åã€‚å‡ºäºŽè¿™ä¸ªç›®çš„ï¼Œä¼šè®®ä¸­æ¯ä¸ªéŸ³é¢‘åº”ç”¨ç¨‹åºçš„å®žä¾‹ï¼Œéƒ½åœ¨RTCPï¼ˆæŽ§åˆ¶ï¼‰ç«¯å£ä¸Šå‘¨æœŸæ€§åœ°å¤šæ’­ä¸€ä¸ªé™„åŠ ç”¨æˆ·åçš„æŽ¥æ”¶æŠ¥å‘Šã€‚æŽ¥æ”¶æŠ¥å‘ŠæŒ‡æ˜Žäº†å½“å‰è¯´è¯è€…è¢«æ”¶å¬åˆ°çš„çŠ¶å†µï¼Œå¯ç”¨äºŽæŽ§åˆ¶è‡ªé€‚åº”æ€§ç¼–ç ã€‚é™¤äº†ç”¨æˆ·åå¤–ï¼Œé€šè¿‡æŽ§åˆ¶å¸¦å®½é™åº¦ï¼Œå¯ä»¥åŒ…å«å…¶ä»–æ ‡è¯†ä¿¡æ¯ã€‚ä¸€ä¸ªç«™ç‚¹åœ¨ç¦»å¼€ä¼šè®®æ—¶å‘é€RTCP BYEåŒ…ï¼ˆç« èŠ‚6.5ï¼‰ã€‚ 2.2 éŸ³é¢‘å’Œè§†é¢‘ä¼šè®®ï¼ˆAudio and Video Conferenceï¼‰ ä¸€ä¸ªä¼šè®®å¦‚æžœåŒæ—¶ä½¿ç”¨éŸ³é¢‘å’Œè§†é¢‘åª’ä½“ï¼Œåˆ™äºŒè€…ä¼ è¾“æ—¶ä½¿ç”¨ä¸åŒçš„RTPä¼šè¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤ç§åª’ä½“ä¸­RTPåŒ…å’ŒRTCPåŒ…çš„ä¼ è¾“ï¼Œæ˜¯ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„UDPç«¯å£å¯¹å’Œï¼ˆæˆ–ï¼‰å¤šæ’­åœ°å€ã€‚åœ¨RTPå±‚æ¬¡ï¼ŒéŸ³é¢‘å’Œè§†é¢‘ä¼šè¯æ²¡æœ‰ç›´æŽ¥çš„è€¦åˆï¼Œä¸‹é¢è¿™ç§æƒ…å†µé™¤å¤–ï¼šä¸€ä¸ªåŒæ—¶å‚åŠ ä¸¤ä¸ªä¼šè¯çš„å‚ä¸Žè€…ï¼Œåœ¨ä¸¤ä¸ªä¼šè¯çš„RTCPåŒ…ä¸­ï¼Œä½¿ç”¨äº†ç›¸åŒçš„è§„èŒƒåï¼Œè¿™æ ·ä¸¤ä¸ªä¼šè¯å°±å‘ç”Ÿå…³è”ï¼ˆè€¦åˆï¼‰äº†ã€‚ è¿™æ ·åŒºéš”å¼€æ¥çš„ç›®çš„ä¹‹ä¸€ï¼Œæ˜¯å…è®¸ä¸€äº›ä¼šè®®å‚ä¸Žè€…åªæŽ¥å—è‡ªå·±é€‰æ‹©çš„å•ä¸€åª’ä½“ï¼ˆæˆ–è€…éŸ³é¢‘ï¼Œæˆ–è€…è§†é¢‘ï¼‰ã€‚æ›´è¿›ä¸€æ­¥çš„è¯´æ˜Žåœ¨ç« èŠ‚5.2ç»™å‡ºã€‚å°½ç®¡ä¸¤ç§åª’ä½“åŒºåˆ†å¼€æ¥äº†ï¼Œä½†é€šè¿‡ä¸¤ä¸ªä¼šè¯RTCPåŒ…å†…è½½æœ‰çš„è®¡æ—¶ä¿¡æ¯ï¼ŒåŒæºçš„éŸ³é¢‘ä¸Žè§†é¢‘è¿˜æ˜¯èƒ½å¤ŸåŒæ­¥å›žæ”¾ã€‚ 2.3 æ··é¢‘å™¨å’Œè½¬æ¢å™¨ï¼ˆMixers and Translatorsï¼‰ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš†å‡è®¾æ‰€æœ‰ç«™ç‚¹éƒ½æ”¶åˆ°ç›¸åŒæ ¼å¼çš„åª’ä½“æ•°æ®ã€‚ç„¶è€Œè¿™å¹¶ä¸æ€»æ˜¯è¡Œå¾—é€šã€‚è€ƒè™‘ä¸€ä¸‹è¿™ç§æƒ…å†µï¼Œä¸€ä¸ªåœ°æ–¹çš„å‚ä¸Žè€…åªèƒ½ä½Žé€ŸæŽ¥å…¥ä¼šè®®ï¼Œè€Œå…¶ä»–å¤§éƒ¨åˆ†å‚ä¸Žè€…éƒ½èƒ½äº«å—é«˜é€Ÿè¿žæŽ¥ã€‚ä¸Žå…¶è®©å¼ºè¿«å¤§å®¶éƒ½å¿å—ä½Žå¸¦å®½ï¼Œä¸å¦‚åœ¨åªèƒ½ä½Žé€ŸæŽ¥å…¥çš„åœ°æ–¹ï¼Œæ”¾ç½®ä¸€ä¸ªå‡è´¨é‡éŸ³é¢‘ç¼–ç çš„RTPå±‚æ¬¡çš„ä¸­ç»§ï¼ˆç§°ä½œæ··é¢‘å™¨ï¼‰ã€‚æ··é¢‘å™¨å°†é‡æ–°åŒæ­¥è¾“å…¥çš„éŸ³é¢‘åŒ…ï¼Œé‡å»ºå‘é€æ–¹äº§ç”Ÿçš„20mså›ºå®šé—´éš”ï¼Œæ··é¢‘å·²é‡å»ºè¿‡çš„éŸ³é¢‘æµä¸ºå•ä¸€çš„æµï¼Œè½¬æ¢éŸ³é¢‘ç¼–ç ä¸ºä½Žå¸¦å®½æ ¼å¼ï¼Œæœ€åŽé€šè¿‡ä½Žå¸¦å®½è¿žæŽ¥è½¬å‘æ•°æ®åŒ…æµï¼ˆpackage stream)ã€‚è¿™äº›åŒ…å¯èƒ½è¢«å•æ’­åˆ°ä¸€ä¸ªæŽ¥æ”¶æ–¹ï¼Œä¹Ÿå¯èƒ½å¤šæ’­åˆ°å¦ä¸€ä¸ªçš„åœ°å€è€Œå‘ç»™å¤šä¸ªæŽ¥æ”¶æ–¹ã€‚RTPæŠ¥å¤´ä¸ºæ··é¢‘å™¨æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œä½¿å…¶èƒ½è¾¨è¯†å‡ºå¯¹æ··é¢‘åŽçš„åŒ…æœ‰ç”¨çš„æºï¼Œä»Žè€Œä¿è¯æä¾›ç»™æŽ¥æ”¶æ–¹æ­£ç¡®çš„è¯´è¯è€…æŒ‡ç¤ºã€‚ åœ¨éŸ³é¢‘ä¼šè®®ä¸­ï¼Œä¸€äº›é¢„å®šå‚ä¸Žè€…å°½ç®¡æœ‰é«˜å¸¦å®½è¿žæŽ¥ï¼Œä½†ä¸èƒ½é€šè¿‡IPå¤šæ’­ç›´æŽ¥æŽ¥å…¥ä¼šè®®ã€‚ä¾‹å¦‚ï¼Œä»–ä»¬å¯èƒ½ä½äºŽä¸€ä¸ªä¸å…è®¸ä»»ä½•IPåŒ…é€šè¿‡çš„åº”ç”¨å±‚é˜²ç«å¢™åŽé¢ã€‚å¯¹è¿™äº›ç«™ç‚¹ï¼Œå¯èƒ½å°±ä¸éœ€è¦æ··é¢‘ï¼Œè€Œéœ€è¦å¦ä¸€ç§ç§°ä¸ºè½¬æ¢å™¨çš„RTPå±‚æ¬¡ä¸­ç»§ã€‚å¯ä»¥åœ¨é˜²ç«å¢™ä¸¤ä¾§åˆ†åˆ«å®‰è£…ä¸€ä¸ªè½¬æ¢å™¨ï¼Œå¤–ä¾§è½¬æ¢å™¨å°†æ‰€æœ‰å¤šæ’­åŒ…é€šè¿‡å®‰å…¨è¿žæŽ¥è½¬å…¥å†…ä¾§è½¬æ¢å™¨ï¼Œå†…ä¾§è½¬æ¢å™¨å†è½¬å‘ç»™å†…éƒ¨ç½‘çš„ä¸€ä¸ªå¤šæ’­ç»„ï¼ˆmulticast group)ã€‚ æ··é¢‘å™¨å’Œè½¬æ¢å™¨å¯ä»¥è®¾è®¡æˆç”¨äºŽå„ç§ç›®çš„ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªè§†é¢‘æ··é¢‘å™¨åœ¨æµ‹é‡å¤šä¸ªä¸åŒè§†é¢‘æµä¸­å„äººçš„å•ç‹¬å½±åƒåŽï¼Œå°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªå•ä¸€è§†é¢‘æµæ¥æ¨¡æ‹Ÿç¾¤ç»„åœºæ™¯ã€‚åˆå¦‚ï¼Œåœ¨åªç”¨IP/UDPå’Œåªç”¨ST_IIçš„ä¸¤ä¸ªä¸»æœºç¾¤ä¹‹é—´é€šè¿‡è½¬æ¢å»ºç«‹è¿žæŽ¥ã€‚å†å¦‚ï¼Œåœ¨æ²¡æœ‰é‡æ–°åŒæ­¥æˆ–æ··é¢‘æ—¶ï¼Œç”¨packet-by-packetç¼–ç è½¬æ¢æ¥è‡ªå„ä¸ªç‹¬ç«‹æºçš„è§†é¢‘æµã€‚æ··é¢‘å™¨å’Œè½¬æ¢å™¨çš„æ“ä½œç»†èŠ‚è§ç« èŠ‚7ã€‚ 2.4 åˆ†å±‚ç¼–ç ï¼ˆLayered Encodingsï¼‰ ä¸ºäº†åŒ¹é…æŽ¥æ”¶æ–¹çš„èƒ½åŠ›ï¼ˆå®¹é‡ï¼‰ä»¥åŠé€‚åº”ç½‘ç»œæ‹¥å¡žï¼Œå¤šåª’ä½“åº”ç”¨ç¨‹åºåº”å½“èƒ½å¤Ÿè°ƒæ•´å…¶ä¼ è¾“é€ŸçŽ‡ã€‚è®¸å¤šåº”ç”¨å®žçŽ°æŠŠè°ƒé€‚ä¼ è¾“é€ŸçŽ‡çš„è´£ä»»æ”¾åœ¨æºç«¯ã€‚è¿™ç§åšæ³•åœ¨å¤šæ’­ä¼ è¾“ä¸­å¹¶ä¸å¥½ï¼Œå› ä¸ºä¸åŒæŽ¥æ”¶æ–¹å¯¹å¸¦å®½å­˜åœ¨ç€å†²çªæ€§éœ€æ±‚ã€‚è¿™ç»å¸¸å¯¼è‡´æœ€å°å…¬åˆ†æ¯çš„åœºæ™¯ï¼Œç½‘æ ¼ä¸­æœ€å°çš„ç®¡é“æ”¯é…äº†å…¨éƒ¨å®žå†µå¤šåª’ä½“â€œå¹¿æ’­â€çš„è´¨é‡å’Œä¿çœŸåº¦ã€‚ ç›¸ååœ°ï¼Œå¯ä»¥æŠŠåˆ†å±‚ç¼–ç å’Œåˆ†å±‚ä¼ è¾“ç³»ç»Ÿç»„åˆèµ·æ¥ï¼Œä»Žè€ŒæŠŠè°ƒé€‚é€ŸçŽ‡çš„è´£ä»»æ”¾åœ¨æŽ¥æ”¶ç«¯ã€‚åœ¨IPå¤šæ’­ä¹‹ä¸Šçš„RTPä¸Šä¸‹æ–‡ä¸­ï¼Œå¯¹ä¸€ä¸ªæ¨ªè·¨å¤šä¸ªRTPä¼šè¯ï¼ˆæ¯ä¸ªä¼šè¯åœ¨ç‹¬è‡ªå¤šæ’­ç»„ä¸Šå¼€å±•ï¼‰çš„åˆ†çº§è¡¨ç¤ºä¿¡å·(a hierarchically represented signal)ï¼Œæºèƒ½å¤ŸæŠŠå®ƒçš„åˆ†å±‚ï¼ˆlayers)åˆ†å‰²æˆæ¡ã€‚ æŽ¥æ”¶æ–¹ä»…éœ€åˆå¹¶é€‚å½“çš„å¤šæ’­ç»„å­é›†ï¼Œå°±èƒ½é€‚åº”å¼‚ç§ç½‘ç»œå’ŒæŽ§åˆ¶æŽ¥æ”¶å¸¦å®½ã€‚ RTPåˆ†å±‚ç¼–ç çš„ç»†èŠ‚åœ¨ç« èŠ‚6.3.9ï¼Œ8.3å’Œ11ä¸­ç»™å‡ºã€‚ 3. å®šä¹‰ï¼ˆdefinitions) RTPè´Ÿè½½ï¼ˆRTP payloadï¼‰ï¼šé€šè¿‡RTPä¼ è¾“çš„åŒ…ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼ŒéŸ³é¢‘æ ·æœ¬æˆ–åŽ‹ç¼©å¥½çš„è§†é¢‘æ•°æ®ã€‚è´Ÿè½½æ ¼å¼ä¸Žè§£é‡Šä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ã€‚ RTPåŒ…ï¼ˆRTP packetï¼‰ï¼šä¸€ç§æ•°æ®åŒ…ï¼Œå…¶ç»„æˆéƒ¨åˆ†æœ‰ï¼šä¸€ä¸ªå›ºå®šRTPæŠ¥å¤´ï¼Œä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„ä½œç”¨æºï¼ˆcontributing sourcesï¼‰åˆ—è¡¨ï¼ˆè§ä¸‹æ–‡ï¼‰ï¼Œä»¥åŠè´Ÿè½½æ•°æ®ã€‚ä¸€äº›ä¸‹å±‚åè®®å¯èƒ½è¦æ±‚å¯¹RTPåŒ…çš„å°è£…è¿›è¡Œå®šä¹‰ã€‚ä¸€èˆ¬åœ°ï¼Œä¸‹å±‚åè®®çš„ä¸€ä¸ªåŒ…åŒ…å«ä¸€ä¸ªRTPåŒ…ï¼Œä½†è‹¥å°è£…æ–¹æ³•å…è®¸ï¼Œä¹Ÿå¯åŒ…å«æ•°ä¸ªRTPåŒ…ï¼ˆè§ç« èŠ‚11ï¼‰ã€‚ RTCPåŒ…ï¼ˆRTCP packetï¼‰ï¼šä¸€ç§æŽ§åˆ¶åŒ…ï¼Œå…¶ç»„æˆéƒ¨åˆ†æœ‰ï¼šä¸€ä¸ªç±»ä¼¼RTPåŒ…çš„å›ºå®šæŠ¥å¤´ï¼ŒåŽè·Ÿä¸€ä¸ªç»“æž„åŒ–çš„éƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†å…·ä½“å…ƒç´ ä¾ä¸åŒRTCPåŒ…çš„ç±»åž‹è€Œå®šã€‚æ ¼å¼çš„å®šä¹‰è§ç« èŠ‚ï¼–ã€‚ä¸€èˆ¬åœ°ï¼Œå¤šä¸ªRTCPåŒ…å°†åœ¨ä¸€ä¸ªä¸‹å±‚åè®®çš„åŒ…ä¸­ä»¥åˆæˆRTCPåŒ…çš„å½¢å¼ä¼ è¾“ï¼›è¿™ä¾é RTCPåŒ…çš„å›ºå®šæŠ¥å¤´ä¸­çš„é•¿åº¦å­—æ®µæ¥å®žçŽ°ã€‚ ç«¯å£ï¼ˆPortï¼‰ï¼šâ€œä¼ è¾“åè®®ç”¨æ¥åœ¨åŒä¸€ä¸»æœºä¸­åŒºåˆ†ä¸åŒç›®çš„åœ°çš„ä¸€ç§æŠ½è±¡ã€‚TCP/IPåè®®ä½¿ç”¨æ­£æ•´æ•°æ¥æ ‡è¯†ä¸åŒç«¯å£ã€‚â€[12] OSIä¼ è¾“å±‚ä½¿ç”¨çš„ä¼ è¾“é€‰æ‹©å™¨ï¼ˆTSEL,the transport selectorsï¼‰ç­‰åŒäºŽè¿™é‡Œçš„ç«¯å£ã€‚RTPéœ€ä¾é ä½Žå±‚åè®®æä¾›çš„å¤šç§æœºåˆ¶ï¼Œå¦‚â€œç«¯å£â€ç”¨ä»¥å¤šè·¯å¤ç”¨ä¼šè¯ä¸­çš„RTPå’ŒRTCPåŒ…ã€‚ ä¼ è¾“åœ°å€(Transport address)ï¼šæ˜¯ç½‘ç»œåœ°å€ä¸Žç«¯å£çš„ç»“åˆï¼Œç”¨æ¥æ ‡è¯†ä¸€ä¸ªä¼ è¾“å±‚æ¬¡çš„ç»ˆç«¯ï¼Œä¾‹å¦‚ä¸€ä¸ªIPåœ°å€ä¸Žä¸€ä¸ªUDPç«¯å£ã€‚åŒ…æ˜¯ä»Žæºä¼ è¾“åœ°å€å‘é€åˆ°ç›®çš„ä¼ è¾“åœ°å€ã€‚ RTPåª’ä½“ç±»åž‹ï¼ˆRTP media typeï¼‰ï¼šä¸€ä¸ªRTPåª’ä½“ç±»åž‹æ˜¯ä¸€ä¸ªå•ç‹¬RTPä¼šè¯æ‰€è½½æœ‰çš„è´Ÿè½½ç±»åž‹çš„é›†åˆã€‚RTPé…ç½®æ–‡ä»¶æŠŠRTPåª’ä½“ç±»åž‹æŒ‡æ´¾ç»™RTPè´Ÿè½½ç±»åž‹ã€‚ å¤šåª’ä½“ä¼šè¯ï¼ˆMultimedia sessionï¼‰ï¼šåœ¨ä¸€ä¸ªå‚ä¸Žè€…å…¬å…±ç»„ä¸­ï¼Œå¹¶å‘çš„RTPä¼šè¯çš„é›†åˆã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè§†é¢‘ä¼šè®®ï¼ˆä¸ºå¤šåª’ä½“ä¼šè¯ï¼‰å¯èƒ½åŒ…å«ä¸€ä¸ªéŸ³é¢‘RTPä¼šè¯å’Œä¸€ä¸ªè§†é¢‘RTPä¼šè¯ã€‚ RTPä¼šè¯ï¼ˆRTP sessionï¼‰ï¼šä¸€ç¾¤å‚ä¸Žè€…é€šè¿‡RTPè¿›è¡Œé€šä¿¡æ—¶æ‰€äº§ç”Ÿçš„å…³è”ã€‚ä¸€ä¸ªå‚ä¸Žè€…å¯èƒ½åŒæ—¶å‚ä¸Žå¤šä¸ªRTPä¼šè¯ã€‚åœ¨ä¸€ä¸ªå¤šåª’ä½“ä¼šè¯ä¸­ï¼Œé™¤éžç¼–ç æ–¹å¼æŠŠå¤šç§åª’ä½“å¤šè·¯å¤ç”¨åˆ°ä¸€ä¸ªå•ä¸€æ•°æ®æµä¸­ï¼Œå¦åˆ™æ¯ç§åª’ä½“éƒ½å°†ä½¿ç”¨å„è‡ªçš„RTCPåŒ…ï¼Œé€šè¿‡å•ç‹¬çš„RTPä¼šè¯æ¥ä¼ é€ã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„ç›®çš„ä¼ è¾“åœ°å€å¯¹ï¼ˆä¸€ä¸ªç½‘ç»œåœ°å€åŠ ä¸Šä¸€å¯¹åˆ†åˆ«ç”¨äºŽRTPå’ŒRTCPçš„ç«¯å£ï¼Œæž„æˆäº†ä¸€ä¸ªä¼ è¾“åœ°å€å¯¹ï¼‰æ¥æŽ¥æ”¶ä¸åŒçš„ä¼šè¯ï¼Œå‚ä¸Žè€…èƒ½æŠŠå¤šä¸ªRTPä¼šè¯åŒºéš”å¼€æ¥ã€‚å•ä¸ªRTPä¼šè¯ä¸­çš„æ‰€æœ‰å‚ä¸Žè€…ï¼Œå¯èƒ½å…±äº«ä¸€ä¸ªå…¬ç”¨ç›®çš„ä¼ è¾“åœ°å€å¯¹ï¼Œæ¯”å¦‚IPå¤šæ’­çš„æƒ…å†µï¼›ä¹Ÿå¯èƒ½å„è‡ªä½¿ç”¨ä¸åŒçš„ç›®çš„ä¼ è¾“åœ°å€å¯¹ï¼Œæ¯”å¦‚ä¸ªä½“å•æ’­ç½‘ç»œåœ°å€åŠ ä¸Šä¸€ä¸ªç«¯å£å¯¹ã€‚å¯¹äºŽå•æ’­çš„æƒ…å†µï¼Œå‚ä¸Žè€…å¯èƒ½ä½¿ç”¨ç›¸åŒç«¯å£å¯¹æ¥æ”¶å¬å…¶ä»–æ‰€æœ‰å‚ä¸Žè€…ï¼Œä¹Ÿå¯èƒ½å¯¹æ¥å…¶ä»–æ¯ä¸ªå‚ä¸Žè€…ä½¿ç”¨ä¸åŒçš„ç«¯å£å¯¹æ¥æ”¶å¬ã€‚ RTPä¼šè¯é—´ç›¸äº’åŒºåˆ«çš„ç‰¹å¾ï¼Œåœ¨äºŽæ¯ä¸ªRTPä¼šè¯éƒ½ç»´æŠ¤ä¸€ä¸ªç”¨äºŽSSRCæ ‡è¯†ç¬¦çš„ç‹¬ç«‹å®Œæ•´çš„ç©ºé—´ã€‚RTPä¼šè¯æ‰€åŒ…å«çš„å‚ä¸Žè€…ç»„ï¼Œç”±èƒ½æŽ¥æ”¶SSRCæ ‡è¯†ç¬¦çš„å‚ä¸Žè€…ç»„æˆï¼Œè¿™äº›SSRCæ ‡è¯†ç¬¦ç”±RTPï¼ˆåŒæ­¥æºæˆ–ä½œç”¨æºï¼‰æˆ–RTCPä¸­çš„ä»»æ„å‚ä¸Žè€…ä¼ é€’ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹è¿°æƒ…å†µï¼Œç”¨å•æ’­UDPå®žçŽ°çš„ä¸‰æ–¹ä¼šè®®ï¼Œæ¯æ–¹éƒ½ç”¨ä¸åŒçš„ç«¯å£å¯¹æ¥æ”¶å¬å…¶ä»–ä¸¤æ–¹ã€‚å¦‚æžœæ”¶åˆ°ä¸€æ–¹çš„æ•°æ®ï¼Œå°±åªæŠŠRTCPåé¦ˆå‘é€ç»™é‚£ä¸€æ–¹ï¼Œåˆ™ä¼šè®®å°±ç›¸å½“äºŽç”±ä¸‰ä¸ªå•ç‹¬çš„ç‚¹åˆ°ç‚¹RTPä¼šè¯æž„æˆï¼›å¦‚æžœæ”¶åˆ°ä¸€æ–¹çš„æ•°æ®ï¼Œå´æŠŠRTCPåé¦ˆå‘é€å¦ä¸¤æ–¹ï¼Œåˆ™ä¼šè®®å°±æ˜¯ç”±ä¸€ä¸ªå¤šæ–¹ï¼ˆmulti-party)RTPä¼šè¯æž„æˆã€‚åŽè€…æ¨¡æ‹Ÿäº†ä¸‰æ–¹é—´è¿›è¡ŒIPå¤šæ’­é€šä¿¡æ—¶çš„è¡Œä¸ºã€‚ RTPæ¡†æž¶å…è®¸ä¸Šè¿°è§„å®šå‘ç”Ÿå˜åŒ–ï¼Œä½†ä¸€ä¸ªç‰¹å®šçš„æŽ§åˆ¶åè®®æˆ–è€…åº”ç”¨ç¨‹åºåœ¨è®¾è®¡æ—¶å¸¸å¸¸å¯¹å˜åŒ–ä½œå‡ºçº¦æŸã€‚ åŒæ­¥æº(SSRCï¼ŒSynchronization source)ï¼šRTPåŒ…æµçš„æºï¼Œç”¨RTPæŠ¥å¤´ä¸­32ä½æ•°å€¼çš„SSRCæ ‡è¯†ç¬¦è¿›è¡Œæ ‡è¯†ï¼Œä½¿å…¶ä¸ä¾èµ–äºŽç½‘ç»œåœ°å€ã€‚ä¸€ä¸ªåŒæ­¥æºçš„æ‰€æœ‰åŒ…æž„æˆäº†ç›¸åŒè®¡æ—¶å’Œåºåˆ—å·ç©ºé—´çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·æŽ¥æ”¶æ–¹å°±å¯ä»¥æŠŠä¸€ä¸ªåŒæ­¥æºçš„åŒ…æ”¾åœ¨ä¸€èµ·ï¼Œæ¥è¿›è¡Œé‡æ”¾ã€‚ä¸¾äº›åŒæ­¥æºçš„ä¾‹å­ï¼Œåƒæ¥è‡ªåŒä¸€ä¿¡å·æºçš„åŒ…æµçš„å‘é€æ–¹ï¼Œå¦‚éº¦å…‹é£Žã€æ‘„å½±æœºã€RTPæ··é¢‘å™¨ï¼ˆè§ä¸‹æ–‡ï¼‰å°±æ˜¯åŒæ­¥æºã€‚ä¸€ä¸ªåŒæ­¥æºå¯èƒ½éšç€æ—¶é—´å˜åŒ–è€Œæ”¹å˜å…¶æ•°æ®æ ¼å¼ï¼Œå¦‚éŸ³é¢‘ç¼–ç ã€‚SSRCæ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªéšæœºé€‰å–çš„å€¼ï¼Œå®ƒåœ¨ç‰¹å®šçš„RTPä¼šè¯ä¸­æ˜¯å…¨å±€å”¯ä¸€ï¼ˆglobally uniqueï¼‰çš„ï¼ˆè§ç« èŠ‚8ï¼‰ã€‚å‚ä¸Žè€…å¹¶ä¸éœ€è¦åœ¨ä¸€ä¸ªå¤šåª’ä½“ä¼šè®®çš„æ‰€æœ‰RTPä¼šè¯ä¸­ï¼Œä½¿ç”¨ç›¸åŒçš„SSRCæ ‡è¯†ç¬¦ï¼›SSRCæ ‡è¯†ç¬¦çš„ç»‘å®šé€šè¿‡RTCPï¼ˆè§ç« èŠ‚6.5.1ï¼‰ã€‚å¦‚æžœå‚ä¸Žè€…åœ¨ä¸€ä¸ªRTPä¼šè¯ä¸­ç”Ÿæˆäº†å¤šä¸ªæµï¼Œä¾‹å¦‚æ¥è‡ªå¤šä¸ªæ‘„å½±æœºï¼Œåˆ™æ¯ä¸ªæ‘„å½±æœºéƒ½å¿…é¡»æ ‡è¯†æˆå•ç‹¬çš„åŒæ­¥æºã€‚ ä½œç”¨æºï¼ˆCSRCï¼ŒContributing source )ï¼šè‹¥ä¸€ä¸ªRTPåŒ…æµçš„æºï¼Œå¯¹ç”±RTPæ··é¢‘å™¨ç”Ÿæˆçš„ç»„åˆæµèµ·äº†ä½œç”¨ï¼Œåˆ™å®ƒå°±æ˜¯ä¸€ä¸ªä½œç”¨æºã€‚å¯¹ç‰¹å®šåŒ…çš„ç”Ÿæˆèµ·ä½œç”¨çš„æºï¼Œå…¶SSRCæ ‡è¯†ç¬¦ç»„æˆçš„åˆ—è¡¨ï¼Œè¢«æ··é¢‘å™¨æ’å…¥åˆ°åŒ…çš„RTPæŠ¥å¤´ä¸­ã€‚è¿™ä¸ªåˆ—è¡¨å«åšCSRCè¡¨ã€‚ç›¸å…³åº”ç”¨çš„ä¾‹å­å¦‚ï¼Œåœ¨éŸ³é¢‘ä¼šè®®ä¸­ï¼Œæ··é¢‘å™¨å‘æ‰€æœ‰çš„è¯´è¯äººï¼ˆtalker)æŒ‡å‡ºï¼Œè°çš„è¯è¯­ï¼ˆspeech)å°†è¢«ç»„åˆåˆ°å³å°†å‘å‡ºçš„åŒ…ä¸­ï¼Œå³ä¾¿æ‰€æœ‰çš„åŒ…éƒ½åŒ…å«åœ¨åŒä¸€ä¸ªï¼ˆæ··é¢‘å™¨çš„ï¼‰SSRCæ ‡è¯†ç¬¦ä¸­ï¼Œä¹Ÿå¯è®©å¬è€…ï¼ˆæŽ¥æ”¶è€…ï¼‰å¯ä»¥æ¸…æ¥šè°æ˜¯å½“å‰è¯´è¯äººã€‚ ç»ˆç«¯ç³»ç»Ÿï¼ˆEnd system)ï¼šä¸€ç§åº”ç”¨ç¨‹åºï¼Œå®ƒäº§ç”Ÿå‘é€å‡ºçš„RTPåŒ…ä¸­å†…å®¹ï¼Œæˆ–è€…ä½¿ç”¨æŽ¥æ”¶åˆ°çš„RTPåŒ…ä¸­å†…å®¹ã€‚åœ¨ä¸€ä¸ªç‰¹å®šçš„RTPä¼šè¯ä¸­ï¼Œä¸€ä¸ªç»ˆç«¯ç³»ç»Ÿå¯ä»¥æ‰®æ¼”ä¸€ä¸ªæˆ–å¤šä¸ªåŒæ­¥æºè§’è‰²ï¼Œä½†é€šå¸¸æ˜¯ä¸€ä¸ªã€‚ æ··é¢‘å™¨ï¼ˆMixer)ï¼šä¸€ç§ä¸­é—´ç³»ç»Ÿï¼Œå®ƒä»Žä¸€ä¸ªæˆ–å¤šä¸ªæºä¸­æŽ¥æ”¶RTPåŒ…ï¼Œå¯èƒ½æ”¹å˜å…¶æ•°æ®æ ¼å¼ï¼Œå†æŒ‰æŸç§æ–¹å¼æŠŠè¿™äº›åŒ…ç»„åˆæˆä¸€ä¸ªæ–°çš„åŒ…ï¼Œç„¶åŽè½¬å‘å‡ºåŽ»ã€‚ç”±äºŽå¤šä¸ªè¾“å…¥æºçš„è®¡æ—¶ä¸€èˆ¬ä¸ä¼šåŒæ­¥ï¼Œæ‰€ä»¥æ··é¢‘å™¨ä¼šå¯¹å„ä¸ªæµçš„è®¡æ—¶ä½œå‡ºè°ƒæ•´ï¼Œå¹¶ä¸ºç»„åˆæµç”Ÿæˆä¸€ä¸ªæ–°çš„è®¡æ—¶ã€‚å› æ­¤ï¼Œæ··é¢‘å™¨å°†è¢«æ ‡è¯†æˆå®ƒæ‰€äº§ç”Ÿæ‰€æœ‰æ•°æ®åŒ…çš„åŒæ­¥æºã€‚ è½¬æ¢å™¨ï¼ˆTranslator)ï¼šä¸€ç§ä¸­é—´ç³»ç»Ÿï¼Œå®ƒè½¬å‘RTPåŒ…è€Œä¸æ”¹å˜å„åŒ…çš„åŒæ­¥æºæ ‡è¯†ç¬¦ã€‚è½¬æ¢å™¨çš„ä¾‹å­å¦‚ä¸‹ï¼šä¸ä½œæ··é¢‘åœ°è½¬å˜ç¼–ç çš„è®¾å¤‡ï¼ŒæŠŠå¤šæ’­å¤åˆ¶åˆ°å•æ’­çš„é‡å¤è£…ç½®ï¼Œä»¥åŠé˜²ç«å¢™é‡Œåº”ç”¨å±‚æ¬¡çš„è¿‡æ»¤å™¨ã€‚ ç›‘è§†å™¨(Monitor)ï¼šä¸€ç§åº”ç”¨ç¨‹åºï¼Œå®ƒæŽ¥æ”¶RTPä¼šè¯å‚ä¸Žè€…æ‰€å‘é€çš„RTCPåŒ…ï¼Œç‰¹åˆ«æ˜¯æŽ¥æ”¶æŠ¥å‘Šï¼ˆreception report)ï¼Œè€Œä¸”å¯¹å½“å‰æœåŠ¡è´¨é‡è¿›è¡Œè¯„ä¼°ï¼Œè¯„ä¼°ç»“æžœç”¨äºŽåˆ†é…ç›‘è§†ä»»åŠ¡ï¼Œæ•…éšœè¯Šæ–­å’Œé•¿æœŸç»Ÿè®¡ã€‚ç›‘è§†å™¨å¸¸å¸¸è¢«å†…å»ºåˆ°å‚ä¸Žä¼šè¯çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªçš„ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºâ€”â€”ä¸å‚åŠ ä¼šè¯ã€ä¹Ÿä¸å‘é€æˆ–æŽ¥æ”¶RTPæ•°æ®åŒ…ï¼ˆå› ä¸ºå®ƒä»¬åœ¨ä¸åŒçš„ç«¯å£ä¸Šï¼‰ã€‚è¿™äº›è¢«ç§°ä½œç¬¬ä¸‰æ–¹ç›‘è§†å™¨ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µä¹Ÿæ˜¯å¯ä»¥æŽ¥å—çš„ï¼Œç¬¬ä¸‰æ–¹ç›‘è§†å™¨åªæŽ¥æ”¶ä½†ä¸å‘é€æ•°æ®åŒ…ï¼Œæˆ–è€…å¦å¤–åœ°ç®—å…¥åˆ°ä¼šè¯ä¸­ã€‚ éžRTPé€”å¾„ï¼ˆNon-RTP means)ï¼šä¸ºæä¾›ä¸€ä¸ªå¯ç”¨çš„æœåŠ¡ï¼Œå¯èƒ½è¿˜éœ€è¦å…¶ä»–çš„åè®®å’Œæœºåˆ¶ã€‚ç‰¹åˆ«åœ°ï¼Œå¯¹å¤šåª’ä½“ä¼šè®®æ¥è¯´ï¼Œä¸€ä¸ªæŽ§åˆ¶åè®®å¯ä»¥å‘å¸ƒå¤šæ’­åœ°å€ï¼Œå‘å¸ƒåŠ å¯†å¯†é’¥ï¼Œåå•†æ‰€ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œä»¥åŠä¸ºæ²¡æœ‰é¢„å®šä¹‰è´Ÿè½½ç±»åž‹å€¼çš„æ ¼å¼ï¼Œå»ºç«‹è´Ÿè½½ç±»åž‹å€¼å’Œå…¶æ‰€ä»£è¡¨çš„è´Ÿè½½æ ¼å¼ä¹‹é—´çš„åŠ¨æ€æ˜ å°„ã€‚å…¶ä»–åè®®çš„ä¾‹å­å¦‚ä¸‹ï¼šä¼šè¯åˆå§‹åŒ–åè®®ï¼ˆSIRFC3261[13]ï¼‰ï¼ŒITUæŽ¨èçš„H.323[14]ï¼Œè¿˜æœ‰ä½¿ç”¨SDP(RFC2327[15])çš„åº”ç”¨ç¨‹åºï¼Œå¦‚RTSP(RFC 2326[16]). å¯¹äºŽç®€å•çš„åº”ç”¨ç¨‹åºï¼Œç”µå­é‚®ä»¶æˆ–è€…ä¼šè®®æ•°æ®åº“ä¹Ÿå¯èƒ½ç”¨åˆ°ã€‚å¯¹è¿™äº›åè®®å’Œæœºåˆ¶çš„è¯¦ç»†è¯´æ˜Žå·²ç»è¶…å‡ºäº†æœ¬æ–‡æ¡£çš„è®¨è®ºèŒƒå›´ã€‚ 5 RTPæ•°æ®ä¼ è¾“åè®® 5.1 RTPå›ºå®šå¤´ä¸­çš„å„å­—æ®µ RTPå¤´æœ‰ä»¥ä¸‹æ ¼å¼:123456789101112 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+|V=2|P|X| CC |M| PT | sequence number |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+| timestamp |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+| synchronization source (SSRC) identifier |+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+| contributing source (CSRC) identifiers || .... |+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ RTPåŒ…å¤´æ ¼å¼ å‰12ä¸ªå­—èŠ‚å‡ºçŽ°åœ¨æ¯ä¸ªRTPåŒ…ä¸­ï¼Œä»…ä»…åœ¨è¢«æ··åˆå™¨æ’å…¥æ—¶ï¼Œæ‰å‡ºçŽ°CSRCè¯†åˆ«ç¬¦åˆ—è¡¨ã€‚è¿™äº›åŸŸæœ‰ä»¥ä¸‹æ„ä¹‰ï¼š ç‰ˆæœ¬(V)ï¼š2æ¯”ç‰¹ æ­¤åŸŸå®šä¹‰äº†RTPçš„ç‰ˆæœ¬ã€‚æ­¤åè®®å®šä¹‰çš„ç‰ˆæœ¬æ˜¯2ã€‚(å€¼1è¢«RTPè‰æ¡ˆç‰ˆæœ¬ä½¿ç”¨ï¼Œå€¼0ç”¨åœ¨æœ€åˆâ€vatâ€è¯­éŸ³å·¥å…·ä½¿ç”¨çš„åè®®ä¸­ã€‚) å¡«å……(P)ï¼š1æ¯”ç‰¹ è‹¥å¡«æ–™æ¯”ç‰¹è¢«è®¾ç½®ï¼Œåˆ™æ­¤åŒ…åŒ…å«ä¸€åˆ°å¤šä¸ªé™„åŠ åœ¨æœ«ç«¯çš„å¡«å……æ¯”ç‰¹ï¼Œå¡«å……æ¯”ç‰¹ä¸ç®—ä½œè´Ÿè½½çš„ä¸€éƒ¨åˆ†ã€‚å¡«å……çš„æœ€åŽä¸€ä¸ªå­—èŠ‚æŒ‡æ˜Žå¯ä»¥å¿½ç•¥å¤šå°‘ä¸ªå¡«å……æ¯”ç‰¹ã€‚å¡«å……å¯èƒ½ç”¨äºŽæŸäº›å…·æœ‰å›ºå®šé•¿åº¦çš„åŠ å¯†ç®—æ³•ï¼Œæˆ–è€…ç”¨äºŽåœ¨åº•å±‚æ•°æ®å•å…ƒä¸­ä¼ è¾“å¤šä¸ªRTPåŒ…ã€‚ æ‰©å±•(X)ï¼š1æ¯”ç‰¹ è‹¥è®¾ç½®æ‰©å±•æ¯”ç‰¹ï¼Œå›ºå®šå¤´(ä»…)åŽé¢è·Ÿéšä¸€ä¸ªå¤´æ‰©å±•ã€‚ CSRCè®¡æ•°(CC)ï¼š4æ¯”ç‰¹ CSRCè®¡æ•°åŒ…å«äº†è·Ÿåœ¨å›ºå®šå¤´åŽé¢CSRCè¯†åˆ«ç¬¦çš„æ•°ç›®ã€‚ æ ‡å¿—(M)ï¼š1æ¯”ç‰¹ æ ‡å¿—çš„è§£é‡Šç”±å…·ä½“åè®®è§„å®šã€‚å®ƒç”¨æ¥å…è®¸åœ¨æ¯”ç‰¹æµä¸­æ ‡è®°é‡è¦çš„äº‹ä»¶ï¼Œå¦‚å¸§è¾¹ç•Œã€‚ è´Ÿè½½ç±»åž‹(PT)ï¼š7æ¯”ç‰¹ æ­¤åŸŸå®šä¹‰äº†è´Ÿè½½çš„æ ¼å¼ï¼Œç”±å…·ä½“åº”ç”¨å†³å®šå…¶è§£é‡Šã€‚åè®®å¯ä»¥è§„å®šè´Ÿè½½ç±»åž‹ç å’Œè´Ÿè½½æ ¼å¼ä¹‹é—´ä¸€ä¸ªé»˜è®¤çš„åŒ¹é…ã€‚å…¶ä»–çš„è´Ÿè½½ç±»åž‹ç å¯ä»¥é€šè¿‡éžRTPæ–¹æ³•åŠ¨æ€å®šä¹‰ã€‚RTPå‘é€ç«¯åœ¨ä»»æ„ç»™å®šæ—¶é—´å‘å‡ºä¸€ä¸ªå•ç‹¬çš„RTPè´Ÿè½½ç±»åž‹ï¼›æ­¤åŸŸä¸ç”¨æ¥å¤ç”¨ä¸åŒçš„åª’ä½“æµã€‚ åºåˆ—å·ï¼ˆsequence numberï¼‰ï¼š16æ¯”ç‰¹ æ¯å‘é€ä¸€ä¸ªRTPæ•°æ®åŒ…ï¼Œåºåˆ—å·åŠ 1ï¼ŒæŽ¥æ”¶ç«¯å¯ä»¥æ®æ­¤æ£€æµ‹ä¸¢åŒ…å’Œé‡å»ºåŒ…åºåˆ—ã€‚åºåˆ—å·çš„åˆå§‹å€¼æ˜¯éšæœºçš„(ä¸å¯é¢„æµ‹)ï¼Œä»¥ä½¿å³ä¾¿åœ¨æºæœ¬èº«ä¸åŠ å¯†æ—¶(æœ‰æ—¶åŒ…è¦é€šè¿‡ç¿»è¯‘å™¨ï¼Œå®ƒä¼šè¿™æ ·åš)ï¼Œå¯¹åŠ å¯†ç®—æ³•æ³›çŸ¥çš„æ™®é€šæ–‡æœ¬æ”»å‡»ä¹Ÿä¼šæ›´åŠ å›°éš¾ã€‚ æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ 32æ¯”ç‰¹æ—¶é—´æˆ³åæ˜ äº†RTPæ•°æ®åŒ…ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚çš„é‡‡æ ·æ—¶é—´ã€‚æ—¶é’Ÿé¢‘çŽ‡ä¾èµ–äºŽè´Ÿè½½æ•°æ®æ ¼å¼ï¼Œå¹¶åœ¨æè¿°æ–‡ä»¶ï¼ˆprofileï¼‰ä¸­è¿›è¡Œæè¿°ã€‚ä¹Ÿå¯ä»¥é€šè¿‡RTPæ–¹æ³•å¯¹è´Ÿè½½æ ¼å¼åŠ¨æ€æè¿°ã€‚ å¦‚æžœRTPåŒ…æ˜¯å‘¨æœŸæ€§äº§ç”Ÿçš„ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨ç”±é‡‡æ ·æ—¶é’Ÿå†³å®šçš„åä¹‰ä¸Šçš„é‡‡æ ·æ—¶åˆ»ï¼Œè€Œä¸æ˜¯è¯»å–ç³»ç»Ÿæ—¶é—´ã€‚ä¾‹å¦‚ï¼Œå¯¹ä¸€ä¸ªå›ºå®šé€ŸçŽ‡çš„éŸ³é¢‘ï¼Œé‡‡æ ·æ—¶é’Ÿå°†åœ¨æ¯ä¸ªå‘¨æœŸå†…å¢žåŠ 1ã€‚å¦‚æžœä¸€ä¸ªéŸ³é¢‘ä»Žè¾“å…¥è®¾å¤‡ä¸­è¯»å–å«æœ‰160ä¸ªé‡‡æ ·å‘¨æœŸçš„å—ï¼Œé‚£ä¹ˆå¯¹æ¯ä¸ªå—ï¼Œæ—¶é—´æˆ³çš„å€¼å¢žåŠ 160ã€‚ æ—¶é—´æˆ³çš„åˆå§‹å€¼åº”å½“æ˜¯éšæœºçš„ï¼Œå°±åƒåºå·ä¸€æ ·ã€‚å‡ ä¸ªè¿žç»­çš„RTPåŒ…å¦‚æžœæ˜¯åŒæ—¶äº§ç”Ÿçš„ã€‚å¦‚ï¼šå±žäºŽåŒä¸€ä¸ªè§†é¢‘å¸§çš„RTPåŒ…ï¼Œå°†æœ‰ç›¸åŒçš„åºåˆ—å·ã€‚ ä¸åŒåª’ä½“æµçš„RTPæ—¶é—´æˆ³å¯èƒ½ä»¥ä¸åŒçš„é€ŸçŽ‡å¢žé•¿ã€‚è€Œä¸”ä¼šæœ‰ç‹¬ç«‹çš„éšæœºåç§»é‡ã€‚å› æ­¤ï¼Œè™½ç„¶è¿™äº›æ—¶é—´æˆ³è¶³ä»¥é‡æž„ä¸€ä¸ªå•ç‹¬çš„æµçš„æ—¶é—´ï¼Œä½†ç›´æŽ¥æ¯”è¾ƒä¸åŒçš„åª’ä½“æµçš„æ—¶é—´æˆ³ä¸èƒ½è¿›è¡ŒåŒæ­¥ã€‚å¯¹äºŽæ¯ä¸€ä¸ªåª’ä½“ï¼Œæˆ‘ä»¬æŠŠä¸Žé‡‡æ ·æ—¶åˆ»ç›¸å…³è”çš„RTPæ—¶é—´æˆ³ä¸Žæ¥è‡ªäºŽå‚è€ƒæ—¶é’Ÿä¸Šçš„æ—¶é—´æˆ³ï¼ˆNTPï¼‰ç›¸å…³è”ã€‚å› æ­¤å‚è€ƒæ—¶é’Ÿçš„æ—¶é—´æˆ³å°±äº†æ•°æ®çš„é‡‡æ ·æ—¶é—´ã€‚ï¼ˆå³ï¼šRTPæ—¶é—´æˆ³å¯ç”¨æ¥å®žçŽ°ä¸åŒåª’ä½“æµçš„åŒæ­¥ï¼ŒNTPæ—¶é—´æˆ³è§£å†³äº†RTPæ—¶é—´æˆ³æœ‰éšæœºåç§»é‡çš„é—®é¢˜ã€‚ï¼‰å‚è€ƒæ—¶é’Ÿç”¨äºŽåŒæ­¥æ‰€æœ‰åª’ä½“çš„å…±åŒæ—¶é—´ã€‚è¿™ä¸€æ—¶é—´æˆ³å¯¹ï¼ˆRTPæ—¶é—´æˆ³å’ŒNTPæ—¶é—´æˆ³ï¼‰ï¼Œç”¨äºŽåˆ¤æ–­RTPæ—¶é—´æˆ³å’ŒNTPæ—¶é—´æˆ³çš„å¯¹åº”å…³ç³»ï¼Œä»¥è¿›è¡Œåª’ä½“æµçš„åŒæ­¥ã€‚å®ƒä»¬ä¸æ˜¯åœ¨æ¯ä¸€ä¸ªæ•°æ®åŒ…ä¸­éƒ½è¢«å‘é€ï¼Œè€Œåœ¨å‘é€é€ŸçŽ‡æ›´ä½Žçš„RTCPçš„SRï¼ˆå‘é€è€…æŠ¥å‘Šï¼‰ä¸­ã€‚ å¦‚æžœä¼ è¾“çš„æ•°æ®æ˜¯å­˜è´®å¥½çš„ï¼Œè€Œä¸æ˜¯å®žæ—¶é‡‡æ ·ç­‰åˆ°çš„ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨ä»Žå‚è€ƒæ—¶é’Ÿå¾—åˆ°çš„è™šçš„è¡¨ç¤ºæ—¶é—´çº¿ï¼ˆvirtual presentation timelineï¼‰ã€‚ä»¥ç¡®å®šå­˜è´®æ•°æ®ä¸­çš„æ¯ä¸ªåª’ä½“ä¸‹ä¸€å¸§æˆ–ä¸‹ä¸€ä¸ªå•å…ƒåº”è¯¥å‘ˆçŽ°çš„æ—¶é—´ã€‚æ­¤ç§æƒ…å†µä¸‹RTPæ—¶é—´æˆ³åæ˜ äº†æ¯ä¸€ä¸ªå•å…ƒåº”å½“å›žæ”¾çš„æ—¶é—´ã€‚çœŸæ­£çš„å›žæ”¾å°†ç”±æŽ¥æ”¶è€…å†³å®šã€‚ SSRCï¼š32æ¯”ç‰¹ ç”¨ä»¥è¯†åˆ«åŒæ­¥æºã€‚æ ‡è¯†ç¬¦è¢«éšæœºç”Ÿæˆï¼Œä»¥ä½¿åœ¨åŒä¸€ä¸ªRTPä¼šè¯æœŸä¸­æ²¡æœ‰ä»»ä½•ä¸¤ä¸ªåŒæ­¥æºæœ‰ç›¸åŒçš„SSRCè¯†åˆ«ç¬¦ã€‚å°½ç®¡å¤šä¸ªæºé€‰æ‹©åŒä¸€ä¸ªSSRCè¯†åˆ«ç¬¦çš„æ¦‚çŽ‡å¾ˆä½Žï¼Œæ‰€æœ‰RTPå®žçŽ°å·¥å…·éƒ½å¿…é¡»å‡†å¤‡æ£€æµ‹å’Œè§£å†³å†²çªã€‚è‹¥ä¸€ä¸ªæºæ”¹å˜æœ¬èº«çš„æºä¼ è¾“åœ°å€ï¼Œå¿…é¡»é€‰æ‹©æ–°çš„SSRCè¯†åˆ«ç¬¦ï¼Œä»¥é¿å…è¢«å½“ä½œä¸€ä¸ªçŽ¯è·¯æºã€‚ CSRCåˆ—è¡¨ï¼š0åˆ°15é¡¹ï¼Œæ¯é¡¹32æ¯”ç‰¹ CSRCåˆ—è¡¨è¯†åˆ«åœ¨æ­¤åŒ…ä¸­è´Ÿè½½çš„æ‰€æœ‰è´¡çŒ®æºã€‚è¯†åˆ«ç¬¦çš„æ•°ç›®åœ¨CCåŸŸä¸­ç»™å®šã€‚è‹¥æœ‰è´¡çŒ®æºå¤šäºŽ15ä¸ªï¼Œä»…è¯†åˆ«15ä¸ªã€‚CSRCè¯†åˆ«ç¬¦ç”±æ··åˆå™¨æ’å…¥ï¼Œå¹¶åˆ—å‡ºæ‰€æœ‰è´¡çŒ®æºçš„SSRCè¯†åˆ«ç¬¦ã€‚ä¾‹å¦‚è¯­éŸ³åŒ…ï¼Œæ··åˆäº§ç”Ÿæ–°åŒ…çš„æ‰€æœ‰æºçš„SSRCæ ‡è¯†ç¬¦éƒ½è¢«åˆ—å‡ºï¼Œä»¥åœ¨æŽ¥æ”¶ç«¯å¤„æ­£ç¡®æŒ‡ç¤ºå‚ä¸Žè€…ã€‚ 5.3.1 RTPå¤´æ‰©å±• RTPæä¾›æ‰©å±•æœºåˆ¶ä»¥å…è®¸å®žçŽ°ä¸ªæ€§åŒ–ï¼šæŸäº›æ–°çš„ä¸Žè´Ÿè½½æ ¼å¼ç‹¬ç«‹çš„åŠŸèƒ½è¦æ±‚çš„é™„åŠ ä¿¡æ¯åœ¨RTPæ•°æ®åŒ…å¤´ä¸­ä¼ è¾“ã€‚è®¾è®¡æ­¤æ–¹æ³•å¯ä»¥ä½¿å…¶å®ƒæ²¡æœ‰æ‰©å±•çš„äº¤äº’å¿½ç•¥æ­¤å¤´æ‰©å±•ã€‚RTPå¤´æ‰©å±•çš„æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ 12345670 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | defined by profile | length | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | header extension | | .... | è‹¥RTPå¤´ä¸­çš„æ‰©å±•æ¯”ç‰¹ä½ç½®1ï¼Œåˆ™ä¸€ä¸ªé•¿åº¦å¯å˜çš„å¤´æ‰©å±•éƒ¨åˆ†è¢«åŠ åˆ°RTPå›ºå®šå¤´ä¹‹åŽã€‚å¤´æ‰©å±•åŒ…å«16æ¯”ç‰¹çš„é•¿åº¦åŸŸï¼ŒæŒ‡ç¤ºæ‰©å±•é¡¹ä¸­32æ¯”ç‰¹å­—çš„ä¸ªæ•°ï¼Œä¸åŒ…æ‹¬4ä¸ªå­—èŠ‚æ‰©å±•å¤´(å› æ­¤é›¶æ˜¯æœ‰æ•ˆå€¼)ã€‚RTPå›ºå®šå¤´ä¹‹åŽåªå…è®¸æœ‰ä¸€ä¸ªå¤´æ‰©å±•ã€‚ä¸ºå…è®¸å¤šä¸ªäº’æ“ä½œå®žçŽ°ç‹¬ç«‹ç”Ÿæˆä¸åŒçš„å¤´æ‰©å±•ï¼Œæˆ–æŸç§ç‰¹å®šå®žçŽ°æœ‰å¤šç§ä¸åŒçš„å¤´æ‰©å±•ï¼Œæ‰©å±•é¡¹çš„å‰16æ¯”ç‰¹ç”¨ä»¥è¯†åˆ«æ ‡è¯†ç¬¦æˆ–å‚æ•°ã€‚è¿™16æ¯”ç‰¹çš„æ ¼å¼ç”±å…·ä½“å®žçŽ°çš„ä¸Šå±‚åè®®å®šä¹‰ã€‚åŸºæœ¬çš„RTPè¯´æ˜Žå¹¶ä¸å®šä¹‰ä»»ä½•å¤´æ‰©å±•æœ¬èº«ã€‚ 6 RTPæŽ§åˆ¶åè®®RTCP RTPæŽ§åˆ¶åè®®(RTCP)å‘ä¼šè®®ä¸­æ‰€æœ‰æˆå‘˜å‘¨æœŸæ€§å‘é€æŽ§åˆ¶åŒ…ã€‚å®ƒä½¿ç”¨ä¸Žæ•°æ®åŒ…ç›¸åŒçš„ä¼ è¾“æœºåˆ¶ã€‚åº•å±‚åè®®å¿…é¡»æä¾›æ•°æ®åŒ…å’ŒæŽ§åˆ¶åŒ…çš„å¤ç”¨ï¼Œä¾‹å¦‚ç”¨ä¸åŒçš„UDPç«¯å£ã€‚RTCPæä¾›ä»¥ä¸‹å››ä¸ªåŠŸèƒ½ï¼šâ—‹åŸºæœ¬åŠŸèƒ½æ˜¯æä¾›æ•°æ®ä¼ è¾“è´¨é‡çš„åé¦ˆã€‚è¿™æ˜¯RTPä½œä¸ºä¸€ç§ä¼ è¾“åè®®çš„ä¸»è¦ä½œç”¨ï¼Œå®ƒä¸Žå…¶ä»–åè®®çš„æµé‡å’Œæ‹¥å¡žæŽ§åˆ¶ç›¸å…³ã€‚åé¦ˆå¯èƒ½å¯¹è‡ªé€‚åº”ç¼–ç æœ‰ç›´æŽ¥ä½œç”¨ï¼Œå¹¶ä¸”IPç»„æ’­çš„å®žéªŒè¡¨æ˜Žå®ƒå¯¹äºŽä»ŽæŽ¥æ”¶ç«¯å¾—åˆ°åé¦ˆä¿¡æ¯ä»¥è¯Šæ–­ä¼ è¾“æ•…éšœä¹Ÿæœ‰å†³å®šæ€§ä½œç”¨ã€‚å‘æ‰€æœ‰æˆå‘˜å‘é€æŽ¥æ”¶åé¦ˆå¯ä»¥ä½¿â€è§‚å¯Ÿå‘˜â€è¯„ä¼°è¿™äº›é—®é¢˜æ˜¯å±€éƒ¨çš„è¿˜æ˜¯å…¨å±€çš„ã€‚åˆ©ç”¨ç±»ä¼¼å¤šç‚¹å¹¿æ’­çš„ä¼ è¾“æœºåˆ¶ï¼Œå¯ä»¥ä½¿æŸäº›å®žä½“ï¼Œè¯¸å¦‚æ²¡æœ‰åŠ å…¥ä¼šè®®çš„ç½‘ç»œä¸šåŠ¡è§‚å¯Ÿå‘˜ï¼ŒæŽ¥æ”¶åˆ°åé¦ˆä¿¡æ¯å¹¶ä½œä¸ºç¬¬ä¸‰æ–¹ç›‘è§†å‘˜æ¥è¯Šæ–­ç½‘ç»œæ•…éšœã€‚åé¦ˆåŠŸèƒ½é€šè¿‡RTCPå‘é€è€…å’ŒæŽ¥æ”¶è€…æŠ¥å‘Šå®žçŽ°ã€‚ â—‹RTCPä¸ºæ¯ä¸ªRTPæºä¼ è¾“ä¸€ä¸ªå›ºå®šçš„è¯†åˆ«ç¬¦ï¼Œç§°ä¸ºè§„èŒƒåï¼ˆCNAMEï¼‰ã€‚ç”±äºŽå½“å‘ç”Ÿå†²çªæˆ–ç¨‹åºé‡å¯æ—¶SSRCå¯èƒ½æ”¹å˜ï¼ŒæŽ¥æ”¶è€…è¦ç”¨CNAMEæ¥è·Ÿè¸ªæ¯ä¸ªæˆå‘˜ã€‚æŽ¥æ”¶è€…è¿˜è¦ç”¨CNAMEæ¥å…³è”ä¸€ç³»åˆ—ç›¸å…³RTPä¼šè¯ä¸­æ¥è‡ªåŒä¸€ä¸ªæˆå‘˜çš„å¤šä¸ªæ•°æ®æµï¼Œä¾‹å¦‚åŒæ­¥è¯­éŸ³å’Œå›¾åƒã€‚ â—‹å‰ä¸¤ä¸ªåŠŸèƒ½è¦æ±‚æ‰€æœ‰æˆå‘˜éƒ½å‘é€RTCPåŒ…ï¼Œå› æ­¤å¿…é¡»æŽ§åˆ¶é€ŸçŽ‡ä»¥ä½¿RTPæˆå‘˜æ•°å¯ä»¥é€çº§å¢žé•¿ã€‚é€šè¿‡è®©æ¯ä¸ªæˆå‘˜å‘æ‰€æœ‰æˆå‘˜å‘é€æŽ§åˆ¶åŒ…ï¼Œå„ä¸ªæˆå‘˜éƒ½å¯ä»¥ç‹¬ç«‹åœ°è§‚å¯Ÿä¼šè®®ä¸­æ‰€æœ‰æˆå‘˜çš„æ•°ç›®ã€‚æ­¤æ•°ç›®å¯ä»¥ç”¨æ¥ä¼°è®¡å‘åŒ…é€ŸçŽ‡ã€‚ â—‹ç¬¬å››ä¸ªå¯é€‰çš„åŠŸèƒ½æ˜¯ä¼ è¾“æœ€å°‘çš„ä¼šè®®æŽ§åˆ¶ä¿¡æ¯ï¼Œä¾‹å¦‚åœ¨ç”¨æˆ·æŽ¥å£ä¸­æ˜¾ç¤ºå‚ä¸Žçš„æˆå‘˜ã€‚è¿™æœ€å¯èƒ½åœ¨â€æ¾æ•£æŽ§åˆ¶â€çš„ä¼šè®®ä¸­èµ·ä½œç”¨ï¼Œåœ¨â€æ¾æ•£æŽ§åˆ¶â€ä¼šè®®é‡Œï¼Œæˆå‘˜å¯ä»¥ä¸ç»è¿‡èµ„æ ¼æŽ§åˆ¶å’Œå‚æ•°åå•†è€ŒåŠ å…¥æˆ–é€€å‡ºä¼šè®®ã€‚RTCPä½œä¸ºä¸€ä¸ªå»¶ä¼¸åˆ°æ‰€æœ‰æˆå‘˜çš„æ–¹ä¾¿é€šè·¯ï¼Œå¿…é¡»è¦æ”¯æŒå…·ä½“åº”ç”¨æ‰€éœ€çš„æ‰€æœ‰æŽ§åˆ¶ä¿¡æ¯é€šä¿¡ã€‚ â—‹åœ¨RTPç”¨äºŽIPå¤šç‚¹å¹¿æ’­æ—¶ï¼ŒåŠŸèƒ½1-3æ˜¯å¼ºåˆ¶çš„ï¼Œåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æŽ¨èä½¿ç”¨ã€‚å»ºè®®RTPåº”ç”¨å¼€å‘å•†é¿å…ä½¿ç”¨åªèƒ½ç”¨äºŽå•å‘å¹¿æ’­è€Œä¸èƒ½æ‰©å……åˆ°å¤šç”¨æˆ·çš„æ–¹æ³•ã€‚ 6.1 RTCPåŒ…æ ¼å¼è¿™éƒ¨åˆ†å®šä¹‰äº†å‡ ä¸ªRTCPåŒ…ç±»åž‹ï¼Œå¯ä»¥ä¼ é€ä¸åŒçš„æŽ§åˆ¶ä¿¡æ¯ï¼š â—‹SRï¼šå‘é€è€…æŠ¥å‘Šï¼Œæè¿°ä½œä¸ºæ´»è·ƒå‘é€è€…æˆå‘˜çš„å‘é€å’ŒæŽ¥æ”¶ç»Ÿè®¡æ•°å­—ï¼› â—‹RRï¼šæŽ¥æ”¶è€…æŠ¥å‘Šï¼Œæè¿°éžæ´»è·ƒå‘é€è€…æˆå‘˜çš„æŽ¥æ”¶ç»Ÿè®¡æ•°å­—ï¼› â—‹SDESï¼šæºæè¿°é¡¹ï¼Œå…¶ä¸­åŒ…æ‹¬è§„èŒƒåCNAMEã€‚ â—‹BYEï¼šè¡¨æ˜Žå‚ä¸Žè€…å°†ç»“æŸä¼šè¯ã€‚ â—‹APPï¼šåº”ç”¨æè¿°åŠŸèƒ½ã€‚ åœ¨æœ¬æ–‡ä¸­å°†è¯¦ç»†ä»‹ç»SRå’ŒRRã€‚ æ¯ä¸ªRTCPåŒ…çš„å¼€å§‹éƒ¨åˆ†æ˜¯ä¸ŽRTPæ•°æ®åŒ…ç›¸ç±»ä¼¼çš„å›ºå®šéƒ¨åˆ†ï¼ŒéšåŽæ˜¯ä¸€å—ç»“æž„åŒ–å•å…ƒï¼Œå®ƒéšè´Ÿè½½ç±»åž‹ä¸åŒé•¿åº¦å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯æ€»ä»¥32æ¯”ç‰¹ç»ˆæ­¢ã€‚å¯¹é½è¦æ±‚å’Œé•¿åº¦åŸŸä½¿RTCPåŒ…å¯â€å †æ ˆâ€ï¼Œå³å¯ä»¥å°†å¤šä¸ªRTCPåŒ…å½¢æˆä¸€ä¸ªå¤åˆRTCPåŒ…ï¼Œåœ¨åº•å±‚åè®®(å¦‚UDP)ä¸­ï¼Œé€šå¸¸éƒ½æ˜¯å°†å¤åˆåŒ…ä½œä¸ºä¸€ä¸ªåŒ…ä¼ è¾“çš„ã€‚å¤åˆåŒ…ä¸­çš„æ¯ä¸ªRTCPå•åŒ…å¯ä»¥å•ç‹¬å¤„ç†ï¼Œè€Œæ— éœ€è€ƒè™‘åŒ…å¤åˆçš„é¡ºåºã€‚ç„¶è€Œï¼Œä¸ºäº†å®žçŽ°æŸäº›åè®®åŠŸèƒ½ï¼Œæ·»åŠ ä»¥ä¸‹é™åˆ¶ï¼š â—‹æŽ¥æ”¶æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯(åœ¨SRæˆ–RRä¸­)ã€‚åªè¦å¸¦å®½å…è®¸åº”å°½å¯èƒ½ç»å¸¸çš„å‘é€ï¼Œä»¥è¾¾åˆ°ç»Ÿè®¡æ•°å­—çš„æœ€å¤§åˆ†è¾¨çŽ‡ã€‚å› æ­¤æ¯ä¸ªå‘¨æœŸå‘é€çš„RTCPåŒ…å¿…é¡»åŒ…å«ä¸€ä¸ªæŠ¥å‘ŠåŒ…ã€‚ â—‹æ–°çš„å‚ä¸Žè€…éœ€è¦å°½å¿«æŽ¥æ”¶ä¸€ä¸ªæºçš„è§„èŒƒåä»¥è¯†åˆ«æ•°æ®æºå¹¶ä¸Žåª’ä½“å»ºç«‹ä¼šè¯ã€‚å› æ­¤ï¼Œæ¯ä¸ªåŒ…ä¸­å¿…é¡»åŒ…å«æºæè¿°é¡¹ä¸­çš„è§„èŒƒåã€‚é™¤éžå¤åˆåŒ…è¿›è¡Œäº†åˆ†å‰²ä»¥è¿›è¡Œéƒ¨åˆ†åŠ å¯†ï¼ˆè§9.1èŠ‚çš„æè¿°ï¼‰ã€‚ â—‹å¿…é¡»é™åˆ¶é¦–æ¬¡åœ¨å¤åˆåŒ…ä¸­å‡ºçŽ°çš„åŒ…ç±»åž‹çš„æ•°ç›®ï¼Œä»¥å¢žåŠ åœ¨ç¬¬ä¸€ä¸ªå­—ä¸­å¸¸æ•°æ¯”ç‰¹çš„æ•°ç›®ï¼Œè¿™æ ·å¯ä»¥å¢žåŠ RTCPåŒ…çš„æœ‰æ•ˆæ€§ï¼Œä»¥åŒºåˆ†è¯¯ä¼ çš„RTPåŒ…å’Œå…¶ä»–æ— å…³çš„åŒ…ã€‚å› æ­¤ï¼Œæ‰€æœ‰RTCPåŒ…å¿…é¡»ä»¥å¤åˆåŒ…çš„å½¢å¼å‘é€ã€‚å¤åˆåŒ…ä¸­è‡³å°‘æœ‰ä¸¤ä¸ªå•ä¸ªçš„RTCPåŒ…ã€‚å…·æœ‰ä»¥ä¸‹æ ¼å¼ï¼š â—‹åŠ å¯†å‰ç¼€ï¼šå½“ä¸”ä»…å½“å¤åˆåŒ…è¢«åŠ å¯†æ—¶ï¼Œå¯¹æ¯ä¸ªRTCPå¤åˆåŒ…åŠ 32æ¯”ç‰¹çš„å‰ç¼€ã€‚ â—‹SRæˆ–RRï¼šå¤åˆåŒ…ä¸­çš„ç¬¬ä¸€ä¸ªRTCPåŒ…å¿…é¡»æ˜¯ä¸€ä¸ªæŠ¥å‘ŠåŒ…ã€‚å³ä½¿æ²¡æœ‰æ•°æ®å‘é€å’ŒæŽ¥æ”¶ï¼Œæ­¤æ—¶å‘é€ç©ºçš„RRåŒ…ï¼Œæˆ–è€…å¤åˆåŒ…ä¸­å…¶ä»–çš„å”¯ä¸€åŒ…æ˜¯BYEåŒ…ï¼Œä¹Ÿå¿…é¡»å‘é€æŠ¥å‘ŠåŒ…ã€‚ â—‹é™„åŠ çš„RRï¼šè‹¥è¢«æŠ¥å‘Šçš„æŽ¥æ”¶ç»Ÿè®¡æºæ•°ç›®è¶…è¿‡SR/RRåŒ…ä¸­æœ€å¤§å…è®¸çš„31ä¸ªï¼Œé™„åŠ çš„RRå¿…é¡»è·Ÿåœ¨æœ€åˆçš„æŠ¥å‘ŠåŒ…åŽé¢ã€‚ â—‹æºæè¿°SDES â—‹BYEæˆ–APPåŒ… æ¯ä¸ªRTPå‚ä¸Žè€…åœ¨ä¸€ä¸ªæŠ¥å‘Šé—´éš”å†…åº”åªå‘é€ä¸€ä¸ªRTCPå¤åˆåŒ…ï¼Œä»¥ä¾¿æ­£ç¡®ä¼°è®¡æ¯ä¸ªå‚ä¸Žè€…çš„RTCPå¸¦å®½ã€‚é™¤éžåƒ9.1èŠ‚æè¿°çš„æƒ…å†µâ€”â€”æŠŠä¸€ä¸ªRTCPå¤åˆåŒ…åˆ†å‰²ä»¥è¿›è¡ŒåŠ å¯†ã€‚å¦‚æžœæ•°æ®æºçš„ä¸ªæ•°å¤ªå¤šï¼Œä»¥è‡³äºŽä¸èƒ½æŠŠæ‰€æœ‰çš„RRåŒ…éƒ½æ”¾åˆ°åŒä¸€ä¸ªRTCPåŒ…ä¸­è€Œä¸è¶…è¿‡ç½‘ç»œè·¯å¾„çš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆmaximum transport unit MTUï¼‰ï¼Œé‚£ä¹ˆå¯åœ¨æ¯ä¸ªé—´éš”ä¸­å‘é€å…¶ä¸­çš„ä¸€éƒ¨åˆ†åŒ…ã€‚åœ¨å¤šä¸ªå‘é€é—´éš”ä¸­ï¼Œæ‰€æœ‰çš„åŒ…åº”è¯¥è¢«ç­‰æ¦‚çŽ‡çš„é€‰ä¸­ã€‚è¿™æ ·å°±å¯ä»¥æŠ¥å‘Šæ‰€æœ‰æ•°æ®æºçš„æŽ¥æ”¶æ•°æ®çš„æƒ…å†µã€‚å¦‚æžœä¸€ä¸ªRTCPå¤åˆåŒ…çš„é•¿åº¦è¶…è¿‡äº†ç½‘ç»œè·¯å¾„çš„MTUï¼Œåˆ™å®ƒåº”å½“è¢«åˆ†å‰²ä¸ºå¤šä¸ªæ›´çŸ­çš„RTCPåŒ…æ¥ä¼ è¾“ã€‚è¿™ä¸ä¼šå½±å“å¯¹RTCPå¸¦å®½çš„ä¼°è®¡ï¼Œå› ä¸ºæ¯ä¸€ä¸ªå¤åˆåŒ…è‡³å°‘ä»£è¡¨äº†ä¸€ä¸ªå‚ä¸Žè€…ã€‚è¦æ³¨æ„çš„æ˜¯æ¯ä¸ªRTCPå¤åˆåŒ…å¿…é¡»ä»¥SRæˆ–RRåŒ…å¼€å¤´ã€‚ 1234567891011| |[--------- packet --------][---------- packet ----------][-packet-] | | receiver chunk chunk V reports item item item item -------------------------------------------------------------------- R[SR #sendinfo #site1#site2][SDES #CNAME PHONE #CNAME LOC][BYE##why] -------------------------------------------------------------------- | | |&lt;----------------------- compound packet -----------------------&gt;| |&lt;-------------------------- UDP packet -------------------------&gt;| #: SSRC/CSRC identifier å›¾1: RTCPå¤åˆåŒ…ä¸¾ä¾‹ 6.2 RTCPä¼ è¾“æ—¶é—´é—´éš” RTPè¢«è®¾è®¡ä¸ºå…è®¸åº”ç”¨è‡ªåŠ¨é€‚åº”ä¸åŒçš„è§„æ¨¡çš„ä¼šè¯â€•â€•ä»Žå‡ ä¸ªå‚ä¸Žè€…åˆ°å‡ åƒä¸ªå‚ä¸Žè€…çš„ä¼šè¯ã€‚ å¯¹æ¯ä¸€ä¸ªä¼šè¯ï¼Œæˆ‘ä»¬å‡å®šæ•°æ®ä¼ è¾“å—åˆ°ä¸€ä¸ªä¸Šé™â€•â€•ä¼šè¯å¸¦å®½çš„é™åˆ¶ã€‚ä¼šè¯å¸¦å®½åˆ†é…ç»™æ‰€æœ‰çš„å‚ä¸Žè€…ã€‚è¿™ä¸ªå¸¦å®½ä¼šè¢«é¢„ç•™ï¼Œå¹¶ç”±ç½‘ç»œæ‰€é™åˆ¶ã€‚å¦‚æžœæ²¡æœ‰é¢„ç•™ï¼ŒåŸºäºŽçŽ¯å¢ƒçš„å…¶ä»–çº¦æŸå°†ä¼šç¡®å®šåˆç†çš„æœ€å¤§å¸¦å®½ä¾›ä¼šè¯ä½¿ç”¨ï¼Œè¿™å°±æ˜¯ä¼šè¯å¸¦å®½ã€‚ä¼šè¯å¸¦å®½åœ¨ä¸€å®šç¨‹åº¦ä¸Šç‹¬ç«‹äºŽåª’ä½“ç¼–ç ï¼Œä½†åª’ä½“ç¼–ç å´ä¾èµ–äºŽä¼šè¯å¸¦å®½ã€‚ åœ¨æ¶‰åŠåª’ä½“åº”ç”¨æ—¶ï¼Œä¼šè¯å¸¦å®½å‚æ•°æœ€å¥½ç”±ä¸€ä¸ªä¼šè¯æŽ§åˆ¶åº”ç”¨æä¾›ã€‚ä½†åª’ä½“åº”ç”¨å¯èƒ½è®¾ç½®ä¸€ä¸ªé»˜è®¤å‚æ•°ã€‚æ­¤å‚æ•°ç”±å•ä¸ªå‘é€è€…é€‰æ‹©çš„ç¼–ç æ–¹å¼çš„æ•°æ®å¸¦å®½ç®—å‡ºã€‚ä¼šè¯ç®¡ç†å¯èƒ½ä¼šåŸºäºŽå¤šæ’­èŒƒå›´çš„è§„åˆ™æˆ–å…¶ä»–æ ‡å‡†ç¡®å®šå¸¦å®½é™åˆ¶ã€‚æ‰€æœ‰çš„å‚ä¸Žè€…åº”ä½¿ç”¨ç›¸åŒçš„ä¼šè¯å¸¦å®½å€¼ä»¥ä¿è¯è®¡ç®—å‡ºç›¸åŒçš„RTCPé—´éš”ã€‚ æŽ§åˆ¶ä¼ è¾“å¸¦å®½åº”å½“æ˜¯ä¼šè¯å¸¦å®½çš„ä¸€å°éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†æ‰€å æ€»çš„ä¼šè¯å¸¦å®½çš„ç™¾åˆ†æ¯”åº”æ˜¯å·²çŸ¥çš„ã€‚ä¸€å°éƒ¨åˆ†ï¼šä¼ è¾“åè®®çš„é¦–è¦åŠŸèƒ½æ˜¯ä¼ è¾“æ•°æ®ï¼›å·²çŸ¥ï¼šæŽ§åˆ¶ä¼ è¾“å¸¦å®½å¯ä»¥è¢«æ”¾è¿›å¸¦å®½æè¿°ä¸­æä¾›ç»™èµ„æºé¢„ç•™åè®®ï¼Œå¹¶ä¸”ä½¿æ¯ä¸ªå‚ä¸Žè€…éƒ½å¯ä»¥ç‹¬ç«‹çš„è®¡ç®—å‡ºä»–æ‰€å æœ‰çš„å¸¦å®½ä»½é¢ã€‚ æŽ§åˆ¶ä¼ è¾“å¸¦å®½ä½œä¸ºé¢å¤–çš„ä¸€éƒ¨åˆ†åŠ å…¥åˆ°ä¼šè¯å¸¦å®½ä¸­ã€‚å»ºè®®RTCPæŽ§åˆ¶ä¼ è¾“å¸¦å®½ä¸ºRTCPä¼šè¯å¸¦å®½çš„5%ã€‚å…¶ä¸­çš„1/4åˆ†é…ç»™å‘é€è€…ï¼›å½“å‘é€è€…çš„æ¯”ä¾‹è¶…è¿‡æ‰€æœ‰å‚ä¸Žè€…çš„1/4æ—¶ï¼Œå…¶RTCPæŽ§åˆ¶å¸¦å®½ç›¸åº”å¢žåŠ ã€‚æ‰€æœ‰çš„ä¼šè¯å‚ä¸Žè€…å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¸¸æ•°ï¼ˆä»¥ä¸Šæåˆ°çš„ç™¾åˆ†æ¯”ï¼‰ï¼Œä»¥ä¾¿è®¡ç®—å‡ºç›¸åŒçš„å‘é€æ—¶é—´é—´éš”ã€‚è¿™äº›å¸¸æ•°åº”åœ¨ä¸€ä¸ªç‰¹æ®Šçš„æè¿°æ–‡ä»¶ä¸­ç¡®å®šã€‚ è®¡ç®—å‡ºçš„RTCPå¤åˆåŒ…çš„å‘é€æ—¶é—´é—´éš”åº”è¯¥æœ‰ä¸€ä¸ªä¸‹é™ï¼Œä»¥å…å‚ä¸Žè€…æ•°é‡è¾ƒå°‘æ—¶å¤§é‡å‘é€RTCPåŒ…ã€‚è¿™ä¹Ÿä½¿ç½‘ç»œæš‚æ—¶æ–­å¼€æ—¶ï¼Œå‘é€é—´éš”ä¸ä¼šå¤ªå°ã€‚åœ¨åº”ç”¨å¼€å§‹æ—¶ï¼Œä¸€ä¸ªå»¶è¿Ÿåº”åŠ åˆ°ç¬¬ä¸€ä¸ªçš„TCPå¤åˆåŒ…å‘é€ä¹‹å‰ï¼Œä»¥ä¾¿ä»Žå…¶ä»–å‚ä¸Žè€…æŽ¥æ”¶RTCPå¤åˆåŒ…ã€‚è¿™æ ·ï¼Œå‘é€æ—¶é—´é—´éš”èƒ½æ›´å¿«çš„æ”¶æ•›åˆ°æ­£ç¡®çš„å€¼ã€‚è¿™ä¸ªå»¶è¿Ÿå¯ä»¥è®¾ä¸ºæœ€å°æ—¶é—´é—´éš”çš„ä¸€åŠã€‚å›ºå®šçš„æ—¶é—´é—´éš”å»ºè®®ä¸º5ç§’ã€‚ ä¸€ä¸ªå®žçŽ°å¯èƒ½ä½¿RTCPæœ€å°å‘é€æ—¶é—´é—´éš”ä¸Žä¼šè¯å¸¦å®½å‚æ•°æˆæ¯”ä¾‹ã€‚åˆ™åº”æ»¡è¶³ä¸‹åˆ—çº¦æŸï¼š â—‹å¯¹å¤šæ’­ä¼šè¯ï¼Œåªæœ‰æ´»åŠ¨çš„æ•°æ®å‘é€è€…ä½¿ç”¨å‡å°çš„æœ€å°åŒ–çš„å€¼è®¡ç®—RTCPå¤åˆåŒ…çš„å‘é€æ—¶é—´é—´éš”ã€‚ â—‹å¯¹å•æ’­ä¼šè¯ï¼Œå‡å°çš„å€¼ä¹Ÿå¯èƒ½è¢«ä¸æ˜¯æ´»åŠ¨çš„æ•°æ®å‘é€è€…ä½¿ç”¨ï¼Œå‘é€åˆå§‹çš„RTCPå¤åˆåŒ…ä¹‹å‰çš„å»¶è¿Ÿå¯èƒ½æ˜¯0ã€‚ â—‹å¯¹æ‰€æœ‰ä¼šè¯ï¼Œåœ¨è®¡ç®—å‚ä¸Žè€…çš„ç¦»å¼€æ—¶é—´æ—¶ï¼Œè¿™ä¸ªå›ºå®šæœ€å°å€¼ä¼šè¢«ç”¨åˆ°ã€‚å› æ­¤ï¼Œä¸ä½¿ç”¨å‡å°çš„å€¼è¿›è¡ŒRTCPåŒ…çš„å‘é€ï¼Œå°±ä¸ä¼šè¢«å…¶ä»–å‚ä¸Žè€…æå‰å®£å¸ƒè¶…æ—¶ã€‚ â—‹å‡å°çš„æœ€å°æ—¶é—´é—´éš”å»ºè®®ä¸ºï¼š360/sb(ç§’)ï¼Œå…¶ä¸­sbï¼šä¼šè¯å¸¦å®½ï¼ˆåƒå­—èŠ‚/ç§’ï¼‰ã€‚å½“sb&gt;72kb/sæ—¶ï¼Œæœ€å°æ—¶é—´é—´éš”å°†å°äºŽ5sã€‚ 6.3èŠ‚æ‰€æè¿°çš„ç®—æ³•å’Œé™„å½•A.7å°†å®žçŽ°æœ¬èŠ‚åˆ—å‡ºçš„ç›®æ ‡ï¼š â—‹è®¡ç®—å‡ºçš„RTCPåŒ…çš„æ—¶é—´é—´éš”ä¸Žç»„ä¸­å‚ä¸Žè€…çš„äººæ•°æˆæ­£æ¯”ã€‚ï¼ˆå‚ä¸Žè€…è¶Šå¤šï¼Œå‘é€æ—¶é—´é—´éš”è¶Šé•¿ï¼Œæ¯ä¸ªå‚ä¸Žè€…å æœ‰çš„RTCPå¸¦å®½è¶Šå°ï¼‰ã€‚ â—‹RTCPåŒ…çš„ï¼ˆçœŸå®žï¼‰æ—¶é—´é—´éš”æ˜¯è®¡ç®—å‡ºçš„æ—¶é—´é—´éš”çš„0.5ï½ž1.5å€ä¹‹é—´æŸä¸ªéšæœºçš„å€¼ï¼Œä»¥é¿å…æ‰€æœ‰çš„å‚ä¸Žè€…æ„å¤–çš„åŒæ­¥ã€‚ â—‹RTCPå¤åˆåŒ…çš„å¹³å‡å¤§å°å°†ä¼šè¢«åŠ¨æ€ä¼°è®¡ï¼ŒåŒ…æ‹¬æ‰€æœ‰å‘é€çš„åŒ…å’ŒæŽ¥æ”¶çš„åŒ…ã€‚ä»¥è‡ªåŠ¨é€‚åº”æºå¸¦çš„æŽ§åˆ¶ä¿¡æ¯æ•°é‡çš„å˜åŒ–ã€‚ â—‹ç”±äºŽè®¡ç®—å‡ºçš„æ—¶é—´é—´éš”ä¾èµ–äºŽç»„ä¸­çš„äººæ•°ã€‚å› æ­¤ï¼Œå½“ä¸€ä¸ªçš„ç”¨æˆ·åŠ å…¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ä¼šè¯æˆ–è€…å¤§é‡çš„ç”¨æˆ·å‡ ä¹ŽåŒæ—¶åŠ å…¥ä¸€ä¸ªæ–°çš„ä¼šè¯æ—¶ï¼Œå°±ä¼šæœ‰æ„å¤–çš„åˆå§‹åŒ–æ•ˆåº”ã€‚è¿™äº›æ–°ç”¨æˆ·å°†åœ¨å¼€å§‹æ—¶é”™è¯¯çš„ä¼°è®¡ç»„ä¸­çš„äººæ•°ï¼ˆä¼°è®¡å¤ªå°ï¼‰ã€‚å› æ­¤ä»–ä»¬çš„RTCPåŒ…çš„å‘é€æ—¶é—´é—´éš”å°±ä¼šå¤ªçŸ­ã€‚å¦‚æžœè®¸å¤šç”¨æˆ·åŒæ—¶åŠ å…¥ä¸€ä¸ªä¼šè¯ï¼Œè¿™ä¸ªé—®é¢˜å°±å¾ˆé‡è¦äº†ã€‚ä¸ºäº†å¤„ç†è¿™å¤„é—®é¢˜è€ƒè™‘äº†ä¸€ç§å«â€œæ—¶é—´é‡ä¼°â€çš„ç®—æ³•ã€‚è¿™ä¸ªç®—æ³•ä½¿å¾—ç»„ä¸­äººæ•°å¢žåŠ æ—¶ï¼Œç”¨æˆ·èƒ½å¤Ÿæ”¯æŒRTCPåŒ…çš„ä¼ è¾“ã€‚ å½“æœ‰ç”¨æˆ·ç¦»å¼€ä¼šè¯ï¼Œä¸ç®¡æ˜¯å‘é€BYEåŒ…è¿˜æ˜¯è¶…æ—¶ï¼Œç»„ä¸­çš„äººæ•°ä¼šå‡å°‘ã€‚è®¡ç®—å‡ºçš„æ—¶é—´é—´éš”ä¹Ÿåº”å½“å‡å°‘ã€‚å› æ­¤ï¼Œåº”ç”¨â€œé€†å‘é‡ä¼°â€ç®—æ³•ï¼Œä½¿ç»„ä¸­çš„æˆå‘˜æ›´å¿«çš„å‡å°‘ä»–ä»¬çš„æ—¶é—´é—´éš”ï¼Œä»¥å¯¹ç»„ä¸­çš„äººæ•°å‡å°‘åšå‡ºå“åº”ã€‚ â—‹BYEåŒ…çš„å¤„ç†å’Œå…¶ä»–RTCPåŒ…çš„å¤„ç†ä¸åŒã€‚BYEåŒ…çš„å‘é€ç”¨åˆ°ä¸€ä¸ªâ€œæ”¾å¼ƒæ”¯æŒâ€ç®—æ³•ã€‚ä»¥é¿å…å¤§é‡çš„BYEåŒ…åŒæ—¶å‘é€ï¼Œä½¿å¤§é‡å‚ä¸Žè€…åŒæ—¶ç¦»å¼€ä¼šè¯ã€‚ è¿™ä¸ªç®—æ³•é€‚ç”¨äºŽæ‰€æœ‰å‚ä¸Žè€…éƒ½å…è®¸RTCPåŒ…çš„æƒ…å†µã€‚æ­¤æ—¶ï¼Œä¼šè¯å¸¦å®½ï¼æ¯ä¸ªå‘é€è€…çš„å¸¦å®½Ã—ä¼šè¯ä¸­å‚ä¸Žè€…çš„æ€»äººæ•°ã€‚è¯¦ç»†ç®—æ³•è§éšåŽå°èŠ‚ï¼Œé™„å½•A.7ç»™å‡ºäº†ç®—æ³•çš„ä¸€ä¸ªå®žçŽ°ã€‚ 6.2.1ç»´æŒä¼šè¯æˆå‘˜çš„äººæ•° å½“ä¾¦å¬åˆ°æ–°çš„ç«™ç‚¹çš„æ—¶å€™ï¼Œåº”å½“æŠŠä»–ä»¬åŠ å…¥è®¡æ•°ã€‚æ¯ä¸€ä¸ªç™»å½•éƒ½åº”åœ¨è¡¨ä¸­åˆ›å»ºä¸€æ¡è®°å½•ï¼Œå¹¶ä»¥SSRCæˆ–CSRCè¿›è¡Œç´¢å¼•ã€‚æ–°çš„ç™»å½•ç›´åˆ°æŽ¥æ”¶åˆ°å«æœ‰SSRCçš„åŒ…æˆ–å«æœ‰ä¸Žæ­¤SSRCç›¸è”ç³»çš„è§„èŒƒåçš„SDESåŒ…æ‰è§†ä¸ºæœ‰æ•ˆï¼ˆè§é™„å½•A.1ï¼‰ã€‚å½“ä¸€ä¸ªä¸ŽSSRCæ ‡è¯†ç¬¦ç›¸å¯¹RTCP BYEåŒ…æ”¶åˆ°æ—¶ï¼Œç™»å½•ä¼šè¢«ä»Žè¡¨ä¸­åˆ é™¤ã€‚é™¤éžä¸€ä¸ªâ€œæŽ‰é˜Ÿâ€çš„æ•°æ®åŒ…åˆ°è¾¾ï¼Œä½¿ç™»å½•é‡æ–°åˆ›å»ºã€‚ å¦‚æžœåœ¨å‡ ä¸ªRTCPæŠ¥å‘Šæ—¶é—´é—´éš”å†…æ²¡æœ‰RTPæˆ–RTCPåŒ…æ”¶åˆ°ï¼Œä¸€ä¸ªå‚ä¸Žè€…å¯èƒ½æ ‡è®°å¦å¤–ä¸€ä¸ªç«™ç‚¹é™æ­¢ï¼Œå¹¶åˆ é™¤å®ƒã€‚è¿™æ˜¯é’ˆå¯¹ä¸¢åŒ…æä¾›çš„ä¸€ä¸ªå¾ˆå¼ºå¥çš„æœºåˆ¶ã€‚æ‰€æœ‰ç«™ç‚¹å¯¹è¿™ä¸ªè¶…æ—¶æ—¶é—´é—´éš”ä¹˜å­åº”å¤§ä½“ç›¸åŒï¼Œä»¥ä½¿è¿™ç§è¶…æ—¶æœºåˆ¶æ­£å¸¸å·¥ä½œã€‚å› æ­¤è¿™ä¸ªä¹˜å­åº”åœ¨ç‰¹åˆ«çš„æè¿°æ–‡ä»¶ä¸­ç¡®å®šã€‚ å¯¹äºŽä¸€ä¸ªæœ‰å¤§é‡å‚ä¸Žè€…çš„ä¼šè¯ï¼Œç»´æŒå¹¶å­˜è´®ä¸€ä¸ªæœ‰æ‰€æœ‰å‚ä¸Žè€…çš„SSRCåŠå„é¡¹ä¿¡æ¯çš„è¡¨å‡ ä¹Žæ˜¯ä¸å¯èƒ½çš„å› æ­¤ï¼Œåªå¯ä»¥åªå­˜è´®SSRCã€‚å…¶ä»–ç®—æ³•ç±»ä¼¼ã€‚å…³é”®çš„é—®é¢˜å°±æ˜¯ï¼Œä»»ä½•ç®—æ³•éƒ½ä¸åº”å½“ä½Žä¼°ç»„çš„è§„æ¨¡ï¼Œè™½ç„¶å®ƒæœ‰å¯èƒ½è¢«é«˜ä¼°ã€‚ 6.3 RTCPåŒ…çš„å‘é€å’ŒæŽ¥æ”¶è§„åˆ™ ä¸‹é¢åˆ—å‡ºäº†å¦‚ä½•å‘é€RTCPåŒ…ï¼Œå½“æŽ¥æ”¶åˆ°çš„TCPåŒ…æ—¶è¯¥å¹²ä»€ä¹ˆçš„è§„åˆ™ã€‚ ä¸ºæ‰§è¡Œè§„åˆ™ï¼Œä¸€ä¸ªä¼šè¯å‚ä¸Žè€…å°±ç»´æŒä¸‹åˆ—å˜é‡ï¼š tp: RTCPåŒ…å‘é€çš„æœ€åŽæ—¶é—´ã€‚ tc: å½“å‰æ—¶é—´ã€‚ tn: ä¼°è®¡çš„ä¸‹ä¸€ä¸ªRTCPåŒ…è¦å‘é€çš„æ—¶é—´ã€‚ pmembers: tnæœ€åŽè¢«é‡æ–°è®¡ç®—æ—¶ï¼Œä¼šè®¡çš„ä¼šè¯æˆå‘˜çš„äººæ•°ã€‚ members: ä¼šè¯æˆå‘˜äººæ•°çš„å½“å‰ä¼°è®¡ã€‚ senders: ä¼šè¯æˆå‘˜ä¸­å‘é€è€…äººæ•°çš„ä¼°è®¡ã€‚ rtcp_bw: ç›®æ ‡RTCPå¸¦å®½ã€‚ä¾‹å¦‚ç”¨äºŽä¼šè¯ä¸­æ‰€æœ‰æˆå‘˜çš„RTCPå¸¦å®½ã€‚å•ä½bit/sã€‚è¿™å°†æ˜¯ç¨‹åºå¼€å§‹æ—¶ï¼ŒæŒ‡å®šç»™â€œä¼šè¯å¸¦å®½â€å‚æ•°çš„ä¸€éƒ¨åˆ†ã€‚ we_sent: è‡ªå½“å‰ç¬¬äºŒä¸ªå‰é¢çš„RTCPå‘é€åŽï¼Œåº”ç”¨ç¨‹åºåˆå‘é€äº†æ•°æ®ï¼Œåˆ™æ­¤é¡¹ä¸ºtrueã€‚ avg_rtcp_size: æ­¤å‚ä¸Žè€…æ”¶åˆ°çš„å’Œå‘é€çš„RTCPå¤åˆåŒ…çš„å¹³å‡å¤§å°ã€‚å•ä½ï¼šbitã€‚æŒ‰6.2èŠ‚ï¼Œæ­¤å¤§å°åŒ…æ‹¬åº•å±‚ä¼ è¾“å±‚å’Œç½‘ç»œå±‚åè®®å¤´ã€‚ initial: å¦‚æžœåº”ç”¨ç¨‹åºè¿˜æœªå‘é€RTCPåŒ…ï¼Œåˆ™æ ‡è®°ä¸ºtrueã€‚ è®¸å¤šè§„åˆ™éƒ½ç”¨åˆ°äº†RTCPåŒ…ä¼ è¾“çš„â€œè®¡ç®—æ—¶é—´é—´éš”â€ã€‚æ­¤æ—¶é—´é—´éš”å°†åœ¨éšåŽçš„å°èŠ‚æè¿°ã€‚ 6.3.1è®¡ç®—RTCPä¼ è¾“æ—¶é—´é—´éš” ä¸€ä¸ªä¼šè¯å‚ä¸Žè€…åŒ…çš„å¹³å‡å‘é€æ—¶é—´é—´éš”åº”å½“å’Œæ‰€åœ¨ä¼šè¯ç»„ä¸­äººæ•°æˆæ­£æ¯”ã€‚è¿™ä¸ªé—´éš”ç§°ä¸ºè®¡ç®—æ—¶é—´é—´éš”ã€‚å®ƒç”±ä¸Šé¢æåˆ°çš„å„ä¸ªçŠ¶æ€å‚é‡ç»“åˆèµ·æ¥è®¡ç®—å¾—å‡ºã€‚è®¡ç®—æ—¶é—´é—´éš”Tçš„è®¡ç®—å¦‚ä¸‹ï¼š 1ï¼ˆ1ï¼‰å¦‚æžœå‘é€è€…äººæ•°â‰¤ä¼šè¯æ€»äººæ•°Ã—25%ã€‚åˆ™Tå–å†³äºŽæ­¤å‚ä¸Žè€…æ˜¯å¦æ˜¯å‘é€è€…ï¼ˆwe_sentçš„å€¼ï¼‰ï¼›å¦åˆ™ï¼Œå‘é€è€…å’ŒæŽ¥æ”¶è€…å°†ç»Ÿä¸€å¤„ç†ã€‚ 1234567891011121314senders&lt;=25%*memberswe_sentc=avg_rtcp_size/(0.25*rtcp_bw);n=senders;c=avg_rtcp_size/(0.75*rtcp_bw);n=members-senders;c=avg_rtcp_size/rtcp_bw;n=members;notyesyesnot å›¾ï¼šç¡®å®šc ï¼Œn å¦‚6.2èŠ‚æ‰€è¿°ï¼ŒRTPæè¿°æ–‡ä»¶å¯èƒ½ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„å‚æ•°ï¼ˆSï¼ŒRï¼‰ç¡®å®šå‘é€è€…ä¸Žéžå‘é€è€…ã€‚æ­¤æ—¶ï¼Œ25%å’Œ75%åªè¦ç›¸åº”çš„æ¢æˆS/(S+R),R/(S+R)å³å¯ã€‚æ³¨æ„Rï¼0çš„æƒ…å†µã€‚ 2 å¦‚æžœinitialä¸ºtrue(åˆ™æœªå‘é€è¿‡RTCPåŒ…)ï¼Œåˆ™è®¾Tmin=2.5s;å¦åˆ™è®¾Tmin=5sã€‚ 3 å†³å®šæ€§çš„è®¡ç®—æ—¶é—´é—´éš”ï¼ˆdeterministic calculated intervalï¼‰Td=max(Tmin ,nc)ã€‚ 4 T=TdÎ»ï¼›å…¶ä¸­Î»~U(0.5,1.5)ã€‚å³Î»æœä»Ž0.5åˆ°1.5ä¹‹é—´çš„å‡åŒ€åˆ†å¸ƒã€‚ 5 T=T/(e-0.5)â‰ˆT/1.21828ï¼Œè¡¥å¿æ—¶é—´é‡ä¼°ç®—æ³•ï¼Œä½¿ä¹‹æ”¶æ•›åˆ°æ¯”è®¡ç®—å‡ºçš„å¹³å‡RTCPå¸¦å®½å°çš„ä¸€ä¸ªå€¼ã€‚ è¿™ä¸ªç®—æ³•äº§ç”Ÿäº†ä¸€ä¸ªéšæœºçš„è®¡ç®—æ—¶é—´é—´éš”ï¼Œå¹¶æŠŠè‡³å°‘25%çš„RTCPå¸¦å®½åˆ†é…ç»™å‘é€è€…ï¼Œå…¶ä½™çš„åˆ†ç»™æŽ¥æ”¶è€…ã€‚è‹¥å‘é€è€…è¶…è¿‡ä¼šè¯æ€»äººæ•°çš„25%ï¼Œæ­¤ç®—æ³•å°†æŠŠå¸¦å®½å¹³å‡åˆ†ç»™æ‰€æœ‰çš„å‚ä¸Žè€…ã€‚ 6 3.2åˆå§‹åŒ– ä¸€åŠ å…¥ä¼šè¯ï¼Œå‚ä¸Žè€…çš„å„çŠ¶æ€å‚é‡åˆå§‹åŒ–ä¸ºï¼štp=0ï¼› tc=0ï¼› senders=0ï¼› pmembers=1ï¼› members=1ï¼› vw_sent=falseï¼› rtcp_bw:ç”±ä¼šè¯å¸¦å®½å‚æ•°çš„ç›¸åº”éƒ¨åˆ†å¾—åˆ°ï¼›initial=trueï¼›avg_rtcp_size:åˆå§‹åŒ–ä¸ºåº”ç”¨ç¨‹åºç¨åŽå°†å‘é€çš„RTCPåŒ…çš„å¯èƒ½å¤§å°ï¼›Tï¼šå¦‚6.3.1èŠ‚ï¼›tn=Tï¼ˆè¿™æ„å‘³ç€ï¼Œä¸€ä¸ªè®¡æ—¶å™¨å°†ç»Tæ—¶é—´åŽè¢«å”¤é†’ï¼‰ï¼›åº”ç”¨ç¨‹åºå¯ä»¥ç”¨ä»»ä½•å®ƒéœ€è¦çš„æ–¹å¼å®žçŽ°è®¡æ—¶å™¨ã€‚ å‚ä¸Žè€…æŠŠå®ƒè‡ªå·±çš„SSRCåŠ åˆ°æˆå‘˜åˆ—è¡¨ä¸­ã€‚ 6.3.3æŽ¥æ”¶åˆ°çš„TPåŒ…æˆ–ä¸€ä¸ªéžBYEçš„RTCPåŒ… å½“æ”¶åˆ°ä¸€ä¸ªå‚ä¸Žè€…çš„RTPæˆ–RTCPåŒ…æ—¶ï¼Œè‹¥å…¶SSRCä¸åœ¨æˆå‘˜åˆ—è¡¨ä¸­ï¼Œå°†å…¶SSRCåŠ å…¥åˆ—è¡¨ï¼›è‹¥æ­¤å‚ä¸Žè€…è¢«ç¡®è®¤æœ‰æ•ˆï¼ˆå¦‚6.2.1èŠ‚æè¿°ï¼‰ï¼Œå°±æŠŠåˆ—è¡¨ä¸­æˆå‘˜çš„å€¼æ›´æ–°ã€‚å¯¹æ¯ä¸ªæœ‰æ•ˆçš„RTPåŒ…ä¸­çš„CSRCæ‰§è¡Œç›¸åŒçš„è¿‡ç¨‹ã€‚ å½“æ”¶åˆ°ä¸€ä¸ªå‚ä¸Žè€…çš„RTPåŒ…æ—¶ï¼Œè‹¥å…¶SSRCä¸åœ¨å‘é€è€…åˆ—è¡¨ä¸­ï¼Œåˆ™å°†å…¶SSRCåŠ å…¥å‘é€è€…åˆ—è¡¨ï¼Œæ›´æ–°ç›¸åº”çš„å€¼ã€‚ æ¯æ”¶åˆ°ä¸€ä¸ªRTCPå¤åˆåŒ…ï¼Œavg_rtcp_sizeæ›´æ–°ä¸ºavg_rtcp_size = 1/16 packet_size + 15/16 avg_rtcp_size ï¼›å…¶ä¸­packet_sizeæ˜¯åˆšæ”¶åˆ°çš„RTCPå¤åˆåŒ…çš„å¤§å°ã€‚ 6.3.4æŽ¥æ”¶RTCP BYEåŒ… é™¤6.3.7å°èŠ‚æè¿°çš„å‘é€RTCP BYEåŒ…ä¹‹å¤–ï¼Œå¦‚æžœæ”¶åˆ°ä¸€ä¸ªRTCP BYEåŒ…ï¼Œåˆ™æ£€æµ‹æˆå‘˜åˆ—è¡¨ã€‚è‹¥SSRCå­˜åœ¨ï¼›å…ˆç§»é™¤ä¹‹ï¼Œå¹¶æ›´æ–°æˆå‘˜çš„å€¼ã€‚ å¦å¤–ï¼Œä¸ºä½¿RTCPåŒ…çš„å‘é€é€ŸçŽ‡ä¸Žç»„ä¸­äººæ•°å˜åŒ–æ›´åŠ åè°ƒï¼Œå½“æ”¶åˆ°ä¸€ä¸ªBYEåŒ…ä½¿å¾—membersçš„å€¼pmembersæ—¶ï¼Œä¸‹é¢çš„é€†å‘é‡ä¼°ç®—æ³•åº”å½“æ‰§è¡Œï¼š ï¼ˆ1ï¼‰tnçš„æ›´æ–°ï¼štn = tc + ( members / pmembers ) ( tn â€“tc )ï¼› ï¼ˆ2ï¼‰tpçš„æ›´æ–°ï¼štp = tc â€“ ( members / pmembers ) ( tc â€“ tp )ï¼›ä¸‹ä¸€ä¸ªRTCPåŒ…å°†åœ¨æ—¶åˆ»tn è¢«å‘é€ï¼Œæ¯”æ›´æ–°å‰æ›´æ—©ä¸€äº›ã€‚ ï¼ˆ3ï¼‰pmembersçš„æ›´æ–°ï¼špmembers=membersï¼› è¿™ä¸ªç®—æ³•å¹¶æ²¡æœ‰é˜²æ­¢ç»„çš„å¤§å°è¢«é”™è¯¯çš„åœ¨çŸ­æ—¶é—´å†…ä¼°è®¡ä¸º0çš„æƒ…å†µã€‚å¦‚ï¼šåœ¨ä¸€ä¸ªè¾ƒå¤šäººæ•°çš„ä¼šè¯ä¸­ï¼Œå¤šæ•°å‚ä¸Žè€…å‡ ä¹ŽåŒæ—¶ç¦»å¼€è€Œå°‘æ•°å‡ ä¸ªå‚ä¸Žè€…æ²¡æœ‰ç¦»å¼€çš„æƒ…å†µã€‚è¿™ä¸ªç®—æ³•å¹¶æ²¡æœ‰ä½¿ä¼°è®¡è¿…é€Ÿè¿”å›žæ­£ç¡®çš„å€¼ã€‚å› ä¸ºè¿™ç§æƒ…å†µè¾ƒç½•è§ï¼Œä¸”å½±å“ä¸å¤§ã€‚ 6.3.5 SSRCè¶…æ—¶ åœ¨éšæœºçš„æ—¶é—´é—´éš”ä¸­ï¼Œä¸€ä¸ªå‚ä¸Žè€…å¿…é¡»æ£€æµ‹å…¶ä»–å‚ä¸Žè€…æ˜¯å¦å·²ç»è¶…æ—¶ã€‚ä¸ºæ­¤ï¼Œå¯¹æŽ¥æ”¶è€…ï¼ˆwe_sentä¸ºfalseï¼‰ï¼Œè¦è®¡ç®—å†³å®šæ€§æ—¶é—´é—´éš”Tdï¼Œå¦‚æžœä»Žæ—¶åˆ»Tc-MTd(Mä¸ºè¶…æ—¶å› å­ï¼Œé»˜è®¤ä¸º5ç§’)å¼€å§‹ï¼Œæœªå‘é€è¿‡RTPæˆ–RTCPåŒ…ï¼Œåˆ™è¶…æ—¶ã€‚å…¶SSRCå°†è¢«ä»Žåˆ—è¡¨ä¸­ç§»é™¤ï¼Œæˆå‘˜è¢«æ›´æ–°ã€‚åœ¨å‘é€è€…åˆ—è¡¨ä¸­ä¹Ÿè¦è¿›è¡Œç±»ä¼¼çš„æ£€æµ‹ã€‚å‘é€è€…åˆ—è¡¨ä¸­ï¼Œä»»ä½•ä»Žæ—¶é—´tc-2T(åœ¨æœ€åŽä¸¤ä¸ªRTCPæŠ¥å‘Šæ—¶é—´é—´éš”å†…)æœªå‘é€RTPåŒ…çš„å‘é€è€…ï¼Œå…¶SSRCä»Žå‘é€è€…åˆ—è¡¨ä¸­ç§»é™¤ï¼Œåˆ—è¡¨æ›´æ–°ã€‚ å¦‚æžœæœ‰æˆå‘˜è¶…æ—¶ï¼Œåº”è¯¥æ‰§è¡Œ6.3.4èŠ‚ä¸­çš„é€†å‘æ£€æµ‹ç®—æ³•ã€‚æ¯ä¸ªå‚ä¸Žè€…åœ¨ä¸€ä¸ªRTCPåŒ…å‘é€æ—¶é—´é—´éš”å†…è‡³å°‘è¦è¿›è¡Œä¸€æ¬¡è¿™æ ·çš„æ£€æµ‹ã€‚ 6.3.6å‘é€æ—¶é’Ÿåˆ°æ—¶äº† å½“åŒ…ä¼ è¾“çš„å‘é€æ—¶é’Ÿåˆ°æ—¶ï¼Œå‚ä¸Žè€…æ‰§è¡Œä¸‹åˆ—æ“ä½œï¼š ï¼ˆ1ï¼‰æŒ‰6.3.1èŠ‚çš„åŠžæ³•è®¡ç®—Tã€‚ ï¼ˆ2ï¼‰æ›´æ–°å‘é€æ—¶é’Ÿçš„å®šæ—¶æ—¶é—´ï¼Œåˆ¤æ–­æ˜¯å¦å‘é€RTCPåŒ…ï¼Œæ›´æ–°pmembersã€‚å¦‚å›¾ï¼š tp+T&lt;=tc å‘é€RTCPåŒ… tp=tc; tn=tc+T; initial=false; avg_rtcp_size=1/16 packet_size + 15/16 avg_rtcp_size tn=tp+T Pmemvers=members yes no //ä¸å‘é€RTCPåŒ… å›¾ï¼šå‘é€æ—¶é’Ÿåˆ°æ—¶çš„æ“ä½œ 6.3.7å‘é€ä¸€ä¸ªBTEåŒ… å½“ä¸€ä¸ªå‚ä¸Žè€…ç¦»å¼€ä¼šè¯æ—¶ï¼Œåº”å‘é€BYEåŒ…ï¼Œé€šçŸ¥å…¶ä»–å‚ä¸Žè€…ã€‚ä¸ºé¿å…å¤§é‡å‚ä¸Žè€…åŒæ—¶ç¦»å¼€ç³»ç»Ÿæ—¶ï¼Œå¤§é‡BYEåŒ…çš„å‘é€ï¼Œè‹¥ä¼šè¯äººæ•°è¶…è¿‡50ï¼Œåˆ™å‚ä¸Žè€…åœ¨è¦ç¦»å¼€ä¼šè¯æ—¶ï¼Œåº”æ‰§è¡Œä¸‹é¢çš„ç®—æ³•ã€‚è¿™ä¸ªç®—æ³•å®žé™…ä¸Šâ€œç¯¡å¤ºâ€äº†ä¸€èˆ¬å¯å˜æˆå‘˜çš„è§’è‰²æ¥ç»Ÿè®¡BYEåŒ…ã€‚ ï¼ˆ1ï¼‰tp=tc ï¼› members=1ï¼› pmembers=1ï¼› sinitial=1ï¼› we_sent=falseï¼› senders=0ï¼› rtcp_size:è®¾ç½®ä¸ºå°†è¦å‘é€çš„RTCPåŒ…å¤§å°ï¼›è®¡ç®—â€œè®¡ç®—æ—¶é—´é—´éš”â€Tï¼›tn=tc+Tï¼›(BYEåŒ…é¢„è®¡åœ¨æ—¶åˆ»tnè¢«å‘é€)ã€‚ (2)æ¯å½“ä»Žå¦å¤–ä¸€ä¸ªå‚ä¸Žè€…æŽ¥æ”¶åˆ°BYEåŒ…æ—¶ï¼Œæˆå‘˜äººæ•°åŠ 1ã€‚ä¸ç®¡æ­¤æˆå‘˜æ˜¯å¦å­˜åœ¨äºŽæˆå‘˜åˆ—è¡¨ä¸­ï¼Œä¹Ÿä¸ç®¡SSRCé‡‡æ ·ä½•æ—¶ä½¿ç”¨åŠBYEåŒ…çš„SSRCæ˜¯å¦åŒ…å«åœ¨é‡‡æ ·ä¹‹ä¸­ã€‚å¦‚æžœæ”¶åˆ°RTPåŒ…æˆ–ç”šçš„RTCPåŒ…ï¼ˆé™¤BYEåŒ…ä¹‹å¤–çš„RTCPåŒ…ï¼‰ï¼Œæˆå‘˜äººæ•°ä¸å¢žåŠ ã€‚ç±»ä¼¼ï¼Œåªæœ‰åœ¨æ”¶åˆ°BYEåŒ…æ—¶ï¼Œavg_rtcp_sizeæ‰æ›´æ–°ã€‚å½“RTPåŒ…åˆ°è¾¾æ—¶ï¼Œå‘é€è€…äººæ•°sendersä¸æ›´æ–°ï¼Œä¿æŒä¸º0ã€‚ ï¼ˆ3ï¼‰åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒBYEåŒ…çš„ä¼ è¾“æœä»Žä¸Šé¢è§„å®šçš„ä¸€èˆ¬çš„RTCPåŒ…çš„ä¼ è¾“ã€‚ ï¼ˆBYEåŒ…çš„ä¼ è¾“ï¼Œæ˜¯ä¸“æ³¨äºŽç»Ÿè®¡ä¼šè¯ä¸­å‘é€BYEåŒ…çš„äººæ•°çš„ã€‚ï¼‰ è¿™å…è®¸BYEåŒ…è¢«ç«‹å³å‘é€ï¼Œå¹¶æŽ§åˆ¶æ€»çš„å¸¦å®½ä½¿ç”¨ã€‚åœ¨æœ€åæƒ…å†µä¸‹ä¸Šï¼Œè¿™å¯èƒ½ä¼šä½¿RTCPæŽ§åˆ¶åŒ…ä½¿ç”¨ä¸¤å€äºŽæ­£å¸¸æ°´å¹³çš„å¸¦å®½ï¼Œè¾¾åˆ°10%â€•â€•å…¶ä¸­5%ç»™BYEåŒ…çš„RTCPåŒ…ï¼Œå…¶ä½™5%ç»™BYEåŒ…ã€‚ ä¸€ä¸ªå‚ä¸Žè€…è‹¥ä¸æƒ³ç”¨ä¸Šé¢çš„æœºåˆ¶è¿›è¡ŒRTCPåŒ…çš„å‘é€ï¼Œå¯ä»¥ç›´æŽ¥ç¦»å¼€ä¼šè¯ï¼Œè€Œæ ¹æœ¬ä¸å‘é€BYEåŒ…ã€‚ä»–ä¼šè¢«å…¶ä»–å‚ä¸Žè€…å› è¶…æ—¶è€Œåˆ é™¤ã€‚ ä¸€ä¸ªå‚ä¸Žè€…æƒ³ç¦»å¼€ä¼šè¯æ—¶ï¼Œå¦‚æžœç»„ä¸­çš„äººæ•°ä¼šè®¡æ•°ç›®å°äºŽ50ï¼Œåˆ™å‚ä¸Žè€…å¯ä»¥ç›´æŽ¥å‘é€BYEåŒ…ã€‚ å¦å¤–ï¼Œä¸€ä¸ªä»Žæœªå‘é€è¿‡RTPæˆ–RTCPåŒ…çš„å‚ä¸Žè€…ï¼Œåœ¨ç¦»å¼€ä¼šè¯æ—¶ï¼Œä¸èƒ½å‘é€BYEåŒ…ã€‚ 6.3.8æ›´æ–°we_sentå˜é‡ å¦‚æžœä¸€ä¸ªå‚ä¸Žè€…æœ€è¿‘å‘è¿‡RTPåŒ…ï¼Œåˆ™å˜é‡we_sentå€¼ä¸ºtrue,å¦åˆ™ä¸ºfalseã€‚ç›¸åŒçš„æœºåˆ¶å¯ä»¥ç®¡ç†å‘é€è€…ä¸­çš„å…¶ä»–å‚ä¸Žè€…ã€‚å¦‚æžœå‚ä¸Žè€…å‘é€äº†TPTåŒ…è€Œæ­¤æ—¶ï¼Œå…¶å¯¹åº”çš„we_sentå˜é‡å€¼ä¸ºfalse,åˆ™å°±æŠŠå®ƒè‡ªå·±åŠ åˆ°å‘é€è€…åˆ—è¡¨ä¸­ï¼Œå¹¶è®¾ç½®å…¶we_sentå˜é‡ä¸ºtrueã€‚6.3.4èŠ‚ä¸­æè¿°çš„é€†å‘é‡ä¼°ç®—æ³•ï¼ˆreverse reconsideration algorithmï¼‰åº”å½“è¢«æ‰§è¡Œã€‚ä»¥å¯èƒ½å‡å°‘å‘é€SRåŒ…å‰çš„å»¶è¿Ÿã€‚æ¯æ¬¡å‘é€ä¸€ä¸ªRTPåŒ…ï¼Œå…¶ç›¸åº”çš„ä¼ è¾“æ—¶é—´éƒ½ä¼šè®°å½•åœ¨è¡¨ä¸­ã€‚ä¸€èˆ¬å‘é€è€…çš„è¶…æ—¶ç®—æ³•åº”ç”¨åˆ°å‚ä¸Žè€…è‡ªèº«ï¼šä»Žtc-2Tæ—¶å¼€å§‹ï¼Œä¸€ç›´æ²¡æœ‰å‘é€RTPåŒ…ï¼Œåˆ™æ­¤å‚ä¸Žè€…å°±ä»Žå‘é€è€…åˆ—è¡¨ä¸­å°†å…¶è‡ªèº«ç§»é™¤ï¼Œå‡å°‘å‘é€è€…æ€»æ•°ï¼Œå¹¶è®¾ç½®we_sentå˜é‡å€¼ä¸ºfalseã€‚ 6.3.9æºæè¿°å¸¦å®½çš„åˆ†é… è¿™é‡Œå®šä¹‰äº†å‡ ç§æºæè¿°é¡¹ï¼Œå¼ºåˆ¶æ€§çš„è§„èŒƒåï¼ˆCNAMEï¼‰é™¤å¤–ã€‚ä¾‹å¦‚ï¼Œä¸ªäººå§“åï¼ˆNAMEï¼‰å’Œç”µå­é‚®ä»¶åœ°å€ï¼ˆEMAILï¼‰ã€‚å®ƒä¹Ÿæä¾›äº†æ–¹æ³•å®šä¹‰æ–°çš„RTCPåŒ…çš„ç±»åž‹ã€‚åº”ç”¨ç¨‹åºåœ¨ç»™è¿™äº›é¢å¤–ä¿¡æ¯åˆ†é…å¸¦å®½æ—¶åº”é¢å¤–å°å¿ƒã€‚å› ä¸ºè¿™ä¼šé™ä½ŽæŽ¥æ”¶æŠ¥å‘ŠåŠCNAMEçš„å‘é€é€ŸçŽ‡ï¼Œå¯èƒ½ç ´ååè®®å‘æŒ¥ä½œç”¨ã€‚å»ºè®®åˆ†é…ç»™ä¸€ä¸ªå‚ä¸Žè€…ç”¨äºŽä¼ è¾“è¿™äº›é¢å¤–ä¿¡æ¯çš„å¸¦å®½ä¸è¶…è¿‡æ€»çš„RTCPå¸¦å®½çš„20%ã€‚å¦å¤–ï¼Œå¹¶éžæ‰€æœ‰çš„æºæè¿°é¡¹éƒ½å°†åŒ…å«è¿›æ¯ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ã€‚åŒ…å«è¿›åº”ç”¨ç¨‹åºçš„æºæè¿°é¡¹åº”æ ¹æ®å…¶ç”¨é€”åˆ†é…ç»™ç›¸åº”çš„å¸¦å®½ç™¾åˆ†æ¯”ã€‚å»ºè®®ä¸è¦åŠ¨æ€ä¼šè®¡è¿™äº›ç™¾åˆ†æ¯”ï¼Œè€Œåº”æ ¹æ®ä¸€ä¸ªæºæè¿°é¡¹çš„å…¸åž‹é•¿åº¦å°†æ‰€å å¸¦å®½çš„ç™¾åˆ†æ¯”çš„è½¬åŒ–ä¸ºæŠ¥å‘Šé—´éš”ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½ä»…å‘é€CNAMEï¼ŒNAMEå’ŒEMAILï¼Œè€Œä¸éœ€è¦å…¶ä»–é¡¹ã€‚NAMEå¯èƒ½ä¼šæ¯”EMAILç»™äºˆæ›´é«˜çš„ä¼˜å…ˆçº§ã€‚å› ä¸ºNAMEå¯èƒ½ä¼šåœ¨åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢ä¸ŠæŒç»­æ˜¾ç¤ºï¼Œä½†EMAILå¯èƒ½ä»…ä»…åœ¨éœ€è¦æ—¶æ‰ä¼šæ˜¾ç¤ºã€‚åœ¨æ¯ä¸€ä¸ªRTCPæ—¶é—´é—´éš”å†…ï¼Œä¸€ä¸ªåŒ…å«CNAMEé¡¹çš„SDESåŒ…å’Œä¸€ä¸ªRRåŒ…å°†ä¼šè¢«å‘é€ã€‚æœ€å°çš„ä¼šè¯æ—¶é—´é—´éš”å¹³å‡ä¸º5ç§’ã€‚æ¯ç»è¿‡3ä¸ªæ—¶é—´é—´éš”ï¼ˆ15ç§’ï¼‰ï¼Œä¸€ä¸ªé¢å¤–çš„é¡¹å°†ä¼šåŒ…å«è¿›è¿™ä¸ªSDESåŒ…ä¸­ã€‚7/8çš„æ—¶é—´æ˜¯NAMEé¡¹ï¼Œæ¯ç»è¿‡8ä¸ªè¿™æ ·çš„é—´éš”ï¼ˆ15s8=2minï¼‰,å°†ä¼šæ˜¯EMAILé¡¹ã€‚ å½“å¤šä¸ªä¼šè¯è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„è§„èŒƒåä¸ºæ¯ä¸ªå‚ä¸Žè€…è¿›è¡Œç»‘å®šæ—¶ï¼Œå¦‚åœ¨ä¸€ä¸ªRTPä¼šè¯ç»„æˆçš„å¤šåª’ä½“ä¼šè®®ä¸­ï¼Œé¢å¤–çš„SDESä¿¡æ¯å¯èƒ½åªåœ¨ä¸€æ¬¡RTPä¼šè¯ä¸­è¢«å‘é€ã€‚å…¶ä½™çš„ä¼šè¯å°†åªå‘é€CNAMEã€‚ç‰¹åˆ«ï¼Œè¿™ä¸ªåŠžæ³•ä¹Ÿåº”è¯¥ç”¨åœ¨åˆ†å±‚ç¼–ç çš„å¤šä¸ªä¼šè¯ä¸­ã€‚ 6.4 å‘é€è€…å’ŒæŽ¥æ”¶è€…æŠ¥å‘Š RTPæŽ¥æ”¶è€…åˆ©ç”¨RTCPæŠ¥å‘ŠåŒ…æä¾›æŽ¥æ”¶è´¨é‡åé¦ˆã€‚æ ¹æ®æŽ¥æ”¶è€…æ˜¯å¦åŒæ—¶è¿˜æ˜¯å‘é€è€…ï¼ŒRTCPåŒ…é‡‡å–ä¸¤ç§ä¸åŒçš„å½¢å¼ã€‚å‘é€è€…æŠ¥å‘Š(SR)å’ŒæŽ¥æ”¶è€…æŠ¥å‘Š(RR)æ ¼å¼ä¸­å”¯ä¸€çš„ä¸åŒï¼Œé™¤åŒ…ç±»åž‹ç ä¹‹å¤–ï¼Œåœ¨äºŽå‘é€è€…æŠ¥å‘ŠåŒ…æ‹¬20å­—èŠ‚çš„å‘é€è€…ä¿¡æ¯ã€‚ SRåŒ…å’ŒRRåŒ…éƒ½åŒ…æ‹¬é›¶åˆ°å¤šä¸ªæŽ¥æ”¶æŠ¥å‘Šå—ã€‚é’ˆå¯¹è¯¥æŽ¥æ”¶è€…å‘å‡ºä¸Šä¸€ä¸ªæŠ¥å‘Šå—åŽæŽ¥æ”¶åˆ°RTPåŒ…çš„èµ·å§‹åŒæ­¥æºï¼Œæ¯ä¸ªæºä¸€ä¸ªå—ã€‚æŠ¥å‘Šä¸å‘é€ç»™CSRCåˆ—è¡¨ä¸­çš„è´¡çŒ®æºã€‚æ¯ä¸ªæŽ¥æ”¶æŠ¥å‘Šå—æä¾›ä»Žç‰¹å®šæ•°æ®æºæŽ¥æ”¶åˆ°æ•°æ®çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ç”±äºŽSR/RRåŒ…æœ€å¤šå…è®¸31ä¸ªæŽ¥æ”¶æŠ¥å‘Šå—ï¼Œæ•…å¯ä»¥åœ¨æœ€åˆçš„SRæˆ–RRåŒ…ä¹‹åŽé™„åŠ RRåŒ…ï¼Œä»¥åŒ…å«ä»Žä¸Šä¸€ä¸ªæŠ¥å‘Šä»¥æ¥çš„é—´éš”å†…æ”¶å¬åˆ°çš„æ‰€æœ‰æºçš„æŽ¥æ”¶æŠ¥å‘Šã€‚å¦‚æžœæ•°æ®æºå¤ªå¤šï¼Œè‡´ä½¿è‹¥æŠŠæ‰€æœ‰çš„RRåŒ…æ”¾åˆ°åŒä¸€ä¸ªRTCPå¤åˆåŒ…ä¸­ä¼šè¶…å‡ºç½‘ç»œçš„MTUã€‚é‚£ä¹ˆå°±åœ¨ä¸€ä¸ªå‘¨æœŸå†…é€‰æ‹©ä¸Šé¢RRåŒ…çš„ä¸€éƒ¨åˆ†ä»¥ä¸è¶…è¿‡MTUã€‚è¿™äº›RRåŒ…çš„é€‰å–åº”è®©å„ä¸ªåŒ…éƒ½æœ‰åŒç­‰çš„å‡ çŽ‡è¢«å–åˆ°ã€‚è¿™æ ·åœ¨å‡ ä¸ªå‘é€å‘¨æœŸé—´éš”ä¸­ï¼Œå¯¹æ‰€æœ‰çš„æ•°æ®æºå°±éƒ½å‘é€æŽ¥æ”¶æŠ¥å‘Šäº†ã€‚ ä»¥ä¸‹éƒ¨åˆ†å®šä¹‰äº†ä¸¤ç§æŠ¥å‘Šçš„æ ¼å¼ã€‚å¦‚æžœåº”ç”¨ç¨‹åºéœ€è¦å…¶ä»–ä¿¡æ¯ï¼Œä»–ä»¬å¯ä»¥è¢«æ‰©å±•ã€‚ 6.4.1 SRï¼šå‘é€è€…æŠ¥å‘ŠRTCPåŒ… 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ header |V=2|P| RC | PT=SR=200 | length | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | SSRC of sender | +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ sender | NTP timestamp, most significant word | info +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | NTP timestamp, least significant word | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | RTP timestamp | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | senderâ€™s packet count | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | senderâ€™s octet count | +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ report | SSRC_1 (SSRC of first source) | block +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 1 | fraction lost | cumulative number of packets lost | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | extended highest sequence number received | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | interarrival jitter | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | last SR (LSR) | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | delay since last SR (DLSR) | +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ report | SSRC_2 (SSRC of second source) | block +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 2 : â€¦ : +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ | profile-specific extensions | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ å‘é€è€…æŠ¥å‘ŠåŒ…ç”±3éƒ¨åˆ†ç»„æˆï¼Œè‹¥å®šä¹‰ï¼Œå¯èƒ½è·Ÿéšç¬¬4ä¸ªé¢å‘åè®®çš„æ‰©å±•éƒ¨åˆ†ã€‚ ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¤´éƒ¨ï¼Œ8å­—èŠ‚é•¿ã€‚è¯¥åŸŸæœ‰ä»¥ä¸‹æ„ä¹‰ï¼š ç‰ˆæœ¬(V)ï¼š2æ¯”ç‰¹ RTPç‰ˆæœ¬è¯†åˆ«ç¬¦ï¼Œåœ¨RTCPåŒ…å†…çš„æ„ä¹‰ä¸ŽRTPåŒ…ä¸­çš„ç›¸åŒã€‚æ­¤åè®®ä¸­å®šä¹‰çš„ç‰ˆæœ¬å·ä¸º2ã€‚ å¡«å……(P)ï¼š1æ¯”ç‰¹ è‹¥è®¾ç½®å¡«å……æ¯”ç‰¹ï¼Œè¯¥RTCPåŒ…åœ¨æœ«ç«¯åŒ…å«ä¸€äº›é™„åŠ å¡«å……æ¯”ç‰¹ï¼Œå¹¶ä¸æ˜¯æŽ§åˆ¶ä¿¡æ¯çš„åŸºæœ¬éƒ¨åˆ†ã€‚å¡«å……çš„æœ€åŽä¸€ä¸ªæ¯”ç‰¹ç»Ÿè®¡äº†å¤šå°‘ä¸ªå­—èŠ‚å¿…é¡»è¢«å¿½ç•¥ã€‚å¡«å……å¯èƒ½ä¼šç”¨äºŽéœ€è¦å›ºå®šé•¿åº¦å—çš„åŠ å¯†ç®—æ³•ã€‚åœ¨å¤åˆRTCPåŒ…ä¸­ï¼Œå¤åˆåŒ…ä½œä¸ºä¸€ä¸ªæ•´ä½“åŠ å¯†ï¼Œå¡«æ–™æ¯”ç‰¹åªèƒ½åŠ åœ¨æœ€åŽä¸€ä¸ªå•ä¸ªRTCPåŒ…çš„åŽé¢ã€‚ æŽ¥æ”¶æŠ¥å‘Šå—è®¡æ•°(RC)ï¼š5æ¯”ç‰¹ è¯¥åŒ…ä¸­æ‰€å«æŽ¥æ”¶æŠ¥å‘Šå—çš„æ•°ç›®ã€‚é›¶å€¼æœ‰æ•ˆã€‚ åŒ…ç±»åž‹(PT)ï¼š8æ¯”ç‰¹ åŒ…å«å¸¸æ•°200ï¼Œç”¨ä»¥è¯†åˆ«è¿™ä¸ªä¸ºSRåŒ…ã€‚ é•¿åº¦ï¼š16æ¯”ç‰¹ è¯¥RTCPåŒ…çš„é•¿åº¦å‡1ã€‚å…¶å•ä½æ˜¯32æ¯”ç‰¹å­—ï¼ŒåŒ…æ‹¬å¤´å’Œä»»ä½•å¡«å……å­—èŠ‚ã€‚(åç§»é‡1ä¿è¯é›¶å€¼æœ‰æ•ˆï¼Œé¿å…äº†åœ¨æ‰«æRTCPåŒ…é•¿åº¦æ—¶å¯èƒ½å‘ç”Ÿçš„æ— é™å¾ªçŽ¯ï¼ŒåŒæ—¶ä»¥32æ¯”ç‰¹ä¸ºå•ä½é¿å…äº†å¯¹ä»¥4ä¸ºå€æ•°çš„æœ‰æ•ˆæ€§æ£€æµ‹ã€‚) SSRCï¼š32æ¯”ç‰¹ SRåŒ…å‘é€è€…çš„åŒæ­¥æºæ ‡è¯†ç¬¦ã€‚ ç¬¬äºŒéƒ¨åˆ†ï¼Œå‘é€è€…ä¿¡æ¯ï¼Œ20å­—èŠ‚é•¿ã€‚åœ¨æ¯ä¸ªå‘é€è€…æŠ¥å‘ŠåŒ…ä¸­å‡ºçŽ°ã€‚å®ƒæ¦‚æ‹¬äº†ä»Žæ­¤å‘é€è€…å‘å‡ºçš„æ•°æ®ä¼ è¾“æƒ…å†µã€‚æ­¤åŸŸæœ‰ä»¥ä¸‹æ„ä¹‰ï¼š NTPæ—¶é—´æˆ³ï¼š64æ¯”ç‰¹ æŒ‡ç¤ºäº†æ­¤æŠ¥å‘Šå‘é€æ—¶çš„èƒŒæ™¯æ—¶é’Ÿï¼ˆwallclockï¼‰æ—¶åˆ»ï¼Œå®ƒå¯ä»¥ä¸Žä»Žå…¶å®ƒæŽ¥æ”¶è€…è¿”å›žçš„æŽ¥æ”¶æŠ¥å‘Šå—ä¸­çš„æ—¶é—´æ ‡å¿—ç»“åˆèµ·æ¥ï¼Œè®¡ç®—å¾€è¿”æ¯ä¸ªæŽ¥æ”¶è€…æ‰€èŠ±çš„æ—¶é—´ã€‚æŽ¥æ”¶è€…åº”è®©NTPæ—¶é—´æˆ³çš„ç²¾åº¦è¿œå¤§äºŽå…¶ä»–æ—¶é—´æˆ³çš„ç²¾åº¦ã€‚æ—¶é—´æˆ³æµ‹é‡çš„ä¸ç¡®å®šæ€§ä¸å¯çŸ¥ï¼Œå› æ­¤ä¹Ÿæ— éœ€æŒ‡ç¤ºã€‚ä¸€ä¸ªç³»ç»Ÿå¯èƒ½æ²¡æœ‰èƒŒæ™¯æ—¶é’Ÿçš„æ¦‚å¿µï¼Œè€Œåªæœ‰ç³»ç»ŸæŒ‡å®šçš„æ—¶é’Ÿï¼Œå¦‚ç³»ç»Ÿæ—¶é—´ï¼ˆsystem uptimeï¼‰ã€‚åœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œæ­¤æ—¶é’Ÿå¯ä»¥ä½œä¸ºå‚è€ƒè®¡ç®—ç›¸å¯¹NTPæ—¶é—´æˆ³ã€‚é€‰æ‹©ä¸€ä¸ªå…¬ç”¨çš„æ—¶åæ˜¯éžå¸¸é‡è¦çš„ã€‚è¿™æ ·å¤šä¸ªç‹¬ç«‹çš„åº”ç”¨éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ—¶é’Ÿã€‚åˆ°2036å¹´ï¼Œç›¸å¯¹å’Œç»å¯¹NTPæ—¶é—´æˆ³ä¼šäº§ç”Ÿå¤§çš„å·®å¼‚ã€‚åˆ°é‚£æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸å†éœ€è¦ç›¸å¯¹æ—¶é’Ÿã€‚ä¸€ä¸ªå‘é€è€…ï¼Œå¦‚æžœä¸ç”¨èƒŒæ™¯æ—¶é’Ÿæ—¶é—´æˆ–é€åŽ»æ—¶é—´ï¼Œå¯ä»¥è®¾ç½®æ­¤é¡¹ä¸ºé›¶ã€‚ RTPæ—¶é—´æˆ³ï¼š32æ¯”ç‰¹ ä¸Žä»¥ä¸Šçš„NTPæ—¶é—´æ ‡å¿—å¯¹åº”åŒä¸€æ—¶åˆ»ã€‚ä¸Žæ•°æ®åŒ…ä¸­çš„RTPæ—¶é—´æˆ³å…·æœ‰ç›¸åŒçš„å•ä½å’Œåç§»é‡ã€‚è¿™ä¸ªä¸€è‡´æ€§å¯ä»¥ç”¨æ¥è®©NTPæ—¶é—´æ ‡å¿—å·²ç»åŒæ­¥çš„æºä¹‹é—´è¿›è¡Œåª’ä½“å†…/é—´åŒæ­¥ï¼Œè¿˜å¯ä»¥è®©ä¸Žåª’ä½“æ— å…³çš„æŽ¥æ”¶è€…ä¼°è®¡åä¹‰RTPæ—¶é’Ÿé¢‘çŽ‡ã€‚æ³¨æ„åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ­¤æ—¶é—´æˆ³ä¸ç­‰äºŽä»»ä½•ä¸´è¿‘çš„RTPåŒ…ä¸­çš„æ—¶é—´æˆ³ã€‚RTPæ—¶é—´æˆ³å¯ä»¥ç”±ç›¸åº”çš„NTPæ—¶é—´æˆ³è®¡ç®—å¾—åˆ°ã€‚ä¾æ®çš„æ˜¯â€œRTPæ—¶é—´æˆ³è®¡æ•°å™¨â€å’Œâ€œåœ¨é‡‡æ ·æ—¶é€šè¿‡å‘¨æœŸæ€§æ£€æµ‹èƒŒæ™¯æ—¶é’Ÿæ—¶é—´å¾—åˆ°çš„å®žé™…æ—¶é—´â€ä¸¤è€…ä¹‹é—´çš„å…³ç³»ã€‚ ï¼ˆåœ¨RTCP SRåŒ…ä¸­æœ‰NTPæ—¶é—´æˆ³ã€RTPæ—¶é—´æˆ³ï¼Œå®ƒä»¬å¯ä»¥è®¡ç®—èƒŒæ™¯æ—¶é’Ÿå’ŒRTPæ—¶é’Ÿä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œé€šè¿‡è¿™ä¸ªå…³ç³»ï¼Œå¯ä»¥ç”±RTPæ•°æ®åŒ…ä¸­çš„RTPæ—¶é—´æˆ³è®¡ç®—ä¹Ÿç›¸åº”çš„å›žæ”¾æ—¶åˆ»ã€‚è¿™æ ·å°±å¯ä»¥è¿›è¡Œå¤šä¸ªæµçš„åŒæ­¥äº†ã€‚ä¹‹æ‰€ä»¥è¦æœ‰NTPæ—¶é—´æˆ³ï¼Œæ˜¯å› ä¸ºä¸åŒæµçš„RTPæ—¶é—´æˆ³æœ‰ä¸åŒçš„éšæœºåç§»é‡ï¼Œæ— æ³•ç›´æŽ¥è¿›è¡ŒåŒæ­¥ï¼šç¬”è€…æ³¨ã€‚ï¼‰ å‘é€çš„æŠ¥æ–‡æ•°ï¼š32æ¯”ç‰¹ ä»Žå¼€å§‹ä¼ è¾“åˆ°æ­¤SRåŒ…äº§ç”Ÿæ—¶è¯¥å‘é€è€…å‘é€çš„RTPæ•°æ®åŒ…æ€»æ•°ã€‚è‹¥å‘é€è€…æ”¹å˜SSRCè¯†åˆ«ç¬¦ï¼Œè¯¥è®¡æ•°å™¨é‡è®¾ã€‚ å‘é€çš„å­—èŠ‚æ–‡æ•°ï¼š32æ¯”ç‰¹ ä»Žå¼€å§‹ä¼ è¾“åˆ°æ­¤SRåŒ…äº§ç”Ÿæ—¶è¯¥å‘é€è€…åœ¨RTPæ•°æ®åŒ…å‘é€çš„å­—èŠ‚æ€»æ•°(ä¸åŒ…æ‹¬å¤´å’Œå¡«å……)ã€‚è‹¥å‘é€è€…æ”¹å˜SSRCè¯†åˆ«ç¬¦ï¼Œè¯¥è®¡æ•°å™¨é‡è®¾ã€‚æ­¤åŸŸå¯ä»¥ç”¨æ¥ä¼°è®¡å¹³å‡çš„è´Ÿè½½æ•°æ®å‘é€é€ŸçŽ‡ã€‚ ç¬¬ä¸‰éƒ¨åˆ†ï¼šé›¶åˆ°å¤šä¸ªæŽ¥æ”¶æŠ¥å‘Šå—ã€‚å—æ•°ç­‰äºŽä»Žä¸Šä¸€ä¸ªæŠ¥å‘Šä»¥æ¥è¯¥å‘é€è€…ä¾¦å¬åˆ°çš„å…¶å®ƒæºï¼ˆä¸åŒ…æ‹¬è‡ªèº«ï¼‰çš„æ•°ç›®ã€‚æ¯ä¸ªæŽ¥æ”¶æŠ¥å‘Šå—ä¼ è¾“ä»ŽæŸä¸ªåŒæ­¥æºæ¥çš„æ•°æ®åŒ…çš„æŽ¥æ”¶ç»Ÿè®¡ä¿¡æ¯ã€‚è‹¥æ•°æ®æºå› å†²çªè€Œæ”¹å˜å…¶SSRCæ ‡è¯†ç¬¦ï¼ŒæŽ¥æ”¶è€…é‡æ–°è®¾ç½®ç»Ÿè®¡ä¿¡æ¯ã€‚è¿™äº›ç»Ÿè®¡ä¿¡æ¯æœ‰ï¼š SSRC_n(åŒæ­¥æºæ ‡è¯†ç¬¦)ï¼š32æ¯”ç‰¹ åœ¨æ­¤æŽ¥æ”¶æŠ¥å‘Šå—ä¸­ä¿¡æ¯æ‰€å±žæºçš„SSRCæ ‡è¯†ç¬¦ã€‚ ä¸¢åŒ…çŽ‡ï¼š8æ¯”ç‰¹ è‡ªä»Žå‰ä¸€SRåŒ…æˆ–RRåŒ…å‘é€ä»¥æ¥ï¼Œä»ŽSSRC_nä¼ æ¥çš„RTPæ•°æ®åŒ…çš„ä¸¢å¤±æ¯”ä¾‹ã€‚ä»¥å®šç‚¹å°æ•°çš„å½¢å¼è¡¨ç¤ºã€‚è¯¥å€¼å®šä¹‰ä¸ºæŸå¤±åŒ…æ•°ï¼æœŸæœ›æŽ¥æ”¶çš„åŒ…æ•°ã€‚è‹¥ç”±äºŽåŒ…é‡å¤è€Œå¯¼è‡´åŒ…ä¸¢å¤±æ•°ä¸ºè´Ÿå€¼ï¼Œä¸¢åŒ…çŽ‡è®¾ä¸ºé›¶ã€‚æ³¨æ„åœ¨æ”¶åˆ°ä¸Šä¸€ä¸ªåŒ…åŽï¼ŒæŽ¥æ”¶è€…æ— æ³•çŸ¥é“ä»¥åŽçš„åŒ…æ˜¯å¦ä¸¢å¤±ã€‚å¦‚ï¼šè‹¥åœ¨ä¸Šä¸€ä¸ªæŽ¥æ”¶æŠ¥å‘Šé—´éš”å†…ä»ŽæŸä¸ªæºå‘å‡ºçš„æ‰€æœ‰æ•°æ®åŒ…éƒ½ä¸¢å¤±ï¼Œé‚£ä¹ˆå°†ä¸ä¸ºæ­¤æ•°æ®æºå‘é€æŽ¥æ”¶æŠ¥å‘Šå—ã€‚ ç´¯è®¡åŒ…ä¸¢å¤±æ•°ï¼š24æ¯”ç‰¹ ä»Žå¼€å§‹æŽ¥æ”¶åˆ°çŽ°åœ¨ï¼Œä»ŽæºSSRC_nå‘åˆ°æœ¬æºçš„RTPæ•°æ®åŒ…çš„ä¸¢åŒ…æ€»æ•°ã€‚è¯¥å€¼å®šä¹‰ä¸ºï¼šæœŸæœ›æŽ¥æ”¶çš„åŒ…æ•°ï¼å®žé™…æŽ¥æ”¶çš„åŒ…æ•°ã€‚æŽ¥æ”¶çš„åŒ…æ‹¬å¤åˆ¶çš„æˆ–è¿Ÿåˆ°çš„ã€‚ç”±äºŽè¿Ÿåˆ°çš„åŒ…ä¸ç®—ä½œæŸå¤±ï¼Œåœ¨å‘ç”Ÿå¤åˆ¶æ—¶ä¸¢åŒ…æ•°å¯èƒ½ä¸ºè´Ÿå€¼ã€‚æœŸæœ›æŽ¥æ”¶çš„åŒ…æ•°å®šä¹‰ä¸ºï¼šæ‰©å±•çš„ä¸Šä¸€æŽ¥æ”¶åºå·(éšåŽå®šä¹‰)å‡åŽ»æœ€åˆæŽ¥æ”¶åºå·ã€‚ æŽ¥æ”¶åˆ°çš„æ‰©å±•çš„æœ€é«˜åºåˆ—å·ï¼š32æ¯”ç‰¹ ä½Ž16æ¯”ç‰¹åŒ…å«ä»ŽæºSSRC_næ¥çš„æœ€é«˜æŽ¥æ”¶åºåˆ—å·ï¼Œé«˜16æ¯”ç‰¹ç”¨ç›¸åº”çš„åºåˆ—å·å‘¨æœŸè®¡æ•°å™¨æ‰©å±•è¯¥åºåˆ—å·ã€‚æ³¨æ„åœ¨åŒä¸€ä¼šè®®ä¸­çš„ä¸åŒæŽ¥æ”¶è€…ï¼Œè‹¥å¯åŠ¨æ—¶é—´æ˜Žæ˜¾ä¸åŒï¼Œå°†äº§ç”Ÿä¸åŒçš„æ‰©å±•é¡¹ã€‚ åˆ°è¾¾é—´éš”æŠ–åŠ¨ï¼š32æ¯”ç‰¹ RTPæ•°æ®åŒ…åˆ°è¾¾æ—¶åˆ»ç»Ÿè®¡æ–¹å·®çš„ä¼°è®¡å€¼ã€‚æµ‹é‡å•ä½åŒæ—¶é—´æˆ³å•ä½ï¼Œç”¨æ— ç¬¦å·æ•´æ•°è¡¨è¾¾ã€‚åˆ°è¾¾æ—¶é—´æŠ–åŠ¨å®šä¹‰ä¸ºä¸€å¯¹åŒ…ä¸­æŽ¥æ”¶è€…ç›¸å¯¹å‘é€è€…çš„æ—¶é—´é—´éš”å·®å€¼çš„å¹³å‡åå·®(å¹³æ»‘åŽçš„ç»å¯¹å€¼)ã€‚å¦‚ä»¥ä¸‹ç­‰å¼æ‰€ç¤ºï¼Œè¯¥å€¼ç­‰äºŽä¸¤ä¸ªåŒ…ç›¸å¯¹ä¼ è¾“æ—¶é—´çš„å·®å€¼ã€‚ç›¸å¯¹ä¼ è¾“æ—¶é—´æ˜¯æŒ‡ï¼šåŒ…çš„RTPæ—¶é—´æˆ³å’Œåˆ°è¾¾æ—¶åˆ»æŽ¥æ”¶è€…æ—¶é’Ÿæ—¶é—´çš„å·®å€¼ã€‚è‹¥Siæ˜¯åŒ…iä¸­çš„RTPæ—¶é—´æˆ³ï¼ŒRiæ˜¯åŒ…iåˆ°è¾¾æ—¶åˆ»ï¼ˆå•ä½ä¸ºï¼šRTPæ—¶é—´æˆ³å•ä½ï¼‰ã€‚å¯¹äºŽä¸¤ä¸ªåŒ…iå’Œjï¼ŒDå¯ä»¥è¡¨ç¤ºä¸º D(iï¼Œj)=(Rj-Sj)-(Ri-Si)ï¼› åˆ°è¾¾æ—¶åˆ»æŠ–åŠ¨å¯ä»¥åœ¨æ”¶åˆ°ä»ŽæºSSRC_næ¥çš„æ¯ä¸ªæ•°æ®åŒ…iåŽè¿žç»­è®¡ç®—ã€‚åˆ©ç”¨è¯¥åŒ…å’Œå‰ä¸€åŒ…i-1çš„åå·®D(æŒ‰åˆ°è¾¾é¡ºåºï¼Œè€Œéžåºå·é¡ºåº)ï¼Œæ ¹æ®å…¬å¼J=J+(|D(i-1ï¼Œi)|-J)/16è®¡ç®—ã€‚æ— è®ºä½•æ—¶å‘é€æŽ¥æ”¶æŠ¥å‘Šï¼Œéƒ½ç”¨å½“å‰çš„Jå€¼ã€‚ æ­¤å¤„æè¿°çš„æŠ–åŠ¨è®¡ç®—å…è®¸ä¸Žåè®®ç‹¬ç«‹çš„ç›‘è§†å™¨å¯¹æ¥è‡ªä¸åŒå®žçŽ°çš„æŠ¥å‘Šè¿›è¡Œæœ‰æ•ˆçš„è§£é‡Šã€‚ ä¸Šä¸€SRæŠ¥æ–‡ (LSR)ï¼š32æ¯”ç‰¹ æŽ¥æ”¶åˆ°çš„æ¥è‡ªæºSSRC_nçš„æœ€æ–°RTCPå‘é€è€…æŠ¥å‘Š(SR)çš„64ä½NTPæ—¶é—´æ ‡å¿—çš„ä¸­é—´32ä½ã€‚è‹¥è¿˜æ²¡æœ‰æŽ¥æ”¶åˆ°SRï¼Œè¯¥åŸŸå€¼ä¸ºé›¶ã€‚ è‡ªä¸Šä¸€SRçš„æ—¶é—´(DLSR)ï¼š32æ¯”ç‰¹ æ˜¯ä»Žæ”¶åˆ°æ¥è‡ªSSRC_nçš„SRåŒ…åˆ°å‘é€æ­¤æŽ¥æ”¶æŠ¥å‘Šå—ä¹‹é—´çš„å»¶æ—¶ï¼Œä»¥1/65536ç§’ä¸ºå•ä½ã€‚è‹¥è¿˜æœªæ”¶åˆ°æ¥è‡ªSSRC_nçš„SRåŒ…ï¼Œè¯¥åŸŸå€¼ä¸ºé›¶ã€‚ å‡è®¾SSRC_rä¸ºå‘å‡ºæ­¤æŽ¥æ”¶æŠ¥å‘Šå—çš„æŽ¥æ”¶è€…ã€‚æºSSRC_nå¯ä»¥é€šè¿‡è®°å½•æ”¶åˆ°æ­¤æŽ¥æ”¶æŠ¥å‘Šå—çš„æ—¶åˆ»Aæ¥è®¡ç®—åˆ°SSRC_rçš„çŽ¯è·¯ä¼ è¾“æ—¶å»¶ã€‚å¯ä»¥åˆ©ç”¨æœ€æ–°çš„SRæ—¶é—´æ ‡å¿—(LSR)è®¡ç®—æ•´ä¸ªçŽ¯è·¯æ—¶é—´A-LSRï¼Œç„¶åŽå‡åŽ»æ­¤DLSRåŸŸå¾—åˆ°çŽ¯è·¯ä¼ è¾“çš„æ—¶å»¶ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ [10 Nov 1995 11:33:25.125 UTC] [10 Nov 1995 11:33:36.5 UTC] n SR(n) A=b710:8000 (46864.500 s) â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-&gt; v ^ ntp_sec =0xb44db705 v ^ dlsr=0x0005:4000 ( 5.250s) ntp_frac=0x20000000 v ^ lsr =0xb705:2000 (46853.125s) (3024992005.125 s) v ^ r v ^ RR(n) â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-&gt; |&lt;-DLSR-&gt;| (5.250 s) A 0xb710:8000 (46864.500 s) DLSR -0x0005:4000 ( 5.250 s) LSR -0xb705:2000 (46853.125 s) delay 0x0006:2000 ( 6.125 s) å›¾2: å¾€è¿”è·¯ç¨‹æ—¶é—´çš„è®¡ç®—ä¸¾ä¾‹ å¯ä»¥ç”¨æ­¤æ¥è¿‘ä¼¼æµ‹é‡åˆ°ä¸€ç»„æŽ¥æ”¶è€…çš„è·ç¦»ï¼Œå°½ç®¡æœ‰äº›è¿žæŽ¥å¯èƒ½æœ‰éžå¸¸ä¸å¯¹ç§°çš„æ—¶å»¶ã€‚ 6.4.2 RRï¼šæŽ¥æ”¶è€…æŠ¥å‘ŠåŒ… 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ header |V=2|P| RC | PT=RR=201 | length | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | SSRC of packet sender | +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ report | SSRC_1 (SSRC of first source) | block +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 1 | fraction lost | cumulative number of packets lost | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | extended highest sequence number received | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | interarrival jitter | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | last SR (LSR) | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | delay since last SR (DLSR) | +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ report | SSRC_2 (SSRC of second source) | block +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 2 : â€¦ : +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ | profile-specific extensions | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ æŽ¥æ”¶è€…æŠ¥å‘ŠåŒ…(RR)ä¸Žå‘é€è€…æŠ¥å‘ŠåŒ…åŸºæœ¬ç›¸åŒï¼Œé™¤äº†åŒ…ç±»åž‹åŸŸåŒ…å«å¸¸æ•°201å’Œæ²¡æœ‰å‘é€è€…ä¿¡æ¯çš„5ä¸ªå­—(NTPå’ŒRTPæ—¶é—´æ ‡å¿—å’Œå‘é€è€…åŒ…å’Œå­—èŠ‚è®¡æ•°)ã€‚ä½™ä¸‹åŒºåŸŸä¸ŽSRåŒ…æ„ä¹‰ç›¸åŒã€‚è‹¥æ²¡æœ‰å‘é€å’ŒæŽ¥æ”¶æ®æŠ¥å‘Šï¼Œåœ¨RTCPå¤åˆåŒ…å¤´éƒ¨åŠ å…¥ç©ºçš„RRåŒ…(RC=0)ã€‚ 6.4.3å‘é€è€…å’ŒæŽ¥æ”¶è€…æŠ¥å‘Šæ‰©å±• å¦‚æžœæœ‰é¢å¤–çš„å…³äºŽå‘é€è€…å’ŒæŽ¥æ”¶è€…çš„ä¿¡æ¯è¦å‘¨æœŸæ€§çš„ï¼Œæè¿°æ–‡ä»¶ï¼ˆprofileï¼‰åº”è¯¥å®šä¹‰æŽ¥æ”¶è€…æŠ¥å‘Šå’Œå‘é€è€…æŠ¥å‘Šæè¿°æ–‡ä»¶æ‰©å±•ã€‚æ­¤æ—¶ï¼Œåº”é‡‡ç”¨è¿™é‡Œçš„åŠžæ³•ï¼Œè€Œä¸æ˜¯å®šä¹‰å¦å¤–çš„RTCPåŒ…ã€‚å› ä¸ºè¿™ç§åŠžæ³•éœ€è¦çš„å¤´éƒ¨ä¿¡æ¯æ›´å°‘ã€‚ æ‰©å±•éƒ¨åˆ†æ˜¯å‘é€æŠ¥å‘ŠåŒ…å’ŒæŽ¥æ”¶æŠ¥å‘ŠåŒ…çš„ç¬¬å››éƒ¨åˆ†ã€‚å¦‚æžœæœ‰çš„è¯ï¼Œåº”ç´§è·Ÿåœ¨æŽ¥æ”¶æŠ¥å‘Šå—çš„åŽé¢ã€‚å¦‚æžœéœ€è¦æ›´å¤šçš„å‘é€è€…ä¿¡æ¯ï¼Œå®ƒåº”å½“è·Ÿåœ¨å‘é€è€…æŠ¥å‘Šçš„å¼€å…³ï¼Œè€Œä¸åº”åœ¨æŠ¥å‘Šä¸­å‡ºçŽ°ã€‚å¦‚æžœè¦åŒ…å«è¿›æŽ¥æ”¶è€…çš„ä¿¡æ¯ï¼Œå®ƒåº”è¯¥ä»¥å—æ•°ç»„çš„æ–¹å¼æ”¾åˆ°æŽ¥æ”¶æŠ¥å‘Šå—çš„åŽé¢ã€‚å³è¿™äº›å—ä¹Ÿåº”è¢«è®¡å…¥RCå­—æ®µä¸­ã€‚ 6.4.4åˆ†æžå‘é€è€…å’ŒæŽ¥æ”¶è€…æŠ¥å‘Š æŽ¥æ”¶è´¨é‡åé¦ˆä¸ä»…å¯¹å‘é€è€…æœ‰ç”¨ï¼Œè€Œä¸”å¯¹äºŽå…¶å®ƒæŽ¥æ”¶è€…å’Œç¬¬ä¸‰æ–¹ç›‘è§†å™¨ä¹Ÿæœ‰ä½œç”¨ã€‚å‘é€è€…å¯ä»¥åŸºäºŽåé¦ˆä¿®æ­£å‘é€ä¿¡æ¯é‡ï¼›æŽ¥æ”¶è€…å¯ä»¥åˆ¤æ–­é—®é¢˜æ˜¯æœ¬åœ°çš„ï¼ŒåŒºåŸŸå†…çš„è¿˜æ˜¯å…¨å±€çš„ï¼›ç½‘ç»œç®¡ç†è€…å¯ä»¥åˆ©ç”¨ä¸Žåè®®æ— å…³çš„ç›‘è§†å™¨(åªæŽ¥æ”¶RTCPåŒ…è€Œä¸æŽ¥æ”¶ç›¸åº”çš„RTPåŒ…)åŽ»è¯„ä¼°å¤šç‚¹ä¼ é€ç½‘ç»œçš„æ€§èƒ½ã€‚ åœ¨å‘é€è€…ä¿¡æ¯å’ŒæŽ¥æ”¶è€…æŠ¥å‘Šå—ä¸­éƒ½è¿žç»­ç»Ÿè®¡ä¸¢åŒ…æ•°ï¼Œå› æ­¤å¯ä»¥è®¡ç®—ä»»ä½•ä¸¤ä¸ªæŠ¥å‘Šå—ä¸­çš„å·®åˆ«ã€‚åœ¨çŸ­æ—¶é—´å’Œé•¿æ—¶é—´å†…éƒ½å¯ä»¥è¿›è¡Œæµ‹ç®—ã€‚æœ€è¿‘æ”¶åˆ°çš„ä¸¤ä¸ªåŒ…ä¹‹é—´å·®å€¼å¯ä»¥è¯„ä¼°å½“å‰ä¼ è¾“è´¨é‡ã€‚åŒ…ä¸­æœ‰NTPæ—¶é—´æˆ³ï¼Œå¯ä»¥ç”¨ä¸¤ä¸ªæŠ¥å‘Šé—´éš”çš„å·®å€¼è®¡ç®—ä¼ è¾“é€ŸçŽ‡ã€‚ç”±äºŽæ­¤æ—¶é—´é—´éš”ä¸Žæ•°æ®ç¼–ç é€ŸçŽ‡ç‹¬ç«‹ï¼Œå› æ­¤å¯ä»¥å®žçŽ°ä¸Žç¼–ç åŠåè®®ç‹¬ç«‹çš„è´¨é‡ç›‘è§†ã€‚ ä¸€ä¸ªä¾‹å­æ˜¯è®¡ç®—ä¸¤ä¸ªæŠ¥å‘Šé—´éš”æ—¶é—´å†…çš„ä¸¢åŒ…çŽ‡ã€‚ä¸¢åŒ…çŽ‡ï¼æ­¤é—´éš”å†…ä¸¢å¤±çš„åŒ…ï¼æ­¤é—´éš”å†…æœŸæœ›æ”¶åˆ°çš„åŒ…ã€‚å¦‚æžœæ­¤å€¼ä¸Žâ€œä¸¢å¤±æ¯”ä¾‹â€å­—æ®µä¸­çš„å€¼ç›¸åŒï¼Œè¯´æ˜ŽåŒ…æ˜¯è¿žç»­çš„ï¼›è‹¥å¦ï¼Œè¯´æ˜ŽåŒ…ä¸æ˜¯è¿žç»­çš„ã€‚é—´éš”æ—¶é—´å†…çš„ä¸¢åŒ…çŽ‡ï¼é—´éš”æ—¶é—´ï¼æ¯ç§’çš„ä¸¢åŒ…çŽ‡ã€‚ ä»Žå‘é€è€…ä¿¡æ¯ä¸­ï¼Œç¬¬ä¸‰æ–¹ç›‘è§†å™¨å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é—´é—´éš”å†…è®¡ç®—å¹³å‡è´Ÿè½½æ•°æ®å‘é€é€ŸçŽ‡å’Œå¹³å‡å‘åŒ…é€ŸçŽ‡ï¼Œè€Œæ— éœ€è€ƒè™‘æ•°æ®æŽ¥æ”¶ã€‚ä¸¤ä¸ªå€¼çš„æ¯”å°±æ˜¯å¹³å‡è´Ÿè½½å¤§å°ï¼ˆå¹³å‡æ¯ä¸ªåŒ…çš„è´Ÿè½½å¤§å°ï¼‰ã€‚ï¼ˆå³ï¼šå¹³å‡è´Ÿè½½å¤§å°ï¼å¹³å‡è´Ÿè½½æ•°æ®å‘é€é€ŸçŽ‡ï¼å¹³å‡å‘åŒ…çŽ‡ã€‚ï¼‰è‹¥èƒ½å‡å®šä¸¢åŒ…ä¸ŽåŒ…çš„å¤§å°æ— å…³ï¼Œé‚£ä¹ˆæŸä¸ªç‰¹å®šæŽ¥æ”¶è€…æ”¶åˆ°çš„åŒ…æ•°ä¹˜ä»¥å¹³å‡è´Ÿè½½å¤§å°(æˆ–ç›¸åº”çš„åŒ…å¤§å°)å°±å¾—å‡ºæŽ¥æ”¶è€…å¯å¾—åˆ°çš„å¤–åœ¨åžåé‡ã€‚ é™¤äº†ç´¯è®¡è®¡æ•°å…è®¸åˆ©ç”¨æŠ¥å‘Šé—´å·®å€¼è¿›è¡Œé•¿æœŸåŒ…æŸæµ‹é‡å¤–ï¼Œå•ä¸ªæŠ¥å‘Šçš„â€œä¸¢åŒ…æ¯”ä¾‹â€å­—æ®µæä¾›ä¸€ä¸ªçŸ­æ—¶æµ‹é‡æ•°æ®ã€‚å½“ä¼šè¯è§„æ¨¡å¢žåŠ åˆ°æ— æ³•ä¸ºæ‰€æœ‰æŽ¥æ”¶è€…ä¿å­˜æŽ¥æ”¶çŠ¶æ€ä¿¡æ¯ï¼Œæˆ–è€…æŠ¥å‘Šé—´éš”å˜å¾—è¶³å¤Ÿé•¿ä»¥è‡³äºŽä»Žä¸€ä¸ªç‰¹å®šæŽ¥æ”¶è€…åªèƒ½æ”¶åˆ°ä¸€ä¸ªæŠ¥å‘Šæ—¶ï¼ŒçŸ­æ—¶æµ‹é‡æ•°æ®å˜å¾—æ›´é‡è¦ã€‚ åˆ°è¾¾é—´éš”æŠ–åŠ¨å­—æ®µæä¾›å¦ä¸€ä¸ªæœ‰å…³ç½‘ç»œé˜»å¡žçš„çŸ­æ—¶æµ‹é‡é‡ã€‚ä¸¢åŒ…åæ˜ äº†é•¿æœŸé˜»å¡žï¼ŒæŠ–åŠ¨æµ‹é‡åæ˜ å‡ºçŸ­æ—¶é—´çš„é˜»å¡žã€‚æŠ–åŠ¨æµ‹é‡å¯ä»¥åœ¨å¯¼è‡´ä¸¢åŒ…å‰é¢„ç¤ºé˜»å¡žã€‚ç”±äºŽåˆ°è¾¾é—´éš”æŠ–åŠ¨å­—æ®µä»…ä»…æ˜¯å‘é€æŠ¥å‘Šæ—¶åˆ»æŠ–åŠ¨çš„ä¸€ä¸ªå¿«ç…§ï¼Œå› æ­¤éœ€è¦åœ¨ä¸€ä¸ªç½‘ç»œå†…åœ¨ä¸€æ®µæ—¶é—´å†…åˆ†æžæ¥è‡ªæŸä¸ªæŽ¥æ”¶è€…çš„æŠ¥å‘Šï¼Œæˆ–è€…åˆ†æžæ¥è‡ªå¤šä¸ªæŽ¥æ”¶è€…çš„æŠ¥å‘Šã€‚ 6.5æºæè¿°RTCPåŒ… æºæè¿°ï¼ˆSDESï¼‰åŒ…ç”±ä¸€ä¸ªå¤´åŠ0ä¸ªæˆ–å¤šä¸ªå—ç»„æˆã€‚æ¯ä¸ªå—éƒ½ç”±å—ä¸­æ‰€æ ‡è¯†çš„æ•°æ®æºçš„æ ‡è¯†ç¬¦åŠå…¶åŽçš„å„ä¸ªæè¿°æž„æˆã€‚ 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ header |V=2|P| SC | PT=SDES=202 | length | +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ chunk | SSRC/CSRC_1 | 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | SDES items | | â€¦ | +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ chunk | SSRC/CSRC_2 | 2 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | SDES items | | â€¦ | +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ 6.6 BYEï¼ˆBYEåŒ…ï¼‰ 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |V=2|P| SC | PT=BYE=203 | length | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | SSRC/CSRC | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ : â€¦ : +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+ (opt) | length | reason for leaving â€¦ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ BYEåŒ…è¡¨æ˜Žä¸€ä¸ªæˆ–å¤šä¸ªæºå°†è¦ç¦»å¼€ã€‚å¦‚æžœæ··åˆå™¨æ”¶åˆ°BYEåŒ…ï¼Œæ··åˆå™¨åº”å½“å‘é€è¿™ä¸ªBYEåŒ…ï¼Œå¹¶ä¿æŒSSRC/CSRCä¸å˜ã€‚å¦‚æžœæ··åˆå™¨å…³é—­ï¼Œåº”å‘è´¡çŒ®æºåˆ—è¡¨ä¸­çš„æ‰€æœ‰SSRCï¼ŒåŒ…æ‹¬å®ƒè‡ªå·±çš„SSRCå‘é€BYEåŒ…ã€‚BYEåŒ…å¯èƒ½ä¼šæœ‰é€‰æ‹©çš„åŒ…å«8ä¸ªå­—èŠ‚çš„ç»Ÿè®¡å­—æ®µï¼Œå…¶åŽè·Ÿä¸Šå‡ ä¸ªå­—èŠ‚çš„æ–‡æœ¬è¡¨æ˜Žç¦»å¼€çš„åŽŸå› ã€‚æ–‡æœ¬å­—ç¬¦ä¸²ç¼–ç æ ¼å¼å’ŒSDESä¸­æè¿°çš„ç›¸åŒã€‚ 9å®‰å…¨æ€§ åº•å±‚åè®®å°†æœ€ç»ˆæä¾›ç”±RTPåº”ç”¨è¦æ±‚çš„æ‰€æœ‰å®‰å…¨æœåŠ¡ï¼ŒåŒ…æ‹¬çœŸå®žæ€§ã€å®Œæ•´æ€§ã€ä¿å¯†æ€§ã€‚è¿™äº›æœåŠ¡åœ¨å‚è€ƒæ–‡çŒ®[27]ä¸­çš„IPåè®®æœ‰è¯¦ç»†æè¿°ã€‚ç”±äºŽä½¿ç”¨RTPçš„åˆå§‹éŸ³é¢‘å’Œè§†é¢‘åº”ç”¨åœ¨IPå±‚å¯ç”¨ä¹‹å‰å°±è¦æ±‚ä¿å¯†æ€§æœåŠ¡ï¼Œå› æ­¤ï¼ŒéšåŽçš„ä¸€å°èŠ‚æè¿°äº†ä½¿ç”¨RTPå’ŒRTCPçš„ä¿å¯†æ€§æœåŠ¡ã€‚æ–°çš„RTPåº”ç”¨å¯ä»¥å®žçŽ°è¿™é‡Œæè¿°çš„RTPä¿å¯†æ€§æœåŠ¡ï¼Œä»¥ç”¨äºŽå‘åŽå…¼å®¹ï¼Œä¹Ÿå¯ä»¥å®žçŽ°æ›¿ä»£è¿™é‡Œçš„å®‰å…¨æœåŠ¡ã€‚è¿™ç§å®‰å…¨æœåŠ¡çš„RTPå¼€é”€æ˜¯æ¯”è¾ƒå°çš„ã€‚å› æ­¤ï¼Œå¦‚æžœè¿™é¡¹æœåŠ¡è¢«å°†æ¥çš„æŸç§æœåŠ¡æ‰€æ›¿ä»£ï¼Œä»£ä»·ä¹Ÿæ˜¯æ¯”è¾ƒå°çš„ã€‚ å¦ä¸€æ–¹é¢ï¼ŒRTPçš„å…¶ä»–æœåŠ¡ï¼ŒæœåŠ¡çš„å…¶ä»–å®žçŽ°åŠå…¶ä»–çš„ç®—æ³•å¯èƒ½ä¼šåœ¨å°†æ¥å®šä¹‰ã€‚ç‰¹åˆ«æ˜¯ä¸ºRTPè´Ÿè½½æä¾›å¯é æ€§çš„å®žæ—¶å®‰å…¨ä¼ è¾“åè®®ï¼ˆ Secure Real-time Transport, SRTPï¼‰æ­£åœ¨åˆ¶å®šä¸­ã€‚å®ƒå¯ä»¥ä½¿RTPå¤´éƒ¨ä¸è¢«åŠ å¯†ã€‚è¿™æ ·ï¼Œé“¾è·¯å±‚çš„å¤´éƒ¨åŽ‹ç¼©ç®—æ³•å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚SRTPåŸºäºŽé«˜çº§ä¼ä¸šæ ‡å‡†ï¼ˆAdvanced Encryption Standard, AESï¼‰åˆ¶å®šã€‚å®ƒæ¯”è¿™é‡Œæè¿°çš„æœåŠ¡æä¾›æ›´å¼ºå¥çš„å®‰å…¨æ€§ã€‚ å¯†é’¥å’Œè¯ä¹¦åˆ†é…è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚ 9.1 ä¿å¯†æ€§ ä¿å¯†æ€§æ„å‘³ç€åªæœ‰ç‰¹å®šçš„æŽ¥æ”¶è€…æ‰èƒ½å¤Ÿå¯¹æ”¶åˆ°çš„åŒ…è¿›è¡Œè§£ç ï¼›å¯¹å…¶ä»–äººï¼ŒåŒ…é‡Œå«æœ‰çš„éƒ½æ˜¯æ— ç”¨ä¿¡æ¯ã€‚å†…å®¹çš„ä¿å¯†æ€§é€šè¿‡åŠ å¯†æ¥å®žçŽ°ã€‚ å½“ç”¨è¿™èŠ‚æŒ‡å®šçš„æ–¹æ³•RTPã€RTCPåŠ å¯†æ—¶ï¼Œä¸ºäº†ä¼ è¾“è€Œå°è£…çš„æ‰€æœ‰å­—èŠ‚å°†åœ¨åº•å±‚çš„åŒ…ä¸­ä½œä¸ºä¸€ä¸ªå•å…ƒåŠ å¯†ã€‚å¯¹RTCPï¼Œæ¯ä¸ªå•å…ƒåœ¨åŠ å¯†ä¹‹å‰å¿…é¡»åœ¨å‰é¢é™„åŠ ä¸€ä¸ª32å­—èŠ‚çš„éšæœºæ•°ã€‚å¯¹RTPï¼Œä¸å¿…åœ¨å‰é¢åŠ å‰ç¼€ï¼Œè€Œæ˜¯è®©åºåˆ—å·å’Œæ—¶é—´æˆ³å­—æ®µéƒ½ç”¨éšæœºåç§»é‡åˆå§‹åŒ–ã€‚ç”±äºŽè¾ƒå·®çš„éšæœºæ€§è´¨ã€‚è¿™å…¶å®žæ˜¯ä¸€ä¸ªå¼±çš„åˆå§‹åŒ–å‘é‡ï¼ˆinitialization vector, IVï¼‰ã€‚å¦å¤–ï¼Œå¦‚æžœå…¶åŽçš„SSRCå­—æ®µè¢«æ”»å‡»è€…å¾—åˆ°ï¼Œåˆ™åŠ å¯†ç®—æ³•å°†å‡ºçŽ°æ–°çš„è–„å¼±ç‚¹ã€‚ å¯¹RTCPï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½å°†RTCPå¤åˆåŒ…ä¸­çš„ä¸€ä¸ªRTCPåŒ…åˆ†å‰²æˆä¸¤ä¸ªRTCPå¤åˆåŒ…ã€‚å…¶ä¸­ï¼Œä¸€ä¸ªåœ¨å‘é€æ—¶åŠ å¯†ï¼Œå¦ä¸€ä¸ªå‘é€æ—¶ä¸åŠ å¯†ã€‚ä¾‹å¦‚ï¼ŒSDESä¿¡æ¯å¯èƒ½ä¼šè¢«åŠ å¯†ï¼Œä½†æŽ¥æ”¶è€…æŠ¥å‘Šå´ä¸åŠ å¯†ï¼Œä»¥é€‚ç”¨äºŽæ²¡æœ‰å¯†é’¥çš„ç¬¬ä¸‰æ–¹ç›‘è§†è€…ã€‚å¦‚å›¾4æ‰€ç¤ºã€‚æºæè¿°ä¿¡æ¯åŽå¿…é¡»é™„åŠ æ²¡æœ‰æŠ¥å‘Šçš„ç©ºRRåŒ…ï¼Œä»¥æ»¡è¶³æ‰€æœ‰RTCPå¤åˆåŒ…å¿…é¡»ä»¥SRæˆ–RRåŒ…å¼€å¤´çš„è¦æ±‚ã€‚SDESçš„CNAMEå­—æ®µåŒ…å«åœ¨åŠ å¯†æˆ–æœªåŠ å¯†çš„åŒ…ä¸­ä¹‹ä¸€å³å¯ï¼Œä½†å¹¶ä¸éƒ½éœ€è¦åŒ…å«ã€‚ç›¸åŒçš„æºæè¿°ä¿¡æ¯ä¸åº”åœ¨ä¸¤ä¸ªåŒ…ä¸­éƒ½æºå¸¦ã€‚å¦åˆ™ä¼šä½¿åŠ å¯†ç®—æ³•ä¸å®‰å…¨ã€‚ UDP packet UDP packet [random][RR][SDES #CNAME â€¦] [SR #senderinfo #site1 #site2] encrypted not encrypted #: SSRC identifier å›¾4: åŠ å¯†çš„å’ŒæœªåŠ å¯†çš„RTCPåŒ… æŽ¥æ”¶è€…åŠ å¯†çš„ä½¿ç”¨å’Œæ­£ç¡®å¯†é’¥çš„ä½¿ç”¨é€šè¿‡å¤´æˆ–è´Ÿè½½çš„æœ‰æ•ˆæ€§æ£€æŸ¥è¿›è¡Œç¡®è®¤ã€‚RTPå’ŒRTCPå¤´çš„æœ‰æ•ˆæ€§æ£€æŸ¥ç”±é™„å½•A.1å’ŒA.2ç»™å‡ºã€‚ ä¸ºå’ŒRFC1889ä¸­RTPåˆå§‹æè¿°ä¸­çš„å®žçŽ°ç›¸ä¸€è‡´ã€‚é»˜è®¤çš„ç®—æ³•æ˜¯é“¾å¼åŠ å¯†å—æ¨¡å¼ï¼ˆcipher block chaining (CBC) modeï¼‰ä¸‹çš„æ•°æ®åŠ å¯†ç®—æ³•ï¼Œè§RFC1423ä¸­1.1èŠ‚çš„æè¿°ã€‚é™¤éžå‡ºçŽ°ç”±5.1èŠ‚æè¿°æŒ‡æ˜Žçš„å¡«å……å¤šä¸ªå­—èŠ‚çš„æƒ…å†µï¼Œå¦åˆ™ï¼Œåˆå§‹çš„éšæœºå‘é‡æ˜¯0ï¼Œå› ä¸ºéšæœºå€¼ç”±RTPå¤´æˆ–RTCPå¤åˆåŒ…çš„éšæœºå‰ç¼€æä¾›ã€‚CBCåˆå§‹å‘é‡çš„ç»†èŠ‚è§å‚è€ƒæ–‡çŒ®[30]ã€‚æ”¯æŒæœ¬èŠ‚çš„åŠ å¯†ç®—æ³•çš„å®žçŽ°ä¹Ÿåº”å½“æ”¯æŒCBCä¸‹çš„DESç®—æ³•ã€‚å› ä¸ºæ­¤ç®—æ³•å¯å®žçŽ°æœ€å¤§ç¨‹åº¦çš„äº¤äº’å¯æ“ä½œæ€§ã€‚é‡‡ç”¨è¿™ç§æ–¹æ³•çš„åŽŸå› æ˜¯ï¼Œå› ç‰¹ç½‘ä¸Šé€šè¿‡éŸ³é¢‘ã€è§†é¢‘å·¥å…·åšå®žéªŒè¯æ˜Žå®ƒç®€ä¾¿ä¸”æœ‰æ•ˆã€‚ä½†DESè¢«å‘çŽ°å¾ˆå®¹æ˜“è¢«ç ´è§£ã€‚å»ºè®®ç”¨æ›´å¼ºå¥çš„åŠ å¯†ç®—æ³•ï¼Œä¾‹å¦‚ä¸‰å±‚DESåŠ å¯†ç®—æ³•æ¥ä»£æ›¿é»˜è®¤çš„åŠ å¯†ç®—æ³•ã€‚å¦å¤–ï¼Œå®‰å…¨CBCæ¨¡å¼è¦æ±‚æ¯ä¸ªåŒ…çš„ç¬¬ä¸€ä¸ªå—å’Œä¸€ä¸ªéšæœºæ•°æ±‚å¼‚æˆ–ã€‚å¯¹äºŽRTCPï¼Œè¿™é€šè¿‡åœ¨æ¯ä¸ªåŒ…å‰é™„åŠ ä¸€ä¸ª32ä½çš„éšæœºæ•°å®žçŽ°ã€‚æ¯ä¸ªåŒ…çš„éšæœºæ•°ç›¸äº’ç‹¬ç«‹ã€‚å¯¹RTPï¼Œæ—¶é—´æˆ³å’Œåºåˆ—å·å°†ä»Žé™„åŠ çš„æ•°å€¼å¼€å§‹ï¼Œä½†å¯¹è¿žç»­çš„åŒ…ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯è¢«ç‹¬ç«‹çš„éšæœºåŒ–çš„ã€‚åº”è¯¥æ³¨æ„åˆ°å¯¹RTPå’ŒRTCPï¼Œè¿™ç§éšæœºæ€§éƒ½å—åˆ°äº†é™åˆ¶ã€‚é«˜å®‰å…¨æ€§çš„åº”ç”¨åº”å½“è€ƒè™‘å…¶ä»–æ›´åŠ ç®€æ·å®‰å…¨çš„æ–¹æ³•ã€‚å…¶ä»–åŠ å¯†ç®—æ³•åº”é€šè¿‡éžRTPæ–¹æ³•å¯¹ä¸€ä¸ªä¼šè¯åŠ¨æ€æŒ‡å®šã€‚ç‰¹åˆ«æ˜¯åŸºäºŽAESçš„SRTPæè¿°æ–‡ä»¶ï¼ˆè§å‚è€ƒæ–‡çŒ®[23]ï¼‰å°†ä¼šæ˜¯æœªæ¥çš„ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä»¥ä¸Šæè¿°äº†IPå±‚æˆ–RTPå±‚åŠ å¯†ã€‚ä½œä¸ºå®ƒçš„æ›¿ä»£ï¼Œæè¿°æ–‡ä»¶å¯ä»¥å®šä¹‰å¦å¤–çš„è´Ÿè½½ç±»åž‹ä»¥ç”¨äºŽåŠ å¯†ã€ç¼–ç ã€‚è¿™äº›ç¼–ç å¿…é¡»æè¿°å¦‚ä½•å¡«å……ï¼Œä»¥åŠç¼–ç çš„å…¶ä»–æ–¹é¢å¦‚ä½•æŽ§åˆ¶ã€‚è¿™ç§æ–¹æ³•å¯ä»¥æŒ‰ç…§åº”ç”¨çš„è¦æ±‚ï¼ŒåªåŠ å¯†æ•°æ®ï¼Œä¸åŠ å¯†å¤´éƒ¨ã€‚è¿™å¯èƒ½å¯¹åŒæ—¶å¤„ç†è§£å¯†å’Œè§£ç çš„ç¡¬ä»¶æœåŠ¡ç‰¹åˆ«é‡è¦ã€‚è¿™ä¹Ÿå¯èƒ½å¯¹RTPå’Œåº•å±‚å¤´éƒ¨çš„é“¾è·¯å±‚çš„åº”ç”¨å¾ˆæœ‰ç”¨ã€‚æ—¢ç„¶å¤´éƒ¨çš„åŠ å¯†å·²ç»è¿›è¡Œäº†åŽ‹ç¼©ï¼Œè´Ÿè½½ï¼ˆè€Œä¸æ˜¯åœ°å€ï¼‰çš„ä¿å¯†æ€§å°±è¶³å¤Ÿäº†ã€‚ 9.2 çœŸå®žæ€§å’Œä¿¡æ¯å®Œæ•´æ€§ çœŸå®žæ€§å’Œä¿¡æ¯å®Œæ•´æ€§æ²¡æœ‰åœ¨RTPå±‚å®šä¹‰ï¼Œå› ä¸ºè¿™äº›æœåŠ¡ç¦»ä¸å¼€å¯†é’¥ç®¡ç†ä½“ç³»ã€‚å¯ä»¥æœŸæœ›çœŸå®žæ€§å’Œä¿¡æ¯å®Œæ•´æ€§å°†ç”±åº•å±‚åè®®å®Œæˆã€‚ 10 æ‹¥å¡žæŽ§åˆ¶ å› ç‰¹ç½‘ä¸Šçš„æ‰€æœ‰ä¼ è¾“åè®®éƒ½éœ€è¦é€šè¿‡ä¸€äº›æ–¹æ³•è¿›è¡Œåœ°å€æ‹¥å¡žæŽ§åˆ¶ï¼ˆè§å‚è€ƒæ–‡çŒ®[31]ï¼‰ï¼ŒRTPä¹Ÿä¸ä¾‹å¤–ã€‚ä½†ç”±äºŽRTPæ•°æ®ä¼ è¾“ç»å¸¸ç¼ºå°‘å¼¹æ€§ï¼ˆä»¥å›ºå®šçš„æˆ–æŽ§åˆ¶å¥½çš„é€ŸçŽ‡äº§ç”ŸåŒ…ï¼‰ã€‚å› æ­¤ï¼ŒRTPçš„æ‹¥å¡žæŽ§åˆ¶æ–¹æ³•å’Œå…¶ä»–çš„ä¼ è¾“åè®®ï¼Œå¦‚TCPå¾ˆä¸ç›¸åŒã€‚åœ¨æŸç§ç¨‹åº¦ä¸Šï¼Œç¼ºä¹å¼¹æ€§æ„å‘³ç€é™ä½Žäº†æ‹¥å¡žçš„é£Žé™©ã€‚å› ä¸ºRTPæµä¸ä¼šåƒTCPæµé‚£æ ·å¢žé•¿åˆ°æ¶ˆè€—æŽ‰æ‰€æœ‰å¯ç”¨çš„å¸¦å®½ç¨‹åº¦ã€‚ä½†æ˜¯ï¼Œç¼ºä¹å¼¹æ€§ä¹Ÿæ„å‘³ç€RTPæµä¸èƒ½ä»»æ„å‡å°å®ƒåœ¨ç½‘ç»œä¸Šçš„è´Ÿè½½é‡ï¼Œä»¥åœ¨å‡ºçŽ°æ‹¥å¡žæ—¶æ¶ˆé™¤ä¹‹ã€‚ ç”±äºŽRTPå¯èƒ½ä¼šåœ¨è®¸å¤šä¸åŒçš„æƒ…å†µä¸‹ç”¨äºŽç›¸å½“å¹¿çš„ã€‚å› æ­¤å°±æ²¡æœ‰ä¸€ä¸ªå…¨éƒ½é€šç”¨ä¸€ä¸ªæ‹¥å¡žæŽ§åˆ¶æœºåˆ¶ã€‚å› æ­¤ï¼Œæ‹¥å¡žæŽ§åˆ¶åº”å½“åœ¨æè¿°æ–‡ä»¶ä¸­å®šä¹‰ã€‚å¯¹äºŽæŸäº›æè¿°ï¼Œå¯èƒ½åŠ ä¸Šå¯åº”ç”¨æ€§é™ˆè¿°ä»¥é™åˆ¶æè¿°åº”ç”¨åœ¨å·²è®¾è®¡æ¶ˆé™¤æ‹¥å¡žçš„çŽ¯å¢ƒä¸­ã€‚å¯¹å…¶å®ƒæè¿°ï¼Œå¯èƒ½éœ€è¦ç‰¹åˆ«çš„æ–¹æ³•ï¼Œå¦‚åŸºäºŽRTCPåé¦ˆçš„è‡ªé€‚åº”æ•°æ®ä¼ è¾“é€ŸçŽ‡ã€‚ å‚è€ƒæ–‡çŒ®ï¼š æ­£å¼å‚è€ƒæ–‡çŒ® [1] Schulzrinne, H. and S. Casner, â€œéŸ³é¢‘å’Œè§†é¢‘ä¼šè®®æœ€å°æŽ§åˆ¶çš„RTPæè¿°â€, RFC 3551, 2003.6 [2] Bradner, S., â€œè¡¨ç¤ºéœ€æ±‚å±‚çš„RFCå…³é”®å­—â€, BCP 14, RFC 2119, 1997.3 [3] Postel, J., â€œç½‘ç»œåè®®â€, STD 5, RFC 791, 1981.9 [4] Mills, D., â€œç½‘ç»œæ—¶é—´åè®®ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰æè¿°ã€å®žçŽ°å’Œåˆ†æžâ€, RFC 1305,1992.3 [5] Yergeau, F., â€œUTF-8, ä¸€ä¸ªISO 10646ä¼ è¾“æ ¼å¼â€, RFC 2279,1998.1 [6] Mockapetris, P., â€œåŸŸåâ€•â€•æ¦‚å¿µå’Œå·¥å…·â€, STD 13, RFC 1034,1987.11 [7] Mockapetris, P., â€œåŸŸåâ€•â€•å®žçŽ°å’Œæè¿°â€, STD 13, RFC 1035,1987.1 [8] Braden, R., â€œå› ç‰¹ç½‘ä¸»æœºéœ€æ±‚â€•â€•åº”ç”¨å’Œæ”¯æŒâ€, STD 3, RFC 1123,1989.10 [9] Resnick, P., â€œå› ç‰¹ç½‘ä¿¡æ¯æ ¼å¼â€, RFC 2822,2001.4 éžæ­£å¼å‚è€ƒæ–‡çŒ® [10] Clark, D. and D. Tennenhouse, â€œæ–°ä¸€ä»£åè®®çš„å»ºæž„è€ƒè™‘,â€ å…³äºŽé€šä¿¡ä½“ç³»ç»“æž„å’Œåè®®çš„æ•°æ®é€šä¿¡ä¸“ä¸šç»„è®¨è®ºç­, (å®¾å¤•æ³•å°¼äºšå·žï¼Œè´¹åŸŽ), IEEE è®¡ç®—æœºé€šä¿¡å›žé¡¾ å·. 20(4), 200ï¼208é¡µ,1990.9 [11] Schulzrinne, H., â€œå…³äºŽè®¾è®¡éŸ³é¢‘ã€è§†é¢‘ä¼šè¯ä¼ è¾“åè®®åŠå…¶å®ƒå¤šå‚ä¸Žè€…å®žæ—¶åº”ç”¨çš„è®¨è®ºâ€, 1993.10 [12] Comer, D., TCP/IPç½‘ç»œåè®® ,å·1. Englewood Cliffs, New Jersey: Prentice Hall, 1991. [13] Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A.,Peterson, J., Sparks, R., Handley, M. and E. Schooler, â€œSIP:ä¼šè¯åˆå§‹åè®®â€, RFC 3261,2002.6 [14] International Telecommunication Union, â€œå¯¹ä¸ä¿è¯è´¨é‡çš„å±€åŸŸç½‘çš„å¯è§†ç”µè¯ç³»ç»Ÿå’Œè®¾å¤‡â€, Recommendation H.323,ITUçš„æ— çº¿ç”µé€šè®¯æ ‡å‡†ä¸€èŠ‚, Geneva, Switzerland, 2003.7 [15] Handley, M. and V. Jacobson, â€œSDP: ä¼šè¯æè¿°åè®®â€, RFC 2327,1998.4 [16] Schulzrinne, H., Rao, A. and R. Lanphier, â€œå®žæ—¶æµåè®®(RTSP)â€, RFC 2326,1998.4 [17] Eastlake 3rd, D., Crocker, S. and J. Schiller, â€œå…³äºŽå®‰å…¨æ€§çš„éšæœºåŒ–å»ºè®®â€, RFC 1750, 1994.12 [18] Bolot, J.-C., Turletti, T. and I. Wakeman, â€œå› ç‰¹ç½‘å¤šæ’­è§†é¢‘åˆ†å¸ƒçš„å¯å‡çº§çš„åé¦ˆæŽ§åˆ¶â€,å…³äºŽé€šä¿¡ä½“ç³»ç»“æž„å’Œåè®®çš„æ•°æ®é€šä¿¡ä¸“ä¸šç»„è®¨è®ºç­ï¼ˆè‹±å›½ï¼Œä¼¦æ•¦ï¼‰, ACM,58â€”67é¡µ, 1994.8 [19] Busse, I., Deffner, B. and H. Schulzrinne, â€œåŸºäºŽRTPçš„å¤šåª’ä½“åº”ç”¨çš„åŠ¨æ€ QoSæŽ§åˆ¶â€, è®¡ç®—æœºé€šè®¯,å·19,49â€”58é¡µ,1996.1 [20] Floyd, S. and V. Jacobson, â€œå‘¨æœŸæ€§è·¯ç”±ä¿¡æ¯çš„åŒæ­¥â€,å…³äºŽé€šä¿¡ä½“ç³»ç»“æž„å’Œåè®®çš„æ•°æ®é€šä¿¡ä¸“ä¸šç»„è®¨è®ºç­ (æ—§é‡‘å±±,åŠ åˆ©ç¦å°¼äºš), 33â€”44é¡µ, ACM,1993.9 å¹¶å‚è§[34]. [21] Rosenberg, J. and H. Schulzrinne, â€œRTPä¸­æˆå‘˜ç»„çš„é‡‡æ ·â€, RFC 2762,2000.2 [22] Cadzow, J., â€œçº½çº¦æ•°å­—ä¿¡å·å¤„ç†å’Œæ•°æ®åˆ†æžåŸºç¡€â€ çº½çº¦: Macmillan, 1987. [23] Hinden, R. and S. Deering, â€œIPv6åœ°å€ç»“æž„â€, RFC 3513,2003.4 [24] Rekhter, Y., Moskowitz, B., Karrenberg, D., de Groot, G. and E.Lear, â€œä¿å¯†å› ç‰¹ç½‘ä¸­çš„åœ°å€åˆ†é…â€, RFC 1918,1996.2 [25] Lear, E., Fair, E., Crocker, D. and T. Kessler, â€œè€ƒè™‘å¯èƒ½æœ‰å®³çš„ç½‘ç»œ10 (ä¸€äº›å®žçŽ°ä¸åº”æˆä¸ºæ ‡å‡†)â€, RFC 1627,1994.7 [26] Feller, W.,æ¦‚çŽ‡è®ºåŠå…¶åº”ç”¨å…¥é—¨,å·1. çº½çº¦: John Wiley and Sons , 1968. [27] Kent, S. and R. Atkinson, â€œå› ç‰¹ç½‘åè®®çš„å®‰å…¨ä½“ç³»â€, RFC 2401,1998.11 [28] Baugher, M., Blom, R., Carrara, E., McGrew, D., Naslund, M.,Norrman, K. and D. Oran, â€œå®‰å…¨å®žæ—¶ä¼ è¾“åè®®â€,2003.4 [29] Balenson, D., â€œå¢žå¼ºå› ç‰¹ç½‘ç”µå­é‚®ä»¶çš„ä¿å¯†æ€§:ç¬¬ä¸‰éƒ¨åˆ†â€, RFC 1423,1993.2 [30] Voydock, V. and S. Kent, â€œé«˜å±‚ç½‘ç»œåè®®çš„å®‰å…¨æœºåˆ¶â€, ACM è®¡ç®—è°ƒæŸ¥,å·15,135-171é¡µ,1983.6 [31] Floyd, S., â€œæ‹¥å¡žæŽ§åˆ¶åŽŸç†â€, BCP 41, RFC 2914,2000.9 [32] Rivest, R., â€œMD5é€šè®¯â€•â€•ç®—æ³•æ‘˜è¦â€, RFC 1321,1992.4 [33] Stubblebine, S., â€œå¤šåª’ä½“ä¼šè¯çš„å®‰å…¨æœåŠ¡â€, ç¬¬16å±Šå›½é™…å®‰å…¨ä¼šè®®ï¼Œ(å·´å°”çš„æ‘©,é©¬é‡Œå…°å·ž),391â€”395é¡µ,1993.9 [34] Floyd, S. and V. Jacobson, â€œå‘¨æœŸè·¯ç”±ä¿¡æ¯åŒæ­¥â€, IEEE/ACM ç½‘ç»œä¼ è¾“,å·2,122â€”136é¡µ,1994.4]]></content>
      <categories>
        <category>RFC</category>
      </categories>
      <tags>
        <tag>åè®®</tag>
        <tag>RTP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webrtc-source-android]]></title>
    <url>%2F2017%2F07%2F15%2Fwebrtc-source-android%2F</url>
    <content type="text"><![CDATA[nativeCreateVideoSource åˆå§‹åŒ–PeerConnectionFactory(pc/peerconnectionfactory) åˆ›å»ºPeerConnectionæ–¹æ³•ä¸­: 12345678910111213141516171819202122232425262728293031rtc::scoped_refptr&lt;PeerConnectionInterface&gt;PeerConnectionFactory::CreatePeerConnection( const PeerConnectionInterface::RTCConfiguration&amp; configuration, std::unique_ptr&lt;cricket::PortAllocator&gt; allocator, std::unique_ptr&lt;rtc::RTCCertificateGeneratorInterface&gt; cert_generator, PeerConnectionObserver* observer) &#123; RTC_DCHECK(signaling_thread_-&gt;IsCurrent()); if (!cert_generator.get()) &#123; // No certificate generator specified, use the default one. cert_generator.reset( new rtc::RTCCertificateGenerator(signaling_thread_, network_thread_)); &#125; if (!allocator) &#123; allocator.reset(new cricket::BasicPortAllocator( default_network_manager_.get(), default_socket_factory_.get())); &#125; network_thread_-&gt;Invoke&lt;void&gt;( RTC_FROM_HERE, rtc::Bind(&amp;cricket::PortAllocator::SetNetworkIgnoreMask, allocator.get(), options_.network_ignore_mask)); rtc::scoped_refptr&lt;PeerConnection&gt; pc( new rtc::RefCountedObject&lt;PeerConnection&gt;(this)); if (!pc-&gt;Initialize(configuration, std::move(allocator), std::move(cert_generator), observer)) &#123; return nullptr; &#125; return PeerConnectionProxy::Create(signaling_thread(), pc);&#125; æž„é€ PeerConnectionå¯¹è±¡pc,å¹¶è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•Initialize,Initializeä¸­: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182ool PeerConnection::Initialize( const PeerConnectionInterface::RTCConfiguration&amp; configuration, std::unique_ptr&lt;cricket::PortAllocator&gt; allocator, std::unique_ptr&lt;rtc::RTCCertificateGeneratorInterface&gt; cert_generator, PeerConnectionObserver* observer) &#123; TRACE_EVENT0(&quot;webrtc&quot;, &quot;PeerConnection::Initialize&quot;); if (!allocator) &#123; LOG(LS_ERROR) &lt;&lt; &quot;PeerConnection initialized without a PortAllocator? &quot; &lt;&lt; &quot;This shouldn&apos;t happen if using PeerConnectionFactory.&quot;; return false; &#125; if (!observer) &#123; // TODO(deadbeef): Why do we do this? LOG(LS_ERROR) &lt;&lt; &quot;PeerConnection initialized without a &quot; &lt;&lt; &quot;PeerConnectionObserver&quot;; return false; &#125; observer_ = observer; port_allocator_ = std::move(allocator); // The port allocator lives on the network thread and should be initialized // there. if (!network_thread()-&gt;Invoke&lt;bool&gt;( RTC_FROM_HERE, rtc::Bind(&amp;PeerConnection::InitializePortAllocator_n, this, configuration))) &#123; return false; &#125; // Call must be constructed on the worker thread. factory_-&gt;worker_thread()-&gt;Invoke&lt;void&gt;( RTC_FROM_HERE, rtc::Bind(&amp;PeerConnection::CreateCall_w, this)); session_.reset(new WebRtcSession( call_.get(), factory_-&gt;channel_manager(), configuration.media_config, event_log_.get(), factory_-&gt;network_thread(), factory_-&gt;worker_thread(), factory_-&gt;signaling_thread(), port_allocator_.get(), std::unique_ptr&lt;cricket::TransportController&gt;( factory_-&gt;CreateTransportController( port_allocator_.get(), configuration.redetermine_role_on_ice_restart)),#ifdef HAVE_SCTP std::unique_ptr&lt;cricket::SctpTransportInternalFactory&gt;( new cricket::SctpTransportFactory(factory_-&gt;network_thread()))#else nullptr#endif )); stats_.reset(new StatsCollector(this)); stats_collector_ = RTCStatsCollector::Create(this); // Initialize the WebRtcSession. It creates transport channels etc. if (!session_-&gt;Initialize(factory_-&gt;options(), std::move(cert_generator), configuration)) &#123; return false; &#125; // Register PeerConnection as receiver of local ice candidates. // All the callbacks will be posted to the application from PeerConnection. session_-&gt;RegisterIceObserver(this); session_-&gt;SignalState.connect(this, &amp;PeerConnection::OnSessionStateChange); session_-&gt;SignalVoiceChannelCreated.connect( this, &amp;PeerConnection::OnVoiceChannelCreated); session_-&gt;SignalVoiceChannelDestroyed.connect( this, &amp;PeerConnection::OnVoiceChannelDestroyed); session_-&gt;SignalVideoChannelCreated.connect( this, &amp;PeerConnection::OnVideoChannelCreated); session_-&gt;SignalVideoChannelDestroyed.connect( this, &amp;PeerConnection::OnVideoChannelDestroyed); session_-&gt;SignalDataChannelCreated.connect( this, &amp;PeerConnection::OnDataChannelCreated); session_-&gt;SignalDataChannelDestroyed.connect( this, &amp;PeerConnection::OnDataChannelDestroyed); session_-&gt;SignalDataChannelOpenMessage.connect( this, &amp;PeerConnection::OnDataChannelOpenMessage); configuration_ = configuration; return true;&#125; è°ƒç”¨CreateCall_wåˆ›å»ºcallå¯¹è±¡: 12345678910111213141516void PeerConnection::CreateCall_w() &#123; RTC_DCHECK(!call_); const int kMinBandwidthBps = 30000; const int kStartBandwidthBps = 300000; const int kMaxBandwidthBps = 2000000; webrtc::Call::Config call_config(event_log_.get()); call_config.audio_state = factory_-&gt;channel_manager() -&gt;media_engine()-&gt;GetAudioState(); call_config.bitrate_config.min_bitrate_bps = kMinBandwidthBps; call_config.bitrate_config.start_bitrate_bps = kStartBandwidthBps; call_config.bitrate_config.max_bitrate_bps = kMaxBandwidthBps; call_.reset(webrtc::Call::Create(call_config));&#125; ä½¿ç”¨callå¯¹è±¡ä»¥åŠPeerConnectionFactoryä¸­channelmanager(PeerConnectionFactoryä¸­Initializeä¸­åˆ›å»º)æž„é€ WebRtcSessionå¯¹è±¡session,è°ƒç”¨Initializeæ–¹æ³•åˆå§‹åŒ–session,åˆå§‹åŒ–sessionæ§½å‡½æ•°ç­‰.session_åˆå§‹åŒ–æ–¹æ³•ä¸­åˆ›å»ºWebRtcSessionDescriptionFactoryå¯¹è±¡webrtc_session_descfactory. åˆ›å»ºChannelWebRtcSession::SetLocalDescription: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051bool WebRtcSession::SetLocalDescription(SessionDescriptionInterface* desc, std::string* err_desc) &#123; RTC_DCHECK(signaling_thread()-&gt;IsCurrent()); // Takes the ownership of |desc| regardless of the result. std::unique_ptr&lt;SessionDescriptionInterface&gt; desc_temp(desc); // Validate SDP. if (!ValidateSessionDescription(desc, cricket::CS_LOCAL, err_desc)) &#123; return false; &#125; // Update the initial_offerer flag if this session is the initial_offerer. Action action = GetAction(desc-&gt;type()); if (state() == STATE_INIT &amp;&amp; action == kOffer) &#123; initial_offerer_ = true; transport_controller_-&gt;SetIceRole(cricket::ICEROLE_CONTROLLING); &#125; if (action == kAnswer) &#123; current_local_description_.reset(desc_temp.release()); pending_local_description_.reset(nullptr); current_remote_description_.reset(pending_remote_description_.release()); &#125; else &#123; pending_local_description_.reset(desc_temp.release()); &#125; // Transport and Media channels will be created only when offer is set. if (action == kOffer &amp;&amp; !CreateChannels(local_description()-&gt;description())) &#123; // TODO(mallinath) - Handle CreateChannel failure, as new local description // is applied. Restore back to old description. return BadLocalSdp(desc-&gt;type(), kCreateChannelFailed, err_desc); &#125; // Remove unused channels if MediaContentDescription is rejected. RemoveUnusedChannels(local_description()-&gt;description()); if (!UpdateSessionState(action, cricket::CS_LOCAL, err_desc)) &#123; return false; &#125; if (remote_description()) &#123; // Now that we have a local description, we can push down remote candidates. UseCandidatesInSessionDescription(remote_description()); &#125; pending_ice_restarts_.clear(); if (error() != ERROR_NONE) &#123; return BadLocalSdp(desc-&gt;type(), GetSessionErrorMsg(), err_desc); &#125; return true;&#125; actionä¸ºofferæ—¶CreateChannelåˆ›å»ºchannels: 123456789101112131415161718192021222324252627282930313233343536373839bool WebRtcSession::CreateChannels(const SessionDescription* desc) &#123; const cricket::ContentGroup* bundle_group = nullptr; if (bundle_policy_ == PeerConnectionInterface::kBundlePolicyMaxBundle) &#123; bundle_group = desc-&gt;GetGroupByName(cricket::GROUP_TYPE_BUNDLE); if (!bundle_group) &#123; LOG(LS_WARNING) &lt;&lt; &quot;max-bundle specified without BUNDLE specified&quot;; return false; &#125; &#125; // Creating the media channels and transport proxies. const cricket::ContentInfo* voice = cricket::GetFirstAudioContent(desc); if (voice &amp;&amp; !voice-&gt;rejected &amp;&amp; !voice_channel_) &#123; if (!CreateVoiceChannel(voice, GetBundleTransportName(voice, bundle_group))) &#123; LOG(LS_ERROR) &lt;&lt; &quot;Failed to create voice channel.&quot;; return false; &#125; &#125; const cricket::ContentInfo* video = cricket::GetFirstVideoContent(desc); if (video &amp;&amp; !video-&gt;rejected &amp;&amp; !video_channel_) &#123; if (!CreateVideoChannel(video, GetBundleTransportName(video, bundle_group))) &#123; LOG(LS_ERROR) &lt;&lt; &quot;Failed to create video channel.&quot;; return false; &#125; &#125; const cricket::ContentInfo* data = cricket::GetFirstDataContent(desc); if (data_channel_type_ != cricket::DCT_NONE &amp;&amp; data &amp;&amp; !data-&gt;rejected &amp;&amp; !rtp_data_channel_ &amp;&amp; !sctp_transport_) &#123; if (!CreateDataChannel(data, GetBundleTransportName(data, bundle_group))) &#123; LOG(LS_ERROR) &lt;&lt; &quot;Failed to create data channel.&quot;; return false; &#125; &#125; return true;&#125; CreateChannelsä¸­åˆ›å»ºä¸‰ä¸ªChannel,å…¶ä¸­CreateVideoChannelåˆ›å»ºè§†é¢‘Channel: 123456789101112131415161718192021222324252627282930313233343536373839404142bool WebRtcSession::CreateVideoChannel(const cricket::ContentInfo* content, const std::string* bundle_transport) &#123; bool require_rtcp_mux = rtcp_mux_policy_ == PeerConnectionInterface::kRtcpMuxPolicyRequire; std::string transport_name = bundle_transport ? *bundle_transport : content-&gt;name; cricket::DtlsTransportInternal* rtp_dtls_transport = transport_controller_-&gt;CreateDtlsTransport( transport_name, cricket::ICE_CANDIDATE_COMPONENT_RTP); cricket::DtlsTransportInternal* rtcp_dtls_transport = nullptr; if (!require_rtcp_mux) &#123; rtcp_dtls_transport = transport_controller_-&gt;CreateDtlsTransport( transport_name, cricket::ICE_CANDIDATE_COMPONENT_RTCP); &#125; video_channel_.reset(channel_manager_-&gt;CreateVideoChannel( call_, media_config_, rtp_dtls_transport, rtcp_dtls_transport, transport_controller_-&gt;signaling_thread(), content-&gt;name, SrtpRequired(), video_options_)); if (!video_channel_) &#123; transport_controller_-&gt;DestroyDtlsTransport( transport_name, cricket::ICE_CANDIDATE_COMPONENT_RTP); if (rtcp_dtls_transport) &#123; transport_controller_-&gt;DestroyDtlsTransport( transport_name, cricket::ICE_CANDIDATE_COMPONENT_RTP); &#125; return false; &#125; video_channel_-&gt;SignalRtcpMuxFullyActive.connect( this, &amp;WebRtcSession::DestroyRtcpTransport_n); video_channel_-&gt;SignalDtlsSrtpSetupFailure.connect( this, &amp;WebRtcSession::OnDtlsSrtpSetupFailure); SignalVideoChannelCreated(); video_channel_-&gt;SignalSentPacket.connect(this, &amp;WebRtcSession::OnSentPacket_w); return true;&#125; è°ƒç”¨channel_managerçš„CreateVideoChannelåˆ›å»ºBaseChannelåŸºç±»çš„cricket::VideoChannel. VideoChanneléœ€è¦ä¼ å…¥VideoMediaChannelä½œä¸ºæž„é€ å‚æ•°: 1234567891011121314151617181920212223242526272829303132//pc/channelmanager.h/ccVideoChannel* ChannelManager::CreateVideoChannel_w( webrtc::Call* call, const cricket::MediaConfig&amp; media_config, DtlsTransportInternal* rtp_dtls_transport, DtlsTransportInternal* rtcp_dtls_transport, rtc::PacketTransportInternal* rtp_packet_transport, rtc::PacketTransportInternal* rtcp_packet_transport, rtc::Thread* signaling_thread, const std::string&amp; content_name, bool srtp_required, const VideoOptions&amp; options) &#123; RTC_DCHECK(initialized_); RTC_DCHECK(worker_thread_ == rtc::Thread::Current()); RTC_DCHECK(nullptr != call); VideoMediaChannel* media_channel = media_engine_-&gt;CreateVideoChannel( call, media_config, options); if (media_channel == NULL) &#123; return NULL; &#125; VideoChannel* video_channel = new VideoChannel( worker_thread_, network_thread_, signaling_thread, media_channel, content_name, rtcp_packet_transport == nullptr, srtp_required); if (!video_channel-&gt;Init_w(rtp_dtls_transport, rtcp_dtls_transport, rtp_packet_transport, rtcp_packet_transport)) &#123; delete video_channel; return NULL; &#125; video_channels_.push_back(video_channel); return video_channel;&#125; VideoMediaChannelå®žä¾‹media_channelç”±MediaEngineInterfaceå¯¹è±¡media_engineåˆ›å»º,media_engineç”±ChannelManageræž„é€ æ–¹æ³•ä¼ å…¥å¹¶åˆå§‹åŒ–,ChannelManagerç”±PeerConnectionFactoryåˆ›å»º,åœ¨PeerConnectionåˆå§‹åŒ–æ–¹æ³•ä¸­,media_engineè¢«åˆ›å»º: 123456789101112131415161718192021222324252627282930313233343536373839404142//pc/peerconnectionfactory.ccbool PeerConnectionFactory::Initialize() &#123; RTC_DCHECK(signaling_thread_-&gt;IsCurrent()); rtc::InitRandom(rtc::Time32()); default_network_manager_.reset(new rtc::BasicNetworkManager()); if (!default_network_manager_) &#123; return false; &#125; default_socket_factory_.reset( new rtc::BasicPacketSocketFactory(network_thread_)); if (!default_socket_factory_) &#123; return false; &#125; std::unique_ptr&lt;cricket::MediaEngineInterface&gt; media_engine = worker_thread_-&gt;Invoke&lt;std::unique_ptr&lt;cricket::MediaEngineInterface&gt;&gt;( RTC_FROM_HERE, rtc::Bind(&amp;PeerConnectionFactory::CreateMediaEngine_w, this)); channel_manager_.reset(new cricket::ChannelManager( std::move(media_engine), worker_thread_, network_thread_)); channel_manager_-&gt;SetVideoRtxEnabled(true); if (!channel_manager_-&gt;Init()) &#123; return false; &#125; return true;&#125;std::unique_ptr&lt;cricket::MediaEngineInterface&gt;PeerConnectionFactory::CreateMediaEngine_w() &#123; RTC_DCHECK(worker_thread_ == rtc::Thread::Current()); return std::unique_ptr&lt;cricket::MediaEngineInterface&gt;( cricket::WebRtcMediaEngineFactory::Create( default_adm_.get(), audio_encoder_factory_, audio_decoder_factory_, video_encoder_factory_.get(), video_decoder_factory_.get(), external_audio_mixer_));&#125; WebRtcMediaEngine2ç»§æ‰¿è‡ªCompositeMediaEngine,CompositeMediaEngineçˆ¶ç±»MediaEngineInterfaceæœ‰WebRtcVoiceEngine voiceä¸ŽWebRtcVideoEngine2 videoä¸¤ä¸ªå¯¹è±¡ WebRtcVideoEngine2WebRtcVideoEngine2å®šä¹‰åœ¨media/engine/webrtcvideoengine2.hä¸‹,ç”¨äºŽåˆ›å»ºWebRtcVideoChannel2(å®šä¹‰åœ¨åŒä¸€å¤´æ–‡ä»¶),WebRtcVideoChannel2å®šä¹‰äº†WebRtcVideoSendStreamä¸ŽWebRtcVideoReceiveStreamä¸¤ä¸ªå†…éƒ¨ç±».]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[WebRtcæºç åˆ†æž(1) PeerConnection]]></title>
    <url>%2F2017%2F07%2F11%2Fwebrtc-source-peerconnection%2F</url>
    <content type="text"><![CDATA[ChannelManagerpc/channelmanager.h 12345678// ChannelManager allows the MediaEngine to run on a separate thread, and takes// care of marshalling calls between threads. It also creates and keeps track of// voice and video channels; by doing so, it can temporarily(æš‚æ—¶çš„) pause all the// channels when a new audio or video device is chosen. The voice and video// channels are stored in separate vectors, to easily allow operations on just// voice or just video channels.// ChannelManager also allows the application to discover what devices it has// using device manager. WebRtcSessionæž„é€ ä¸­é€šè¿‡MediaControllerInterfaceåˆå§‹åŒ–ChannelManagerå˜é‡channelmanager , ChannelManageré€šè¿‡æž„é€ ä¼ å…¥MediaEngineInterface. WebRtcSessionpc/webrtcsession.h 1234567// A WebRtcSession manages general session state. This includes negotiation// of both the application-level and network-level protocols: the former// defines what will be sent and the latter defines how it will be sent. Each// network-level protocol is represented by a Transport object. Each Transport// participates in the network-level negotiation. The individual streams of// packets are represented by TransportChannels. The application-level protocol// is represented by SessionDecription objects. MediaControllerInterfacepc/mediacontroller.h 123// The MediaController currently owns shared state between media channels.// Abstract interface is defined here such that it can be faked/mocked for// tests, but no other real reason. å®žçŽ°ç±»MediaController,ç®¡ç†ChannelManager,cricket::ChannelManager* const channel_manager_;,åœ¨PeerConnectionçš„Initializeæ–¹æ³•ä¸­,é€šè¿‡PeerConnectionFactoryåˆ›å»º.PeerConnectionFactoryä¸­Initializeä¸­çœŸæ­£åˆ›å»ºChannelManager,åˆ›å»ºChannelManagerä¹‹å‰,å…ˆåˆ›å»ºå‡ºMediaEngine,å®žé™…åœ¨PeerConnectionFactory::CreateMediaEngine_wä¸­é€šè¿‡cricket::WebRtcMediaEngineFactory::Createåˆ›å»º. 7&gt; Downloading src/resources/voice_engine/audio_tiny44.wavâ€¦ 4&gt; Downloading src/resources/voice_engine/audio_tiny48.wavâ€¦ 2&gt; Downloading src/resources/voice_engine/audio_tiny8.wavâ€¦ Hook â€˜download_from_google_storage â€“directory â€“recursive â€“num_threads=10 â€“no_auth â€“quiet â€“bucket chromium-webrtc-resources src/resourcesâ€™ took 528.97 secs WARNING: â€˜src/testing/gmockâ€™ has been moved from DEPS to a higher level checkout. The git folder containing all the local branches has been saved to /Users/shenjunwei/soft-source/webrtc/old_src_testing_gmock.git. If you donâ€™t care about its state you can safely remove that folder to free up space. WARNING: â€˜src/testing/gtestâ€™ has been moved from DEPS to a higher level checkout. The git folder containing all the local branches has been saved to /Users/shenjunwei/soft-source/webrtc/old_src_testing_gtest.git. If you donâ€™t care about its state you can safely remove that folder to free up space.]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å…³äºŽå†…å­˜å¯¹é½é‚£äº›äº‹]]></title>
    <url>%2F2017%2F07%2F09%2Ftips-about-data-structure-alignment%2F</url>
    <content type="text"><![CDATA[Wrote by mutouyun. 1. å†…å­˜å¯¹é½ï¼ˆData Structure Alignmentï¼‰æ˜¯ä»€ä¹ˆå†…å­˜å¯¹é½ï¼Œæˆ–è€…è¯´å­—èŠ‚å¯¹é½ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®ç±»åž‹æ‰€èƒ½å­˜æ”¾çš„å†…å­˜åœ°å€çš„å±žæ€§ï¼ˆAlignment is a property of a memory addressï¼‰ã€‚ è¿™ä¸ªå±žæ€§æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªæ•´æ•°å¿…é¡»æ˜¯2çš„Næ¬¡æ–¹ï¼ˆ1ã€2ã€4ã€8ã€â€¦â€¦ã€1024ã€â€¦â€¦ï¼‰ã€‚ å½“æˆ‘ä»¬è¯´ï¼Œä¸€ä¸ªæ•°æ®ç±»åž‹çš„å†…å­˜å¯¹é½ä¸º8æ—¶ï¼Œæ„æ€å°±æ˜¯æŒ‡è¿™ä¸ªæ•°æ®ç±»åž‹æ‰€å®šä¹‰å‡ºæ¥çš„æ‰€æœ‰å˜é‡ï¼Œå…¶å†…å­˜åœ°å€éƒ½æ˜¯8çš„å€æ•°ã€‚ å½“ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»åž‹ï¼ˆfundamental typesï¼‰çš„å¯¹é½å±žæ€§ï¼Œå’Œè¿™ä¸ªæ•°æ®ç±»åž‹çš„å¤§å°ç›¸ç­‰æ—¶ï¼Œè¿™ç§å¯¹é½æ–¹å¼ç§°ä½œè‡ªç„¶å¯¹é½ï¼ˆnaturally alignedï¼‰ã€‚ æ¯”å¦‚ï¼Œä¸€ä¸ª4å­—èŠ‚å¤§å°çš„intåž‹æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒçš„å­—èŠ‚å¯¹é½ä¹Ÿæ˜¯4ã€‚ 2. ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å†…å­˜å¯¹é½è¿™æ˜¯å› ä¸ºï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¡¬ä»¶å¹³å°éƒ½èƒ½å¤Ÿéšä¾¿è®¿é—®ä»»æ„ä½ç½®çš„å†…å­˜çš„ã€‚ å¾®è½¯çš„MSDNé‡Œæœ‰è¿™æ ·ä¸€æ®µè¯ï¼š Many CPUs, such as those based on Alpha, IA-64, MIPS, and SuperH architectures, refuse to read misaligned data. When a program requests that one of these CPUs access data that is not aligned, the CPU enters an exception state and notifies the software that it cannot continue. On ARM, MIPS, and SH device platforms, for example, the operating system default is to give the application an exception notification when a misaligned access is requested. å¤§æ„æ˜¯è¯´ï¼Œæœ‰ä¸å°‘å¹³å°çš„CPUï¼Œæ¯”å¦‚Alphaã€IA-64ã€MIPSè¿˜æœ‰SuperHæž¶æž„ï¼Œè‹¥è¯»å–çš„æ•°æ®æ˜¯æœªå¯¹é½çš„ï¼ˆæ¯”å¦‚ä¸€ä¸ª4å­—èŠ‚çš„intåœ¨ä¸€ä¸ªå¥‡æ•°å†…å­˜åœ°å€ä¸Šï¼‰ï¼Œå°†æ‹’ç»è®¿é—®ï¼Œæˆ–æŠ›å‡ºç¡¬ä»¶å¼‚å¸¸ã€‚ å¦å¤–ï¼Œåœ¨ç»´åŸºç™¾ç§‘é‡Œä¹Ÿè®°è½½ç€å¦‚ä¸‹å†…å®¹ï¼š Data alignment means putting the data at a memory offset equal to some multiple of the word size, which increases the systemâ€™s performance due to the way the CPU handles memory. æ„æ€æ˜¯ï¼Œè€ƒè™‘åˆ°CPUå¤„ç†å†…å­˜çš„æ–¹å¼ï¼ˆ32ä½çš„x86 CPUï¼Œä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå¯ä»¥è¯»å–4ä¸ªè¿žç»­çš„å†…å­˜å•å…ƒï¼Œå³4å­—èŠ‚ï¼‰ï¼Œä½¿ç”¨å­—èŠ‚å¯¹é½å°†ä¼šæé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼ˆä¹Ÿå°±æ˜¯CPUè¯»å–å†…å­˜æ•°æ®çš„æ•ˆçŽ‡ã€‚æ¯”å¦‚ä½ ä¸€ä¸ªintæ”¾åœ¨å¥‡æ•°å†…å­˜ä½ç½®ä¸Šï¼Œæƒ³æŠŠè¿™4ä¸ªå­—èŠ‚è¯»å‡ºæ¥ï¼Œ32ä½CPUå°±éœ€è¦ä¸¤æ¬¡ã€‚ä½†å¯¹é½ä¹‹åŽä¸€æ¬¡å°±å¯ä»¥äº†ï¼‰ã€‚ 3. å†…å­˜å¯¹é½å¸¦æ¥çš„æ•°æ®ç»“æž„å¤§å°å˜åŒ–å› ä¸ºæœ‰äº†å†…å­˜å¯¹é½ï¼Œå› æ­¤æ•°æ®åœ¨å†…å­˜é‡Œçš„å­˜æ”¾å°±ä¸æ˜¯ç´§æŒ¨ç€çš„ï¼Œè€Œæ˜¯å¯èƒ½ä¼šå‡ºçŽ°ä¸€äº›ç©ºéš™ï¼ˆData Structure Paddingï¼Œä¹Ÿå°±æ˜¯ç”¨äºŽå¡«å……çš„ç©ºç™½å†…å®¹ï¼‰ã€‚å› æ­¤å¯¹åŸºæœ¬æ•°æ®ç±»åž‹æ¥è¯´å¯èƒ½è¿˜å¥½è¯´ï¼Œå¯¹äºŽä¸€ä¸ªå†…éƒ¨æœ‰å¤šä¸ªåŸºæœ¬ç±»åž‹çš„ç»“æž„ä½“ï¼ˆstructï¼‰æˆ–ç±»è€Œè¨€ï¼Œsizeofçš„ç»“æžœå¾€å¾€å’Œæƒ³è±¡ä¸­ä¸å¤§ä¸€æ ·ã€‚ è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š 12345678struct MyStruct &#123; char a; // 1 byte int b; // 4 bytes short c; // 2 bytes long long d; // 8 bytes char e; // 1 byte &#125;; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMyStructä¸­æœ‰5ä¸ªæˆå‘˜ï¼Œå¦‚æžœç›´æŽ¥ç›¸åŠ çš„è¯å¤§å°åº”è¯¥æ˜¯16ï¼Œä½†åœ¨32ä½MSVCé‡Œå®ƒçš„sizeofç»“æžœæ˜¯32ã€‚ ä¹‹æ‰€ä»¥ç»“æžœå‡ºçŽ°åå·®ï¼Œä¸ºäº†ä¿è¯è¿™ä¸ªç»“æž„ä½“é‡Œçš„æ¯ä¸ªæˆå‘˜éƒ½åº”è¯¥åœ¨å®ƒå¯¹é½äº†çš„å†…å­˜ä½ç½®ä¸Šï¼Œè€Œåœ¨æŸäº›ä½ç½®æ’å…¥äº†Paddingã€‚ ä¸‹é¢æˆ‘ä»¬å°è¯•è€ƒè™‘å†…å­˜å¯¹é½ï¼Œæ¥è®¡ç®—ä¸€ä¸‹è¿™ä¸ªç»“æž„ä½“çš„å¤§å°ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾MyStructçš„æ•´ä½“åç§»ä»Ž0x00å¼€å§‹ï¼Œè¿™æ ·å°±å¯ä»¥æš‚æ—¶å¿½ç•¥MyStructæœ¬èº«çš„å¯¹é½ã€‚è¿™æ—¶ï¼Œç»“æž„ä½“çš„æ•´ä½“å†…å­˜åˆ†å¸ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œcharå’Œintä¹‹é—´ï¼›shortå’Œlong longä¹‹é—´ï¼Œä¸ºäº†ä¿è¯æˆå‘˜å„è‡ªçš„å¯¹é½å±žæ€§ï¼Œåˆ†åˆ«æ’å…¥äº†ä¸€äº›Paddingã€‚ å› æ­¤æ•´ä¸ªç»“æž„ä½“ä¼šè¢«å¡«å……å¾—çœ‹èµ·æ¥åƒè¿™æ ·ï¼š 123456789101112struct MyStruct &#123; char a; // 1 byte char pad_0[3]; // Padding 3 int b; // 4 bytes short c; // 2 bytes char pad_1[6]; // Padding 6 long long d; // 8 bytes char e; // 1 byte char pad_2[7]; // Padding 7 &#125;; æ³¨æ„åˆ°ä¸Šé¢åŠ äº†Paddingçš„ç¤ºæ„ç»“æž„ä½“é‡Œï¼Œeçš„åŽé¢è¿˜è·Ÿäº†7ä¸ªå­—èŠ‚çš„å¡«å……ã€‚è¿™æ˜¯å› ä¸ºç»“æž„ä½“çš„æ•´ä½“å¤§å°å¿…é¡»å¯è¢«å¯¹é½å€¼æ•´é™¤ï¼Œæ‰€ä»¥â€œchar eâ€çš„åŽé¢è¿˜ä¼šè¢«ç»§ç»­å¡«å……7ä¸ªå­—èŠ‚å¥½è®©ç»“æž„ä½“çš„æ•´ä½“å¤§å°æ˜¯8çš„å€æ•°32ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨gcc + 32ä½linuxä¸­å°è¯•è®¡ç®—sizeof(MyStruct)ï¼Œå¾—åˆ°çš„ç»“æžœæ˜¯24ã€‚ è¿™æ˜¯å› ä¸ºgccä¸­çš„å¯¹é½è§„åˆ™å’ŒMSVCä¸ä¸€æ ·ï¼Œä¸åŒçš„å¹³å°ä¸‹ä¼šä½¿ç”¨ä¸åŒçš„é»˜è®¤å¯¹é½å€¼ï¼ˆThe default alignment is fixed for a particular target ABIï¼‰ã€‚åœ¨gcc + 32ä½linuxä¸­ï¼Œå¤§å°è¶…è¿‡4å­—èŠ‚çš„åŸºæœ¬ç±»åž‹ä»ç„¶æŒ‰4å­—èŠ‚å¯¹é½ã€‚å› æ­¤MyStructçš„å†…å­˜å¸ƒå±€è¿™æ—¶çœ‹èµ·æ¥åº”è¯¥åƒè¿™ä¸ªæ ·å­ï¼š ä¸‹é¢æˆ‘ä»¬æ¥ç¡®å®šè¿™ä¸ªç»“æž„ä½“ç±»åž‹æœ¬èº«çš„å†…å­˜å¯¹é½æ˜¯å¤šå°‘ã€‚ä¸ºäº†ä¿è¯ç»“æž„ä½“å†…çš„æ¯ä¸ªæˆå‘˜éƒ½èƒ½å¤Ÿæ”¾åœ¨å®ƒè‡ªç„¶å¯¹é½çš„ä½ç½®ä¸Šï¼Œå¯¹è¿™ä¸ªç»“æž„ä½“æœ¬èº«æ¥è¯´æœ€ç†æƒ³çš„å†…å­˜å¯¹é½æ•°å€¼åº”è¯¥æ˜¯ç»“æž„ä½“é‡Œå†…å­˜å¯¹é½æ•°å€¼æœ€å¤§çš„æˆå‘˜çš„å†…å­˜å¯¹é½æ•°ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºŽä¸Šé¢çš„MyStructï¼Œç»“æž„ä½“ç±»åž‹æœ¬èº«çš„å†…å­˜å¯¹é½åº”è¯¥æ˜¯8ã€‚å¹¶ä¸”ï¼Œå½“æˆ‘ä»¬å¼ºåˆ¶å¯¹é½æ–¹å¼å°äºŽ8æ—¶ï¼Œæ¯”å¦‚è®¾ç½®MyStructå¯¹é½ä¸º2ï¼Œé‚£ä¹ˆå…¶å†…éƒ¨æˆå‘˜çš„å¯¹é½ä¹Ÿå°†è¢«å¼ºåˆ¶ä¸èƒ½è¶…è¿‡2ã€‚ ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå¯¹äºŽä¸€ä¸ªæ•°æ®ç±»åž‹æ¥è¯´ï¼Œå…¶å†…éƒ¨æˆå‘˜çš„ä½ç½®åº”è¯¥æ˜¯ç›¸å¯¹å›ºå®šçš„ã€‚å‡å¦‚ä¸Šé¢è¿™ä¸ªç»“æž„ä½“æ•´ä½“æŒ‰1æˆ–è€…2å­—èŠ‚å¯¹é½ï¼Œè€Œæˆå‘˜å´æŒ‰ç…§å„è‡ªçš„æ–¹å¼è‡ªç„¶å¯¹é½ï¼Œå°±æœ‰å¯èƒ½å‡ºçŽ°æˆå‘˜çš„ç›¸å¯¹åç§»é‡éšå†…å­˜ä½ç½®è€Œæ”¹å˜çš„é—®é¢˜ã€‚ æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç”»ä¸€ä¸‹æ•´ä¸ªç»“æž„ä½“æŒ‰1å­—èŠ‚å¯¹é½ï¼Œå¹¶ä¸”ç»“æž„ä½“å†…çš„æ¯ä¸ªæˆå‘˜æŒ‰è‡ªç„¶ä½ç½®å¯¹é½çš„å†…å­˜å¸ƒå±€ï¼š ä¸Šé¢çš„ç¬¬ä¸€ç§æƒ…å†µï¼Œå‡è®¾MyStructçš„èµ·å§‹åœ°å€æ˜¯0x01ï¼ˆå› ä¸ºç»“æž„ä½“æœ¬èº«çš„åç§»æŒ‰1å­—èŠ‚å¯¹é½ï¼‰ï¼Œé‚£ä¹ˆcharå’Œintä¹‹é—´å°†ä¼šè¢«å¡«å……2ä¸ªå­—èŠ‚çš„Paddingï¼Œä»¥ä¿è¯intçš„å¯¹é½è¿˜æ˜¯4å­—èŠ‚ã€‚ å¦‚æžœç¬¬äºŒæ¬¡åˆ†é…MyStructçš„å†…å­˜æ—¶èµ·å§‹åœ°å€å˜ä¸º0x03ï¼Œç”±äºŽintè¿˜æ˜¯4å­—èŠ‚å¯¹é½ï¼Œåˆ™charå’Œintä¹‹é—´å°†ä¸ä¼šå¡«å……Paddingï¼ˆå¡«å……äº†åè€Œä¸å¯¹é½äº†ï¼‰ã€‚ ä»¥æ­¤ç±»æŽ¨ï¼Œè‹¥MyStructæŒ‰1å­—èŠ‚å¯¹é½æ—¶ä¸å¼ºåˆ¶æ‰€æœ‰æˆå‘˜çš„å¯¹é½å‡ä¸è¶…è¿‡1çš„è¯ï¼Œè¿™ä¸ªç»“æž„ä½“é‡Œçš„ç›¸å¯¹åç§»æ–¹å¼ä¸€å…±æœ‰4ç§ã€‚ å› æ­¤å¯¹äºŽç»“æž„ä½“æ¥è¯´ï¼Œé»˜è®¤çš„å¯¹é½å°†ç­‰äºŽå…¶ä¸­å¯¹é½æœ€å¤§çš„æˆå‘˜çš„å¯¹é½å€¼ã€‚å¹¶ä¸”ï¼Œå½“æˆ‘ä»¬é™å®šç»“æž„ä½“çš„å†…å­˜å¯¹é½æ—¶ï¼ŒåŒæ—¶ä¹Ÿé™å®šäº†ç»“æž„ä½“å†…æ‰€æœ‰æˆå‘˜çš„å†…å­˜å¯¹é½ä¸èƒ½è¶…è¿‡ç»“æž„ä½“æœ¬èº«çš„å†…å­˜å¯¹é½ã€‚ 4. æŒ‡å®šå†…å­˜å¯¹é½åœ¨C++98/03é‡Œï¼Œå¯¹å†…å­˜å¯¹é½çš„æ“ä½œåœ¨ä¸åŒçš„ç¼–è¯‘å™¨é‡Œå¯èƒ½æœ‰ä¸åŒçš„æ–¹æ³•ã€‚ åœ¨MSVCä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨#progma packæ¥æŒ‡å®šå†…å­˜å¯¹é½ï¼š 12345678910#pragma pack(1) // æŒ‡å®šåŽé¢çš„å†…å®¹å†…å­˜å¯¹é½ä¸º1 struct MyStruct &#123; char a; // 1 byte int b; // 4 bytes short c; // 2 bytes long long d; // 8 bytes char e; // 1 byte &#125;; #pragma pack() // è¿˜åŽŸé»˜è®¤çš„å†…å­˜å¯¹é½ è¿™æ—¶ï¼ŒMyStructç”±äºŽæŒ‰1å­—èŠ‚å¯¹é½ï¼Œå…¶ä¸­çš„æ‰€æœ‰æˆå‘˜éƒ½å°†å˜ä¸º1å­—èŠ‚å¯¹é½ï¼Œå› æ­¤sizeof(MyStruct)å°†ç­‰äºŽ16ã€‚ è¿˜æœ‰å¦å¤–ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼š 12345678__declspec(align(64)) struct MyStruct &#123; char a; // 1 byte int b; // 4 bytes short c; // 2 bytes long long d; // 8 bytes char e; // 1 byte &#125;; __declspec(align(64))å°†æŒ‡å®šå†…å­˜å¯¹é½ä¸º64ã€‚æ¯”è¾ƒå‘çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•ä¸èƒ½æŒ‡å®šå†…å­˜å¯¹é½å°äºŽé»˜è®¤å¯¹é½ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½è°ƒå¤§ä¸èƒ½è°ƒå°ï¼ˆ__declspec(align(#)) can only increase alignment restrictionsï¼‰ã€‚å› æ­¤ä¸‹é¢è¿™æ ·å†™ä¼šå¿½ç•¥æŽ‰declspecï¼š 12__declspec(align(1)) struct MyStruct // ... // warning C4359: &apos;MyStruct&apos;: Alignment specifier is less than actual alignment (8), and will be ignored. å¾®è½¯çš„__declspec(align(#))ï¼Œå…¶#çš„å†…å®¹å¯ä»¥æ˜¯é¢„ç¼–è¯‘å®ï¼Œä½†ä¸èƒ½æ˜¯ç¼–è¯‘æœŸæ•°å€¼ï¼š 12345678#define XX 32 struct __declspec(align(XX)) MyStruct_1 &#123;&#125;; // OK template &lt;size_t YY&gt; struct __declspec(align(YY)) MyStruct_2 &#123;&#125;; // error C2059: syntax error: &apos;identifier&apos; static const unsigned ZZ = 32; struct __declspec(align(ZZ)) MyStruct_3 &#123;&#125;; // error C2057: expected constant expression åœ¨Visual C++ Compiler November 2013 CTPä¹‹åŽï¼Œå¾®è½¯ç»ˆäºŽæ”¯æŒç¼–è¯‘æœŸæ•°å€¼çš„å†™æ³•äº†ï¼š 123template &lt;size_t YY&gt; struct __declspec(align(YY)) MyStruct_2 &#123;&#125;; // OK in 2013 CTP __declspec(align(#))æœ€å¤§æ”¯æŒå¯¹é½ä¸º8192ï¼ˆValid entries are integer powers of two from 1 to 8192ï¼‰ã€‚ ä¸‹é¢å†æ¥çœ‹gccã€‚gccå’ŒMSVCä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨#pragma packï¼š 123456#pragma pack(1) struct MyStruct &#123; // ... &#125;; #pragma pack() å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨__attribute__((__aligned__((#))))ï¼š 123456789struct __attribute__((__aligned__((1)))) MyStruct_1 &#123; // ... &#125;; struct MyStruct_2 &#123; // ... &#125; __attribute__((__aligned__((1)))); è¿™ä¸œè¥¿å†™ä¸Šé¢å†™ä¸‹é¢éƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸èƒ½å†™åœ¨structå‰é¢ã€‚ å’ŒMSVCä¸€æ ·ï¼Œ__attribute__ä¹Ÿåªèƒ½æŠŠå­—èŠ‚å¯¹é½æ”¹å¤§ï¼Œä¸èƒ½æ”¹å°ï¼ˆThe aligned attribute can only increase the alignmentï¼‰ã€‚æ¯”è¾ƒå‘çš„æ˜¯å½“ä½ è¯•å›¾æ”¹å°çš„æ—¶å€™ï¼Œgccæ²¡æœ‰ä»»ä½•ç¼–è¯‘æç¤ºä¿¡æ¯ã€‚ gccå¯ä»¥æŽ¥å—ä¸€ä¸ªå®æˆ–ç¼–è¯‘æœŸæ•°å€¼ï¼š 12345678910#define XX 1 struct __attribute__((__aligned__((XX)))) MyStruct_1 &#123;&#125;; // OK template &lt;size_t YY&gt; struct __attribute__((__aligned__((YY)))) MyStruct_2 &#123;&#125;; // OK static const unsigned ZZ = 1; struct __attribute__((__aligned__((ZZ)))) MyStruct_3 &#123;&#125;; // ^ // error: requested alignment is not an integer constant gccçš„__attribute__((__aligned__((#))))æ”¯æŒçš„ä¸Šé™å—é™äºŽé“¾æŽ¥å™¨ï¼ˆNote that the effectiveness of aligned attributes may be limited by inherent limitations in your linkerï¼‰ã€‚ 5. èŽ·å¾—å†…å­˜å¯¹é½åŒæ ·çš„ï¼Œåœ¨C++98/03é‡Œï¼Œä¸åŒçš„ç¼–è¯‘å™¨å¯èƒ½æœ‰ä¸åŒçš„æ–¹æ³•æ¥èŽ·å¾—ä¸€ä¸ªç±»åž‹çš„å†…å­˜å¯¹é½ã€‚ MSVCä½¿ç”¨__alignofæ“ä½œç¬¦èŽ·å¾—å†…å­˜å¯¹é½å¤§å°ï¼š 123MyStruct xx; std::cout &lt;&lt; __alignof(xx) &lt;&lt; std::endl; std::cout &lt;&lt; __alignof(MyStruct) &lt;&lt; std::endl; gccåˆ™ä½¿ç”¨__alignof__ï¼š 123MyStruct xx; std::cout &lt;&lt; __alignof__(xx) &lt;&lt; std::endl; std::cout &lt;&lt; __alignof__(MyStruct) &lt;&lt; std::endl; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è®ºæ˜¯__alignofè¿˜æ˜¯__alignof__ï¼Œå¯¹äºŽå¯¹é½çš„è®¡ç®—éƒ½å‘ç”Ÿåœ¨ç¼–è¯‘æœŸã€‚å› æ­¤åƒä¸‹é¢è¿™æ ·å†™ï¼š 123int a; char&amp; c = reinterpret_cast&lt;char&amp;&gt;(a); std::cout &lt;&lt; __alignof__(c) &lt;&lt; std::endl; å¾—åˆ°çš„ç»“æžœå°†æ˜¯1ã€‚ å¦‚æžœéœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¡ç®—ä¸€ä¸ªå˜é‡çš„å†…å­˜å¯¹é½ï¼Œæ¯”å¦‚æ ¹æ®ä¸€ä¸ªvoid*æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜åœ°å€æ¥åˆ¤æ–­è¿™ä¸ªåœ°å€çš„å†…å­˜å¯¹é½æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªç®€å•çš„æ–¹æ³•ï¼š 1234__declspec(align(128)) long a = 0; size_t x = reinterpret_cast&lt;size_t&gt;(&amp;a); x &amp;= ~(x - 1); // è®¡ç®—açš„å†…å­˜å¯¹é½å¤§å° std::cout &lt;&lt; x &lt;&lt; std::endl; ç”¨è¿™ç§æ–¹å¼å¾—åˆ°çš„å†…å­˜å¯¹é½å¤§å°å¯èƒ½æ¯”å®žé™…çš„å¤§ï¼Œå› ä¸ºå®ƒæ˜¯åˆ‡å®žçš„èŽ·å¾—è¿™ä¸ªå†…å­˜åœ°å€åˆ°åº•èƒ½è¢«å¤šå¤§çš„2^Næ•´é™¤ã€‚ 6. å †å†…å­˜çš„å†…å­˜å¯¹é½æˆ‘ä»¬åœ¨è®¨è®ºå†…å­˜å¯¹é½çš„æ—¶å€™å¾ˆå®¹æ˜“å¿½ç•¥æŽ‰å †å†…å­˜ã€‚æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨mallocåˆ†é…å†…å­˜ï¼Œå´ä¸ç†ä¼šè¿™å—å†…å­˜çš„å¯¹é½æ–¹å¼ï¼Œä»¿ä½›å †å†…å­˜ä¸éœ€è¦è€ƒè™‘å†…å­˜å¯¹é½ä¸€æ ·ã€‚ å®žé™…ä¸Šï¼Œmallocä¸€èˆ¬ä½¿ç”¨å½“å‰å¹³å°é»˜è®¤çš„æœ€å¤§å†…å­˜å¯¹é½æ•°å¯¹é½å†…å­˜ã€‚æ¯”å¦‚MSVCåœ¨32ä½ä¸‹ä¸€èˆ¬æ˜¯8å­—èŠ‚å¯¹é½ï¼›64ä½ä¸‹åˆ™æ˜¯16å­—èŠ‚ï¼ˆIn Visual C++, the fundamental alignment is the alignment thatâ€™s required for a double, or 8 bytes. In code that targets 64-bit platforms, itâ€™s 16 bytesï¼‰ã€‚è¿™æ ·å¯¹äºŽå¸¸è§„çš„æ•°æ®éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ ä½†æ˜¯å¦‚æžœæˆ‘ä»¬è‡ªå®šä¹‰çš„å†…å­˜å¯¹é½è¶…å‡ºäº†è¿™ä¸ªèŒƒå›´ï¼Œåˆ™æ˜¯ä¸èƒ½ç›´æŽ¥ä½¿ç”¨mallocæ¥èŽ·å–å†…å­˜çš„ã€‚ å½“æˆ‘ä»¬éœ€è¦åˆ†é…ä¸€å—å…·æœ‰ç‰¹å®šå†…å­˜å¯¹é½çš„å†…å­˜å—æ—¶ï¼Œåœ¨MSVCä¸‹åº”å½“ä½¿ç”¨_aligned_mallocï¼›è€Œåœ¨gccä¸‹ä¸€èˆ¬ä½¿ç”¨memalignç­‰å‡½æ•°ã€‚ å…¶å®žè‡ªå·±å®žçŽ°ä¸€ä¸ªç®€æ˜“çš„aligned_mallocæ˜¯å¾ˆå®¹æ˜“çš„ï¼š 1234567891011121314151617181920212223242526#include &lt;assert.h&gt; inline void* aligned_malloc(size_t size, size_t alignment) &#123; // æ£€æŸ¥alignmentæ˜¯å¦æ˜¯2^N assert(!(alignment &amp; (alignment - 1))); // è®¡ç®—å‡ºä¸€ä¸ªæœ€å¤§çš„offsetï¼Œsizeof(void*)æ˜¯ä¸ºäº†å­˜å‚¨åŽŸå§‹æŒ‡é’ˆåœ°å€ size_t offset = sizeof(void*) + (--alignment); // åˆ†é…ä¸€å—å¸¦offsetçš„å†…å­˜ char* p = static_cast&lt;char*&gt;(malloc(offset + size)); if (!p) return nullptr; // é€šè¿‡â€œ&amp; (~alignment)â€æŠŠå¤šè®¡ç®—çš„offsetå‡æŽ‰ void* r = reinterpret_cast&lt;void*&gt;(reinterpret_cast&lt;size_t&gt;(p + offset) &amp; (~alignment)); // å°†rå½“åšä¸€ä¸ªæŒ‡å‘void*çš„æŒ‡é’ˆï¼Œåœ¨rå½“å‰åœ°å€å‰é¢æ”¾å…¥åŽŸå§‹åœ°å€ static_cast&lt;void**&gt;(r)[-1] = p; // è¿”å›žç»è¿‡å¯¹é½çš„å†…å­˜åœ°å€ return r; &#125; inline void aligned_free(void* p) &#123; // è¿˜åŽŸå›žåŽŸå§‹åœ°å€ï¼Œå¹¶free free(static_cast&lt;void**&gt;(p)[-1]); &#125; 7. C++11ä¸­å¯¹å†…å­˜å¯¹é½çš„æ“ä½œC++11æ ‡å‡†é‡Œç»Ÿä¸€äº†å†…å­˜å¯¹é½çš„ç›¸å…³æ“ä½œã€‚ æŒ‡å®šå†…å­˜å¯¹é½ä½¿ç”¨alignasè¯´æ˜Žç¬¦ï¼š 12345678910alignas(32) long long a = 0; #define XX 1 struct alignas(XX) MyStruct_1 &#123;&#125;; // OK template &lt;size_t YY = 1&gt; struct alignas(YY) MyStruct_2 &#123;&#125;; // OK static const unsigned ZZ = 1; struct alignas(ZZ) MyStruct_3 &#123;&#125;; // OK æ³¨æ„åˆ°MyStruct_3ç¼–è¯‘æ˜¯OKçš„ã€‚åœ¨C++11é‡Œï¼Œåªè¦æ˜¯ä¸€ä¸ªç¼–è¯‘æœŸæ•°å€¼ï¼ˆåŒ…æ‹¬static constï¼‰éƒ½æ”¯æŒalignasï¼ˆthe assignment-expression shall be an integral constant expressionï¼Œå‚è€ƒISO/IEC-14882:2011ï¼Œ7.6.2 Alignment specifierï¼Œç¬¬2æ¬¾ï¼‰ã€‚ ä½†æ˜¯éœ€è¦å°å¿ƒçš„æ˜¯ï¼Œç›®å‰å¾®è½¯çš„ç¼–è¯‘å™¨ï¼ˆVisual C++ Compiler November 2013 CTPï¼‰åœ¨MyStruct_3çš„æƒ…å†µä¸‹ä»ç„¶ä¼šæŠ¥error C2057ã€‚ å¦å¤–ï¼ŒalignasåŒå‰é¢ä»‹ç»çš„__declspecã€__attribute__ä¸€æ ·ï¼Œåªèƒ½æ”¹å¤§ä¸èƒ½æ”¹å°ï¼ˆå‚è€ƒISO/IEC-14882:2011ï¼Œ7.6.2 Alignment specifierï¼Œç¬¬5æ¬¾ï¼‰ã€‚å¦‚æžœéœ€è¦æ”¹å°ï¼Œæ¯”å¦‚è®¾ç½®å¯¹é½ä¸º1çš„è¯ï¼Œä»ç„¶éœ€è¦ä½¿ç”¨#pragma packã€‚æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨C++11é‡Œ#pragmaçš„ç­‰ä»·ç‰©_Pragmaï¼ˆå¾®è½¯æš‚ä¸æ”¯æŒè¿™ä¸ªï¼‰ï¼š 12345678910_Pragma(&quot;pack(1)&quot;) struct MyStruct &#123; char a; // 1 byte int b; // 4 bytes short c; // 2 bytes long long d; // 8 bytes char e; // 1 byte &#125;; _Pragma(&quot;pack()&quot;) é™¤äº†è¿™äº›ä¹‹å¤–ï¼Œalignasæ¯”__declspecã€è¿™ä¸ªcharå°±æŒ‰intçš„æ–¹å¼å¯¹é½äº†ã€‚ èŽ·å–å†…å­˜å¯¹é½ä½¿ç”¨alignofæ“ä½œç¬¦ï¼šå¼ºå¤§çš„åœ°æ–¹åœ¨äºŽå®ƒè¿˜å¯ä»¥è¿™æ ·ç”¨ï¼š 1alignas(int) char c; è¿™ä¸ªcharå°±æŒ‰intçš„æ–¹å¼å¯¹é½äº†ã€‚ èŽ·å–å†…å­˜å¯¹é½ä½¿ç”¨alignofæ“ä½œç¬¦ï¼š 123MyStruct xx; std::cout &lt;&lt; alignof(xx) &lt;&lt; std::endl; std::cout &lt;&lt; alignof(MyStruct) &lt;&lt; std::endl; ç›¸å…³æ³¨æ„ç‚¹å’Œå‰é¢ä»‹ç»çš„__alignofã€__alignof__å¹¶æ— äºŒè‡´ã€‚ é™¤äº†alignaså’Œalignofï¼ŒC++11ä¸­è¿˜æä¾›äº†å‡ ä¸ªæœ‰ç”¨çš„å·¥å…·ã€‚ A. std::alignment_of åŠŸèƒ½æ˜¯ç¼–è¯‘æœŸè®¡ç®—ç±»åž‹çš„å†…å­˜å¯¹é½ã€‚ stdé‡Œæä¾›è¿™ä¸ªæ˜¯ä¸ºäº†è¡¥å……alignofçš„åŠŸèƒ½ã€‚alignofåªèƒ½è¿”å›žä¸€ä¸ªsize_tï¼Œè€Œalignment_ofåˆ™ç»§æ‰¿è‡ªstd::integral_constantï¼Œå› æ­¤æ‹¥æœ‰value_typeã€typeã€operator()ç­‰æŽ¥å£ï¼ˆæˆ–è€…è¯´æ“ä½œï¼‰ã€‚ B. std::aligned_storage è¿™æ˜¯ä¸ªå¥½ä¸œè¥¿ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦åˆ†é…ä¸€å—å•çº¯çš„å†…å­˜å—ï¼Œæ¯”å¦‚new char[32]ï¼Œä¹‹åŽå†ä½¿ç”¨placement newåœ¨è¿™å—å†…å­˜ä¸Šæž„å»ºå¯¹è±¡ï¼š 12char xx[32]; ::new (xx) MyStruct; ä½†æ˜¯char[32]æ˜¯1å­—èŠ‚å¯¹é½çš„ï¼Œxxå¾ˆæœ‰å¯èƒ½å¹¶ä¸åœ¨MyStructæŒ‡å®šçš„å¯¹é½ä½ç½®ä¸Šã€‚è¿™æ—¶è°ƒç”¨placement newæž„é€ å†…å­˜å—ï¼Œå¯èƒ½ä¼šå¼•èµ·æ•ˆçŽ‡é—®é¢˜æˆ–å‡ºé”™ï¼Œè¿™æ—¶æˆ‘ä»¬åº”è¯¥ä½¿ç”¨std::aligned_storageæ¥æž„é€ å†…å­˜å—ï¼š 12std::aligned_storage&lt;sizeof(MyStruct), alignof(MyStruct)&gt;::type xx; ::new (&amp;xx) MyStruct; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½¿ç”¨å †å†…å­˜çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½è¿˜æ˜¯éœ€è¦aligned_mallocã€‚å› ä¸ºçŽ°åœ¨çš„ç¼–è¯‘å™¨é‡Œnewå¹¶ä¸èƒ½åœ¨è¶…å‡ºé»˜è®¤æœ€å¤§å¯¹é½åŽï¼Œè¿˜èƒ½ä¿è¯å†…å­˜çš„å¯¹é½æ˜¯æ­£ç¡®çš„ã€‚æ¯”å¦‚åœ¨MSVC 2013é‡Œï¼Œä¸‹é¢çš„ä»£ç ï¼š 1234567891011struct alignas(32) MyStruct &#123; char a; // 1 byte int b; // 4 bytes short c; // 2 bytes long long d; // 8 bytes char e; // 1 byte &#125;; void* p = new MyStruct; // warning C4316: &apos;MyStruct&apos; : object allocated on the heap may not be aligned 32 å°†ä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘è­¦å‘Šã€‚ C. std::max_align_t è¿”å›žå½“å‰å¹³å°çš„æœ€å¤§é»˜è®¤å†…å­˜å¯¹é½ç±»åž‹ã€‚mallocè¿”å›žçš„å†…å­˜ï¼Œå…¶å¯¹é½å’Œmax_align_tç±»åž‹çš„å¯¹é½å¤§å°åº”å½“æ˜¯ä¸€è‡´çš„ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™ä¸ªæ–¹å¼èŽ·å¾—å½“å‰å¹³å°çš„æœ€å¤§é»˜è®¤å†…å­˜å¯¹é½æ•°ï¼š 12std::cout &lt;&lt; alignof(std::max_align_t) &lt;&lt; std::endl; D. std::align è¿™è´§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥åœ¨ä¸€å¤§å—å†…å­˜å½“ä¸­èŽ·å–ä¸€ä¸ªç¬¦åˆæŒ‡å®šå†…å­˜è¦æ±‚çš„åœ°å€ã€‚ çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š 1234char buffer[] = &quot;------------------------&quot;; void * pt = buffer; std::size_t space = sizeof(buffer) - 1; std::align(alignof(int), sizeof(char), pt, space); æ„æ€æ˜¯ï¼Œåœ¨bufferè¿™ä¸ªå¤§å†…å­˜å—ä¸­ï¼ŒæŒ‡å®šå†…å­˜å¯¹é½ä¸ºalignof(int)ï¼Œæ‰¾ä¸€å—sizeof(char)å¤§å°çš„å†…å­˜ï¼Œå¹¶åœ¨æ‰¾åˆ°è¿™å—å†…å­˜åŽï¼Œå°†åœ°å€æ”¾å…¥ptï¼Œå°†bufferä»Žptå¼€å§‹çš„é•¿åº¦æ”¾å…¥spaceã€‚ å…³äºŽè¿™ä¸ªå‡½æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œã€‚ å…³äºŽå†…å­˜å¯¹é½ï¼Œè¯¥è¯´çš„å°±æ˜¯è¿™ä¹ˆå¤šäº†ã€‚æˆ‘ä»¬ç»å¸¸ä¼šçœ‹åˆ°å†…å­˜å¯¹é½çš„åº”ç”¨ï¼Œæ˜¯åœ¨ç½‘ç»œæ”¶å‘åŒ…ä¸­ã€‚ä¸€èˆ¬ç”¨äºŽå‘é€çš„ç»“æž„ä½“ï¼Œéƒ½æ˜¯1å­—èŠ‚å¯¹é½çš„ï¼Œç›®çš„æ˜¯ç»Ÿä¸€æ”¶å‘åŒæ–¹ï¼ˆå¯èƒ½å¤„äºŽä¸åŒå¹³å°ï¼‰ä¹‹é—´çš„æ•°æ®å†…å­˜å¸ƒå±€ï¼Œä»¥åŠå‡å°‘ä¸å¿…è¦çš„æµé‡æ¶ˆè€—ã€‚ C++11ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ä¸å°‘æœ‰ç”¨çš„å·¥å…·ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ–¹ä¾¿çš„æ“ä½œå†…å­˜å¯¹é½ã€‚ä½†æ˜¯åœ¨å †å†…å­˜æ–¹é¢ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½è¿˜æ˜¯éœ€è¦è‡ªå·±æƒ³åŠžæ³•ã€‚ä¸è¿‡åœ¨å¹³æ—¶çš„åº”ç”¨ä¸­ï¼Œå› ä¸ºå¾ˆå°‘ä¼šæ‰‹åŠ¨æŒ‡å®šå†…å­˜å¯¹é½åˆ°å¤§äºŽç³»ç»Ÿé»˜è®¤çš„å¯¹é½æ•°ï¼Œæ‰€ä»¥å€’ä¹Ÿä¸æ¯”æ¯æ¬¡new/deleteçš„æ—¶å€™éƒ½æå¿ƒåŠèƒ†ã€‚ å‚è€ƒæ–‡ç« ï¼š Data structure alignment About Data Alignment #pragma pack align (C++) __alignof Operator 6.57.8 Structure-Packing Pragmas 5.32 Specifying Attributes of Types C/C++ Data alignment åŠ struct sizeæ·±å…¥åˆ†æž C++ å†…å­˜å¯¹é½ ç»“æž„/ç±»å¯¹é½çš„å£°æ˜Žæ–¹å¼ å­—èŠ‚å¯¹é½ï¼ˆå¼ºåˆ¶å¯¹é½ä»¥åŠè‡ªç„¶å¯¹é½ï¼‰ mallocå‡½æ•°å­—èŠ‚å¯¹é½å¾ˆç»å…¸çš„é—®é¢˜ Cè¯­è¨€å­—èŠ‚å¯¹é½ ç½‘ç»œç¼–ç¨‹(9)å†…å­˜å¯¹é½å¯¹è·¨å¹³å°é€šè®¯çš„å½±å“ Usage Issue of std::align std::align and std::aligned_storage for aligned allocation of memory blocks http://www.cnblogs.com/fangkm/p/4370492.html]]></content>
      <categories>
        <category>Memory</category>
      </categories>
      <tags>
        <tag>tips</tag>
        <tag>Memory</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[WebRTCçš„æ¨¡å—å¤„ç†æœºåˆ¶]]></title>
    <url>%2F2017%2F07%2F06%2Fwebrtc-modules%2F</url>
    <content type="text"><![CDATA[å¯¹äºŽå®žæ—¶éŸ³è§†é¢‘åº”ç”¨æ¥è®²ï¼Œåª’ä½“æ•°æ®ä»Žé‡‡é›†åˆ°æ¸²æŸ“ï¼Œåœ¨æ•°æ®æµæ°´çº¿ä¸Šä¾æ¬¡å®Œæˆä¸€ç³»åˆ—å¤„ç†ã€‚æµæ°´çº¿ç”±ä¸åŒçš„åŠŸèƒ½æ¨¡å—ç»„æˆï¼Œå½¼æ­¤åˆ†å·¥åä½œï¼šæ•°æ®é‡‡é›†æ¨¡å—è´Ÿè´£ä»Žæ‘„åƒå¤´/éº¦å…‹é£Žé‡‡é›†éŸ³è§†é¢‘æ•°æ®ï¼Œç¼–è§£ç æ¨¡å—è´Ÿè´£å¯¹æ•°æ®è¿›è¡Œç¼–è§£ç ï¼ŒRTPæ¨¡å—è´Ÿè´£æ•°æ®æ‰“åŒ…å’Œè§£åŒ…ã€‚æ•°æ®æµæ°´çº¿ä¸Šçš„æ•°æ®å¤„ç†é€Ÿåº¦æ˜¯å½±å“åº”ç”¨å®žæ—¶æ€§çš„æœ€é‡è¦å› ç´ ã€‚ä¸Žæ­¤åŒæ—¶ï¼Œä»ŽæœåŠ¡è´¨é‡ä¿è¯è§’åº¦è®²ï¼Œåº”ç”¨éœ€è¦çŸ¥é“æ•°æ®æµæ°´çº¿çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚è§†é¢‘é‡‡é›†æ¨¡å—çš„å®žæ—¶å¸§çŽ‡ã€å½“å‰ç½‘ç»œçš„å®žæ—¶é€ŸçŽ‡ã€æŽ¥æ”¶ç«¯çš„æ•°æ®ä¸¢åŒ…çŽ‡ï¼Œç­‰ç­‰ã€‚å„ä¸ªåŠŸèƒ½æ¨¡å—å¯ä»¥åŸºäºŽè¿™äº›è¿è¡ŒçŠ¶æ€ä¿¡æ¯ä½œç›¸åº”è°ƒæ•´ï¼Œä»Žè€Œåœ¨è´¨é‡ã€é€Ÿåº¦ç­‰æ–¹é¢ä¼˜åŒ–æ•°æ®æµæ°´çº¿çš„è¿è¡Œï¼Œå®žçŽ°æ›´å¿«ã€æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ WebRTCé‡‡ç”¨æ¨¡å—æœºåˆ¶ï¼ŒæŠŠæ•°æ®æµæ°´çº¿ä¸ŠåŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹çš„å¤„ç†ç‚¹å®šä¹‰ä¸ºæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä¸“æ³¨äºŽè‡ªå·±çš„ä»»åŠ¡ï¼Œæ¨¡å—ä¹‹é—´åŸºäºŽæ•°æ®æµè¿›è¡Œé€šä¿¡ã€‚ä¸Žæ­¤åŒæ—¶ï¼Œä¸“æœ‰çº¿ç¨‹æ”¶é›†å’Œå¤„ç†æ¨¡å—å†…éƒ¨çš„è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼Œå¹¶æŠŠè¿™äº›ä¿¡æ¯åé¦ˆåˆ°ç›®æ ‡æ¨¡å—ï¼Œå®žçŽ°æ¨¡å—è¿è¡ŒçŠ¶æ€ç›‘æŽ§å’ŒæœåŠ¡è´¨é‡ä¿è¯ã€‚æœ¬æ–‡åœ¨æ·±å…¥åˆ†æžWebRTCæºä»£ç åŸºç¡€ä¸Šï¼Œå­¦ä¹ ç ”ç©¶å…¶æ¨¡å—å¤„ç†æœºåˆ¶çš„å®žçŽ°ç»†èŠ‚ï¼Œä»Žå¦ä¸€ä¸ªè§’åº¦ç†è§£WebRTCçš„æŠ€æœ¯åŽŸç†ã€‚ 1 WebRTCæ•°æ®æµæ°´çº¿æˆ‘ä»¬å¯ä»¥æŠŠWebRTCçœ‹ä½œæ˜¯ä¸€ä¸ªä¸“æ³¨äºŽå®žæ—¶éŸ³è§†é¢‘é€šä¿¡çš„SDKã€‚å…¶å¯¹å¤–çš„APIä¸»è¦è´Ÿè´£PeerConnectionå»ºç«‹ã€MediaStreamåˆ›å»ºã€NATç©¿é€ã€SDPåå•†ç­‰å·¥ä½œï¼Œå¯¹å†…åˆ™ä¸»è¦é›†ä¸­äºŽéŸ³è§†é¢‘æ•°æ®çš„å¤„ç†ï¼Œä»Žæ•°æ®é‡‡é›†åˆ°æ¸²æŸ“çš„æ•´ä¸ªå¤„ç†è¿‡ç¨‹å¯ä»¥ç”¨ä¸€ä¸ªæ•°æ®æµæ°´çº¿æ¥æè¿°ï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚ éŸ³è§†é¢‘æ•°æ®é¦–å…ˆä»Žé‡‡é›†ç«¯è¿›è¡Œé‡‡é›†ï¼Œä¸€èˆ¬æ¥è¯´éŸ³é¢‘æ•°æ®æ¥è‡ªéº¦å…‹é£Žï¼Œè§†é¢‘æ•°æ®æ¥è‡ªæ‘„åƒå¤´ã€‚åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹ï¼ŒéŸ³é¢‘æ•°æ®æ¥è‡ªæ‰¬å£°å™¨ï¼Œè§†é¢‘æ•°æ®æ¥è‡ªæ¡Œé¢å…±äº«ã€‚é‡‡é›†ç«¯çš„è¾“å‡ºæ˜¯éŸ³è§†é¢‘Raw Dataã€‚ç„¶åŽRaw Dataåˆ°è¾¾ç¼–ç æ¨¡å—ï¼Œæ•°æ®è¢«ç¼–ç å™¨ç¼–ç æˆç¬¦åˆè¯­æ³•è§„åˆ™çš„NALå•å…ƒï¼Œåˆ°è¾¾å‘é€ç«¯ç¼“å†²åŒºPacedSenderå¤„ã€‚æŽ¥ä¸‹æ¥PacedSenderæŠŠNALå•å…ƒå‘é€åˆ°RTPæ¨¡å—æ‰“åŒ…ä¸ºRTPæ•°æ®åŒ…ï¼Œæœ€åŽç»è¿‡ç½‘ç»œæ¨¡å—å‘é€åˆ°ç½‘ç»œã€‚ åœ¨æŽ¥æ”¶ç«¯ï¼ŒRTPæ•°æ®åŒ…ç»è¿‡ç½‘ç»œæ¨¡å—æŽ¥æ”¶åŽè¿›è¡Œè§£åŒ…å¾—åˆ°NALå•å…ƒï¼ŒæŽ¥ä¸‹æ¥NALå•å…ƒåˆ°è¾¾æŽ¥æ”¶ç«¯ç¼“å†²åŒº(JitterBufferæˆ–è€…NetEQ)è¿›è¡Œä¹±åºé‡æŽ’å’Œç»„å¸§ã€‚ä¸€å¸§å®Œæ•´çš„æ•°æ®æŽ¥æ”¶å¹¶ç»„å¸§ä¹‹åŽï¼Œè°ƒç”¨è§£ç æ¨¡å—è¿›è¡Œè§£ç ï¼Œå¾—åˆ°è¯¥å¸§æ•°æ®çš„Raw Dataã€‚æœ€åŽRaw Dataäº¤ç»™æ¸²æŸ“æ¨¡å—è¿›è¡Œæ’­æ”¾/æ˜¾ç¤ºã€‚ åœ¨æ•°æ®æµæ°´çº¿ä¸Šï¼Œè¿˜æœ‰ä¸€ç³»åˆ—æ¨¡å—è´Ÿè´£æœåŠ¡è´¨é‡ç›‘æŽ§ï¼Œå¦‚ä¸¢å¸§ç­–ç•¥ï¼Œä¸¢åŒ…ç­–ç•¥ï¼Œç¼–ç å™¨è¿‡åº¦ä½¿ç”¨ä¿æŠ¤ï¼Œç çŽ‡ä¼°è®¡ï¼Œå‰å‘çº é”™ï¼Œä¸¢åŒ…é‡ä¼ ï¼Œç­‰ç­‰ã€‚ WebRTCæ•°æ®æµæ°´çº¿ä¸Šçš„åŠŸèƒ½å•å…ƒè¢«å®šä¹‰ä¸ºæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä»Žä¸Šæ¸¸æ¨¡å—èŽ·å–è¾“å…¥æ•°æ®ï¼Œåœ¨æœ¬æ¨¡å—è¿›è¡ŒåŠ å·¥åŽå¾—åˆ°è¾“å‡ºæ•°æ®ï¼Œäº¤ç»™ä¸‹æ¸¸æ¨¡å—è¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ã€‚WebRTCçš„æ¨¡å—å¤„ç†æœºåˆ¶åŒ…æ‹¬æ¨¡å—å’Œæ¨¡å—å¤„ç†çº¿ç¨‹ï¼Œå‰è€…æŠŠWebRTCæ•°æ®æµæ°´çº¿ä¸Šçš„åŠŸèƒ½éƒ¨ä»¶å°è£…ä¸ºæ¨¡å—ï¼ŒåŽè€…é©±åŠ¨æ¨¡å—å†…éƒ¨çŠ¶æ€æ›´æ–°å’Œæ¨¡å—ä¹‹é—´çŠ¶æ€ä¼ é€’ã€‚æ¨¡å—ä¸€èˆ¬æŒ‚è½½åˆ°æ¨¡å—å¤„ç†çº¿ç¨‹ä¸Šï¼Œç”±å¤„ç†çº¿ç¨‹é©±åŠ¨æ¨¡å—çš„å¤„ç†å‡½æ•°ã€‚ä¸‹é¢åˆ†åˆ«æè¿°ä¹‹ã€‚ WebRTCæ¨¡å—WebRTCæ¨¡å—è™šåŸºç±»Moduleå®šä¹‰åœ¨webrtc/modules/include/modue.hä¸­ï¼Œå¦‚å›¾2æ‰€ç¤ºã€‚ Moduleè™šåŸºç±»å¯¹å¤–æä¾›ä¸‰ä¸ªå‡½æ•°ä½œä¸ºAPIï¼šTimeUntilNextProcess()ç”¨æ¥è®¡ç®—è·ä¸‹æ¬¡è°ƒç”¨å¤„ç†å‡½æ•°Process()çš„æ—¶é—´é—´éš”ï¼›Process()æ˜¯æ¨¡å—çš„å¤„ç†å‡½æ•°ï¼Œè´Ÿè´£æ¨¡å—å†…éƒ¨è¿è¡Œç›‘æŽ§ã€çŠ¶æ€æ›´æ–°å’Œæ¨¡å—é—´é€šä¿¡ï¼›ProcessThreadAttached()ç”¨æ¥æŠŠæ¨¡å—æŒ‚è½½åˆ°æ¨¡å—å¤„ç†çº¿ç¨‹ï¼Œæˆ–è€…ä»Žæ¨¡å—å¤„ç†çº¿ç¨‹åˆ†ç¦»å‡ºæ¥ï¼Œå®žé™…å®žçŽ°ä¸­è¿™ä¸ªå‡½æ•°æš‚æ—¶æ²¡æœ‰è¢«ç”¨åˆ°ã€‚ Moduleçš„æ´¾ç”Ÿç±»åˆ†å¸ƒåœ¨WebRTCæ•°æ®æµæ°´çº¿ä¸Šçš„ä¸åŒéƒ¨åˆ†ï¼Œå„è‡ªæ‰¿æ‹…è‡ªå·±çš„æ•°æ®å¤„ç†å’ŒæœåŠ¡è´¨é‡ä¿è¯ä»»åŠ¡ã€‚ 3 WebRTCæ¨¡å—å¤„ç†çº¿ç¨‹WebRTCæ¨¡å—å¤„ç†çº¿ç¨‹æ˜¯æ¨¡å—å¤„ç†æœºåˆ¶çš„é©±åŠ¨å™¨ï¼Œå®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯å¯¹æ‰€æœ‰æŒ‚è½½åœ¨æœ¬çº¿ç¨‹ä¸‹çš„æ¨¡å—ï¼Œå‘¨æœŸæ€§è°ƒç”¨å…¶Process()å¤„ç†å‡½æ•°å¤„ç†æ¨¡å—å†…éƒ¨äº‹åŠ¡ï¼Œå¹¶å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚å…¶è™šåŸºç±»ProcessThreadå’Œæ´¾ç”Ÿç±»ProcessThreadImplå¦‚å›¾3æ‰€ç¤ºã€‚ ProcessThreadåŸºç±»æä¾›ä¸€ç³»åˆ—APIå®Œæˆçº¿ç¨‹åŠŸèƒ½ï¼šStart()/Stop()å‡½æ•°ç”¨æ¥å¯åŠ¨å’Œç»“æŸçº¿ç¨‹ï¼›WakeUp()å‡½æ•°ç”¨æ¥å”¤é†’æŒ‚è½½åœ¨æœ¬çº¿ç¨‹ä¸‹çš„æŸä¸ªæ¨¡å—ï¼Œä½¿å¾—è¯¥æ¨¡å—æœ‰æœºä¼šé©¬ä¸Šæ‰§è¡Œå…¶Process()å¤„ç†å‡½æ•°ï¼›PostTask()å‡½æ•°ç”¨æ¥é‚®é€’ä¸€ä¸ªä»»åŠ¡ç»™æœ¬çº¿ç¨‹ï¼›RegisterModule()å’ŒDeRegisterModule()ç”¨æ¥å‘çº¿ç¨‹æ³¨å†Œ/æ³¨é”€æ¨¡å—ã€‚ WebRTCåŸºäºŽProcessThreadçº¿ç¨‹å®žçŽ°æ´¾ç”Ÿç±»ProcessThreadImplï¼Œå¦‚å›¾3æ‰€ç¤ºã€‚åœ¨æˆå‘˜å˜é‡æ–¹é¢ï¼Œwakeupç”¨æ¥å”¤é†’å¤„äºŽç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼›threadæ˜¯å¹³å°ç›¸å…³çš„çº¿ç¨‹å®žçŽ°å¦‚POSIXçº¿ç¨‹ï¼›modulesæ˜¯æ³¨å†Œåœ¨æœ¬çº¿ç¨‹ä¸‹çš„æ¨¡å—é›†åˆï¼›queue_æ˜¯é‚®é€’ç»™æœ¬çº¿ç¨‹çš„ä»»åŠ¡é›†åˆï¼›threadnameæ˜¯çº¿ç¨‹åå­—ã€‚åœ¨æˆå‘˜å‡½æ•°æ–¹é¢ï¼ŒProcess()å®ŒæˆProcessThreadçš„æ ¸å¿ƒä»»åŠ¡ï¼Œå…¶ä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ 1234567891011121314151617181920212223bool ProcessThreadImpl::Process() &#123; for (ModuleCallback&amp; m : modules_) &#123; if (m.next_callback == 0) m.next_callback = GetNextCallbackTime(m.module, now); if (m.next_callback &lt;= now || m.next_callback == kCallProcessImmediately) &#123; m.module-&gt;Process(); m.next_callback = GetNextCallbackTime(m.module, rtc::TimeMillis();); &#125; if (m.next_callback &lt; next_checkpoint) next_checkpoint = m.next_callback; &#125; while (!queue_.empty()) &#123; ProcessTask* task = queue_.front(); queue_.pop(); task-&gt;Run(); delete task; &#125; &#125; int64_t time_to_wait = next_checkpoint - rtc::TimeMillis(); if (time_to_wait &gt; 0) wake_up_-&gt;Wait(static_cast&lt;unsigned long&gt;(time_to_wait)); return true;&#125; Process()å‡½æ•°é¦–å…ˆå¤„ç†æŒ‚è½½åœ¨æœ¬çº¿ç¨‹ä¸‹çš„æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯æ¨¡å—å¤„ç†çº¿ç¨‹çš„æ ¸å¿ƒä»»åŠ¡ï¼šé’ˆå¯¹æ¯ä¸ªæ¨¡å—ï¼Œè®¡ç®—å…¶ä¸‹æ¬¡è°ƒç”¨æ¨¡å—Process()å¤„ç†å‡½æ•°çš„æ—¶åˆ»(è°ƒç”¨è¯¥æ¨¡å—çš„TimeUntilNextProcess()å‡½æ•°)ã€‚å¦‚æžœæ—¶åˆ»æ˜¯å½“å‰æ—¶åˆ»ï¼Œåˆ™è°ƒç”¨æ¨¡å—çš„Process()å¤„ç†å‡½æ•°ï¼Œå¹¶æ›´æ–°ä¸‹æ¬¡è°ƒç”¨æ—¶åˆ»ã€‚éœ€è¦æ³¨æ„ï¼Œä¸åŒæ¨¡å—çš„æ‰§è¡Œé¢‘çŽ‡ä¸ä¸€æ ·ï¼Œçº¿ç¨‹åœ¨æœ¬è½®è°ƒç”¨æœ«å°¾çš„ç­‰å¾…æ—¶é—´å’Œæœ¬çº¿ç¨‹ä¸‹æ‰€æœ‰æ¨¡å—çš„æœ€è¿‘ä¸‹æ¬¡è°ƒç”¨æ—¶åˆ»ç›¸å…³ã€‚ æŽ¥ä¸‹æ¥çº¿ç¨‹Process()å‡½æ•°å¤„ç†ProcessTaské˜Ÿåˆ—ä¸­çš„å¼‚æ­¥ä»»åŠ¡ï¼Œé’ˆå¯¹æ¯ä¸ªä»»åŠ¡è°ƒç”¨Run()å‡½æ•°ï¼Œç„¶åŽä»»åŠ¡å‡ºé˜Ÿåˆ—å¹¶é”€æ¯ã€‚ç­‰æ¨¡å—è°ƒç”¨å’Œä»»åŠ¡éƒ½å¤„ç†å®ŒåŽï¼Œåˆ™æŠŠæœ¬æ¬¡æ—¶é—´ç‰‡çš„å‰©ä½™æ—¶é—´ç­‰å¾…å®Œæ¯•ï¼Œç„¶åŽè¿”å›žã€‚å¦‚æžœåœ¨ç­‰å¾…æœŸé—´å…¶ä»–çº¿ç¨‹å‘æœ¬çº¿ç¨‹Wakeupæ¨¡å—æˆ–è€…é‚®é€’ä¸€ä¸ªä»»åŠ¡ï¼Œåˆ™çº¿ç¨‹è¢«ç«‹å³å”¤é†’å¹¶è¿”å›žï¼Œè¿›è¡Œä¸‹ä¸€è½®æ—¶é—´ç‰‡çš„æ‰§è¡Œã€‚ è‡³æ­¤ï¼Œå…³äºŽWebRTCçš„æ¨¡å—å’Œæ¨¡å—å¤„ç†çº¿ç¨‹çš„åŸºæœ¬å®žçŽ°åˆ†æžå®Œæ¯•ï¼Œä¸‹ä¸€èŠ‚å°†å¯¹WebRTC SDKå†…æ¨¡å—å®žä¾‹å’Œæ¨¡å—å¤„ç†çº¿ç¨‹å®žä¾‹è¿›è¡Œè¯¦ç»†åˆ†æžã€‚ 4 WebRTCæ¨¡å—å¤„ç†çº¿ç¨‹å®žä¾‹WebRTCå…³äºŽæ¨¡å—å’Œå¤„ç†çº¿ç¨‹çš„å®žçŽ°åœ¨webrtc/modulesç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•æ±‡é›†äº†æ‰€æœ‰æ´¾ç”Ÿç±»æ¨¡å—å’Œæ¨¡å—å¤„ç†çº¿ç¨‹çš„å®žçŽ°åŠå®žä¾‹åˆ†å¸ƒã€‚æœ¬èŠ‚å¯¹è¿™äº›å†…å®¹è¿›è¡Œæ€»ç»“ã€‚ WebRTCç›®å‰åˆ›å»ºä¸‰ä¸ªProcessThreadImplçº¿ç¨‹å®žä¾‹ï¼Œåˆ†åˆ«æ˜¯è´Ÿè´£å¤„ç†éŸ³é¢‘çš„VoiceProcessTreadï¼Œè´Ÿè´£å¤„ç†è§†é¢‘å’ŒéŸ³è§†é¢‘åŒæ­¥çš„ModuleProcessThreadï¼Œä»¥åŠè´Ÿè´£æ•°æ®å¹³æ»‘å‘é€çš„PacerThreadã€‚è¿™ä¸‰ä¸ªçº¿ç¨‹å’ŒæŒ‚è½½åœ¨çº¿ç¨‹ä¸‹çš„æ¨¡å—å¦‚å›¾4æ‰€ç¤ºã€‚ VoiceProcessThreadçº¿ç¨‹ç”±Workerçº¿ç¨‹åœ¨åˆ›å»ºVoiceEngineæ—¶åˆ›å»ºï¼Œè´Ÿè´£éŸ³é¢‘ç«¯æ¨¡å—çš„å¤„ç†ã€‚æŒ‚è½½åœ¨è¯¥çº¿ç¨‹ä¸‹çš„æ¨¡å—å¦‚å›¾4æ‰€ç¤ºï¼Œå…¶ä¸­MonitorModuleè´Ÿè´£å¯¹éŸ³é¢‘æ•°æ®æ··éŸ³å¤„ç†è¿‡ç¨‹ä¸­äº§ç”Ÿçš„è­¦å‘Šå’Œé”™è¯¯è¿›è¡Œå¤„ç†ï¼ŒAudioDeviceModuleImplè´Ÿè´£å¯¹éŸ³é¢‘è®¾å¤‡é‡‡é›†å’Œæ’­æ”¾éŸ³é¢‘æ•°æ®æ—¶äº§ç”Ÿçš„è­¦å‘Šå’Œé”™è¯¯è¿›è¡Œå¤„ç†ï¼ŒModuleRtpRtcpImplè´Ÿè´£éŸ³é¢‘RTPæ•°æ®åŒ…å‘é€è¿‡ç¨‹ä¸­çš„ç çŽ‡è®¡ç®—ã€RTTæ›´æ–°ã€RTCPæŠ¥æ–‡å‘é€ç­‰å†…å®¹ã€‚ ModuleProcessThreadçº¿ç¨‹ç”±Workerçº¿ç¨‹åœ¨åˆ›å»ºVideoChannelæ—¶åˆ›å»ºï¼Œè´Ÿè´£è§†é¢‘ç«¯æ¨¡å—çš„å¤„ç†ã€‚æŒ‚è½½åœ¨è¯¥çº¿ç¨‹ä¸‹çš„æ¨¡å—å¦‚å›¾4æ‰€ç¤ºï¼Œå…¶ä¸­CallStatsè´Ÿè´£Callå¯¹è±¡ç»Ÿè®¡æ•°æ®(å¦‚RTT)çš„æ›´æ–°ï¼ŒCongestionControllerè´Ÿè´£æ‹¥å¡žæŽ§åˆ¶[1][2]ï¼ŒVideoSenderè´Ÿè´£è§†é¢‘å‘é€ç«¯ç»Ÿè®¡æ•°æ®çš„æ›´æ–°ï¼ŒVideoReceiverè´Ÿè´£è§†é¢‘æŽ¥æ”¶ç«¯ç»Ÿè®¡æ•°æ®æ›´æ–°å’Œå¤„ç†çŠ¶æ€åé¦ˆ(å¦‚è¯·æ±‚å…³é”®å¸§)ï¼ŒModuleRtpRtcpImplè´Ÿè´£è§†é¢‘RTPæ•°æ®åŒ…å‘é€è¿‡ç¨‹ä¸­çš„ç çŽ‡è®¡ç®—ã€RTTæ›´æ–°ã€RTCPæŠ¥æ–‡å‘é€ç­‰å†…å®¹ï¼ŒOveruseFrameDetectorè´Ÿè´£è§†é¢‘å¸§é‡‡é›†ç«¯è¿‡è½½ç›‘æŽ§ï¼ŒReceiveStatisticsImplè´Ÿè´£ç”±æŽ¥æ”¶ç«¯ç»Ÿè®¡æ•°æ®è§¦å‘çš„ç çŽ‡æ›´æ–°è¿‡ç¨‹ï¼ŒViESyncModuleè´Ÿè´£éŸ³è§†é¢‘åŒæ­¥ã€‚ PacerThreadçº¿ç¨‹ç”±Workerçº¿ç¨‹åœ¨åˆ›å»ºVideoChannelæ—¶åˆ›å»ºï¼Œè´Ÿè´£æ•°æ®å¹³æ»‘å‘é€ã€‚æŒ‚è½½åœ¨è¯¥çº¿ç¨‹ä¸‹çš„PacedSenderè´Ÿè´£å‘é€ç«¯æ•°æ®å¹³æ»‘å‘é€ï¼›RemoteEstimatorProxyæ´¾ç”Ÿè‡ªRemoteBitrateEstimatorï¼Œè´Ÿè´£åœ¨å¯ç”¨å‘é€ç«¯ç çŽ‡ä¼°è®¡çš„æƒ…å†µä¸‹æŠŠæŽ¥æ”¶ç«¯æ”¶é›†åˆ°çš„åé¦ˆä¿¡æ¯å‘é€å›žå‘é€ç«¯ã€‚ ç”±ä»¥ä¸Šåˆ†æžå¯çŸ¥ï¼ŒWebRTCåˆ›å»ºçš„æ¨¡å—å¤„ç†çº¿ç¨‹å®žä¾‹åŸºæœ¬ä¸Šæ¶µç›–äº†éŸ³è§†é¢‘æ•°æ®ä»Žé‡‡é›†åˆ°æ¸²æŸ“è¿‡ç¨‹ä¸­çš„å¤§éƒ¨åˆ†æ•°æ®æ“ä½œã€‚ä½†è¿˜æœ‰ä¸€äº›æ¨¡å—ä¸ä¾èµ–äºŽæ¨¡å—çº¿ç¨‹å·¥ä½œï¼Œè¿™éƒ¨åˆ†æ¨¡å—æ˜¯å°‘æ•°ï¼Œæœ¬æ–‡ä¸å±•å¼€å…·ä½“çš„æè¿°ã€‚ å‚è€ƒæ–‡çŒ®[1] WebRTCåŸºäºŽGCCçš„æ‹¥å¡žæŽ§åˆ¶(ä¸Š) â€“ ç®—æ³•åˆ†æž [2] WebRTCåŸºäºŽGCCçš„æ‹¥å¡žæŽ§åˆ¶(ä¸‹) - å®žçŽ°åˆ†æž è½¬è‡³]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidåº”ç”¨æ€§èƒ½ä¼˜åŒ–]]></title>
    <url>%2F2017%2F07%2F03%2Ftips-android-performance%2F</url>
    <content type="text"><![CDATA[Androidæ‰‹æœºç”±äºŽå…¶æœ¬èº«çš„åŽå°æœºåˆ¶å’Œç¡¬ä»¶ç‰¹ç‚¹ï¼Œæ€§èƒ½ä¸Šä¸€ç›´è¢«è¯Ÿç—…ï¼Œæ‰€ä»¥è½¯ä»¶å¼€å‘è€…å¯¹è½¯ä»¶æœ¬èº«çš„æ€§èƒ½ä¼˜åŒ–å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼›æœ¬æ–‡å°†å¯¹Androidå¼€å‘è¿‡ç¨‹ä¸­æ€§èƒ½ä¼˜åŒ–çš„å„ä¸ªæ–¹é¢åšä¸€ä¸ªå›žé¡¾ä¸Žæ€»ç»“ã€‚ Cacheä¼˜åŒ– ListViewç¼“å­˜ï¼š ListViewä¸­æœ‰ä¸€ä¸ªå›žæ”¶å™¨ï¼ŒItemæ»‘å‡ºç•Œé¢çš„æ—¶å€™Viewä¼šå›žæ”¶åˆ°è¿™é‡Œï¼Œéœ€è¦æ˜¾ç¤ºæ–°çš„Itemçš„æ—¶å€™ï¼Œå°±å°½é‡é‡ç”¨å›žæ”¶å™¨é‡Œé¢çš„Viewï¼›æ¯æ¬¡åœ¨getViewå‡½æ•°ä¸­inflateæ–°çš„itemä¹‹å‰ä¼šå…ˆåˆ¤æ–­å›žæ”¶å™¨ä¸­æ˜¯å¦æœ‰ç¼“å­˜çš„viewï¼Œå³åˆ¤æ–­convertViewæ˜¯å¦ä¸ºnullï¼Œæ˜¯åˆ™inflateä¸€ä¸ªæ–°çš„item Viewï¼Œå¦åˆ™é‡ç”¨å›žæ”¶å™¨ä¸­çš„itemã€‚ æ­¤å¤–ï¼ŒListViewè¿˜ä½¿ç”¨é™æ€çš„ViewHolderå‡å°‘findViewByIdçš„æ¬¡æ•° ListViewä¸­æœ‰getViewTypeCount()å‡½æ•°ç”¨äºŽèŽ·å–åˆ—è¡¨æœ‰å‡ ç§å¸ƒå±€ç±»åž‹ï¼ŒgetItemViewType(int position)ç”¨äºŽèŽ·å–åœ¨positionä½ç½®ä¸Šçš„å¸ƒå±€ç±»åž‹; æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ViewTypeæ¥ç»™ä¸åŒç±»åž‹çš„itemåˆ›å»ºä¸åŒçš„Viewï¼Œè¿™æ ·å¯ä»¥åˆ©äºŽListViewçš„å›žæ”¶ å¯¹Itemä¸­å›¾ç‰‡è¿›è¡Œé€‚å½“åŽ‹ç¼©, å¹¶è¿›è¡Œå¼‚æ­¥åŠ è½½ï¼›å¦‚æžœå¿«é€Ÿæ»‘åŠ¨ï¼Œä¸åŠ è½½å›¾ç‰‡ï¼›å®žçŽ°æ•°æ®çš„åˆ†é¡µåŠ è½½ IOç¼“å­˜ï¼šåœ¨æ–‡ä»¶å’Œç½‘ç»œIOä¸­ä½¿ç”¨å…·æœ‰ç¼“å­˜ç­–ç•¥çš„è¾“å…¥æµï¼ŒBufferedInputStreamæ›¿ä»£InputStreamï¼ŒBufferedReaderæ›¿ä»£Readerï¼ŒBufferedReaderæ›¿ä»£BufferedInputStream dataç¼“å­˜(ç©ºé—´æ¢æ—¶é—´)ï¼šâ‘ ç¼“å­˜æ•°æ®åº“çš„æŸ¥è¯¢ç»“æžœï¼Œæ¯”å¦‚ç¼“å­˜æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®æ¡æ•°ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å¤šæ¬¡çš„select countæŸ¥è¯¢ â‘¡ç¼“å­˜ç£ç›˜æ–‡ä»¶ä¸­éœ€è¦é¢‘ç¹è®¿é—®çš„æ•°æ®åˆ°å†…å­˜ä¸­ â‘¢ç¼“å­˜è€—æ—¶è®¡ç®—çš„ç»“æžœ Batteryä¼˜åŒ– cpuçš„ä½¿ç”¨çŽ‡å’Œä½¿ç”¨é¢‘çŽ‡å°†ç›´æŽ¥æˆ–é—´æŽ¥çš„å½±å“ç”µé‡çš„åˆ†é…å’Œä½¿ç”¨ï¼Œcpué™é¢‘å¯ä»¥èŠ‚çº¦ç”µé‡ serviceä¼˜åŒ– serviceä½œä¸ºä¸€ä¸ªè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­çš„åŽå°æœåŠ¡ï¼Œåº”è¯¥å°½é‡é¿å…è€—æ—¶åŠ¨ä½œï¼Œè€Œåº”è¯¥å°½é‡æ–°å¼€çº¿ç¨‹åŽ»å¤„ç†è€—æ—¶åŠ¨ä½œ ç›‘å¬ç³»ç»Ÿå¹¿æ’­çœ‹serviceæ˜¯å¦å­˜æ´»ï¼Œå¦åˆ™killæŽ‰ï¼›é™ä½Žserviceä¼˜å…ˆçº§ä½¿å¾—ç³»ç»Ÿå†…å­˜åƒç´§æ—¶ä¼šè¢«è‡ªåŠ¨killæŽ‰ ä½¿ç”¨Androidæä¾›çš„IntentServiceä»£æ›¿serviceï¼Œå› ä¸ºIntentServiceä¼šåœ¨è¿è¡Œå®Œæˆä¹‹åŽè‡ªåŠ¨åœæ­¢ï¼Œè€Œserviceéœ€è¦æ‰‹åŠ¨è°ƒç”¨stopService()æ‰èƒ½åœæ­¢è¿è¡Œ å®šæ—¶æ‰§è¡Œä»»åŠ¡çš„Alarmæœºåˆ¶ï¼šAndroidçš„å®šæ—¶ä»»åŠ¡æœ‰ä¸¤ç§å®žçŽ°æ–¹å¼ï¼ŒTimerç±»å’ŒAlarmæœºåˆ¶ï¼›Timerä¸é€‚åˆé•¿æœŸåŽå°è¿è¡Œçš„å®šæ—¶ä»»åŠ¡ã€‚å› ä¸ºæ¯ç§æ‰‹æœºéƒ½ä¼šæœ‰è‡ªå·±çš„ä¼‘çœ ç­–ç•¥ï¼ŒAndroidæ‰‹æœºå°±ä¼šåœ¨é•¿æ—¶é—´ä¸æ“ä½œçš„æƒ…å†µä¸‹è‡ªåŠ¨è®©CPUè¿›å…¥åˆ°ç¡çœ çŠ¶æ€ï¼Œè¿™å°±æœ‰å¯èƒ½å¯¼è‡´Timerä¸­çš„å®šæ—¶ä»»åŠ¡æ— æ³•æ­£å¸¸è¿è¡Œã€‚è€ŒAlarmæœºåˆ¶åˆ™ä¸å­˜åœ¨è¿™ç§æƒ…å†µï¼Œå®ƒå…·æœ‰å”¤é†’CPUçš„åŠŸèƒ½ï¼Œå³å¯ä»¥ä¿è¯æ¯æ¬¡éœ€è¦æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ—¶å€™CPUèƒ½æ­£å¸¸å·¥ä½œã€‚ç„¶è€Œä»ŽAndroid4.4ä¹‹åŽï¼ŒAlarmä»»åŠ¡çš„è§¦å‘æ—¶é—´å°†ä¼šå˜å¾—ä¸å‡†ç¡®ï¼Œæœ‰å¯èƒ½ä¼šå»¶è¿Ÿä¸€æ®µæ—¶é—´åŽä»»åŠ¡æ‰èƒ½å¾—åˆ°æ‰§è¡Œã€‚è¿™ä¸æ˜¯bugï¼Œè€Œæ˜¯ç³»ç»Ÿåœ¨è€—ç”µæ€§æ–¹é¢è¿›è¡Œçš„ä¼˜åŒ–ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç›®å‰æœ‰å¤šå°‘Alarmä»»åŠ¡å­˜åœ¨ï¼Œç„¶åŽå°†è§¦å‘æ—¶é—´å°†è¿‘çš„å‡ ä¸ªä»»åŠ¡æ”¾åœ¨ä¸€èµ·æ‰§è¡Œï¼Œè¿™å°±å¯ä»¥å¤§å¹…åº¦çš„å‡å°‘CPUè¢«å”¤é†’çš„æ¬¡æ•°ï¼Œä»Žè€Œæœ‰æ•ˆå»¶é•¿ç”µæ± çš„ä½¿ç”¨æ—¶é—´ æ¸²æŸ“å±‚ä¼˜åŒ– Android ç•Œé¢å¡é¡¿çš„åŽŸå› ï¼Ÿ UIçº¿ç¨‹ä¸­åšè€—æ—¶æ“ä½œï¼Œæ¯”å¦‚è¿›è¡Œç½‘ç»œè¯·æ±‚,ç£ç›˜è¯»å–ï¼Œä½å›¾ä¿®æ”¹ï¼Œæ›´æ–°UIç­‰è€—æ—¶æ“ä½œï¼Œä»Žè€Œå¯¼è‡´UIçº¿ç¨‹å¡é¡¿ å¸ƒå±€Layoutè¿‡äºŽå¤æ‚ï¼Œæ— æ³•åœ¨16mså†…å®Œæˆæ¸²æŸ“ï¼Œæˆ–è€…åµŒå¥—å±‚æ¬¡è¿‡æ·± Viewè¿‡åº¦ç»˜åˆ¶æˆ–è€…é¢‘ç¹çš„è§¦å‘measureã€layoutï¼ŒåŒä¸€æ—¶é—´åŠ¨ç”»æ‰§è¡Œçš„æ¬¡æ•°è¿‡å¤šï¼Œå¯¼è‡´CPUæˆ–GPUè´Ÿè½½è¿‡é‡ å†—ä½™èµ„æºåŠé€»è¾‘ç­‰å¯¼è‡´åŠ è½½å’Œæ‰§è¡Œç¼“æ…¢ Android ç•Œé¢å¡é¡¿æ€Žä¹ˆå¤„ç†ï¼Ÿ xmlå¸ƒå±€ä¼˜åŒ–ï¼šå°½é‡ä½¿ç”¨includeã€mergeã€ViewStubæ ‡ç­¾ï¼Œå°½é‡ä¸å­˜åœ¨å†—ä½™åµŒå¥—åŠè¿‡äºŽå¤æ‚å¸ƒå±€ï¼ˆè­¬å¦‚10å±‚å°±ä¼šç›´æŽ¥å¼‚å¸¸ï¼‰ï¼Œä¾‹å¦‚ä½¿ç”¨RelativeLayoutä»£æ›¿LinearLayoutå¯ä»¥å‡å°‘å¸ƒå±€å±‚æ¬¡å’Œå¤æ‚æ€§ï¼ŒViewçš„åµŒå¥—å±‚æ¬¡ä¸èƒ½è¿‡æ·±ï¼Œå°½é‡ä½¿ç”¨GONEæ›¿æ¢INVISIBLEï¼Œä½¿ç”¨weightåŽå°½é‡å°†widthå’Œheighè®¾ç½®ä¸º0dpï¼Œå‡å°‘è¿ç®—ï¼ŒItemå­˜åœ¨éžå¸¸å¤æ‚çš„åµŒå¥—æ—¶è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰Item Viewæ¥å–ä»£ï¼Œå‡å°‘measureä¸Žlayoutæ¬¡æ•°ç­‰ã€‚ ListViewåŠAdapterä¼˜åŒ–ï¼›å°½é‡å¤ç”¨getViewæ–¹æ³•ä¸­çš„ç›¸å…³Viewï¼Œä¸é‡å¤èŽ·å–å®žä¾‹å¯¼è‡´å¡é¡¿ï¼Œåˆ—è¡¨å°½é‡åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­ä¸è¿›è¡ŒUIå…ƒç´ åˆ·æ–°ç­‰ã€‚ èƒŒæ™¯å’Œå›¾ç‰‡ç­‰å†…å­˜åˆ†é…ä¼˜åŒ–ï¼›å°½é‡å‡å°‘ä¸å¿…è¦çš„èƒŒæ™¯è®¾ç½®ï¼Œå›¾ç‰‡å°½é‡åŽ‹ç¼©å¤„ç†æ˜¾ç¤ºï¼Œå°½é‡é¿å…é¢‘ç¹å†…å­˜æŠ–åŠ¨ç­‰é—®é¢˜å‡ºçŽ°ï¼›å°½å¯èƒ½ä¸ºä¸åŒåˆ†è¾¨çŽ‡åˆ›å»ºèµ„æºï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„ç¡¬ä»¶ç¼©æ”¾ è‡ªå®šä¹‰Viewç­‰ç»˜å›¾ä¸Žå¸ƒå±€ä¼˜åŒ–ï¼›å°½é‡é¿å…åœ¨drawã€measureã€layoutä¸­åšè¿‡äºŽè€—æ—¶åŠè€—å†…å­˜æ“ä½œï¼Œå°¤å…¶æ˜¯drawæ–¹æ³•ä¸­ï¼Œå°½é‡å‡å°‘drawã€measureã€layoutç­‰æ‰§è¡Œæ¬¡æ•°ï¼Œé¿å…è¿‡åº¦æ¸²æŸ“å’Œç»˜åˆ¶ï¼›å‡å°‘ä¸å¿…è¦çš„inflateï¼Œå°½é‡ä½¿ç”¨å…¨å±€å˜é‡ç¼“å­˜View é¿å…ANRï¼Œä¸è¦åœ¨UIçº¿ç¨‹ä¸­åšè€—æ—¶æ“ä½œï¼Œè­¬å¦‚å¤šæ¬¡æ•°æ®åº“æ“ä½œç­‰ Layoutå¸¸ç”¨çš„æ ‡ç­¾ includeæ ‡ç­¾ï¼šè¯¥æ ‡ç­¾å¯ä»¥ç”¨äºŽå°†å¸ƒå±€æ–‡ä»¶ä¸­çš„å…¬å…±éƒ¨åˆ†æå–å‡ºæ¥ç»™å…¶å®ƒå¸ƒå±€æ–‡ä»¶å¤ç”¨ï¼Œä»Žè€Œä½¿å¾—å¸ƒå±€æ¨¡å—åŒ–ï¼Œä»£ç è½»é‡åŒ–; æ³¨æ„ç‚¹: â‘ å¦‚æžœæ ‡ç­¾å·²ç»å®šä¹‰äº†idï¼Œè€ŒåµŒå…¥å¸ƒå±€æ–‡ä»¶çš„rootå¸ƒå±€æ–‡ä»¶ä¹Ÿå®šä¹‰äº†idï¼Œæ ‡ç­¾çš„idä¼šè¦†ç›–æŽ‰åµŒå…¥å¸ƒå±€æ–‡ä»¶rootçš„idï¼Œå¦‚æžœincludeæ ‡ç­¾æ²¡æœ‰å®šä¹‰idåˆ™ä¼šä½¿ç”¨åµŒå…¥æ–‡ä»¶rootçš„id â‘¡å¦‚æžœæƒ³ä½¿ç”¨æ ‡ç­¾è¦†ç›–åµŒå…¥å¸ƒå±€rootå¸ƒå±€å±žæ€§ï¼Œå¿…é¡»åŒæ—¶è¦†ç›–layout_heightå’Œlayout_widthå±žæ€§ï¼Œå¦åˆ™ä¼šç›´æŽ¥æŠ¥ç¼–è¯‘æ—¶è¯­æ³•é”™è¯¯ viewstubæ ‡ç­¾ï¼šè¯¥æ ‡ç­¾ä¸Žincludeä¸€æ ·ç”¨äºŽå¼•å…¥å¸ƒå±€æ¨¡å—ï¼Œåªæ˜¯å¼•å…¥çš„å¸ƒå±€é»˜è®¤ä¸ä¼šæ‰©å¼ ï¼Œæ—¢ä¸ä¼šå ç”¨æ˜¾ç¤ºä¹Ÿä¸ä¼šå ç”¨ä½ç½®ï¼Œä»Žè€Œåœ¨è§£æžlayoutæ—¶èŠ‚çœcpuå’Œå†…å­˜ï¼Œåªæœ‰é€šè¿‡è°ƒç”¨setVisibilityå‡½æ•°æˆ–è€…Inflateå‡½æ•°æ‰ä¼šå°†å…¶è¦è£…è½½çš„ç›®æ ‡å¸ƒå±€ç»™åŠ è½½å‡ºæ¥ï¼Œä»Žè€Œè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„æ•ˆæžœï¼›ä¾‹å¦‚æ¡ç›®è¯¦æƒ…ã€è¿›åº¦æ¡æ ‡è¯†æˆ–è€…æœªè¯»æ¶ˆæ¯ç­‰ï¼Œè¿™äº›æƒ…å†µå¦‚æžœåœ¨ä¸€å¼€å§‹åˆå§‹åŒ–ï¼Œè™½ç„¶è®¾ç½®å¯è§æ€§View.GONE,ä½†æ˜¯åœ¨Inflateçš„æ—¶å€™Viewä»ç„¶ä¼šè¢«Inflateï¼Œä»ç„¶ä¼šåˆ›å»ºå¯¹è±¡ã€‚ mergeæ ‡ç­¾ï¼šè¯¥æ ‡ç­¾åœ¨layoutä¸­ä¼šè¢«è‡ªåŠ¨å¿½ç•¥ï¼Œä»Žè€Œå‡å°‘ä¸€å±‚å¸ƒå±€åµŒå¥—ï¼Œå…¶ä¸»è¦ç”¨å¤„æ˜¯å½“ä¸€ä¸ªå¸ƒå±€ä½œä¸ºå­å¸ƒå±€è¢«å…¶ä»–å¸ƒå±€includeæ—¶ï¼Œä½¿ç”¨mergeå½“ä½œè¯¥å¸ƒå±€çš„é¡¶èŠ‚ç‚¹æ¥ä»£æ›¿layouté¡¶èŠ‚ç‚¹å°±å¯ä»¥å‡å°‘ä¸€å±‚åµŒå¥— hierarchy viewerï¼šè¯¥å·¥å…·å¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹Activityçš„å¸ƒå±€ï¼Œå„ä¸ªViewçš„å±žæ€§ã€measureã€layoutã€drawçš„æ—¶é—´ï¼Œå¦‚æžœè€—æ—¶è¾ƒå¤šä¼šç”¨çº¢è‰²æ ‡è®°ï¼Œå¦åˆ™æ˜¾ç¤ºç»¿è‰² ç½‘ç»œä¼˜åŒ– å¼‚æ­¥è¯·æ±‚ç½‘ç»œæ•°æ®ï¼Œé¿å…é¢‘ç¹è¯·æ±‚æ•°æ®ï¼ˆä¾‹å¦‚å¦‚æžœæŸä¸ªé¡µé¢å†…è¯·æ±‚è¿‡å¤šï¼Œå¯ä»¥è€ƒè™‘åšä¸€å®šçš„è¯·æ±‚åˆå¹¶ï¼‰ï¼Œå°½å¯èƒ½çš„å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°å’Œå‡å°ç½‘ç»œè¯·æ±‚æ—¶é—´é—´éš” ç½‘ç»œåº”ç”¨ä¼ è¾“ä¸­ä½¿ç”¨é«˜æ•ˆçŽ‡çš„æ•°æ®æ ¼å¼ï¼Œè­¬å¦‚ä½¿ç”¨JSONä»£æ›¿XMLï¼Œä½¿ç”¨WebPä»£æ›¿å…¶ä»–å›¾ç‰‡æ ¼å¼,å¹¶å¯¹æ•°æ®è¿›è¡ŒGzipåŽ‹ç¼©æ•°æ®ï¼Œæ¯”å¦‚postè¯·æ±‚çš„bodyå’Œheaderå†…å®¹ åŠæ—¶ç¼“å­˜æ•°æ®åˆ°å†…å­˜/æ–‡ä»¶/æ•°æ®åº“ æ‰§è¡ŒæŸäº›æ“ä½œå‰å°½é‡å…ˆè¿›è¡Œç½‘ç»œçŠ¶æ€åˆ¤æ–­ï¼Œæ¯”å¦‚wifiä¼ è¾“æ•°æ®æ¯”èœ‚çªæ•°æ®æ›´çœç”µï¼Œæ‰€ä»¥å°½é‡åœ¨wifiä¸‹è¿›è¡Œæ•°æ®çš„é¢„åŠ è½½ httpClientå’ŒhttpUrlConnectionå¯¹æ¯”ï¼š httpClientæ˜¯apacheçš„å¼€æºå®žçŽ°ï¼ŒAPIæ•°é‡å¤šï¼Œéžå¸¸ç¨³å®š httpUrlConnectionæ˜¯javaè‡ªå¸¦çš„æ¨¡å—: â‘ å¯ä»¥ç›´æŽ¥æ”¯æŒGZIPåŽ‹ç¼©,è€ŒHttpClientè™½ç„¶ä¹Ÿæ”¯æŒGZIPï¼Œä½†è¦è‡ªå·±å†™ä»£ç å¤„ç† â‘¡httpUrlConnectionç›´æŽ¥åœ¨ç³»ç»Ÿå±‚é¢åšäº†ç¼“å­˜ç­–ç•¥å¤„ç†ï¼ŒåŠ å¿«é‡å¤è¯·æ±‚çš„é€Ÿåº¦ â‘¢APIç®€å•ï¼Œä½“ç§¯è¾ƒå°,è€Œä¸”ç›´æŽ¥æ”¯æŒç³»ç»Ÿçº§è¿žæŽ¥æ± ï¼Œå³æ‰“å¼€çš„è¿žæŽ¥ä¸ä¼šç›´æŽ¥å…³é—­ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…æ‰€æœ‰ç¨‹åºå¯å…±ç”¨ HttpURLConnectionåœ¨Android2.2ä¹‹å‰æœ‰ä¸ªé‡å¤§Bugï¼Œè°ƒç”¨close()å‡½æ•°ä¼šå½±å“è¿žæŽ¥æ± ï¼Œå¯¼è‡´è¿žæŽ¥å¤ç”¨å¤±æ•ˆï¼Œéœ€è¦å…³é—­keepAlive;å› æ­¤åœ¨2.2ä¹‹å‰httpè¯·æ±‚éƒ½æ˜¯ç”¨httpClientï¼Œ2.2ä¹‹åŽåˆ™æ˜¯ä½¿ç”¨HttpURLConnection ä½†æ˜¯!!!çŽ°åœ¨!!!Androidä¸å†æŽ¨èè¿™ä¸¤ç§æ–¹å¼ï¼äºŒæ˜¯ç›´æŽ¥ä½¿ç”¨OKHttpè¿™ç§æˆç†Ÿæ–¹æ¡ˆï¼æ”¯æŒAndroid 2.3åŠå…¶ä»¥ä¸Šç‰ˆæœ¬ æ•°æ®ç»“æž„ä¼˜åŒ– ArrayListå’ŒLinkedListçš„é€‰æ‹©ï¼šArrayListæ ¹æ®indexå–å€¼æ›´å¿«ï¼ŒLinkedListæ›´å å†…å­˜ã€éšæœºæ’å…¥åˆ é™¤æ›´å¿«é€Ÿã€æ‰©å®¹æ•ˆçŽ‡æ›´é«˜ ArrayListã€HashMapã€LinkedHashMapã€HashSetçš„é€‰æ‹©ï¼šhashç³»åˆ—æ•°æ®ç»“æž„æŸ¥è¯¢é€Ÿåº¦æ›´ä¼˜ï¼ŒArrayListå­˜å‚¨æœ‰åºå…ƒç´ ï¼ŒHashMapä¸ºé”®å€¼å¯¹æ•°æ®ç»“æž„ï¼ŒLinkedHashMapå¯ä»¥è®°ä½åŠ å…¥æ¬¡åºçš„hashMapï¼ŒHashSetä¸å…è®¸é‡å¤å…ƒç´  HashMapã€WeakHashMapé€‰æ‹©ï¼šWeakHashMapä¸­å…ƒç´ å¯åœ¨é€‚å½“æ—¶å€™è¢«ç³»ç»Ÿåžƒåœ¾å›žæ”¶å™¨è‡ªåŠ¨å›žæ”¶ï¼Œæ‰€ä»¥é€‚åˆåœ¨å†…å­˜ç´§å¼ æ—¶ä½¿ç”¨ Collections.synchronizedMapå’ŒConcurrentHashMapçš„é€‰æ‹©ï¼šConcurrentHashMapä¸ºç»†åˆ†é”ï¼Œé”ç²’åº¦æ›´å°ï¼Œå¹¶å‘æ€§èƒ½æ›´ä¼˜ï¼›Collections.synchronizedMapä¸ºå¯¹è±¡é”ï¼Œè‡ªå·±æ·»åŠ å‡½æ•°è¿›è¡Œé”æŽ§åˆ¶æ›´æ–¹ä¾¿ Androidä¸­æ€§èƒ½æ›´ä¼˜çš„æ•°æ®ç±»åž‹ï¼šå¦‚SparseArrayã€SparseBooleanArrayã€SparseIntArrayã€Pairï¼›Sparseç³»åˆ—çš„æ•°æ®ç»“æž„æ˜¯ä¸ºkeyä¸ºintæƒ…å†µçš„ç‰¹æ®Šå¤„ç†ï¼Œé‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾åŠç®€å•çš„æ•°ç»„å­˜å‚¨ï¼ŒåŠ ä¸Šä¸éœ€è¦æ³›åž‹è½¬æ¢çš„å¼€é”€ï¼Œç›¸å¯¹Mapæ¥è¯´æ€§èƒ½æ›´ä¼˜ å†…å­˜ä¼˜åŒ– Androidåº”ç”¨å†…å­˜æº¢å‡ºOOM å†…å­˜æº¢å‡ºçš„ä¸»è¦å¯¼è‡´åŽŸå› æœ‰å¦‚ä¸‹å‡ ç±»ï¼šâ‘ åº”ç”¨ä»£ç å­˜åœ¨å†…å­˜æ³„éœ²ï¼Œé•¿æ—¶é—´ç§¯ç´¯æ— æ³•é‡Šæ”¾å¯¼è‡´OOMï¼›â‘¡åº”ç”¨çš„æŸäº›é€»è¾‘æ“ä½œç–¯ç‹‚çš„æ¶ˆè€—æŽ‰å¤§é‡å†…å­˜ï¼ˆè­¬å¦‚åŠ è½½ä¸€å¼ ä¸ç»è¿‡å¤„ç†çš„è¶…å¤§è¶…é«˜æ¸…å›¾ç‰‡ç­‰ï¼‰å¯¼è‡´è¶…è¿‡é˜ˆå€¼OOM è§£å†³æ€è·¯â‘ åœ¨å†…å­˜å¼•ç”¨ä¸Šåšäº›å¤„ç†ï¼Œå¸¸ç”¨çš„æœ‰è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ â‘¡åœ¨å†…å­˜ä¸­åŠ è½½å›¾ç‰‡æ—¶ç›´æŽ¥åœ¨å†…å­˜ä¸­åšå¤„ç†ï¼Œå¦‚ï¼šè¾¹ç•ŒåŽ‹ç¼© â‘¢åŠ¨æ€å›žæ”¶å†…å­˜ï¼Œæ‰‹åŠ¨recyle bitmapï¼Œå›žæ”¶å¯¹è±¡ â‘£ä¼˜åŒ–Dalvikè™šæ‹Ÿæœºçš„å †å†…å­˜åˆ†é… â‘¤è‡ªå®šä¹‰å †å†…å­˜å¤§å°]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>tips</tag>
        <tag>æ€§èƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šåª’ä½“ä¹‹æœ¯è¯­]]></title>
    <url>%2F2017%2F06%2F27%2Fmedia-terminology%2F</url>
    <content type="text"><![CDATA[ä¸€.ç¼–è§£ç æœ¯è¯­1.GOP/ç æµ/æ¯”ç‰¹çŽ‡/å¸§é€ŸçŽ‡/åˆ†è¾¨çŽ‡1.1GOPï¼ˆGroup of pictureï¼‰å…³é”®å¸§çš„å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªIDRå¸§ä¹‹é—´çš„è·ç¦»ï¼Œä¸€ä¸ªå¸§ç»„çš„æœ€å¤§å¸§æ•°ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œæ¯ä¸€ç§’è§†é¢‘è‡³å°‘éœ€è¦ä½¿ç”¨ 1 ä¸ªå…³é”®å¸§ã€‚å¢žåŠ å…³é”®å¸§ä¸ªæ•°å¯æ”¹å–„è´¨é‡ï¼Œä½†æ˜¯åŒæ—¶å¢žåŠ å¸¦å®½å’Œç½‘ç»œè´Ÿè½½ã€‚ éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œé€šè¿‡æé«˜GOPå€¼æ¥æé«˜å›¾åƒè´¨é‡æ˜¯æœ‰é™åº¦çš„ï¼Œåœ¨é‡åˆ°åœºæ™¯åˆ‡æ¢çš„æƒ…å†µæ—¶ï¼ŒH.264ç¼–ç å™¨ä¼šè‡ªåŠ¨å¼ºåˆ¶æ’å…¥ä¸€ä¸ªIå¸§ï¼Œæ­¤æ—¶å®žé™…çš„GOPå€¼è¢«ç¼©çŸ­äº†ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨ä¸€ä¸ªGOPä¸­ï¼ŒPã€Bå¸§æ˜¯ç”±Iå¸§é¢„æµ‹å¾—åˆ°çš„ï¼Œå½“Iå¸§çš„å›¾åƒè´¨é‡æ¯”è¾ƒå·®æ—¶ï¼Œä¼šå½±å“åˆ°ä¸€ä¸ªGOPä¸­åŽç»­Pã€Bå¸§çš„å›¾åƒè´¨é‡ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªGOPå¼€å§‹æ‰æœ‰å¯èƒ½å¾—ä»¥æ¢å¤ï¼Œæ‰€ä»¥GOPå€¼ä¹Ÿä¸å®œè®¾ç½®è¿‡å¤§ã€‚ åŒæ—¶ï¼Œç”±äºŽPã€Bå¸§çš„å¤æ‚åº¦å¤§äºŽIå¸§ï¼Œæ‰€ä»¥è¿‡å¤šçš„Pã€Bå¸§ä¼šå½±å“ç¼–ç æ•ˆçŽ‡ï¼Œä½¿ç¼–ç æ•ˆçŽ‡é™ä½Žã€‚å¦å¤–ï¼Œè¿‡é•¿çš„GOPè¿˜ä¼šå½±å“Seekæ“ä½œçš„å“åº”é€Ÿåº¦ï¼Œç”±äºŽPã€Bå¸§æ˜¯ç”±å‰é¢çš„Iæˆ–På¸§é¢„æµ‹å¾—åˆ°çš„ï¼Œæ‰€ä»¥Seekæ“ä½œéœ€è¦ç›´æŽ¥å®šä½ï¼Œè§£ç æŸä¸€ä¸ªPæˆ–Bå¸§æ—¶ï¼Œéœ€è¦å…ˆè§£ç å¾—åˆ°æœ¬GOPå†…çš„Iå¸§åŠä¹‹å‰çš„Nä¸ªé¢„æµ‹å¸§æ‰å¯ä»¥ï¼ŒGOPå€¼è¶Šé•¿ï¼Œéœ€è¦è§£ç çš„é¢„æµ‹å¸§å°±è¶Šå¤šï¼Œseekå“åº”çš„æ—¶é—´ä¹Ÿè¶Šé•¿ã€‚ 1.12CABAC/CAVLCH.264/AVCæ ‡å‡†ä¸­ä¸¤ç§ç†µç¼–ç æ–¹æ³•ï¼ŒCABACå«è‡ªé€‚åº”äºŒè¿›åˆ¶ç®—æ•°ç¼–ç ï¼ŒCAVLCå«å‰åŽè‡ªé€‚åº”å¯å˜é•¿åº¦ç¼–ç ï¼Œ CABACï¼šæ˜¯ä¸€ç§æ— æŸç¼–ç æ–¹å¼ï¼Œç”»è´¨å¥½ï¼ŒX264å°±ä¼šèˆå¼ƒä¸€äº›è¾ƒå°çš„DCTç³»æ•°ï¼Œç çŽ‡é™ä½Žï¼Œå¯ä»¥å°†ç çŽ‡å†é™ä½Ž10-15%ï¼ˆç‰¹åˆ«æ˜¯åœ¨é«˜ç çŽ‡æƒ…å†µä¸‹ï¼‰ï¼Œä¼šé™ä½Žç¼–ç å’Œè§£ç çš„é€Ÿé€Ÿã€‚ CAVLCå°†å ç”¨æ›´å°‘çš„CPUèµ„æºï¼Œä½†ä¼šå½±å“åŽ‹ç¼©æ€§èƒ½ã€‚ å…¶ä»–: å¸§ï¼šå½“é‡‡æ ·è§†é¢‘ä¿¡å·æ—¶ï¼Œå¦‚æžœæ˜¯é€šè¿‡é€è¡Œæ‰«æï¼Œé‚£ä¹ˆå¾—åˆ°çš„ä¿¡å·å°±æ˜¯ä¸€å¸§å›¾åƒï¼Œé€šå¸¸å¸§é¢‘ä¸º25å¸§æ¯ç§’ï¼ˆPALåˆ¶ï¼‰ã€30å¸§æ¯ç§’ï¼ˆNTSCåˆ¶ï¼‰ï¼› åœºï¼šå½“é‡‡æ ·è§†é¢‘ä¿¡å·æ—¶ï¼Œå¦‚æžœæ˜¯é€šè¿‡éš”è¡Œæ‰«æï¼ˆå¥‡ã€å¶æ•°è¡Œï¼‰ï¼Œé‚£ä¹ˆä¸€å¸§å›¾åƒå°±è¢«åˆ†æˆäº†ä¸¤åœºï¼Œé€šå¸¸åœºé¢‘ä¸º50Hzï¼ˆPALåˆ¶ï¼‰ã€60Hzï¼ˆNTSCåˆ¶ï¼‰ï¼› å¸§é¢‘ã€åœºé¢‘çš„ç”±æ¥ï¼šæœ€æ—©ç”±äºŽæŠ—å¹²æ‰°å’Œæ»¤æ³¢æŠ€æœ¯çš„é™åˆ¶ï¼Œç”µè§†å›¾åƒçš„åœºé¢‘é€šå¸¸ä¸Žç”µç½‘é¢‘çŽ‡ï¼ˆäº¤æµç”µï¼‰ç›¸ä¸€è‡´ï¼ŒäºŽæ˜¯æ ¹æ®å„åœ°äº¤æµç”µé¢‘çŽ‡ä¸åŒå°±æœ‰äº†æ¬§æ´²å’Œä¸­å›½ç­‰PALåˆ¶çš„50Hzå’ŒåŒ—ç¾Žç­‰NTSCåˆ¶çš„60Hzï¼Œä½†æ˜¯çŽ°åœ¨å¹¶æ²¡æœ‰è¿™æ ·çš„é™åˆ¶äº†ï¼Œå¸§é¢‘å¯ä»¥å’Œåœºé¢‘ä¸€æ ·ï¼Œæˆ–è€…åœºé¢‘å¯ä»¥æ›´é«˜ã€‚ å¸§ç¼–ç ã€åœºç¼–ç æ–¹å¼ï¼šé€è¡Œè§†é¢‘å¸§å†…é‚»è¿‘è¡Œç©ºé—´ç›¸å…³æ€§è¾ƒå¼ºï¼Œå› æ­¤å½“æ´»åŠ¨é‡éžå¸¸å°æˆ–è€…é™æ­¢çš„å›¾åƒæ¯”è¾ƒé€‚å®œé‡‡ç”¨å¸§ç¼–ç æ–¹å¼ï¼›è€Œåœºå†…ç›¸é‚»è¡Œä¹‹é—´çš„æ—¶é—´ç›¸å…³æ€§è¾ƒå¼ºï¼Œå¯¹è¿åŠ¨é‡è¾ƒå¤§çš„è¿åŠ¨å›¾åƒåˆ™é€‚å®œé‡‡ç”¨åœºç¼–ç æ–¹å¼ã€‚ 1.1.3Deblockingå¼€å¯ä¼šå‡å°‘å—æ•ˆåº”. 1.1.4FORCE_IDRæ˜¯å¦è®©æ¯ä¸ªIå¸§å˜æˆIDRå¸§ï¼Œå¦‚æžœæ˜¯IDRå¸§ï¼Œæ”¯æŒéšæœºè®¿é—®ã€‚ 1.1.5frame,tff,bffâ€“frame å°†ä¸¤åœºåˆå¹¶ä½œä¸ºä¸€å¸§è¿›è¡Œç¼–ç ,â€“tff Enable interlaced mode (å¼€å¯éš”è¡Œç¼–ç å¹¶è®¾ç½®ä¸ŠåŠåœºåœ¨å‰),â€“bff Enable interlaced modeã€‚ PAFF å’ŒMBAFFï¼šå½“å¯¹éš”è¡Œæ‰«æå›¾åƒè¿›è¡Œç¼–ç æ—¶ï¼Œæ¯å¸§åŒ…æ‹¬ä¸¤ä¸ªåœºï¼Œç”±äºŽä¸¤ä¸ªåœºä¹‹é—´å­˜åœ¨è¾ƒå¤§çš„æ‰«æé—´éš”ï¼Œè¿™æ ·ï¼Œå¯¹è¿åŠ¨å›¾åƒæ¥è¯´ï¼Œå¸§ä¸­ç›¸é‚»ä¸¤è¡Œä¹‹é—´çš„ç©ºé—´ç›¸å…³æ€§ç›¸å¯¹äºŽé€è¡Œæ‰«ææ—¶å°±ä¼šå‡å°ï¼Œå› æ­¤è¿™æ—¶å¯¹ä¸¤ä¸ªåœºåˆ†åˆ«è¿›è¡Œç¼–ç ä¼šæ›´èŠ‚çœç æµã€‚ å¯¹å¸§æ¥è¯´ï¼Œå­˜åœ¨ä¸‰ç§å¯é€‰çš„ç¼–ç æ–¹å¼ï¼šå°†ä¸¤åœºåˆå¹¶ä½œä¸ºä¸€å¸§è¿›è¡Œç¼–ç (frame æ–¹å¼)æˆ–å°†ä¸¤åœºåˆ†åˆ«ç¼–ç (field æ–¹å¼)æˆ–å°†ä¸¤åœºåˆå¹¶èµ·æ¥ä½œä¸ºä¸€å¸§ï¼Œä½†ä¸åŒçš„æ˜¯å°†å¸§ä¸­åž‚ç›´ç›¸é‚»çš„ä¸¤ä¸ªå®å—åˆå¹¶ä¸ºå®å—å¯¹è¿›è¡Œç¼–ç ï¼›å‰ä¸¤ç§ç§°ä¸ºPAFF ç¼–ç ï¼Œå¯¹è¿åŠ¨åŒºåŸŸè¿›è¡Œç¼–ç æ—¶field æ–¹å¼æœ‰æ•ˆï¼Œå¯¹éžè¿åŒºåŸŸç¼–ç æ—¶ï¼Œç”±äºŽç›¸é‚»ä¸¤è¡Œæœ‰è¾ƒå¤§çš„ç›¸å…³æ€§ï¼Œå› è€Œframe æ–¹å¼ä¼šæ›´æœ‰æ•ˆã€‚å½“å›¾åƒåŒæ—¶å­˜åœ¨è¿åŠ¨åŒºåŸŸå’Œéžè¿åŠ¨åŒºåŸŸæ—¶ï¼Œåœ¨MB å±‚æ¬¡ä¸Šï¼Œå¯¹è¿åŠ¨åŒºåŸŸé‡‡å–field æ–¹å¼ï¼Œå¯¹éžè¿åŠ¨åŒºåŸŸé‡‡å–frame æ–¹å¼ä¼šæ›´åŠ æœ‰æ•ˆï¼Œè¿™ç§æ–¹å¼å°±ç§°ä¸ºMBAFFï¼Œé¢„æµ‹çš„å•ä½æ˜¯å®å—å¯¹ã€‚ 1.2ç æµ/ç çŽ‡ç æµ(Data Rate)æ˜¯æŒ‡è§†é¢‘æ–‡ä»¶åœ¨å•ä½æ—¶é—´å†…ä½¿ç”¨çš„æ•°æ®æµé‡ï¼Œä¹Ÿå«ç çŽ‡æˆ–ç æµçŽ‡ï¼Œé€šä¿—ä¸€ç‚¹çš„ç†è§£å°±æ˜¯å–æ ·çŽ‡,æ˜¯è§†é¢‘ç¼–ç ä¸­ç”»é¢è´¨é‡æŽ§åˆ¶ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œä¸€èˆ¬æˆ‘ä»¬ç”¨çš„å•ä½æ˜¯kb/sæˆ–è€…Mb/sã€‚ä¸€èˆ¬æ¥è¯´åŒæ ·åˆ†è¾¨çŽ‡ä¸‹ï¼Œè§†é¢‘æ–‡ä»¶çš„ç æµè¶Šå¤§ï¼ŒåŽ‹ç¼©æ¯”å°±è¶Šå°ï¼Œç”»é¢è´¨é‡å°±è¶Šé«˜ã€‚ç æµè¶Šå¤§ï¼Œè¯´æ˜Žå•ä½æ—¶é—´å†…å–æ ·çŽ‡è¶Šå¤§ï¼Œæ•°æ®æµï¼Œç²¾åº¦å°±è¶Šé«˜ï¼Œå¤„ç†å‡ºæ¥çš„æ–‡ä»¶å°±è¶ŠæŽ¥è¿‘åŽŸå§‹æ–‡ä»¶ï¼Œå›¾åƒè´¨é‡è¶Šå¥½ï¼Œç”»è´¨è¶Šæ¸…æ™°ï¼Œè¦æ±‚æ’­æ”¾è®¾å¤‡çš„è§£ç èƒ½åŠ›ä¹Ÿè¶Šé«˜ã€‚ å½“ç„¶ï¼Œç æµè¶Šå¤§ï¼Œæ–‡ä»¶ä½“ç§¯ä¹Ÿè¶Šå¤§ï¼Œå…¶è®¡ç®—å…¬å¼æ˜¯æ–‡ä»¶ä½“ç§¯=æ—¶é—´Xç çŽ‡/8ã€‚ä¾‹å¦‚ï¼Œç½‘ç»œä¸Šå¸¸è§çš„ä¸€éƒ¨90åˆ†é’Ÿ1Mbpsç æµçš„720P RMVBæ–‡ä»¶ï¼Œå…¶ä½“ç§¯å°±=5400ç§’Ã—1Mb/8=675MBã€‚ é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªè§†é¢‘æ–‡ä»¶åŒ…æ‹¬äº†ç”»é¢åŠå£°éŸ³ï¼Œä¾‹å¦‚ä¸€ä¸ªRMVBçš„è§†é¢‘æ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«äº†è§†é¢‘ä¿¡æ¯å’ŒéŸ³é¢‘ä¿¡æ¯ï¼ŒéŸ³é¢‘åŠè§†é¢‘éƒ½æœ‰å„è‡ªä¸åŒçš„é‡‡æ ·æ–¹å¼å’Œæ¯”ç‰¹çŽ‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªè§†é¢‘æ–‡ä»¶éŸ³é¢‘å’Œè§†é¢‘çš„æ¯”ç‰¹çŽ‡å¹¶ä¸æ˜¯ä¸€æ ·çš„ã€‚è€Œæˆ‘ä»¬æ‰€è¯´çš„ä¸€ä¸ªè§†é¢‘æ–‡ä»¶ç æµçŽ‡å¤§å°ï¼Œä¸€èˆ¬æ˜¯æŒ‡è§†é¢‘æ–‡ä»¶ä¸­éŸ³é¢‘åŠè§†é¢‘ä¿¡æ¯ç æµçŽ‡çš„æ€»å’Œã€‚ ä»¥ä»¥å›½å†…æœ€æµè¡Œï¼Œå¤§å®¶æœ€ç†Ÿæ‚‰çš„RMVBè§†é¢‘æ–‡ä»¶ä¸ºä¾‹ï¼ŒRMVBä¸­çš„VBï¼ŒæŒ‡çš„æ˜¯VBRï¼Œå³Variable Bit Rateçš„ç¼©å†™ï¼Œä¸­æ–‡å«ä¹‰æ˜¯å¯å˜æ¯”ç‰¹çŽ‡ï¼Œå®ƒè¡¨ç¤ºRMVBé‡‡ç”¨çš„æ˜¯åŠ¨æ€ç¼–ç çš„æ–¹å¼ï¼ŒæŠŠè¾ƒé«˜çš„é‡‡æ ·çŽ‡ç”¨äºŽå¤æ‚çš„åŠ¨æ€ç”»é¢(æ­Œèˆžã€é£žè½¦ã€æˆ˜äº‰ã€åŠ¨ä½œç­‰)ï¼Œè€ŒæŠŠè¾ƒä½Žçš„é‡‡æ ·çŽ‡ç”¨äºŽé™æ€ç”»é¢ï¼Œåˆç†åˆ©ç”¨èµ„æºï¼Œè¾¾åˆ°ç”»è´¨ä¸Žä½“ç§¯å¯å…¼å¾—çš„æ•ˆæžœã€‚ ç çŽ‡å’Œå–æ ·çŽ‡æœ€æ ¹æœ¬çš„å·®åˆ«å°±æ˜¯ç çŽ‡æ˜¯é’ˆå¯¹æºæ–‡ä»¶æ¥è®²çš„ã€‚ 1.3é‡‡æ ·çŽ‡é‡‡æ ·çŽ‡ï¼ˆä¹Ÿç§°ä¸ºé‡‡æ ·é€Ÿåº¦æˆ–è€…é‡‡æ ·é¢‘çŽ‡ï¼‰å®šä¹‰äº†æ¯ç§’ä»Žè¿žç»­ä¿¡å·ä¸­æå–å¹¶ç»„æˆç¦»æ•£ä¿¡å·çš„é‡‡æ ·ä¸ªæ•°ï¼Œå®ƒç”¨èµ«å…¹ï¼ˆHzï¼‰æ¥è¡¨ç¤ºã€‚é‡‡æ ·çŽ‡æ˜¯æŒ‡å°†æ¨¡æ‹Ÿä¿¡å·è½¬æ¢æˆæ•°å­—ä¿¡å·æ—¶çš„é‡‡æ ·é¢‘çŽ‡ï¼Œä¹Ÿå°±æ˜¯å•ä½æ—¶é—´å†…é‡‡æ ·å¤šå°‘ç‚¹ã€‚ä¸€ä¸ªé‡‡æ ·ç‚¹æ•°æ®æœ‰å¤šå°‘ä¸ªæ¯”ç‰¹ã€‚æ¯”ç‰¹çŽ‡æ˜¯æŒ‡æ¯ç§’ä¼ é€çš„æ¯”ç‰¹(bit)æ•°ã€‚å•ä½ä¸º bps(Bit Per Second)ï¼Œæ¯”ç‰¹çŽ‡è¶Šé«˜ï¼Œä¼ é€çš„æ•°æ®è¶Šå¤§ï¼ŒéŸ³è´¨è¶Šå¥½.æ¯”ç‰¹çŽ‡ =é‡‡æ ·çŽ‡ x é‡‡ç”¨ä½æ•° xå£°é“æ•°. é‡‡æ ·çŽ‡ç±»ä¼¼äºŽåŠ¨æ€å½±åƒçš„å¸§æ•°ï¼Œæ¯”å¦‚ç”µå½±çš„é‡‡æ ·çŽ‡æ˜¯24èµ«å…¹ï¼ŒPALåˆ¶å¼çš„é‡‡æ ·çŽ‡æ˜¯25èµ«å…¹ï¼ŒNTSCåˆ¶å¼çš„é‡‡æ ·çŽ‡æ˜¯30èµ«å…¹ã€‚å½“æˆ‘ä»¬æŠŠé‡‡æ ·åˆ°çš„ä¸€ä¸ªä¸ªé™æ­¢ç”»é¢å†ä»¥é‡‡æ ·çŽ‡åŒæ ·çš„é€Ÿåº¦å›žæ”¾æ—¶ï¼Œçœ‹åˆ°çš„å°±æ˜¯è¿žç»­çš„ç”»é¢ã€‚åŒæ ·çš„é“ç†ï¼ŒæŠŠä»¥44.1kHZé‡‡æ ·çŽ‡è®°å½•çš„CDä»¥åŒæ ·çš„é€ŸçŽ‡æ’­æ”¾æ—¶ï¼Œå°±èƒ½å¬åˆ°è¿žç»­çš„å£°éŸ³ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªé‡‡æ ·çŽ‡è¶Šé«˜ï¼Œå¬åˆ°çš„å£°éŸ³å’Œçœ‹åˆ°çš„å›¾åƒå°±è¶Šè¿žè´¯ã€‚å½“ç„¶ï¼Œäººçš„å¬è§‰å’Œè§†è§‰å™¨å®˜èƒ½åˆ†è¾¨çš„é‡‡æ ·çŽ‡æ˜¯æœ‰é™çš„ï¼ŒåŸºæœ¬ä¸Šé«˜äºŽ44.1kHZé‡‡æ ·çš„å£°éŸ³ï¼Œç»å¤§éƒ¨åˆ†äººå·²ç»è§‰å¯Ÿä¸åˆ°å…¶ä¸­çš„åˆ†åˆ«äº†ã€‚ è€Œå£°éŸ³çš„ä½æ•°å°±ç›¸å½“äºŽç”»é¢çš„é¢œè‰²æ•°ï¼Œè¡¨ç¤ºæ¯ä¸ªå–æ ·çš„æ•°æ®é‡ï¼Œå½“ç„¶æ•°æ®é‡è¶Šå¤§ï¼Œå›žæ”¾çš„å£°éŸ³è¶Šå‡†ç¡®ï¼Œä¸è‡³äºŽæŠŠå¼€æ°´å£¶çš„å«å£°å’Œç«è½¦çš„é¸£ç¬›æ··æ·†ã€‚åŒæ ·çš„é“ç†ï¼Œå¯¹äºŽç”»é¢æ¥è¯´å°±æ˜¯æ›´æ¸…æ™°å’Œå‡†ç¡®ï¼Œä¸è‡³äºŽæŠŠè¡€å’Œè¥¿çº¢æŸ¿é…±æ··æ·†ã€‚ä¸è¿‡å—äººçš„å™¨å®˜çš„æœºèƒ½é™åˆ¶ï¼Œ16ä½çš„å£°éŸ³å’Œ24ä½çš„ç”»é¢åŸºæœ¬å·²ç»æ˜¯æ™®é€šäººç±»çš„æžé™äº†ï¼Œæ›´é«˜ä½æ•°å°±åªèƒ½é ä»ªå™¨æ‰èƒ½åˆ†è¾¨å‡ºæ¥äº†ã€‚æ¯”å¦‚ç”µè¯å°±æ˜¯3kHZå–æ ·çš„7ä½å£°éŸ³ï¼Œè€ŒCDæ˜¯44.1kHZå–æ ·çš„16ä½å£°éŸ³ï¼Œæ‰€ä»¥CDå°±æ¯”ç”µè¯æ›´æ¸…æ¥šã€‚ å½“ä½ ç†è§£äº†ä»¥ä¸Šè¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œæ¯”ç‰¹çŽ‡å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚ä»¥ç”µè¯ä¸ºä¾‹ï¼Œæ¯ç§’3000æ¬¡å–æ ·ï¼Œæ¯ä¸ªå–æ ·æ˜¯7æ¯”ç‰¹ï¼Œé‚£ä¹ˆç”µè¯çš„æ¯”ç‰¹çŽ‡æ˜¯21000ã€‚ è€ŒCDæ˜¯æ¯ç§’ 44100æ¬¡å–æ ·ï¼Œä¸¤ä¸ªå£°é“ï¼Œæ¯ä¸ªå–æ ·æ˜¯13ä½PCMç¼–ç ï¼Œæ‰€ä»¥CDçš„æ¯”ç‰¹çŽ‡æ˜¯44100213=1146600ï¼Œä¹Ÿå°±æ˜¯è¯´CDæ¯ç§’çš„æ•°æ®é‡å¤§çº¦æ˜¯ 144KBï¼Œè€Œä¸€å¼ CDçš„å®¹é‡æ˜¯74åˆ†ç­‰äºŽ4440ç§’ï¼Œå°±æ˜¯639360KBï¼640MBã€‚ ç çŽ‡å’Œå–æ ·çŽ‡æœ€æ ¹æœ¬çš„å·®åˆ«å°±æ˜¯ç çŽ‡æ˜¯é’ˆå¯¹æºæ–‡ä»¶æ¥è®²çš„ 1.4æ¯”ç‰¹çŽ‡æ¯”ç‰¹çŽ‡æ˜¯æŒ‡æ¯ç§’ä¼ é€çš„æ¯”ç‰¹(bit)æ•°ã€‚å•ä½ä¸ºbps(Bit Per Second)ï¼Œæ¯”ç‰¹çŽ‡è¶Šé«˜ï¼Œä¼ é€çš„æ•°æ®è¶Šå¤§ã€‚åœ¨è§†é¢‘é¢†åŸŸ,æ¯”ç‰¹çŽ‡å¸¸ç¿»è¯‘ä¸ºç çŽ‡ !!! æ¯”ç‰¹çŽ‡è¡¨ç¤ºç»è¿‡ç¼–ç ï¼ˆåŽ‹ç¼©ï¼‰åŽçš„éŸ³ã€è§†é¢‘æ•°æ®æ¯ç§’é’Ÿéœ€è¦ç”¨å¤šå°‘ä¸ªæ¯”ç‰¹æ¥è¡¨ç¤ºï¼Œè€Œæ¯”ç‰¹å°±æ˜¯äºŒè¿›åˆ¶é‡Œé¢æœ€å°çš„å•ä½ï¼Œè¦ä¹ˆæ˜¯0ï¼Œè¦ä¹ˆæ˜¯1ã€‚æ¯”ç‰¹çŽ‡ä¸ŽéŸ³ã€è§†é¢‘åŽ‹ç¼©çš„å…³ç³»ï¼Œç®€å•çš„è¯´å°±æ˜¯æ¯”ç‰¹çŽ‡è¶Šé«˜ï¼ŒéŸ³ã€è§†é¢‘çš„è´¨é‡å°±è¶Šå¥½ï¼Œä½†ç¼–ç åŽçš„æ–‡ä»¶å°±è¶Šå¤§ï¼›å¦‚æžœæ¯”ç‰¹çŽ‡è¶Šå°‘åˆ™æƒ…å†µåˆšå¥½ç›¸åã€‚ æ¯”ç‰¹çŽ‡æ˜¯æŒ‡å°†æ•°å­—å£°éŸ³ã€è§†é¢‘ç”±æ¨¡æ‹Ÿæ ¼å¼è½¬åŒ–æˆæ•°å­—æ ¼å¼çš„é‡‡æ ·çŽ‡ï¼Œé‡‡æ ·çŽ‡è¶Šé«˜ï¼Œè¿˜åŽŸåŽçš„éŸ³è´¨ã€ç”»è´¨å°±è¶Šå¥½ã€‚ å¸¸è§ç¼–ç æ¨¡å¼ï¼š VBRï¼ˆVariable Bitrateï¼‰åŠ¨æ€æ¯”ç‰¹çŽ‡ ä¹Ÿå°±æ˜¯æ²¡æœ‰å›ºå®šçš„æ¯”ç‰¹çŽ‡ï¼ŒåŽ‹ç¼©è½¯ä»¶åœ¨åŽ‹ç¼©æ—¶æ ¹æ®éŸ³é¢‘æ•°æ®å³æ—¶ç¡®å®šä½¿ç”¨ä»€ä¹ˆæ¯”ç‰¹çŽ‡ï¼Œè¿™æ˜¯ä»¥è´¨é‡ä¸ºå‰æå…¼é¡¾æ–‡ä»¶å¤§å°çš„æ–¹å¼ï¼ŒæŽ¨èç¼–ç æ¨¡å¼ï¼› ABRï¼ˆAverage Bitrateï¼‰å¹³å‡æ¯”ç‰¹çŽ‡ æ˜¯VBRçš„ä¸€ç§æ’å€¼å‚æ•°ã€‚LAMEé’ˆå¯¹CBRä¸ä½³çš„æ–‡ä»¶ä½“ç§¯æ¯”å’ŒVBRç”Ÿæˆæ–‡ä»¶å¤§å°ä¸å®šçš„ç‰¹ç‚¹ç‹¬åˆ›äº†è¿™ç§ç¼–ç æ¨¡å¼ã€‚ABRåœ¨æŒ‡å®šçš„æ–‡ä»¶å¤§å°å†…ï¼Œä»¥æ¯50å¸§ï¼ˆ30å¸§çº¦1ç§’ï¼‰ä¸ºä¸€æ®µï¼Œä½Žé¢‘å’Œä¸æ•æ„Ÿé¢‘çŽ‡ä½¿ç”¨ç›¸å¯¹ä½Žçš„æµé‡ï¼Œé«˜é¢‘å’Œå¤§åŠ¨æ€è¡¨çŽ°æ—¶ä½¿ç”¨é«˜æµé‡ï¼Œå¯ä»¥åšä¸ºVBRå’ŒCBRçš„ä¸€ç§æŠ˜è¡·é€‰æ‹©ã€‚ CBRï¼ˆConstant Bitrateï¼‰ï¼Œå¸¸æ•°æ¯”ç‰¹çŽ‡ æŒ‡æ–‡ä»¶ä»Žå¤´åˆ°å°¾éƒ½æ˜¯ä¸€ç§ä½é€ŸçŽ‡ã€‚ç›¸å¯¹äºŽVBRå’ŒABRæ¥è®²ï¼Œå®ƒåŽ‹ç¼©å‡ºæ¥çš„æ–‡ä»¶ä½“ç§¯å¾ˆå¤§ï¼Œè€Œä¸”éŸ³è´¨ç›¸å¯¹äºŽVBRå’ŒABRä¸ä¼šæœ‰æ˜Žæ˜¾çš„æé«˜ã€‚ 1.5å¸§é€ŸçŽ‡å¸§é€ŸçŽ‡ä¹Ÿç§°ä¸ºFPS(Frames PerSecond)çš„ç¼©å†™â€”â€”å¸§/ç§’ã€‚æ˜¯æŒ‡æ¯ç§’é’Ÿåˆ·æ–°çš„å›¾ç‰‡çš„å¸§æ•°ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºå›¾å½¢å¤„ç†å™¨æ¯ç§’é’Ÿèƒ½å¤Ÿåˆ·æ–°å‡ æ¬¡ã€‚è¶Šé«˜çš„å¸§é€ŸçŽ‡å¯ä»¥å¾—åˆ°æ›´æµç•…ã€æ›´é€¼çœŸçš„åŠ¨ç”»ã€‚æ¯ç§’é’Ÿå¸§æ•°(FPS)è¶Šå¤šï¼Œæ‰€æ˜¾ç¤ºçš„åŠ¨ä½œå°±ä¼šè¶Šæµç•…ã€‚ 1.6åˆ†è¾¨çŽ‡å°±æ˜¯å¸§å¤§å°æ¯ä¸€å¸§å°±æ˜¯ä¸€å‰¯å›¾åƒã€‚ 640*480åˆ†è¾¨çŽ‡çš„è§†é¢‘ï¼Œå»ºè®®è§†é¢‘çš„ç é€ŸçŽ‡è®¾ç½®åœ¨700ä»¥ä¸Šï¼ŒéŸ³é¢‘é‡‡æ ·çŽ‡44100å°±è¡Œäº† ä¸€ä¸ªéŸ³é¢‘ç¼–ç çŽ‡ä¸º128Kbpsï¼Œè§†é¢‘ç¼–ç çŽ‡ä¸º800Kbpsçš„æ–‡ä»¶ï¼Œå…¶æ€»ç¼–ç çŽ‡ä¸º928Kbpsï¼Œæ„æ€æ˜¯ç»è¿‡ç¼–ç åŽçš„æ•°æ®æ¯ç§’é’Ÿéœ€è¦ç”¨928Kæ¯”ç‰¹æ¥è¡¨ç¤ºã€‚ è§†é¢‘åˆ†è¾¨çŽ‡æ˜¯æŒ‡è§†é¢‘æˆåƒäº§å“æ‰€æˆå›¾åƒçš„å¤§å°æˆ–å°ºå¯¸ã€‚å¸¸è§çš„è§†åƒåˆ†è¾¨çŽ‡æœ‰352Ã—288ï¼Œ176Ã—144ï¼Œ640Ã—480ï¼Œ1024Ã—768ã€‚åœ¨æˆåƒçš„ä¸¤ç»„æ•°å­—ä¸­ï¼Œå‰è€…ä¸ºå›¾ç‰‡é•¿åº¦ï¼ŒåŽè€…ä¸ºå›¾ç‰‡çš„å®½åº¦ï¼Œä¸¤è€…ç›¸ä¹˜å¾—å‡ºçš„æ˜¯å›¾ç‰‡çš„åƒç´ ï¼Œé•¿å®½æ¯”ä¸€èˆ¬ä¸º4ï¼š3. ç›®å‰ç›‘æŽ§è¡Œä¸šä¸­ä¸»è¦ä½¿ç”¨Qcif(176Ã—144ï¼‰ã€CIF(352Ã—288ï¼‰ã€HALF D1(704Ã—288ï¼‰ã€D1(704Ã—576ï¼‰ç­‰å‡ ç§åˆ†è¾¨çŽ‡ã€‚ D1æ˜¯æ•°å­—ç”µè§†ç³»ç»Ÿæ˜¾ç¤ºæ ¼å¼çš„æ ‡å‡†ï¼Œå…±åˆ†ä¸ºä»¥ä¸‹5ç§è§„æ ¼ï¼š D1ï¼š480iæ ¼å¼ï¼ˆ525iï¼‰ï¼š720Ã—480ï¼ˆæ°´å¹³480çº¿ï¼Œéš”è¡Œæ‰«æï¼‰ï¼Œå’ŒNTSCæ¨¡æ‹Ÿç”µè§†æ¸…æ™°åº¦ç›¸åŒï¼Œè¡Œé¢‘ä¸º15.25kHzï¼Œç›¸å½“äºŽæˆ‘ä»¬æ‰€è¯´çš„4CIF(720Ã—576) D2ï¼š480Pæ ¼å¼ï¼ˆ525pï¼‰ï¼š720Ã—480ï¼ˆæ°´å¹³480çº¿ï¼Œé€è¡Œæ‰«æï¼‰ï¼Œè¾ƒD1éš”è¡Œæ‰«æè¦æ¸…æ™°ä¸å°‘ï¼Œå’Œé€è¡Œæ‰«æDVDè§„æ ¼ç›¸åŒï¼Œè¡Œé¢‘ä¸º31.5kHz D3ï¼š1080iæ ¼å¼ï¼ˆ1125iï¼‰ï¼š1920Ã—1080ï¼ˆæ°´å¹³1080çº¿ï¼Œéš”è¡Œæ‰«æï¼‰ï¼Œé«˜æ¸…æ–¹å¼é‡‡ç”¨æœ€å¤šçš„ä¸€ç§åˆ†è¾¨çŽ‡ï¼Œåˆ†è¾¨çŽ‡ä¸º1920Ã—1080i/60Hzï¼Œè¡Œé¢‘ä¸º33.75kHz D4ï¼š720pæ ¼å¼ï¼ˆ750pï¼‰ï¼š1280Ã—720ï¼ˆæ°´å¹³720çº¿ï¼Œé€è¡Œæ‰«æï¼‰ï¼Œè™½ç„¶åˆ†è¾¨çŽ‡è¾ƒD3è¦ä½Žï¼Œä½†æ˜¯å› ä¸ºé€è¡Œæ‰«æï¼Œå¸‚é¢ä¸Šæ›´å¤šäººæ„Ÿè§‰ç›¸å¯¹äºŽ1080Iï¼ˆå®žé™…é€æ¬¡540çº¿ï¼‰è§†è§‰æ•ˆæžœæ›´åŠ æ¸…æ™°ã€‚ä¸è¿‡ä¸ªäººæ„Ÿè§‰æ¥è¯´ï¼Œåœ¨æœ€å¤§åˆ†è¾¨çŽ‡è¾¾åˆ°1920Ã—1080çš„æƒ…å†µä¸‹ï¼ŒD3è¦æ¯”D4æ„Ÿè§‰æ›´åŠ æ¸…æ™°ï¼Œå°¤å…¶æ˜¯æ–‡å­—è¡¨çŽ°åŠ›ä¸Šï¼Œåˆ†è¾¨çŽ‡ä¸º1280Ã—720p/60Hzï¼Œè¡Œé¢‘ä¸º45kHz D5ï¼š1080pæ ¼å¼ï¼ˆ1125pï¼‰ï¼š1920Ã—1080ï¼ˆæ°´å¹³1080çº¿ï¼Œé€è¡Œæ‰«æï¼‰ï¼Œç›®å‰æ°‘ç”¨é«˜æ¸…è§†é¢‘çš„æœ€é«˜æ ‡å‡†ï¼Œåˆ†è¾¨çŽ‡ä¸º1920Ã—1080P/60Hzï¼Œè¡Œé¢‘ä¸º67.5KHZã€‚ å…¶ä¸­D1 å’ŒD2æ ‡å‡†æ˜¯æˆ‘ä»¬ä¸€èˆ¬æ¨¡æ‹Ÿç”µè§†çš„æœ€é«˜æ ‡å‡†ï¼Œå¹¶ä¸èƒ½ç§°çš„ä¸Šé«˜æ¸…æ™°ï¼ŒD3çš„1080iæ ‡å‡†æ˜¯é«˜æ¸…æ™°ç”µè§†çš„åŸºæœ¬æ ‡å‡†ï¼Œå®ƒå¯ä»¥å…¼å®¹720pæ ¼å¼ï¼Œè€ŒD5çš„1080Påªæ˜¯ä¸“ä¸šä¸Šçš„æ ‡å‡†ã€‚ è®¡ç®—è¾“å‡ºæ–‡ä»¶å¤§å°å…¬å¼ï¼š ï¼ˆéŸ³é¢‘ç¼–ç çŽ‡ï¼ˆKBitä¸ºå•ä½ï¼‰/8 +è§†é¢‘ç¼–ç çŽ‡ï¼ˆKBitä¸ºå•ä½ï¼‰/8ï¼‰Ã—å½±ç‰‡æ€»é•¿åº¦ï¼ˆç§’ä¸ºå•ä½ï¼‰=æ–‡ä»¶å¤§å°ï¼ˆMBä¸ºå•ä½ï¼‰ 2.é«˜æ¸…è§†é¢‘ç›®å‰çš„720Pä»¥åŠ1080Pé‡‡ç”¨äº†å¾ˆå¤šç§ç¼–ç ï¼Œä¾‹å¦‚ä¸»æµçš„MPEG2ï¼ŒVC-1ä»¥åŠH.264ï¼Œè¿˜æœ‰Divxä»¥åŠXvidï¼Œè‡³äºŽå°è£…æ ¼å¼æ›´å¤šåˆ°ä»¤äººå‘æŒ‡ï¼Œtsã€mkvã€wmvä»¥åŠè“å…‰ä¸“ç”¨ç­‰ç­‰ã€‚ 720å’Œ1080ä»£è¡¨è§†é¢‘æµçš„åˆ†è¾¨çŽ‡ï¼Œå‰è€…1280720ï¼ŒåŽè€…19201080ï¼Œä¸åŒçš„ç¼–ç éœ€è¦ä¸åŒçš„ç³»ç»Ÿèµ„æºï¼Œå¤§æ¦‚å¯ä»¥è®¤ä¸ºæ˜¯H.264&gt;VC-1&gt;MPEG2ã€‚ VC-1æ˜¯æœ€åŽè¢«è®¤å¯çš„é«˜æ¸…ç¼–ç æ ¼å¼ï¼Œä¸è¿‡å› ä¸ºæœ‰å¾®è½¯çš„åŽå°ï¼Œæ‰€ä»¥è¿™ç§ç¼–ç æ ¼å¼ä¸èƒ½å°çª¥ã€‚ç›¸å¯¹äºŽMPEG2ï¼ŒVC-1çš„åŽ‹ç¼©æ¯”æ›´é«˜ï¼Œä½†ç›¸å¯¹äºŽH.264è€Œè¨€ï¼Œç¼–ç è§£ç çš„è®¡ç®—åˆ™è¦ç¨å°ä¸€äº›ï¼Œç›®å‰æ¥çœ‹ï¼ŒVC-1å¯èƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¹³è¡¡ï¼Œè¾…ä»¥å¾®è½¯çš„æ”¯æŒï¼Œåº”è¯¥æ˜¯ä¸€åªä¸å¯å¿½è§†çš„åŠ›é‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒVC-1å¤šä¸º â€œ.wmvâ€åŽç¼€ï¼Œä½†è¿™éƒ½ä¸æ˜¯ç»å¯¹çš„ï¼Œå…·ä½“çš„ç¼–ç æ ¼å¼è¿˜æ˜¯è¦é€šè¿‡è½¯ä»¶æ¥æŸ¥è¯¢ã€‚ æ€»çš„æ¥è¯´ï¼Œä»ŽåŽ‹ç¼©æ¯”ä¸Šæ¥çœ‹ï¼ŒH.264çš„åŽ‹ç¼©æ¯”çŽ‡æ›´é«˜ä¸€äº›ï¼Œä¹Ÿå°±æ˜¯åŒæ ·çš„è§†é¢‘ï¼Œé€šè¿‡H.264ç¼–ç ç®—æ³•åŽ‹å‡ºæ¥çš„è§†é¢‘å®¹é‡è¦æ¯”VC-1çš„æ›´å°ï¼Œä½†æ˜¯VC-1 æ ¼å¼çš„è§†é¢‘åœ¨è§£ç è®¡ç®—æ–¹é¢åˆ™æ›´å°ä¸€äº›ï¼Œä¸€èˆ¬é€šè¿‡é«˜æ€§èƒ½çš„CPUå°±å¯ä»¥å¾ˆæµç•…çš„è§‚çœ‹é«˜æ¸…è§†é¢‘ã€‚ç›¸ä¿¡è¿™ä¹Ÿæ˜¯ç›®å‰NVIDIA Geforce 8ç³»åˆ—æ˜¾å¡ä¸èƒ½å®Œå…¨è§£ç VC-1è§†é¢‘çš„ä¸»è¦åŽŸå› ã€‚ PS&amp;TSæ˜¯ä¸¤ç§è§†é¢‘æˆ–å½±ç‰‡å°è£…æ ¼å¼ï¼Œå¸¸ç”¨äºŽé«˜æ¸…ç‰‡ã€‚æ‰©å±•ååˆ†åˆ«ä¸ºVOB/EVOå’ŒTSç­‰ï¼›å…¶æ–‡ä»¶ç¼–ç ä¸€èˆ¬ç”¨MPEG2/VC-1/H.264 é«˜æ¸…ï¼Œè‹±æ–‡ä¸ºâ€œHigh Definitionâ€ï¼Œå³æŒ‡â€œé«˜åˆ†è¾¨çŽ‡â€ã€‚ é«˜æ¸…ç”µè§†(HDTV)ï¼Œæ˜¯ç”±ç¾Žå›½ç”µå½±ç”µè§†å·¥ç¨‹å¸ˆåä¼šç¡®å®šçš„é«˜æ¸…æ™°åº¦ç”µè§†æ ‡å‡†æ ¼å¼ã€‚çŽ°åœ¨çš„å¤§å±å¹•æ¶²æ™¶ç”µè§†æœºï¼Œä¸€èˆ¬éƒ½æ”¯æŒ1080iå’Œ720Pï¼Œè€Œä¸€äº›ä¿—ç§°çš„â€œå…¨é«˜æ¸…â€(Full HD)ï¼Œåˆ™æ˜¯æŒ‡æ”¯æŒ1080Pè¾“å‡ºçš„ç”µè§†æœºã€‚ ç›®å‰çš„é«˜æ¸…è§†é¢‘ç¼–ç æ ¼å¼ä¸»è¦æœ‰H.264ã€VC-1ã€MPEG-2ã€MPEG-4ã€DivXã€XviDã€WMA-HDä»¥åŠX264ã€‚äº‹å®žä¸Šï¼ŒçŽ°åœ¨ç½‘ç»œä¸Šæµä¼ çš„é«˜æ¸…è§†é¢‘ä¸»è¦ä»¥ä¸¤ç±»æ–‡ä»¶çš„æ–¹å¼å­˜åœ¨ï¼šä¸€ç±»æ˜¯ç»è¿‡MPEG-2æ ‡å‡†åŽ‹ç¼©ï¼Œä»¥tpå’Œtsä¸ºåŽç¼€çš„è§†é¢‘æµæ–‡ä»¶;ä¸€ç±»æ˜¯ç»è¿‡WMV-HD(Windows Media Video HighDefinition)æ ‡å‡†åŽ‹ç¼©è¿‡çš„wmvæ–‡ä»¶ï¼Œè¿˜æœ‰å°‘æ•°æ–‡ä»¶åŽç¼€ä¸ºaviæˆ–mpgï¼Œå…¶æ€§è´¨ä¸Žwmvæ˜¯ä¸€æ ·çš„ã€‚çœŸæ­£æ•ˆæžœå¥½çš„é«˜æ¸…è§†é¢‘æ›´å¤šåœ°ä»¥H.264ä¸ŽVC-1è¿™ä¸¤ç§ä¸»æµçš„ç¼–ç æ ¼å¼æµä¼ ã€‚ ä¸€èˆ¬æ¥è¯´ï¼ŒH.264æ ¼å¼ä»¥â€œ.aviâ€ã€â€œ.mkvâ€ä»¥åŠâ€œ.tsâ€å°è£…æ¯”è¾ƒå¸¸è§ã€‚ 3.ä½çŽ‡ï¼ˆå®šç çŽ‡ï¼Œå˜ç çŽ‡ï¼‰ä½çŽ‡åˆç§°ä¸ºâ€œç çŽ‡â€ã€‚æŒ‡å•ä½æ—¶é—´å†…ï¼Œå•ä¸ªå½•åƒé€šé“æ‰€äº§ç”Ÿçš„æ•°æ®é‡ï¼Œå…¶å•ä½é€šå¸¸æ˜¯bpsã€Kbpsæˆ–Mbpsã€‚å¯ä»¥æ ¹æ®å½•åƒçš„æ—¶é—´ä¸Žä½çŽ‡ä¼°ç®—å‡ºä¸€å®šæ—¶é—´å†…çš„å½•åƒæ–‡ä»¶å¤§å°ã€‚ ä½çŽ‡æ˜¯ä¸€ä¸ªå¯è°ƒå‚æ•°ï¼Œä¸åŒçš„åˆ†è¾¨çŽ‡æ¨¡å¼ä¸‹å’Œç›‘æŽ§åœºæ™¯ä¸‹ï¼Œåˆé€‚çš„ä½çŽ‡å¤§å°æ˜¯ä¸åŒçš„ã€‚åœ¨è®¾ç½®æ—¶ï¼Œè¦ç»¼åˆè€ƒè™‘ä¸‰ä¸ªå› ç´ ï¼š åˆ†è¾¨çŽ‡:åˆ†è¾¨çŽ‡æ˜¯å†³å®šä½çŽ‡ï¼ˆç çŽ‡ï¼‰çš„ä¸»è¦å› ç´ ï¼Œä¸åŒçš„åˆ†è¾¨çŽ‡è¦é‡‡ç”¨ä¸åŒçš„ä½çŽ‡ã€‚æ€»ä½“è€Œè¨€ï¼Œå½•åƒçš„åˆ†è¾¨çŽ‡è¶Šé«˜ï¼Œæ‰€è¦æ±‚çš„ä½çŽ‡ï¼ˆç çŽ‡ï¼‰ä¹Ÿè¶Šå¤§ï¼Œä½†å¹¶ä¸æ€»æ˜¯å¦‚æ­¤ï¼Œå›¾1è¯´æ˜Žäº†ä¸åŒåˆ†è¾¨çŽ‡çš„åˆç†çš„ç çŽ‡é€‰æ‹©èŒƒå›´ã€‚æ‰€è°“â€œåˆç†çš„èŒƒå›´â€æŒ‡çš„æ˜¯ï¼Œå¦‚æžœä½ŽäºŽè¿™ä¸ªèŒƒå›´ï¼Œå›¾åƒè´¨é‡çœ‹èµ·æ¥ä¼šå˜å¾—ä¸å¯æŽ¥å—ï¼›å¦‚æžœé«˜äºŽè¿™ä¸ªèŒƒå›´ï¼Œåˆ™æ˜¾å¾—æ²¡æœ‰å¿…è¦ï¼Œå¯¹äºŽç½‘ç»œèµ„æºä»¥åŠå­˜å‚¨èµ„æºæ¥è¯´æ˜¯ä¸€ç§æµªè´¹ã€‚ åœºæ™¯:ç›‘æŽ§çš„åœºæ™¯æ˜¯è®¾ç½®ç çŽ‡æ—¶è¦è€ƒè™‘çš„ç¬¬äºŒä¸ªå› ç´ ã€‚åœ¨è§†é¢‘ç›‘æŽ§ä¸­ï¼Œå›¾åƒçš„è¿åŠ¨å‰§çƒˆç¨‹åº¦è¿˜ä¸Žä½çŽ‡æœ‰ä¸€å®šçš„å…³ç³»ï¼Œè¿åŠ¨è¶Šå‰§çƒˆï¼Œç¼–ç æ‰€è¦æ±‚çš„ç çŽ‡å°±è¶Šé«˜ã€‚åä¹‹åˆ™è¶Šä½Žã€‚å› æ­¤åœ¨åŒæ ·çš„å›¾åƒåˆ†è¾¨çŽ‡æ¡ä»¶ä¸‹ï¼Œç›‘æŽ§äººå¤šçš„åœºæ™¯å’Œäººå°‘çš„åœºæ™¯ï¼Œæ‰€è¦æ±‚çš„ä½çŽ‡ä¹Ÿæ˜¯ä¸åŒçš„ã€‚ å­˜å‚¨ç©ºé—´:æœ€åŽéœ€è¦è€ƒé‡çš„å› ç´ æ˜¯å­˜å‚¨ç©ºé—´ï¼Œè¿™ä¸ªå› ç´ ä¸»è¦æ˜¯å†³å®šäº†å½•åƒç³»ç»Ÿçš„æˆæœ¬ã€‚ä½çŽ‡è®¾ç½®å¾—è¶Šé«˜ï¼Œç”»è´¨ç›¸å¯¹ä¼šè¶Šå¥½ï¼Œä½†æ‰€è¦æ±‚çš„å­˜å‚¨ç©ºé—´å°±è¶Šå¤§ã€‚æ‰€ä»¥åœ¨å·¥ç¨‹å®žæ–½ä¸­ï¼Œè®¾ç½®åˆé€‚çš„ä½çŽ‡å³å¯ä»¥ä¿è¯è‰¯å¥½çš„å›žæ”¾å›¾åƒè´¨é‡ï¼Œåˆå¯ä»¥é¿å…ä¸å¿…è¦çš„èµ„æºæµªè´¹ã€‚ QP(quantizer parameter) ä»‹äºŽ0~31ä¹‹é—´ï¼Œå€¼è¶Šå°ï¼Œé‡åŒ–è¶Šç²¾ç»†ï¼Œå›¾åƒè´¨é‡å°±è¶Šé«˜ï¼Œè€Œäº§ç”Ÿçš„ç æµä¹Ÿè¶Šé•¿ã€‚ PSNR å…è®¸è®¡ç®—å³°å€¼ä¿¡å™ªæ¯”(PSNR,Peak signal-to-noise ratio),ç¼–ç ç»“æŸåŽåœ¨å±å¹•ä¸Šæ˜¾ç¤ºPSNRè®¡ç®—ç»“æžœã€‚å¼€å¯ä¸Žå¦ä¸Žè¾“å‡ºçš„è§†é¢‘è´¨é‡æ— å…³ï¼Œå…³é—­åŽä¼šå¸¦æ¥å¾®å°çš„é€Ÿåº¦æå‡ã€‚ profile level åˆ†åˆ«æ˜¯BPã€EPã€MPã€HPï¼š BP-Baseline Profileï¼šåŸºæœ¬ç”»è´¨ã€‚æ”¯æŒI/P å¸§ï¼Œåªæ”¯æŒæ— äº¤é”™ï¼ˆProgressiveï¼‰å’ŒCAVLCï¼› EP-Extended profileï¼šè¿›é˜¶ç”»è´¨ã€‚æ”¯æŒI/P/B/SP/SI å¸§ï¼Œåªæ”¯æŒæ— äº¤é”™ï¼ˆProgressiveï¼‰å’ŒCAVLCï¼› MP-Main profileï¼šä¸»æµç”»è´¨ã€‚æä¾›I/P/B å¸§ï¼Œæ”¯æŒæ— äº¤é”™ï¼ˆProgressiveï¼‰å’Œäº¤é”™ï¼ˆInterlacedï¼‰ï¼Œä¹Ÿæ”¯æŒCAVLC å’ŒCABAC çš„æ”¯æŒï¼› HP-High profileï¼šé«˜çº§ç”»è´¨ã€‚åœ¨main Profile çš„åŸºç¡€ä¸Šå¢žåŠ äº†8x8å†…éƒ¨é¢„æµ‹ã€è‡ªå®šä¹‰é‡åŒ–ã€æ— æŸè§†é¢‘ç¼–ç å’Œæ›´å¤šçš„YUV æ ¼å¼ï¼› H.264è§„å®šäº†ä¸‰ç§æ¡£æ¬¡ï¼Œæ¯ä¸ªæ¡£æ¬¡æ”¯æŒä¸€ç»„ç‰¹å®šçš„ç¼–ç åŠŸèƒ½ï¼Œå¹¶æ”¯æŒä¸€ç±»ç‰¹å®šçš„åº”ç”¨ã€‚ åŸºæœ¬æ¡£æ¬¡ï¼šåˆ©ç”¨Iç‰‡å’ŒPç‰‡æ”¯æŒå¸§å†…å’Œå¸§é—´ç¼–ç ï¼Œæ”¯æŒåˆ©ç”¨åŸºäºŽä¸Šä¸‹æ–‡çš„è‡ªé€‚åº”çš„å˜é•¿ç¼–ç è¿›è¡Œçš„ç†µç¼–ç ï¼ˆCAVLCï¼‰ã€‚ä¸»è¦ç”¨äºŽå¯è§†ç”µè¯ã€ä¼šè®®ç”µè§†ã€æ— çº¿é€šä¿¡ç­‰å®žæ—¶è§†é¢‘é€šä¿¡ï¼› ä¸»è¦æ¡£æ¬¡ï¼šæ”¯æŒéš”è¡Œè§†é¢‘ï¼Œé‡‡ç”¨Bç‰‡çš„å¸§é—´ç¼–ç å’Œé‡‡ç”¨åŠ æƒé¢„æµ‹çš„å¸§å†…ç¼–ç ï¼›æ”¯æŒåˆ©ç”¨åŸºäºŽä¸Šä¸‹æ–‡çš„è‡ªé€‚åº”çš„ç®—æœ¯ç¼–ç ï¼ˆCABACï¼‰ã€‚ä¸»è¦ç”¨äºŽæ•°å­—å¹¿æ’­ç”µè§†ä¸Žæ•°å­—è§†é¢‘å­˜å‚¨ï¼› æ‰©å±•æ¡£æ¬¡ï¼šæ”¯æŒç æµä¹‹é—´æœ‰æ•ˆçš„åˆ‡æ¢ï¼ˆSPå’ŒSIç‰‡ï¼‰ã€æ”¹è¿›è¯¯ç æ€§èƒ½ï¼ˆæ•°æ®åˆ†å‰²ï¼‰ï¼Œä½†ä¸æ”¯æŒéš”è¡Œè§†é¢‘å’ŒCABACã€‚ä¸»è¦ç”¨äºŽç½‘ç»œçš„è§†é¢‘æµï¼Œå¦‚è§†é¢‘ç‚¹æ’­ã€‚]]></content>
      <categories>
        <category>media</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Image Stride(å†…å­˜å›¾åƒè¡Œè·¨åº¦)]]></title>
    <url>%2F2017%2F06%2F27%2Fmedia-graphic-image-stride%2F</url>
    <content type="text"><![CDATA[When a video image is stored in memory, the memory buffer might contain extra padding bytes after each row of pixels. The padding bytes affect how the image is store in memory, but do not affect how the image is displayed. å½“è§†é¢‘å›¾åƒå­˜å‚¨åœ¨å†…å­˜æ—¶ï¼Œå›¾åƒçš„æ¯ä¸€è¡Œæœ«å°¾ä¹Ÿè®¸åŒ…å«ä¸€äº›æ‰©å±•çš„å†…å®¹ï¼Œè¿™äº›æ‰©å±•çš„å†…å®¹åªå½±å“å›¾åƒå¦‚ä½•å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä½†æ˜¯ä¸å½±å“å›¾åƒå¦‚ä½•æ˜¾ç¤ºå‡ºæ¥ï¼› The stride is the number of bytes from one row of pixels in memory to the next row of pixels in memory. Stride is also called pitch. If padding bytes are present, the stride is wider than the width of the image, as shown in the following illustration. Stride å°±æ˜¯è¿™äº›æ‰©å±•å†…å®¹çš„åç§°ï¼ŒStride ä¹Ÿè¢«ç§°ä½œ Pitchï¼Œå¦‚æžœå›¾åƒçš„æ¯ä¸€è¡Œåƒç´ æœ«å°¾æ‹¥æœ‰æ‰©å±•å†…å®¹ï¼ŒStride çš„å€¼ä¸€å®šå¤§äºŽå›¾åƒçš„å®½åº¦å€¼ï¼Œå°±åƒä¸‹å›¾æ‰€ç¤ºï¼š Two buffers that contain video frames with equal dimensions can have two different strides. If you process a video image, you must take into the stride into account. ä¸¤ä¸ªç¼“å†²åŒºåŒ…å«åŒæ ·å¤§å°ï¼ˆå®½åº¦å’Œé«˜åº¦ï¼‰çš„è§†é¢‘å¸§ï¼Œå´ä¸ä¸€å®šæ‹¥æœ‰åŒæ ·çš„ Stride å€¼ï¼Œå¦‚æžœä½ å¤„ç†ä¸€ä¸ªè§†é¢‘å¸§ï¼Œä½ å¿…é¡»åœ¨è®¡ç®—çš„æ—¶å€™æŠŠ Stride è€ƒè™‘è¿›åŽ»ï¼› In addition, there are two ways that an image can be arranged in memory. In a top-down image, the top row of pixels in the image appears first in memory. In a bottom-up image, the last row of pixels appears first in memory. The following illustration shows the difference between a top-down image and a bottom-up image. å¦å¤–ï¼Œä¸€å¼ å›¾åƒåœ¨å†…å­˜ä¸­æœ‰ä¸¤ç§ä¸åŒçš„å­˜å‚¨åºåˆ—ï¼ˆarrangedï¼‰ï¼Œå¯¹äºŽä¸€ä¸ªä»Žä¸Šè€Œä¸‹å­˜å‚¨ï¼ˆTop-Downï¼‰ çš„å›¾åƒï¼Œæœ€é¡¶è¡Œçš„åƒç´ ä¿å­˜åœ¨å†…å­˜ä¸­æœ€å¼€å¤´çš„éƒ¨åˆ†ï¼Œå¯¹äºŽä¸€å¼ ä»Žä¸‹è€Œä¸Šå­˜å‚¨ï¼ˆBottom-Upï¼‰çš„å›¾åƒï¼Œæœ€åŽä¸€è¡Œçš„åƒç´ ä¿å­˜åœ¨å†…å­˜ä¸­æœ€å¼€å¤´çš„éƒ¨åˆ†ï¼Œä¸‹é¢å›¾ç¤ºå±•ç¤ºäº†è¿™ä¸¤ç§æƒ…å†µï¼š A bottom-up image has a negative stride, because stride is defined as the number of bytes need to move down a row of pixels, relative to the displayed image. YUV images should always be top-down, and any image that is contained in a Direct3D surface must be top-down. RGB images in system memory are usually bottom-up. ä¸€å¼ ä»Žä¸‹è€Œä¸Šçš„å›¾åƒæ‹¥æœ‰ä¸€ä¸ªè´Ÿçš„ Stride å€¼ï¼Œå› ä¸º Stride è¢«å®šä¹‰ä¸º[ä»Žä¸€è¡Œåƒç´ ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œåƒç´ æ—¶éœ€è¦è·¨è¿‡å¤šå°‘ä¸ªåƒç´ ]ï¼Œä»…ç›¸å¯¹äºŽè¢«æ˜¾ç¤ºå‡ºæ¥çš„å›¾åƒè€Œè¨€ï¼›è€Œ YUV å›¾åƒæ°¸è¿œéƒ½æ˜¯ä»Žä¸Šè€Œä¸‹è¡¨ç¤ºçš„ï¼Œä»¥åŠä»»ä½•åŒ…å«åœ¨ Direct3D Surface ä¸­çš„å›¾åƒå¿…é¡»æ˜¯ä»Žä¸Šè€Œä¸‹ï¼ŒRGB å›¾åƒä¿å­˜åœ¨ç³»ç»Ÿå†…å­˜æ—¶é€šå¸¸æ˜¯ä»Žä¸‹è€Œä¸Šï¼› Video transforms in particular need to handle buffers with mismatched strides, because the input buffer might not match the output buffer. For example, suppose that you want to convert a source image and write the result to a destination image. Assume that both images have the same width and height, but might not have the same pixel format or the same image stride. å°¤å…¶æ˜¯è§†é¢‘å˜æ¢ï¼Œç‰¹åˆ«éœ€è¦å¤„ç†ä¸åŒ Stride å€¼çš„å›¾åƒï¼Œå› ä¸ºè¾“å…¥ç¼“å†²ä¹Ÿè®¸ä¸Žè¾“å‡ºç¼“å†²ä¸åŒ¹é…ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ æƒ³è¦å°†æºå›¾åƒè½¬æ¢å¹¶ä¸”å°†ç»“æžœå†™å…¥åˆ°ç›®æ ‡å›¾åƒï¼Œå‡è®¾ä¸¤ä¸ªå›¾åƒæ‹¥æœ‰ç›¸åŒçš„å®½åº¦å’Œé«˜åº¦ï¼Œä½†æ˜¯å…¶åƒç´ æ ¼å¼ä¸Ž Stride å€¼ä¹Ÿè®¸ä¸åŒï¼› The following example code shows a generalized approach for writing this kind of function. This is not a complete working example, because it abstracts many of the specific details. ä¸‹é¢ä»£ç æ¼”ç¤ºäº†ä¸€ç§é€šç”¨æ–¹æ³•æ¥ç¼–å†™è¿™ç§åŠŸèƒ½ï¼Œè¿™æ®µä»£ç å¹¶ä¸å®Œæ•´ï¼Œå› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„ç®—æ³•ï¼Œæ²¡æœ‰å®Œå…¨è€ƒè™‘åˆ°çœŸå®žéœ€æ±‚ä¸­çš„æ‰€æœ‰ç»†èŠ‚ï¼› 12345678910111213141516171819202122void ProcessVideoImage( BYTE* pDestScanLine0, LONG lDestStride, const BYTE* pSrcScanLine0, LONG lSrcStride, DWORD dwWidthInPixels, DWORD dwHeightInPixels )&#123; for (DWORD y = 0; y &lt; dwHeightInPixels; y++) &#123; SOURCE_PIXEL_TYPE *pSrcPixel = (SOURCE_PIXEL_TYPE*)pDestScanLine0; DEST_PIXEL_TYPE *pDestPixel = (DEST_PIXEL_TYPE*)pSrcScanLine0; for (DWORD x = 0; x &lt; dwWidthInPixels; x +=2) &#123; pDestPixel[x] = TransformPixelValue(pSrcPixel[x]); &#125; pDestScanLine0 += lDestStride; pSrcScanLine0 += lSrcStride; &#125;&#125; This function takes six parameters: A pointer to the start of scan line 0 in the destination image. The stride of the destination image. A pointer to the start of scan line 0 in the source image. The stride of the source image. The width of the image in pixels. The height of the image in pixels. è¿™ä¸ªå‡½æ•°éœ€è¦å…­ä¸ªå‚æ•°ï¼š ç›®æ ‡å›¾åƒçš„èµ·å§‹æ‰«æè¡Œçš„å†…å­˜æŒ‡é’ˆ ç›®æ ‡å›¾åƒçš„ Stride å€¼ æºå›¾åƒçš„èµ·å§‹æ‰«æè¡Œçš„å†…å­˜æŒ‡é’ˆ æºå›¾åƒçš„ Stride å€¼ å›¾åƒçš„å®½åº¦å€¼ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ å›¾åƒçš„é«˜åº¦å€¼ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ The general idea is to process one row at a time, iterating over each pixel in the row. Assume that SOURCE_PIXEL_TYPE and DEST_PIXEL_TYPE are structures representing the pixel layout for the source and destination images, respectively. (For example, 32-bit RGB uses the RGBQUAD structure. Not every pixel format has a pre-defined structure.) Casting the array pointer to the structure type enables you to access the RGB or YUV components of each pixel. At the start of each row, the function stores a pointer to the row. At the end of the row, it increments the pointer by the width of the image stride, which advances the pointer to the next row. è¿™é‡Œçš„è¦ç‚¹æ˜¯å¦‚ä½•ä¸€æ¬¡å¤„ç†ä¸€è¡Œåƒç´ ï¼ŒéåŽ†ä¸€è¡Œé‡Œé¢çš„æ¯ä¸€ä¸ªåƒç´ ï¼Œå‡è®¾æºåƒç´ ç±»åž‹ä¸Žç›®æ ‡åƒç´ ç±»åž‹å„è‡ªåœ¨åƒç´ çš„å±‚é¢ä¸Šå·²ç»ç»“æž„åŒ–æ¥è¡¨ç¤ºä¸€ä¸ªæºå›¾åƒä¸Žç›®æ ‡å›¾åƒçš„åƒç´ ï¼Œï¼ˆä¸¾ä¸ªä¾‹å­ï¼Œ32 ä½ RGB åƒç´ ä½¿ç”¨ RGBQUAD ç»“æž„ä½“ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ç§åƒç´ ç±»åž‹éƒ½æœ‰é¢„å®šä¹‰ç»“æž„ä½“çš„ï¼‰å¼ºåˆ¶è½¬æ¢æ•°ç»„æŒ‡é’ˆåˆ°è¿™æ ·çš„ç»“æž„ä½“æŒ‡é’ˆï¼Œå¯ä»¥æ–¹ä¾¿ä½ ç›´æŽ¥è¯»å†™æ¯ä¸€ä¸ªåƒç´ çš„ RGB æˆ–è€… YUV å€¼ï¼Œåœ¨æ¯ä¸€è¡Œçš„å¼€å¤´ï¼Œè¿™ä¸ªå‡½æ•°ä¿å­˜äº†ä¸€ä¸ªæŒ‡å‘è¿™è¡Œåƒç´ çš„æŒ‡é’ˆï¼Œå‡½æ•°çš„æœ€åŽä¸€è¡Œï¼Œé€šè¿‡å›¾åƒçš„ Stride å€¼ç›´æŽ¥å°†æŒ‡é’ˆè·³è½¬åˆ°å›¾åƒçš„ä¸‹ä¸€è¡Œåƒç´ çš„èµ·å§‹ç‚¹ï¼› This example calls a hypothetical function named TransformPixelValue for each pixel. This could be any function that calculates a target pixel from a source pixel. Of course, the exact details will depend on the particular task. For example, if you have a planar YUV format, you must access the chroma planes independently from the luma plane; with interlaced video, you might need to process the fields separately; and so forth. To give a more concrete example, the following code converts a 32-bit RGB image into an AYUV image. The RGB pixels are accessed using an RGBQUAD structure, and the AYUV pixels are accessed using aDXVA2_AYUVSample8 Structure structure. å¼•ç”¨: å¦‚æžœä½ ç”¨çš„æ˜¯ MSDN Library For Visual Studio 2008 SP1ï¼Œé‚£ä¹ˆä½ åº”è¯¥èƒ½å¤Ÿåœ¨ä¸‹é¢åœ°å€ä¸­æ‰¾åˆ°è¿™ç¯‡æ–‡ç« çš„åŽŸæ–‡ï¼š ms-help://MS.MSDNQTR.v90.chs/medfound/html/13cd1106-48b3-4522-ac09-8efbaab5c31d.htm http://blog.csdn.net/g0ose/article/details/52116453]]></content>
      <categories>
        <category>media</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OpenGLæ··è‰²]]></title>
    <url>%2F2017%2F06%2F27%2Fgl-glBlendFunc%2F</url>
    <content type="text"><![CDATA[æ··åˆå°±æ˜¯æŠŠä¸¤ç§é¢œè‰²æ··åœ¨ä¸€èµ·ã€‚å…·ä½“ä¸€ç‚¹ï¼Œå°±æ˜¯æŠŠæŸä¸€åƒç´ ä½ç½®åŽŸæ¥çš„é¢œè‰²å’Œå°†è¦ç”»ä¸ŠåŽ»çš„é¢œè‰²ï¼Œé€šè¿‡æŸç§æ–¹å¼æ··åœ¨ä¸€èµ·ï¼Œä»Žè€Œå®žçŽ°ç‰¹æ®Šçš„æ•ˆæžœã€‚ å‡è®¾æˆ‘ä»¬éœ€è¦ç»˜åˆ¶è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šé€è¿‡çº¢è‰²çš„çŽ»ç’ƒåŽ»çœ‹ç»¿è‰²çš„ç‰©ä½“ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆç»˜åˆ¶ç»¿è‰²çš„ç‰©ä½“ï¼Œå†ç»˜åˆ¶çº¢è‰²çŽ»ç’ƒã€‚åœ¨ç»˜åˆ¶çº¢è‰²çŽ»ç’ƒçš„æ—¶å€™ï¼Œåˆ©ç”¨â€œæ··åˆâ€åŠŸèƒ½ï¼ŒæŠŠå°†è¦ç»˜åˆ¶ä¸ŠåŽ»çš„çº¢è‰²å’ŒåŽŸæ¥çš„ç»¿è‰²è¿›è¡Œæ··åˆï¼ŒäºŽæ˜¯å¾—åˆ°ä¸€ç§æ–°çš„é¢œè‰²ï¼Œçœ‹ä¸ŠåŽ»å°±å¥½åƒçŽ»ç’ƒæ˜¯åŠé€æ˜Žçš„ã€‚ è¦ä½¿ç”¨OpenGLçš„æ··åˆåŠŸèƒ½ï¼Œåªéœ€è¦è°ƒç”¨ï¼šglEnable(GL_BLEND);å³å¯ã€‚è¦å…³é—­OpenGLçš„æ··åˆåŠŸèƒ½ï¼Œåªéœ€è¦è°ƒç”¨ï¼šglDisable(GL_BLEND);å³å¯ã€‚ æ³¨æ„ï¼š åªæœ‰åœ¨RGBAæ¨¡å¼ä¸‹ï¼Œæ‰å¯ä»¥ä½¿ç”¨æ··åˆåŠŸèƒ½ï¼Œé¢œè‰²ç´¢å¼•æ¨¡å¼ä¸‹æ˜¯æ— æ³•ä½¿ç”¨æ··åˆåŠŸèƒ½çš„ã€‚ 1.æºå› å­å’Œç›®æ ‡å› å­æ··åˆéœ€è¦æŠŠåŽŸæ¥çš„é¢œè‰²å’Œå°†è¦ç”»ä¸ŠåŽ»çš„é¢œè‰²æ‰¾å‡ºæ¥ï¼Œç»è¿‡æŸç§æ–¹å¼å¤„ç†åŽå¾—åˆ°ä¸€ç§æ–°çš„é¢œè‰²ã€‚è¿™é‡ŒæŠŠå°†è¦ç”»ä¸ŠåŽ»çš„é¢œè‰²ç§°ä¸ºâ€œæºé¢œè‰²â€ï¼ŒæŠŠåŽŸæ¥çš„é¢œè‰²ç§°ä¸ºâ€œç›®æ ‡é¢œè‰²â€ã€‚ OpenGL ä¼šæŠŠæºé¢œè‰²å’Œç›®æ ‡é¢œè‰²å„è‡ªå–å‡ºï¼Œå¹¶ä¹˜ä»¥ä¸€ä¸ªç³»æ•°ï¼ˆæºé¢œè‰²ä¹˜ä»¥çš„ç³»æ•°ç§°ä¸ºâ€œæºå› å­â€ï¼Œç›®æ ‡é¢œè‰²ä¹˜ä»¥çš„ç³»æ•°ç§°ä¸ºâ€œç›®æ ‡å› å­â€ï¼‰ï¼Œç„¶åŽç›¸åŠ ï¼Œè¿™æ ·å°±å¾—åˆ°äº†æ–°çš„é¢œ è‰²ã€‚ï¼ˆä¹Ÿå¯ä»¥ä¸æ˜¯ç›¸åŠ ï¼Œæ–°ç‰ˆæœ¬çš„OpenGLå¯ä»¥è®¾ç½®è¿ç®—æ–¹å¼ï¼ŒåŒ…æ‹¬åŠ ã€å‡ã€å–ä¸¤è€…ä¸­è¾ƒå¤§çš„ã€å–ä¸¤è€…ä¸­è¾ƒå°çš„ã€é€»è¾‘è¿ç®—ç­‰ï¼‰ ä¸‹é¢ç”¨æ•°å­¦å…¬å¼æ¥è¡¨è¾¾ä¸€ä¸‹è¿™ä¸ªè¿ç®—æ–¹å¼ã€‚å‡è®¾æºé¢œè‰²çš„å››ä¸ªåˆ†é‡ï¼ˆæŒ‡çº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²ï¼Œalphaå€¼ï¼‰æ˜¯(Rs, Gs, Bs, As)ï¼Œç›®æ ‡é¢œè‰²çš„å››ä¸ªåˆ†é‡æ˜¯(Rd, Gd, Bd, Ad)ï¼Œåˆè®¾æºå› å­ä¸º(Sr, Sg, Sb, Sa)ï¼Œç›®æ ‡å› å­ä¸º(Dr, Dg, Db, Da)ã€‚åˆ™æ··åˆäº§ç”Ÿçš„æ–°é¢œè‰²å¯ä»¥è¡¨ç¤ºä¸ºï¼š (Rs*Sr+Rd*Dr, Gs*Sg+Gd*Dg, Bs*Sb+Bd*Db, As*Sa+Ad*Da) å¦‚æžœé¢œè‰²çš„æŸä¸€åˆ†é‡è¶…è¿‡äº†1.0ï¼Œåˆ™å®ƒä¼šè¢«è‡ªåŠ¨æˆªå–ä¸º1.0ï¼Œä¸éœ€è¦è€ƒè™‘è¶Šç•Œçš„é—®é¢˜ã€‚ æºå› å­å’Œç›®æ ‡å› å­æ˜¯å¯ä»¥é€šè¿‡glBlendFuncå‡½æ•°æ¥è¿›è¡Œè®¾ç½®çš„ã€‚glBlendFuncæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå‰è€…è¡¨ç¤ºæºå› å­ï¼ŒåŽè€…è¡¨ç¤ºç›®æ ‡å› å­ã€‚è¿™ä¸¤ä¸ªå‚æ•°å¯ä»¥æ˜¯å¤šç§å€¼ï¼Œä¸‹é¢ä»‹ç»æ¯”è¾ƒå¸¸ç”¨çš„å‡ ç§ã€‚ GL_ZEROï¼šè¡¨ç¤ºä½¿ç”¨0.0ä½œä¸ºå› å­ï¼Œå®žé™…ä¸Šç›¸å½“äºŽä¸ä½¿ç”¨è¿™ç§é¢œè‰²å‚ä¸Žæ··åˆè¿ç®—ã€‚ GL_ONEï¼šè¡¨ç¤ºä½¿ç”¨1.0ä½œä¸ºå› å­ï¼Œå®žé™…ä¸Šç›¸å½“äºŽå®Œå…¨çš„ä½¿ç”¨äº†è¿™ç§é¢œè‰²å‚ä¸Žæ··åˆè¿ç®—ã€‚ GL_SRC_ALPHAï¼šè¡¨ç¤ºä½¿ç”¨æºé¢œè‰²çš„alphaå€¼æ¥ä½œä¸ºå› å­ã€‚ GL_DST_ALPHAï¼šè¡¨ç¤ºä½¿ç”¨ç›®æ ‡é¢œè‰²çš„alphaå€¼æ¥ä½œä¸ºå› å­ã€‚ GL_ONE_MINUS_SRC_ALPHAï¼šè¡¨ç¤ºç”¨1.0å‡åŽ»æºé¢œè‰²çš„alphaå€¼æ¥ä½œä¸ºå› å­ã€‚ GL_ONE_MINUS_DST_ALPHAï¼šè¡¨ç¤ºç”¨1.0å‡åŽ»ç›®æ ‡é¢œè‰²çš„alphaå€¼æ¥ä½œä¸ºå› å­ã€‚ GL_SRC_COLOR: æŠŠæºé¢œè‰²çš„å››ä¸ªåˆ†é‡åˆ†åˆ«ä½œä¸ºå› å­çš„å››ä¸ªåˆ†é‡ GL_ONE_MINUS_SRC_COLOR GL_DST_COLOR GL_ONE_MINUS_DST_COLOR GL_SRC_COLORä¸ŽGL_ONE_MINUS_SRC_COLORåœ¨OpenGLæ—§ç‰ˆæœ¬ä¸­åªèƒ½ç”¨äºŽè®¾ç½®ç›®æ ‡å› å­ï¼ŒGL_DST_COLORä¸ŽGL_ONE_MINUS_DST_COLORåœ¨OpenGL æ—§ç‰ˆæœ¬ä¸­åªèƒ½ç”¨äºŽè®¾ç½®æºå› å­ã€‚æ–°ç‰ˆæœ¬çš„OpenGLåˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œå¹¶ä¸”æ”¯æŒæ–°çš„GL_CONST_COLORï¼ˆè®¾å®šä¸€ç§å¸¸æ•°é¢œè‰²ï¼Œå°†å…¶å››ä¸ªåˆ†é‡åˆ†åˆ«ä½œä¸º å› å­çš„å››ä¸ªåˆ†é‡ï¼‰ã€GL_ONE_MINUS_CONST_COLORã€GL_CONST_ALPHAã€ GL_ONE_MINUS_CONST_ALPHAã€‚å¦å¤–è¿˜æœ‰GL_SRC_ALPHA_SATURATEã€‚æ–°ç‰ˆæœ¬çš„OpenGLè¿˜å…è®¸é¢œè‰²çš„alpha å€¼å’ŒRGBå€¼é‡‡ç”¨ä¸åŒçš„æ··åˆå› å­ã€‚ 2.æ¨¡å¼ç¤ºä¾‹ å¦‚æžœè®¾ç½®äº†glBlendFunc(GL_ONE, GL_ZERO);ï¼Œåˆ™è¡¨ç¤ºå®Œå…¨ä½¿ç”¨æºé¢œè‰²ï¼Œå®Œå…¨ä¸ä½¿ç”¨ç›®æ ‡é¢œè‰²ï¼Œå› æ­¤ç”»é¢æ•ˆæžœå’Œä¸ä½¿ç”¨æ··åˆçš„æ—¶å€™ä¸€è‡´ï¼ˆå½“ç„¶æ•ˆçŽ‡å¯èƒ½ä¼šä½Žä¸€ç‚¹ç‚¹ï¼‰ã€‚å¦‚æžœæ²¡æœ‰è®¾ç½®æºå› å­å’Œç›®æ ‡å› å­ï¼Œåˆ™é»˜è®¤æƒ…å†µå°±æ˜¯è¿™æ ·çš„è®¾ç½®ã€‚ å¦‚æžœè®¾ç½®äº†glBlendFunc(GL_ZERO, GL_ONE);ï¼Œåˆ™è¡¨ç¤ºå®Œå…¨ä¸ä½¿ç”¨æºé¢œè‰²ï¼Œå› æ­¤æ— è®ºä½ æƒ³ç”»ä»€ä¹ˆï¼Œæœ€åŽéƒ½ä¸ä¼šè¢«ç”»ä¸ŠåŽ»äº†ã€‚ï¼ˆä½†è¿™å¹¶ä¸æ˜¯è¯´è¿™æ ·è®¾ç½®å°±æ²¡æœ‰ç”¨ï¼Œæœ‰äº›æ—¶å€™å¯èƒ½æœ‰ç‰¹æ®Šç”¨é€”ï¼‰ å¦‚æžœè®¾ç½®äº†glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);ï¼Œåˆ™è¡¨ç¤ºæºé¢œè‰²ä¹˜ä»¥è‡ªèº«çš„alpha å€¼ï¼Œç›®æ ‡é¢œè‰²ä¹˜ä»¥1.0å‡åŽ»æºé¢œè‰²çš„alphaå€¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæºé¢œè‰²çš„alphaå€¼è¶Šå¤§ï¼Œåˆ™äº§ç”Ÿçš„æ–°é¢œè‰²ä¸­æºé¢œè‰²æ‰€å æ¯”ä¾‹å°±è¶Šå¤§ï¼Œè€Œç›®æ ‡é¢œè‰²æ‰€å æ¯”ä¾‹åˆ™å‡ å°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„å°†æºé¢œè‰²çš„alphaå€¼ç†è§£ä¸ºâ€œä¸é€æ˜Žåº¦â€ã€‚è¿™ä¹Ÿæ˜¯æ··åˆæ—¶æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚ å¦‚æžœè®¾ç½®äº†glBlendFunc(GL_ONE, GL_ONE);ï¼Œåˆ™è¡¨ç¤ºå®Œå…¨ä½¿ç”¨æºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ï¼Œæœ€ç»ˆçš„é¢œè‰²å®žé™…ä¸Šå°±æ˜¯ä¸¤ç§é¢œè‰²çš„ç®€å•ç›¸åŠ ã€‚ä¾‹å¦‚çº¢è‰²(1, 0, 0)å’Œç»¿è‰²(0, 1, 0)ç›¸åŠ å¾—åˆ°(1, 1, 0)ï¼Œç»“æžœä¸ºé»„è‰²ã€‚ æ³¨æ„ï¼š æ‰€è°“æºé¢œè‰²å’Œç›®æ ‡é¢œè‰²ï¼Œæ˜¯è·Ÿç»˜åˆ¶çš„é¡ºåºæœ‰å…³çš„ã€‚å‡å¦‚å…ˆç»˜åˆ¶äº†ä¸€ä¸ªçº¢è‰²çš„ç‰©ä½“ï¼Œå†åœ¨å…¶ä¸Šç»˜åˆ¶ç»¿è‰²çš„ç‰©ä½“ã€‚åˆ™ç»¿è‰²æ˜¯æºé¢œè‰²ï¼Œçº¢è‰²æ˜¯ç›®æ ‡é¢œè‰²ã€‚å¦‚æžœé¡ºåºåè¿‡æ¥ï¼Œåˆ™ çº¢è‰²å°±æ˜¯æºé¢œè‰²ï¼Œç»¿è‰²æ‰æ˜¯ç›®æ ‡é¢œè‰²ã€‚åœ¨ç»˜åˆ¶æ—¶ï¼Œåº”è¯¥æ³¨æ„é¡ºåºï¼Œä½¿å¾—ç»˜åˆ¶çš„æºé¢œè‰²ä¸Žè®¾ç½®çš„æºå› å­å¯¹åº”ï¼Œç›®æ ‡é¢œè‰²ä¸Žè®¾ç½®çš„ç›®æ ‡å› å­å¯¹åº”ã€‚ 3.å¯¹ä¸¤ç§ç¤ºä¾‹æ¨¡å¼çš„å…·ä½“è§£é‡Š:æ¨¡å¼ä¸€: 12GLES20.glEnable(GLES20.GL_BLEND); GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE_MINUS_SRC_ALPHA); æ¨¡å¼äºŒ: 12GLES20.glEnable(GLES20.GL_BLEND); GLES20.glBlendFunc(GLES20.GL_ONE, GLES20.GL_ONE_MINUS_SRC_ALPHA); æ¨¡å¼ä¸€æ˜¯ä¼ ç»Ÿçš„alphaé€šé“æ··åˆï¼Œè¿™ç§æ¨¡å¼ä¸‹é¢œè‰²å’Œalphaå€¼æ˜¯åˆ†ç«‹çš„ï¼Œrgbå†³å®šé¢œè‰²ï¼Œalphaå†³å®š..ï¼ˆè‹±æ–‡æ˜¯å†³å®šhow solid it is æ°´å¹³æœ‰é™æ‰¾ä¸åˆ°å‡†ç¡®çš„ä¸­æ–‡æ¥è¡¨è¾¾ï¼‰ åœ¨æ•°å­¦ä¸Šè¡¨è¾¾å¼æ˜¯ï¼šblend(source, dest) = (source.rgb * source.a) + (dest.rgb * (1 â€“ source.a)).è¦æ³¨æ„çš„æ˜¯è¿™ç§æ¨¡å¼ä¸‹ï¼Œé€æ˜Žåªè·Ÿalphaæœ‰å…³ï¼Œè·Ÿrgbå€¼æ— å…³ï¼Œä¸€ä¸ªé€æ˜Žçš„é¢œè‰²ï¼Œä¸é€æ˜Žçš„é¢œè‰²æœ‰ç›¸åŒçš„rgbå€¼ï¼Œåªè¦alpha=0å³å¯ã€‚ æ¨¡å¼äºŒæ˜¯alphaé¢„ä¹˜çš„æ··åˆï¼ˆPremultiplied Alpha Blendingï¼‰ï¼Œè¿™ç§æ¨¡å¼ä¸‹rgbä¸Žalphaæ˜¯è”ç³»åœ¨ä¸€èµ·çš„ï¼Œæ•°å­¦ä¸Šçš„è¡¨è¾¾å¼æ˜¯ blend(source, dest) = source.rgb + (dest.rgb * (1 â€“ source.a)),åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œé€æ˜Žçš„è¡¨ç¤ºæ˜¯rgbå€¼éƒ½ä¸º0. 4.EGLSurfaceèƒŒæ™¯é€æ˜Žè®¾ç½®åœ¨OpenGLç»˜åˆ¶ä¸­,é™¤äº†è®¾ç½®æ··è‰²å¤–,è¿˜è¦è®¾ç½®EGLSurfaceé…ç½®æ”¯æŒAlpha,å¦‚æžœä¸è®¾ç½®EGLç›¸å…³çš„EGLSurfaceæ”¯æŒé€æ˜Ž,å°±ç®—OpenGLå‡½æ•°ä¸­å¼€å¯æ··è‰²,ç»˜åˆ¶å®ŒæˆåŽä»æ˜¯æœ‰é»‘è‰²èƒŒæ™¯. 4.1GLSurfaceViewåœ¨onSurfaceCreatedé‡Œï¼Œè°ƒç”¨GLES20.glClearColor(0f, 0f, 0f, 0f);alphaä¸º0ï¼Œå³é€æ˜Žã€‚ ç„¶åŽï¼Œå¯¹surfaceviewè¦ä½œä¸€å®šå¤„ç†ï¼š 12345mGLSurfaceView.setEGLConfigChooser(8, 8, 8, 8, 16, 0);TestRenderer renderer = new TestRenderer();mGLSurfaceView.setRender(renderer);mGLSurfaceView.getHolder().setFormat(PixelFormat.TRANSLUCENT);mGLSurfaceView.setZOrderOnTop(true); 4.2SurfaceTextureæˆ–Surfaceæž„é€ çš„SurfaceEGL14.eglChooseConfigä¸­configæ•°ç»„å¢žåŠ EGL10.EGL_ALPHA_SIZEé…ç½®: 12345678int[] CONFIG_RGBA = &#123; EGL10.EGL_RED_SIZE, 8, EGL10.EGL_GREEN_SIZE, 8, EGL10.EGL_BLUE_SIZE, 8, EGL10.EGL_ALPHA_SIZE, 8, EGL10.EGL_RENDERABLE_TYPE, EGL_OPENGL_ES2_BIT, EGL10.EGL_NONE &#125;; 5.å®žçŽ°ä¸‰ç»´æ··åˆåœ¨è¿›è¡Œä¸‰ç»´åœºæ™¯çš„æ··åˆæ—¶å¿…é¡»æ³¨æ„çš„æ˜¯æ·±åº¦ç¼“å†²ã€‚ æ·±åº¦ç¼“å†²æ˜¯è¿™æ ·ä¸€æ®µæ•°æ®ï¼Œå®ƒè®°å½•äº†æ¯ä¸€ä¸ªåƒç´ è·ç¦»è§‚å¯Ÿè€…æœ‰å¤šè¿‘ã€‚åœ¨å¯ç”¨æ·±åº¦ç¼“å†²æµ‹è¯•çš„æƒ…å†µä¸‹ï¼Œå¦‚æžœå°†è¦ç»˜åˆ¶çš„åƒç´ æ¯”åŽŸæ¥çš„åƒç´ æ›´è¿‘ï¼Œåˆ™åƒç´ å°†è¢«ç»˜åˆ¶ã€‚å¦åˆ™,åƒç´ å°±ä¼šè¢«å¿½ç•¥æŽ‰ï¼Œä¸è¿›è¡Œç»˜åˆ¶ã€‚è¿™åœ¨ç»˜åˆ¶ä¸é€æ˜Žçš„ç‰©ä½“æ—¶éžå¸¸æœ‰ç”¨â€”â€”ä¸ç®¡æ˜¯å…ˆç»˜åˆ¶è¿‘çš„ç‰©ä½“å†ç»˜åˆ¶è¿œçš„ç‰©ä½“ï¼Œè¿˜æ˜¯å…ˆç»˜åˆ¶è¿œçš„ç‰©ä½“å†ç»˜åˆ¶è¿‘çš„ç‰©ä½“ï¼Œæˆ–è€…å¹²è„†ä»¥ æ··ä¹±çš„é¡ºåºè¿›è¡Œç»˜åˆ¶ï¼Œæœ€åŽçš„æ˜¾ç¤ºç»“æžœæ€»æ˜¯è¿‘çš„ç‰©ä½“é®ä½è¿œçš„ç‰©ä½“ã€‚ ç„¶è€Œåœ¨ä½ éœ€è¦å®žçŽ°åŠé€æ˜Žæ•ˆæžœæ—¶ï¼Œå‘çŽ°ä¸€åˆ‡éƒ½ä¸æ˜¯é‚£ä¹ˆç¾Žå¥½äº†ã€‚å¦‚æžœä½ ç»˜åˆ¶äº†ä¸€ä¸ªè¿‘è·ç¦»çš„åŠé€æ˜Žç‰©ä½“ï¼Œåˆ™å®ƒåœ¨æ·±åº¦ç¼“å†²åŒºå†…ä¿ç•™äº†ä¸€äº›ä¿¡æ¯ï¼Œä½¿å¾—è¿œå¤„çš„ç‰©ä½“å°†æ— æ³•å†è¢«ç»˜åˆ¶å‡ºæ¥ã€‚è™½ç„¶åŠé€æ˜Žçš„ç‰©ä½“ä»ç„¶åŠé€æ˜Žï¼Œä½†é€è¿‡å®ƒçœ‹åˆ°çš„å´ä¸æ˜¯æ­£ç¡®çš„å†…å®¹äº†ã€‚ è¦ è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œéœ€è¦åœ¨ç»˜åˆ¶åŠé€æ˜Žç‰©ä½“æ—¶å°†æ·±åº¦ç¼“å†²åŒºè®¾ç½®ä¸ºåªè¯»ï¼Œè¿™æ ·ä¸€æ¥ï¼Œè™½ç„¶åŠé€æ˜Žç‰©ä½“è¢«ç»˜åˆ¶ä¸ŠåŽ»äº†ï¼Œæ·±åº¦ç¼“å†²åŒºè¿˜ä¿æŒåœ¨åŽŸæ¥çš„çŠ¶æ€ã€‚å¦‚æžœå†æœ‰ä¸€ä¸ªç‰©ä½“ å‡ºçŽ°åœ¨åŠé€æ˜Žç‰©ä½“ä¹‹åŽï¼Œåœ¨ä¸é€æ˜Žç‰©ä½“ä¹‹å‰ï¼Œåˆ™å®ƒä¹Ÿå¯ä»¥è¢«ç»˜åˆ¶ï¼ˆå› ä¸ºæ­¤æ—¶æ·±åº¦ç¼“å†²åŒºä¸­è®°å½•çš„æ˜¯é‚£ä¸ªä¸é€æ˜Žç‰©ä½“çš„æ·±åº¦ï¼‰ã€‚ä»¥åŽå†è¦ç»˜åˆ¶ä¸é€æ˜Žç‰©ä½“æ—¶ï¼Œåªéœ€è¦å† å°†æ·±åº¦ç¼“å†²åŒºè®¾ç½®ä¸ºå¯è¯»å¯å†™çš„å½¢å¼å³å¯ã€‚æ€Žä¹ˆç»˜åˆ¶ä¸€ä¸ªä¸€éƒ¨åˆ†åŠé€æ˜Žä¸€éƒ¨åˆ†ä¸é€æ˜Žçš„ç‰©ä½“ï¼Ÿè¿™ä¸ªå¥½åŠžï¼Œåªéœ€è¦æŠŠç‰©ä½“åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†å…¨æ˜¯åŠé€æ˜Ž çš„ï¼Œä¸€éƒ¨åˆ†å…¨æ˜¯ä¸é€æ˜Žçš„ï¼Œåˆ†åˆ«ç»˜åˆ¶å°±å¯ä»¥äº†ã€‚ å³ä½¿ä½¿ç”¨äº†ä»¥ä¸ŠæŠ€å·§ï¼Œæˆ‘ä»¬ä»ç„¶ä¸èƒ½éšå¿ƒæ‰€æ¬²çš„æŒ‰ç…§æ··ä¹±é¡ºåºæ¥è¿›è¡Œç»˜åˆ¶ã€‚å¿…é¡»æ˜¯å…ˆç»˜åˆ¶ä¸é€æ˜Žçš„ç‰©ä½“ï¼Œç„¶ åŽç»˜åˆ¶é€æ˜Žçš„ç‰©ä½“ã€‚å¦åˆ™ï¼Œå‡è®¾èƒŒæ™¯ä¸ºè“è‰²ï¼Œè¿‘å¤„ä¸€å—çº¢è‰²çŽ»ç’ƒï¼Œä¸­é—´ä¸€ä¸ªç»¿è‰²ç‰©ä½“ã€‚å¦‚æžœå…ˆç»˜åˆ¶çº¢è‰²åŠé€æ˜ŽçŽ»ç’ƒçš„è¯ï¼Œå®ƒå…ˆå’Œè“è‰²èƒŒæ™¯è¿›è¡Œæ··åˆï¼Œåˆ™ä»¥åŽç»˜åˆ¶ä¸­é—´ çš„ç»¿è‰²ç‰©ä½“æ—¶ï¼Œæƒ³å•ç‹¬ä¸Žçº¢è‰²çŽ»ç’ƒæ··åˆå·²ç»ä¸èƒ½å®žçŽ°äº†ã€‚ æ€»ç»“èµ·æ¥ï¼Œç»˜åˆ¶é¡ºåºå°±æ˜¯ï¼šé¦–å…ˆç»˜åˆ¶æ‰€æœ‰ä¸é€æ˜Žçš„ç‰©ä½“ã€‚å¦‚æžœä¸¤ä¸ªç‰©ä½“éƒ½æ˜¯ä¸é€æ˜Žçš„ï¼Œåˆ™è°å…ˆè°åŽ éƒ½æ²¡æœ‰å…³ç³»ã€‚ç„¶åŽï¼Œå°†æ·±åº¦ç¼“å†²åŒºè®¾ç½®ä¸ºåªè¯»ã€‚æŽ¥ä¸‹æ¥ï¼Œç»˜åˆ¶æ‰€æœ‰åŠé€æ˜Žçš„ç‰©ä½“ã€‚å¦‚æžœä¸¤ä¸ªç‰©ä½“éƒ½æ˜¯åŠé€æ˜Žçš„ï¼Œåˆ™è°å…ˆè°åŽåªéœ€è¦æ ¹æ®è‡ªå·±çš„æ„æ„¿ï¼ˆæ³¨æ„äº†ï¼Œå…ˆç»˜åˆ¶ çš„å°†æˆä¸ºâ€œç›®æ ‡é¢œè‰²â€ï¼ŒåŽç»˜åˆ¶çš„å°†æˆä¸ºâ€œæºé¢œè‰²â€ï¼Œæ‰€ä»¥ç»˜åˆ¶çš„é¡ºåºå°†ä¼šå¯¹ç»“æžœé€ æˆä¸€äº›å½±å“ï¼‰ã€‚æœ€åŽï¼Œå°†æ·±åº¦ç¼“å†²åŒºè®¾ç½®ä¸ºå¯è¯»å¯å†™å½¢å¼ã€‚ è°ƒç”¨glDepthMask(GL_FALSE);å¯å°†æ·±åº¦ç¼“å†²åŒºè®¾ç½®ä¸ºåªè¯»å½¢å¼ã€‚è°ƒç”¨glDepthMask(GL_TRUE);å¯å°†æ·±åº¦ç¼“å†²åŒºè®¾ç½®ä¸ºå¯è¯»å¯å†™å½¢å¼ã€‚ glBlendFuncå‡½æ•°å®˜ç½‘æ–‡æ¡£]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>OpenGL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[androidç³»ç»Ÿç¼–ç MediaCodec]]></title>
    <url>%2F2017%2F06%2F25%2Ftips-android-mediacodec%2F</url>
    <content type="text"><![CDATA[androidç¼–ç å™¨å±€é™æ€§1. é¢œè‰²æ ¼å¼é—®é¢˜MediaCodecåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œåœ¨configureçš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªMediaFormatå¯¹è±¡ï¼Œå½“ä½œä¸ºç¼–ç å™¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦åœ¨MediaFormatä¸­æŒ‡å®šè§†é¢‘çš„å®½é«˜ï¼Œå¸§çŽ‡ï¼Œç çŽ‡ï¼ŒIå¸§é—´éš”ç­‰åŸºæœ¬ä¿¡æ¯ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä¿¡æ¯å°±æ˜¯ï¼ŒæŒ‡å®šç¼–ç å™¨æŽ¥å—çš„YUVå¸§çš„é¢œè‰²æ ¼å¼ã€‚è¿™ä¸ªæ˜¯å› ä¸ºç”±äºŽYUVæ ¹æ®å…¶é‡‡æ ·æ¯”ä¾‹ï¼ŒUVåˆ†é‡çš„æŽ’åˆ—é¡ºåºæœ‰å¾ˆå¤šç§ä¸åŒçš„é¢œè‰²æ ¼å¼ï¼Œè€Œå¯¹äºŽAndroidçš„æ‘„åƒå¤´åœ¨onPreviewFrameè¾“å‡ºçš„YUVå¸§æ ¼å¼ï¼Œå¦‚æžœæ²¡æœ‰é…ç½®ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯NV21æ ¼å¼ï¼Œä½†Googleå¯¹MediaCodecçš„APIåœ¨è®¾è®¡å’Œè§„èŒƒçš„æ—¶å€™ï¼Œæ˜¾å¾—å¾ˆä¸åŽšé“ï¼Œè¿‡äºŽè´´è¿‘Androidçš„HALå±‚äº†ï¼Œå¯¼è‡´äº†NV21æ ¼å¼å¹¶ä¸æ˜¯æ‰€æœ‰æœºå™¨çš„MediaCodecéƒ½æ”¯æŒè¿™ç§æ ¼å¼ä½œä¸ºç¼–ç å™¨çš„è¾“å…¥æ ¼å¼ï¼ å› æ­¤ï¼Œåœ¨åˆå§‹åŒ–MediaCodecçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡codecInfo.getCapabilitiesForTypeæ¥æŸ¥è¯¢æœºå™¨ä¸Šçš„MediaCodecå®žçŽ°å…·ä½“æ”¯æŒå“ªäº›YUVæ ¼å¼ä½œä¸ºè¾“å…¥æ ¼å¼ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œèµ·ç åœ¨4.4+çš„ç³»ç»Ÿä¸Šï¼Œè¿™ä¸¤ç§æ ¼å¼åœ¨å¤§éƒ¨åˆ†æœºå™¨éƒ½æœ‰æ”¯æŒï¼š 12MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420PlannderMediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420SemiPlannder ä¸¤ç§æ ¼å¼åˆ†åˆ«æ˜¯YUV420På’ŒNV21ï¼Œå¦‚æžœæœºå™¨ä¸Šåªæ”¯æŒYUV420Pæ ¼å¼çš„æƒ…å†µä¸‹ï¼Œåˆ™éœ€è¦å…ˆå°†æ‘„åƒå¤´è¾“å‡ºçš„NV21æ ¼å¼å…ˆè½¬æ¢æˆYUV420Pï¼Œæ‰èƒ½é€å…¥ç¼–ç å™¨è¿›è¡Œç¼–ç ï¼Œå¦åˆ™æœ€ç»ˆå‡ºæ¥çš„è§†é¢‘å°±ä¼šèŠ±å±ï¼Œæˆ–è€…é¢œè‰²å‡ºçŽ°é”™ä¹± è¿™ä¸ªç®—æ˜¯ä¸€ä¸ªä¸å¤§ä¸å°çš„å‘ï¼ŒåŸºæœ¬ä¸Šç”¨ä¸Šäº†MediaCodecè¿›è¡Œè§†é¢‘ç¼–ç éƒ½ä¼šé‡ä¸Šè¿™ä¸ªé—®é¢˜ 2. ç¼–ç å™¨æ”¯æŒç‰¹æ€§ç›¸å½“æœ‰é™å¦‚æžœä½¿ç”¨MediaCodecæ¥ç¼–ç H264è§†é¢‘æµï¼Œå¯¹äºŽH264æ ¼å¼æ¥è¯´ï¼Œä¼šæœ‰ä¸€äº›é’ˆå¯¹åŽ‹ç¼©çŽ‡ä»¥åŠç çŽ‡ç›¸å…³çš„è§†é¢‘è´¨é‡è®¾ç½®ï¼Œå…¸åž‹çš„è¯¸å¦‚Profile(baseline, main, high)ï¼ŒProfile Level, Bitrate mode(CBR, CQ, VBR)ï¼Œåˆç†é…ç½®è¿™äº›å‚æ•°å¯ä»¥è®©æˆ‘ä»¬åœ¨åŒç­‰çš„ç çŽ‡ä¸‹ï¼ŒèŽ·å¾—æ›´é«˜çš„åŽ‹ç¼©çŽ‡ï¼Œä»Žè€Œæå‡è§†é¢‘çš„è´¨é‡ï¼ŒAndroidä¹Ÿæä¾›äº†å¯¹åº”çš„APIè¿›è¡Œè®¾ç½®ï¼Œå¯ä»¥è®¾ç½®åˆ°MediaFormatä¸­è¿™äº›è®¾ç½®é¡¹: 123MediaFormat.KEY_BITRATE_MODEMediaFormat.KEY_PROFILEMediaFormat.KEY_LEVEL ä½†é—®é¢˜æ˜¯ï¼Œå¯¹äºŽProfileï¼ŒLevel, Bitrate modeè¿™äº›è®¾ç½®ï¼Œåœ¨å¤§éƒ¨åˆ†æ‰‹æœºä¸Šéƒ½æ˜¯ä¸æ”¯æŒçš„ï¼Œå³ä½¿æ˜¯è®¾ç½®äº†æœ€ç»ˆä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œä¾‹å¦‚è®¾ç½®äº†Profileä¸ºhighï¼Œæœ€åŽå‡ºæ¥çš„è§†é¢‘ä¾ç„¶è¿˜ä¼šæ˜¯Baselineâ€¦. è¿™ä¸ªé—®é¢˜ï¼Œåœ¨7.0ä»¥ä¸‹çš„æœºå™¨å‡ ä¹Žæ˜¯å¿…çŽ°çš„ï¼Œå…¶ä¸­ä¸€ä¸ªå¯èƒ½çš„åŽŸå› æ˜¯ï¼ŒAndroidåœ¨æºç å±‚çº§hardcodeäº†profileçš„çš„è®¾ç½®ï¼š 12345//XXXXif(h264type.eProfile != OMX_VIDEO_AVCProfileBaseline)&#123; ALOGW(&quot;Use baseline profile instead of %d for AVC recording&quot;, h264type.eProfile); h264type.eProfile = OMX_VIDEO_AVCProfileBaseline;&#125; Androidç›´åˆ°7.0ä¹‹åŽæ‰å–æ¶ˆäº†è¿™æ®µåœ°æ–¹çš„Hardcode: 123456if(h264type.eProfile == OMX_VIDEO_AVCProfileBaseline)&#123; ....&#125;else if(h264type.eProfile == OMX_VIDEO_AVCProfileMain || h264type.eProfile == OMX_VIDEO_AVCProfileBaseHigh) .....&#125; è¿™ä¸ªé—®é¢˜å¯ä»¥è¯´é—´æŽ¥å¯¼è‡´äº†MediaCodecç¼–ç å‡ºæ¥çš„è§†é¢‘è´¨é‡åä½Žï¼ŒåŒç­‰ç çŽ‡ä¸‹ï¼Œéš¾ä»¥èŽ·å¾—è·Ÿè½¯ç¼–ç ç”šè‡³iOSé‚£æ ·çš„è§†é¢‘è´¨é‡ã€‚ 3. 16ä½å¯¹é½è¦æ±‚å‰é¢è¯´åˆ°ï¼ŒMediaCodecè¿™ä¸ªAPIåœ¨è®¾è®¡çš„æ—¶å€™ï¼Œè¿‡äºŽè´´è¿‘HALå±‚ï¼Œè¿™åœ¨å¾ˆå¤šSocçš„å®žçŽ°ä¸Šï¼Œæ˜¯ç›´æŽ¥æŠŠä¼ å…¥MediaCodecçš„bufferï¼Œåœ¨ä¸ç»è¿‡ä»»ä½•å‰ç½®å¤„ç†çš„æƒ…å†µä¸‹å°±ç›´æŽ¥é€å…¥äº†Socä¸­ã€‚è€Œåœ¨ç¼–ç h264è§†é¢‘æµçš„æ—¶å€™ï¼Œç”±äºŽh264çš„ç¼–ç å—å¤§å°ä¸€èˆ¬æ˜¯16x16ï¼ŒäºŽæ˜¯ä¹Žåœ¨ä¸€å¼€å§‹è®¾ç½®è§†é¢‘çš„å®½é«˜çš„æ—¶å€™ï¼Œå¦‚æžœè®¾ç½®äº†ä¸€ä¸ªæ²¡æœ‰å¯¹é½16çš„å¤§å°ï¼Œä¾‹å¦‚960x540ï¼Œåœ¨æŸäº›cpuä¸Šï¼Œæœ€ç»ˆç¼–ç å‡ºæ¥çš„è§†é¢‘å°±ä¼šç›´æŽ¥èŠ±å±ï¼ å¾ˆæ˜Žæ˜¾è¿™è¿˜æ˜¯å› ä¸ºåŽ‚å•†åœ¨å®žçŽ°è¿™ä¸ªAPIçš„æ—¶å€™ï¼Œå¯¹ä¼ å…¥çš„æ•°æ®ç¼ºå°‘æ ¡éªŒä»¥åŠå‰ç½®å¤„ç†å¯¼è‡´çš„ï¼Œç›®å‰æ¥çœ‹ï¼ŒåŽä¸ºï¼Œä¸‰æ˜Ÿçš„Socå‡ºçŽ°è¿™ä¸ªé—®é¢˜ä¼šæ¯”è¾ƒé¢‘ç¹ï¼Œå…¶ä»–åŽ‚å•†çš„ä¸€äº›æ—©æœŸSocä¹Ÿæœ‰è¿™ç§é—®é¢˜ï¼Œä¸€èˆ¬æ¥è¯´è§£å†³æ–¹æ³•è¿˜æ˜¯åœ¨è®¾ç½®è§†é¢‘å®½é«˜çš„æ—¶å€™ï¼Œç»Ÿä¸€è®¾ç½®æˆå¯¹é½16ä½ä¹‹åŽçš„å¤§å°å°±å¥½äº†ã€‚ 4.è½¯ç¼–è§£ç ä»‹ç»é™¤äº†ä½¿ç”¨MediaCodecè¿›è¡Œç¼–ç ä¹‹å¤–ï¼Œå¦å¤–ä¸€ç§æ¯”è¾ƒæµè¡Œçš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ffmpeg+x264/openh264è¿›è¡Œè½¯ç¼–ç ï¼Œffmpegæ˜¯ç”¨äºŽä¸€äº›è§†é¢‘å¸§çš„é¢„å¤„ç†ã€‚è¿™é‡Œä¸»è¦æ˜¯ä½¿ç”¨x264/openh264ä½œä¸ºè§†é¢‘çš„ç¼–ç å™¨ã€‚ x264åŸºæœ¬ä¸Šè¢«è®¤ä¸ºæ˜¯å½“ä»Šå¸‚é¢ä¸Šæœ€å¿«çš„å•†ç”¨è§†é¢‘ç¼–ç å™¨ï¼Œè€Œä¸”åŸºæœ¬ä¸Šæ‰€æœ‰h264çš„ç‰¹æ€§éƒ½æ”¯æŒï¼Œé€šè¿‡åˆç†é…ç½®å„ç§å‚æ•°è¿˜æ˜¯èƒ½å¤Ÿå¾—åˆ°è¾ƒå¥½çš„åŽ‹ç¼©çŽ‡å’Œç¼–ç é€Ÿåº¦çš„ï¼Œé™äºŽç¯‡å¹…ï¼Œè¿™é‡Œä¸å†é˜è¿°h264çš„å‚æ•°é…ç½®ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸‹è¿™ä¸¤ç¯‡æ–‡ç« å¯¹x264ç¼–ç å‚æ•°çš„è°ƒä¼˜ï¼š https://www.nmm-hd.org/d/index.php?title=X264%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D&amp;variant=zh-cn http://www.cnblogs.com/wainiwann/p/5647521.html openh264(https://github.com/cisco/openh264)åˆ™æ˜¯ç”±æ€ç§‘å¼€æºçš„å¦å¤–ä¸€ä¸ªh264ç¼–ç å™¨ï¼Œé¡¹ç›®åœ¨2013å¹´å¼€æºï¼Œå¯¹æ¯”èµ·x264æ¥è¯´ç•¥æ˜¾å¹´è½»ï¼Œä¸è¿‡ç”±äºŽæ€ç§‘æ”¯ä»˜æ»¡äº†h264çš„å¹´åº¦ä¸“åˆ©è´¹ï¼Œæ‰€ä»¥å¯¹äºŽå¤–éƒ¨ç”¨æˆ·æ¥è¯´ï¼Œç›¸å½“äºŽå¯ä»¥ç›´æŽ¥å…è´¹ä½¿ç”¨äº†ï¼Œå¦å¤–ï¼Œfirefoxç›´æŽ¥å†…ç½®äº†openh264ï¼Œä½œä¸ºå…¶åœ¨webRTCä¸­çš„è§†é¢‘çš„ç¼–è§£ç å™¨ä½¿ç”¨ã€‚ ä½†å¯¹æ¯”èµ·x264ï¼Œopenh264åœ¨h264é«˜çº§ç‰¹æ€§çš„æ”¯æŒæ¯”è¾ƒå·®ï¼š Profileåªæ”¯æŒåˆ°baseline, level 5.2 å¤šçº¿ç¨‹ç¼–ç åªæ”¯æŒslice basedï¼Œä¸æ”¯æŒframe basedçš„å¤šçº¿ç¨‹ç¼–ç  ä»Žç¼–ç æ•ˆçŽ‡ä¸Šæ¥çœ‹ï¼Œopenh264çš„é€Ÿåº¦ä¹Ÿå¹¶ä¸ä¼šæ¯”x264å¿«ï¼Œä¸è¿‡å…¶æœ€å¤§çš„å¥½å¤„ï¼Œè¿˜æ˜¯èƒ½å¤Ÿç›´æŽ¥å…è´¹ä½¿ç”¨å§ã€‚ å‚è€ƒå¾®ä¿¡Androidè§†é¢‘ç¼–ç çˆ¬è¿‡çš„é‚£äº›å‘ androidç¼–ç å™¨æ”¯æŒå‚æ•°Supported Media FormatsVideo encoding recommendations The table below lists the Android media framework video encoding profiles and parameters recommended for playback using the H.264 Baseline Profile codec. The same recommendations apply to the Main Profile codec, which is only available in Android 6.0 and later. SD (Low quality) SD (High quality) HD 720p (N/A on all devices) Video resolution 176 x 144 px 480 x 360 px 1280 x 720 px Video frame rate 12 fps 30 fps 30 fps Video bitrate 56 Kbps 500 Kbps 2 Mbps Audio codec AAC-LC AAC-LC AAC-LC Audio channels 1 (mono) 2 (stereo) 2 (stereo) Audio bitrate 24 Kbps 128 Kbps 192 Kbps The table below lists the Android media framework video encoding profiles and parameters recommended for playback using the VP8 media codec. SD (Low quality) SD (High quality) HD 720p (N/A on all devices) HD 1080p (N/A on all devices) Video resolution 320 x 180 px 640 x 360 px 1280 x 720 px 1920 x 1080 px Video frame rate 30 fps 30 fps 30 fps 30 fps Video bitrate 800 Kbps 2 Mbps 4 Mbps 10 Mbps CamcorderProfileRetrieves the predefined camcorder profile settings for camcorder applications. These settings are read-only. The compressed output from a recording session with a given CamcorderProfile contains two tracks: one for audio and one for video. Each profile specifies the following set of parameters: The file output format Video codec format Video bit rate in bits per second Video frame rate in frames per second Video frame width and height, Audio codec format Audio bit rate in bits per second, Audio sample rate Number of audio channels for recording. Androidç¼–ç å™¨å¸¸è§é—®é¢˜MediaCodec KEY_FRAME_RATE seems to be ignoredæ€»ç»“èµ·æ¥å°±æ˜¯å’Œè¾“å…¥ç¼–ç å™¨çš„å¸§çŽ‡æœ‰å…³ç³» I am trying to modify the source for screenrecord in android 4.4 and lower the captured frame rate, but no matter what value I put in: 1format-&gt;setFloat(&quot;frame-rate&quot;, 5); the result is always the same ( a very high frame rate ) Is the encoder ignoring this property ? how can I control the frame rate ? The frame-rate value is not ignored, but it doesnâ€™t do what you want. The combination of frame-rate and i-frame-interval determines how often I-frames (also called â€œsync framesâ€) appear in the encoded output. The frame rate value might also play a role in meeting the bitrate target on some devices, but Iâ€™m not sure about that (see e.g. this post). The MediaCodec encoder does not drop frames. If you want to reduce the frame rate, you have to do so by sending fewer frames to it. The screenrecord command doesnâ€™t â€œsampleâ€ the screen at a fixed frame rate. Instead, every frame it receives from the surface compositor (SurfaceFlinger) is sent to the encoder, with an appropriate time stamp. If screenrecord receives 60 frames per seconds, youâ€™ll have 60fps output. If it receives 10 frames in quick succession, followed by nothing for 5 seconds, followed by a couple more, youâ€™ll have exactly that in the output file. You can modify screenrecord to drop frames, but you have to be a bit careful. If you try to reduce the maximum frame rate from 60fps to 30fps by dropping every-other frame, you run the risk that in a â€œframe0 - frame1 - long_pause - frame2â€ sequence youâ€™ll drop frame1, and the video will hold on frame0 instead, showing a not-quite-complete animation. So you need to buffer up a frame, and then encode or drop frame N-1 if the difference in presentation times between that and frame N is ~17ms. The tricky part is that screenrecord, in its default operating mode, directs the frames to the encoder without touching them, so all you see is the encoded output. You canâ€™t arbitrarily drop individual frames of encoded data, so you really want to prevent the encoder from seeing them in the first place. If you use the screenrecord v1.1 sources you can tap into â€œoverlayâ€ mode, used for â€“bugreport, to have the frames pass through screenrecord on their way to the encoder. In some respects it might be simpler to write a post-processor that reduces the frame rate. I donâ€™t know how much quality would be lost by decoding and re-encoding the video.]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>Android</tag>
        <tag>tips</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[media-storage-and-transfer]]></title>
    <url>%2F2017%2F06%2F20%2Fmedia-storage-and-transfer%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[media-compress]]></title>
    <url>%2F2017%2F06%2F20%2Fmedia-compress%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[media-video]]></title>
    <url>%2F2017%2F06%2F20%2Fmedia-video%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[media-audio]]></title>
    <url>%2F2017%2F06%2F20%2Fmedia-audio%2F</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[å¤šåª’ä½“æŠ€æœ¯(ä¸€)ä¹‹å›¾å½¢å›¾åƒ]]></title>
    <url>%2F2017%2F06%2F20%2Fmedia-graphic%2F</url>
    <content type="text"><![CDATA[1.å›¾å½¢ä¸Žå›¾åƒçš„åŸºæœ¬æ¦‚å¿µ1.1å›¾å½¢ä¸Žå›¾åƒçš„é¢œè‰²æ¨¡åž‹1.1.1é¢œè‰²çš„åŸºæœ¬æ¦‚å¿µ1.1.1.1 ç‰©ä½“çš„é¢œè‰²ç‰©ä½“çš„é¢œè‰²ä¸åŒæ˜¯å› ä¸ºä»–ä»¬å¯¹å…‰çš„å¸æ”¶å’Œåå°„çš„å±žæ€§ä¸åŒ.ç‰©ä½“çš„é¢œè‰²æ˜¯ç”±è¯¥ç‰©ä½“æ‰€åå°„çš„å…‰çš„æ³¢é•¿æ¥å†³å®šçš„. äººçœ¼çœ‹åˆ°çš„ç‰©ä½“çš„é¢œè‰²ä¸ä»…å–å†³äºŽè¯¥ç‰©ä½“æ‰€åå°„çš„å…‰çš„æ³¢é•¿,è¿˜ä¸Žç…§å°„å®ƒçš„å…‰æºæœ‰å…³.å¦‚æžœç”¨å•ä¸€è“è‰²åŽ»ç…§å°„ç»¿è‰²çš„æ ‘å¶, åˆ™æ­¤æ—¶çš„æ ‘å¶åªèƒ½æ˜¯é»‘è‰²çš„.å› ä¸ºè“è‰²å…‰æºä¸­æ²¡æœ‰ç»¿è‰²æˆåˆ†,æ ‘å¶å¸æ”¶äº†å…¨éƒ¨è“è‰²è€Œå‘ˆçŽ°é»‘è‰². åœ¨å½©è‰²æ˜¾ç¤ºå™¨ä¸­,ä¸ºäº†ä½¿é¢œè‰²å…·æœ‰è¾ƒå¥½çš„è¿˜åŽŸåº¦å’ŒçœŸå®žæ„Ÿ,é€šå¸¸é‡‡ç”¨ç±»ä¼¼è‡ªç„¶å…‰ä½œä¸ºç…§æ˜Žå…‰æº. 1.1.1.2 å½©è‰²ä¸‰è¦ç´ é¢œè‰²ä¿¡æ¯å¯¹äººçš„è§†è§‰ååº”,å¯é€šè¿‡è‰²è°ƒ,è‰²é¥±å’Œåº¦å’Œäº®åº¦è¿™ä¸‰ä¸ªå‚é‡æ¥è¡¨ç¤º: è‰²è°ƒ:ç”¨æ¥æè¿°é¢œè‰²çš„ä¸åŒç±»åˆ«çš„ç‰©ç†é‡ç§°ä¸ºè‰²è°ƒ,å¦‚çº¢,æ©™,é»„,ç»¿,é’,è“,ç´«.è‰²è°ƒå–å†³äºŽè¯¥ç§é¢œè‰²çš„ä¸»è¦æ³¢é•¿. è‰²é¥±å’Œåº¦:è‰²é¥±å’Œåº¦åˆ™æ˜¯æè¿°é¢œè‰²çš„æ·±æµ…ç¨‹åº¦çš„ç‰©ç†é‡,å®ƒæŒ‰è¯¥ç§é¢œè‰²æ··å…¥ç™½å…‰çš„æ¯”ä¾‹æ¥è¡¨ç¤º,å½“æŸè‰²å…‰çš„é¥±å’Œåº¦ä¸º100%æ—¶,å°±æ˜¯è¡¨ç¤ºè¯¥è‰²å…‰æ˜¯å®Œå…¨æ²¡æœ‰æ··å…¥ç™½è‰²å…‰çš„å•è‰²å…‰é¥±å’Œåº¦è¶Šé«˜åˆ™é¢œè‰²ä¹Ÿè¶Šæµ“.å¦‚æžœå¤§é‡æ··å…¥ç™½è‰²å…‰ä½¿é¥±å’Œåº¦é™ä½Ž,äººè§†è§‰ä¼šæ„Ÿåˆ°é¢œè‰²å˜æ·¡.ä¾‹å¦‚,åœ¨æµ“çš„çš„çº¢è‰²å…‰ä¸­æ··å…¥å¤§é‡çš„ç™½å…‰,ç”±äºŽé¥±å’Œåº¦é™ä½Žå°±å˜æˆäº†ç²‰çº¢è‰²,ä½†æ˜¯å› ä¸ºçº¢è‰²æ˜¯åŸºæœ¬è‰²,æ‰€ä»¥è‰²è°ƒå¹¶ä¸æ”¹å˜.åœ¨æŸé¢œè‰²ä¸­æ··å…¥ç™½å…‰ä¸Žå¢žå¼ºç™½å…‰å¯¹æŸé¢œè‰²ç‰©ä½“çš„ç…§å°„æ˜¯ä¸åŒçš„.å‰è€…æ˜¯åœ¨æ‘„å…¥äººçœ¼çš„çœ¸è‰²å…‰ä¸­æ··å…¥ç™½å…‰,è€ŒåŽè€…çš„ç»“æžœåˆ™æ˜¯åŠ å¼ºäº†æŸè‰²ç‰©ä½“çš„åå°„å…‰çš„å¼ºåº¦,åœ¨æ‘„å…¥äººçœ¼çš„åå°„å…‰ä¸­å¹¶æ²¡æœ‰æ··å…¥ç™½å…‰,å› æ­¤å®ƒå¹¶æ²¡æœ‰æ”¹å˜è¯¥è‰²çš„é¥±å’Œåº¦. äº®åº¦:ç”¨æ¥æè¿°è‰²å…‰çš„æ˜Žæš—å˜åŒ–çš„å¼ºåº¦çš„ç‰©ç†é‡æˆä¸ºäº®åº¦.äº®åº¦æ˜¯è‰²å…‰èƒ½é‡çš„ä¸€ç§æè¿°,æ˜¯æŒ‡è‰²è°ƒå’Œè‰²é¥±å’Œåº¦å·²ç»å›ºå®šçš„å…‰,å½“å®ƒçš„å…¨éƒ¨èƒ½é‡å¢žå¼ºæ—¶æ„Ÿè§‰æ˜Žäº®,å¦åˆ™æ„Ÿè§‰æš—æ·¡. è‰²è°ƒå’Œè‰²é¥±å’Œåº¦ç»Ÿç§°ä¸ºè‰²åº¦. 1.1.1.3 ä¸‰åŸºè‰²åŽŸç†ä¸‰åŸºè‰²åŽŸç†è®¤ä¸ºè‡ªç„¶ç•Œä¸­æ™¯ç‰©çš„ç»å¤§å¤šæ•°çš„å½©è‰²å…‰,èƒ½åˆ†è§£ä¸ºäº’ç›¸ç‹¬ç«‹çš„çº¢(R),ç»¿(G),è“(B)ä¸‰ç§åŸºè‰²å…‰;åä¹‹,ç”¨äº’ç›¸ç‹¬ç«‹çš„çº¢,ç»¿,è“3ç§åŸºè‰²å…‰ä»¥ä¸åŒçš„æ¯”ä¾‹æ··åˆ,å¯æ¨¡æ‹Ÿå‡ºè‡ªç„¶ç•Œä¸­ç»å¤§å¤šæ•°æ™¯è‰²çš„å…‰.RGBä¸‰åŸºè‰²ç›¸äº’ç‹¬ç«‹çš„å«ä¹‰æ˜¯æŒ‡,ä»»ä¸€ç§åŸºè‰²éƒ½ä¸èƒ½ç”±å¦å¤–ä¸¤ç§åŸºè‰²æ··åˆè€Œäº§ç”Ÿ.ä¸‰åŸºè‰²çš„é€‰æ‹©å¹¶ä¸æ˜¯å”¯ä¸€çš„. 1.1.1.4 åƒç´ (pixel)åƒç´ æ˜¯è®¡ç®—æœºå›¾å½¢ä¸Žå›¾åƒä¸­èƒ½è¢«å•ç‹¬å¤„ç†çš„æœ€å°åŸºæœ¬å•å…ƒ. ä»Žåƒç´ çš„è§†è§‰å±žæ€§çœ‹,å®ƒæ˜¯ä¸€ä¸ªæœ€å°å¯æ˜¯å•ä½.ä¸€å¹…å½©è‰²å›¾åƒå¯ä»¥çœ‹æˆæ˜¯ç”±è®¸å¤šå¾ˆå°çš„å¯æ˜¯ç‚¹ç»„æˆçš„,è¿™ä¸ªç‚¹å°±æ˜¯åƒç´ .æ¯ä¸ªåƒç´ ç‚¹éƒ½æœ‰ç¡®å®šçš„é¢œè‰²å’Œäº®åº¦,è¿™ä¸ªé¢œè‰²å°±æ˜¯æœ‰äº’ç›¸ç‹¬ç«‹çš„çº¢,ç»¿,è“ä¸‰ç§åŸºè‰²å…‰ä»¥ä¸åŒçš„æ¯”ä¾‹æ··åˆè€Œæˆçš„. ä»Žåƒç´ çš„é‡å€¼å±žæ€§çœ‹,å®ƒçš„æ•°æ®ç»“æž„åº”åŒæ—¶æ˜¾ç¤ºåœ°å€,è‰²å½©,äº®åº¦ç­‰æ•°æ®ä¿¡æ¯,è¿™äº›æ•°æ®å°±ç§°ä¸ºåƒç´ å€¼. 1.1.2 é¢œè‰²æ¨¡åž‹é¢œè‰²æ¨¡åž‹(æˆ–ç§°è‰²å½©æ¨¡åž‹)å°±æ˜¯å®šé‡é¢œè‰²æ–¹æ³•.åœ¨ä¸åŒçš„é¢†åŸŸåº”ç”¨äºŽå›¾åƒæ—¶,ä¸ºäº†å°½å¯èƒ½å¤šåœ°,æœ‰æ•ˆåœ°æè¿°å„ç§é¢œè‰²,å¾€å¾€é‡‡ç”¨ä¸åŒçš„é¢œè‰²æ¨¡åž‹,ä¾‹å¦‚,ç”¨æ˜¾ç¤ºå™¨è¿™ç±»å‘å…‰ç‰©ä½“æ˜¾ç¤ºæ—¶é‡‡ç”¨çš„æ˜¯RGBæ¨¡åž‹,ç”¨æ‰“å°æœºè¿™ç±»å¸å…‰ç‰©ä½“è¾“å‡ºå›¾åƒæ—¶ç”¨CMYæ¨¡åž‹,è¿›è¡Œå½©è‰²ç”µè§†ä¿¡å·çš„æ˜¾ç¤ºä¸Žä¼ è¾“æ—¶é‡‡ç”¨YUVæ¨¡åž‹,ä»Žäº‹è‰ºæœ¯ç»˜ç”»æ—¶ä¹ æƒ¯é‡‡ç”¨HSLæ¨¡åž‹. 1.1.2.1 RGBæ¨¡åž‹RGBæ¨¡åž‹ä¹Ÿç§°ä¸ºåŠ è‰²æ³•æ··è‰²æ¨¡åž‹.å…¶æ··è‰²è§„å¾‹æ˜¯:ä»¥ç­‰é‡çš„çº¢,ç»¿,è“åŸºè‰²å…‰æ··åˆæ—¶: çº¢ + ç»¿ = é»„è‰² çº¢ + è“ = å“çº¢è‰² ç»¿ + è“ = é’è‰² çº¢ + ç»¿ + è“ = ç™½è‰² 3ç§åŸºè‰²å…‰å…¨æ—  = é»‘è‰² åŠ è‰²æ³•çš„æ··è‰²è§„å¾‹å¯ä»¥ä½¿ç”¨ä¸‹å›¾è¡¨ç¤º,3ä¸ªåœ†åˆ†åˆ«çº¢ç»¿è“3ç§åŸºè‰²,åœ†ä¸Žåœ†çš„å åŠ åŒºåŸŸè¡¨ç¤ºä»¥ç­‰é‡çš„åŸºè‰²ç›¸æ··åˆæ—¶æ‰€åˆæˆçš„é¢œè‰²,å…¶è‰²è°ƒå¦‚è¯¥åŒºåŸŸçš„æ–‡å­—è¡¨ç¤º.å½“3ç§åŸºè‰²ç­‰é‡ç›¸åŠ æ—¶,å°±ä¼šå¾—åˆ°ç™½è‰².å…¶ä¸­,åˆå°å°æŠŠå“çº¢è‰²æˆä¸ºç»¿è‰²çš„è¡¥è‰²,é’è‰²ç§°ä¸ºçº¢è‰²çš„è¡¥è‰²,é»„è‰²ç§°ä¸ºè“è‰²çš„è¡¥è‰². ç‰©ä½“çš„é¢œè‰²æ˜¯ä¸°å¯Œå¤šå½©çš„,ä»»ä½•ä¸€ç§é¢œè‰²å’Œè¿™3ç§åŸºè‰²ä¹‹é—´çš„å…³ç³»å¯ä»¥ç”¨ä¸‹é¢çš„é…è‰²æ–¹ç¨‹å¼æ¥æè¿°: F(ç‰©ä½“é¢œè‰²)=R(çº¢è‰²çš„ç™¾åˆ†æ¯”) + G(ç»¿è‰²çš„ç™¾åˆ†æ¯”) + B(è“è‰²çš„ç™¾åˆ†æ¯”) ç”±äºŽäººç±»çš„è§†è§‰ç‰¹æ€§,ä¸¤ç§æˆ–3ç§åŸºè‰²äº§ç”Ÿæ··è‰²æ•ˆæžœ,ä¸ä¸€å®šè¦åŒæ—¶å’ŒåŒä¸€ç©ºé—´ä½ç½®æ··åˆ.ä¾‹å¦‚,åœ¨å¿ƒç†å­¦å®žéªŒä¸­æœ‰ä¸€ä¸ªè‰²è½®å®žéªŒ,å®ƒæ˜¯åœ¨å¯æ—‹è½¬çš„åœ†ç›˜ä¸ŠæŒ‰æ‰‡å½¢é¢ç§¯å‡ç­‰çš„åˆ†æˆ3éƒ¨åˆ†,å¹¶æ¶‚ä¸Š3ç§åŸºè‰²,å½“åœ†ç›˜æ…¢æ…¢æ—‹è½¬æ—¶èƒ½å¤Ÿåˆ†è¾¨å‡º3ä¸­åŸºè‰²,ä½†å½“åœ†ç›˜æ—‹è½¬çš„é¢‘çŽ‡æé«˜åˆ°é—ªå…‰èžåˆé¢‘çŽ‡ä»¥ä¸Šæ—¶,äººçœ¼ä¸å†èƒ½åˆ†è¾¨å‡º3ç§åŸºè‰²,è€Œäº§ç”Ÿç™½é¢œè‰²çš„æ„Ÿè§‰,ä»¥è¾¾åˆ°æ··è‰²çš„æ•ˆæžœ.è¿™å°±æ˜¯ â€œæ—¶é—´æ··è‰²æ³•â€ .æœ€åˆçš„é¡ºåºåˆ¶å½©è‰²ç”µè§†å°±åº”ç”¨äº†äººçš„è¿™ä¸€è§†è§‰æ•ˆæžœ.ä¾‹å¦‚,å¾ˆç»†å°çš„çº¢ç‚¹å’Œæ—…åº—å‡åŒ€é—´ç½®äº’ç›¸é çš„å¾ˆè¿‘,åªæœ‰åœ¨è¿‘è·ç¦»ä»”ç»†è§‚çœ‹æ‰èƒ½åŒºåˆ†å‡ºæ¥,å½“è§‚çœ‹è·ç¦»å¾ˆè¿œæ—¶å°±åªæ„Ÿè§‰åˆ°é»„è‰²çš„ä¸€ç¯‡äº†,è¿™å°±æ˜¯ â€œç©ºé—´æ··è‰²æ³•â€ .ç›®å‰å¹¿æ³›ä½¿ç”¨çš„å½©è‰²æ˜¾åƒç®¡ä»¥åŠå¤§åž‹LEDçœŸå½©è‰²å¹¿å‘Šå±å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸€æ··è‰²è§†è§‰æ•ˆåº”. åœ¨å¤šåª’ä½“æŠ€æœ¯ä¸­,RGBé¢œè‰²æ¨¡åž‹æ˜¯æœ€åŸºæœ¬çš„æ¨¡åž‹,å› ä¸ºå½©è‰²æ˜¾ç¤ºå™¨åªæœ‰æŒ‰RGBåˆ†é‡å¼è¾“å…¥,æ‰èƒ½åœ¨æ˜¾ç¤ºå±å¹•ä¸Šåˆæˆä»»æ„é¢œè‰². 1.1.2.2 CMYæ¨¡åž‹CMY(Cyan Magenta Yellow)æ¨¡åž‹æ˜¯é‡‡ç”¨é’,å“çº¢,é»„è‰²3ç§åŸºæœ¬é¢œè‰²æŒ‰ä¸€å®šæ¯”ä¾‹åˆæˆé¢œè‰²çš„æ–¹æ³•.CMYæ¨¡åž‹åˆç§°ä¸ºå‡è‰²æ³•æ··è‰²æ¨¡åž‹,å› ä¸ºè‰²å½©çš„æ˜¾ç¤ºä¸æ˜¯ç›´æŽ¥æ¥è‡ªäºŽå…‰çº¿çš„è‰²å½©,è€Œæ˜¯å…‰çº¿è¢«ç‰©ä½“å¸æ”¶æŽ‰ä¸€éƒ¨åˆ†ä¹‹åŽå‘å°„å›žæ¥çš„å‰©ä½™å…‰çº¿æ‰€äº§ç”Ÿçš„.å…‰çº¿éƒ½è¢«å¸æ”¶æ—¶ç§°ä¸ºé»‘è‰²,å½“å…‰çº¿éƒ½è¢«åå°„æ—¶æˆä¸ºç™½è‰².è¿™ç§æ¨¡å¼é€‚åˆäºŽå½©è‰²æ‰“å°æœºç­‰ç”¨å½©è‰²å¢¨æ°´æˆ–é¢œæ–™è¿›è¡Œæ··åˆæ˜¾ç¤ºçš„æƒ…å†µ. åœ¨ç›¸å‡æ··è‰²ä¸­,å½“3ç§åŸºæœ¬é¢œè‰²ç­‰é‡ç›¸å‡æ—¶å¾—åˆ°é»‘è‰²;ç­‰é‡é»„è‰²(Y)å’Œå“çº¢(M)ç›¸å‡è€Œé’è‰²ä¸º0æ—¶,ç­‰åˆ°çº¢è‰²(R);ç­‰é‡é’è‰²(C)å’Œå“çº¢(M)ç›¸å‡è€Œé»„è‰²ä¸º0æ—¶,å¾—åˆ°è“è‰²(B);ç­‰é‡é»„è‰²(Y)å’Œé’è‰²(C)ç›¸å‡è€Œå“çº¢(M)ä¸º0æ—¶,å¾—åˆ°ç»¿è‰²(G). ç”±äºŽé¢œæ–™çš„åŒ–å­¦ç‰¹æ€§,å®žé™…ä¸Šç­‰é‡çš„CMYæ··åˆåŽå¹¶ä¸èƒ½äº§ç”ŸçœŸæ­£çš„é»‘è‰²,å› æ­¤åœ¨å°åˆ·æ—¶é€šå¸¸å†åŠ ä¸Šé»‘è‰²(Black),è¿™æ ·åˆç§°ä¸ºCMYKæ¨¡å¼,å››è‰²å°åˆ·ä¾¿æ˜¯ç”±æ­¤è€Œæ¥. æ˜¾ç„¶,RGBä¸ŽCMYæ¨¡åž‹æ˜¯é¢œè‰²äº’è¡¥çš„æ¨¡åž‹,å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸è½¬æ¢.å¦‚æžœæŒ‰æ¯ä¸ªåƒç´ æ¯ç§é¢œè‰²ç”¨ä¸€ä½äºŒè¿›åˆ¶æ•°è¡¨ç¤ºçš„è¯,RGBä¸ŽCMYæ¨¡åž‹ä¹‹é—´çš„é¢œè‰²å…³ç³»å¦‚ä¸‹è¡¨æ‰€ç¤º.åˆ©ç”¨å®ƒä»¬ä¹‹é—´çš„å…³ç³»,å¯ä»¥æŠŠæ˜¾ç¤ºå™¨æ˜¾ç¤ºçš„é¢œè‰²è½¬æ¢æˆæ‰“å°çš„é¢œè‰².ä½†å®žé™…ä¸Šå› ä¸ºå‘å°„å…‰ä¸Žåå°„å…‰çš„æ€§è´¨å®Œå…¨ä¸åŒ,æ˜¾ç¤ºå™¨ä¸Šçš„é¢œè‰²ä¸å¯èƒ½ç²¾ç¡®åœ°åœ¨æ‰“å°æœºä¸Šå¤åˆ¶å‡ºæ¥,å› æ­¤å®žé™…çš„è½¬æ¢è¿‡ç¨‹ä¼šåˆ©ç”¨ä¸€å®šçš„ç®—æ³•è¿›è¡Œä¸€å®šç¨‹åº¦ä¸Šçš„å¤±çœŸè¡¥å¿. |RGB|CMY|é¢œè‰²| |â€”|â€”|â€”| |000|111|é»‘| |001|110|è“| |010|101|ç»¿| |011|100|é’| |100|011|çº¢| |101|010|å“çº¢| |110|001|é»„| |111|000|ç™½| 1.1.2.3 YUVä¸ŽYIQæ¨¡åž‹åœ¨å½©è‰²ç”µè§†ç³»ç»Ÿä¸­ä¸é‡‡ç”¨RGBé¢œè‰²æ¨¡åž‹,è€Œé‡‡ç”¨YUVæˆ–YIQæ¨¡åž‹è¡¨ç¤ºå½©è‰²å›¾åƒ.YUVé€‚ç”¨äºŽPAL(Phase Altermation Line,åŒè¡Œå€’ç›¸åˆ¶å¼)å’ŒSECAM(æ³•æ–‡)(Sequential Cæ¬§äº†è®©Memo,é¡ºåºä¼ é€å½©è‰²ä¸Žå­˜å‚¨åˆ¶å¼)å½©è‰²ç”µè§†åˆ¶å¼,è€ŒYIQé€‚ç”¨äºŽç¾Žå›½å›½å®¶ç”µè§†æ ‡å‡†å§”å‘˜ä¼š(NTSC,National Television System Committee)å½©è‰²ç”µè§†åˆ¶å¼. Yæ˜¯äº®åº¦ä¿¡å·,Uå’ŒVåˆ™æ˜¯ä¸¤ä¸ªè‰²å·®ä¿¡å·,åˆ†åˆ«ä¼ é€çº¢åŸºè‰²åˆ†é‡å’Œè“åŸºè‰²åˆ†é‡ä¸Žäº®åº¦åˆ†é‡çš„å·®å€¼ä¿¡å·. é‡‡ç”¨YUVé¢œè‰²æ¨¡åž‹çš„å¥½å¤„æ˜¯:å…¶ä¸€,äº®åº¦ä¿¡å·Yè§£å†³äº†å½©è‰²ç”µè§†ä¸Žé»‘ç™½ç”µè§†çš„å…¼å®¹æ€§é—®é¢˜;å…¶äºŒ,ç”±äºŽäººçœ¼å¯¹é¢œè‰²ç»†èŠ‚çš„åˆ†è¾¨çŽ‡ä½ŽäºŽå¯¹äº®åº¦ç»†èŠ‚çš„åˆ†è¾¨çŽ‡,æ‰€ä»¥å¯ä»¥ç”¨ä¸€ä¸ªé€šé“æ¥ä¼ é€,Y,U,Vè¿™3ä¸ªä¿¡å·,ç»™äº®åº¦ä¿¡å·è¾ƒå¤§çš„å¸¦å®½(6MHz)æ¥ä¼ é€å›¾åƒçš„ç»†èŠ‚,è€Œç»™è‰²å·®ä¿¡å·è¾ƒå°çš„å¸¦å®½(1.3MHz)æ¥è¿›è¡Œå¤§é¢ç§¯æ¶‚è‰².è¿™æ ·,æ€»çš„ä¼ è¾“æ•°æ®é‡å’ŒRGBæ¨¡åž‹ç›¸æ¯”,è¦æ˜Žæ˜¾å°ä¸€äº›,èµ·åˆ°äº†ä¸€ç§æ•°æ®åŽ‹ç¼©èŠ‚çœå­˜å‚¨ç©ºé—´çš„ä½œç”¨,è€Œå¯¹äºŽè¿™ç§æ•°æ®åŽ‹ç¼©å¸¦æ¥çš„ç”»é¢å˜åŒ–äººçœ¼ä¸€èˆ¬æ˜¯æ„Ÿè§‰ä¸åˆ°çš„. ç”µè§†ç³»ç»Ÿé€šå¸¸é‡‡ç”¨æ‘„åƒæœºæŠŠæ‘„å¾—çš„å½©è‰²å›¾åƒä¿¡å·ç»åˆ†è‰²,æ”¾å¤§å’Œæ ¡æ­£åˆ†æˆRGBè¿™3ä¸ªåˆ†é‡çš„ä¿¡å·,å†ç»è¿‡çŸ©é˜µå˜æ¢ç”µè·¯å°†å½©è‰²ä¿¡å·åˆ†è§£æˆäº®åº¦ä¿¡å·Yå’Œè‰²å·®ä¿¡å·,U,V,è€ŒåŽå¯¹å…¶è¿›è¡Œç¼–ç ,ç”¨åŒä¸€ä¿¡é“å‘é€å‡ºåŽ».æŽ¥æ”¶ç«¯å†é€šè¿‡ç¼–ç åŠçŸ©é˜µé€†å˜æ¢è¿˜åŽŸæˆ3ä¸ªåŸºè‰²æ˜¾ç¤º. åœ¨NTSCå½©è‰²ç”µè§†åˆ¶å¼ä¸­ä½¿ç”¨YIQæ¨¡åž‹,å…¶ç‰¹æ€§ä¸ŽYUVæ¨¡åž‹ç›¸è¿‘.å…¶ä¸­çš„Yè¡¨ç¤ºäº®åº¦,I,Qä¹Ÿæ˜¯ä¸¤ä¸ªè‰²å·®åˆ†é‡,ä½†å®ƒä»¬åœ¨è‰²åº¦çŸ¢é‡å›¾ä¸­ä¸ŽU,Vçš„ä½ç½®ä¸åŒ.Q,Iæ­£äº¤åæ ‡è½´ä¸ŽU,Væ­£äº¤åæ ‡è½´ä¹‹é—´æœ‰33åº¦å¤¹è§’,å¦‚å›¾æ‰€ç¤º: I,Qä¸ŽU,Vä¹‹é—´çš„å…³ç³»å¦‚ä¸‹: I = Vcos33 - Usin33 Q = Vsin33 + Ucos33 äººçœ¼çš„å½©è‰²è§†è§‰ç‰¹æ€§è¡¨æ˜Ž,äººçœ¼åˆ†è¾¨çº¢ä¸Žé»„ä¹‹é—´çš„é¢œè‰²å˜åŒ–çš„èƒ½åŠ›æœ€å¼º,è€Œåˆ†è¾¨è“,ç´«ä¹‹é—´é¢œè‰²å˜åŒ–çš„èƒ½åŠ›æœ€å¼±.å› æ­¤YIQæ¨¡åž‹åœ¨è‰²åº¦çŸ¢é‡å›¾ä¸­,é€‰æ‹©Iè½´æ­£å¥½å¤„äºŽå¤¹è§’123åº¦å¤„,å³äººçœ¼å…·æœ‰æœ€å¤§å½©è‰²åˆ†è¾¨çŽ‡çš„çº¢ä¸Žé»„ä¹‹é—´çš„æ©™è‰²å’Œé’è‰²(ç›¸è§’ä¸º303åº¦)å¤„,é€‰æ‹©ä¸ŽIè½´æ­£äº¤çš„è‰²åº¦ä¿¡å·è½´ä¸ºQè½´(ç›¸è§’ä¸º33åº¦),æ­£æ˜¯äººçœ¼æœ€ä¸æ•æ„Ÿçš„è‰²è½´ä½ç½®.å› è€ŒYIQæ¨¡åž‹ä¼ é€åˆ†è¾¨åŠ›è¾ƒå¼ºçš„Iä¿¡å·æ—¶,ç”¨è¾ƒå®½çš„é¢‘å¸¦(1.3MHz~1.5MHz),ä¼ é€åˆ†è¾¨åŠ›å¼±çš„Qä¿¡å·æ—¶,å¯ç”¨è¾ƒçª„çš„é¢‘å¸¦(0.5MHz),è¿™å°±å¯ä»¥åœ¨ä¿è¯è¾ƒå¥½çš„é¢œè‰²ä¼ è¾“ç‰¹æ€§æƒ…å†µä¸‹,æœ€å¤§é™åº¦åœ°èŠ‚çœå­˜å‚¨ç©ºé—´. 1.1.2.4 HSIé¢œè‰²æ¨¡åž‹HSIæˆ–HSLæ˜¯Hue Saturation Intensity(Lightness)çš„è‹±æ–‡ç¼©å†™,é¢œè‰²æ¨¡åž‹ç”¨H,S,Iè¿™ä¸‰ä¸ªå‚æ•°æè¿°é¢œè‰²ç‰¹æ€§,å…¶ä¸­Hå®šä¹‰é¢œè‰²çš„æ³¢é•¿,ç§°ä¸ºè‰²è°ƒ;Sè¡¨ç¤ºé¢œè‰²çš„æ·±æµ…ç¨‹åº¦,ç§°ä¸ºé¥±å’Œåº¦;Iè¡¨ç¤ºå¼ºåº¦æˆ–äº®åº¦,è¿™æ­£æ˜¯é¢œè‰²çš„ä¸‰è¦ç´ . HSIæ¨¡åž‹æ›´æŽ¥è¿‘äººå¯¹é¢œè‰²æ›´æŽ¥è¿‘äººå¯¹å½©è‰²çš„è®¤è¯†,ç¬¦åˆäººçœ¼å¯¹é¢œè‰²çš„æ„ŸçŸ¥æ–¹å¼,æ˜¯ä¸€ç§ä»Žäº‹è‰ºæœ¯ç»˜ç”»çš„ç”»å®¶ä»¬ä¹ æƒ¯ä½¿ç”¨çš„æè¿°è‰²å½©çš„æ–¹æ³•.å®ƒæ¯”RGBæ¨¡åž‹ä½¿ç”¨æ›´æ–¹ä¾¿,ä»Žè€Œèƒ½å‡å°‘å½©è‰²å›¾åƒå¤„ç†çš„å¤æ‚æ€§,å¢žåŠ å¿«é€Ÿæ€§,å› æ­¤ä¸€èˆ¬çš„å›¾åƒå¤„ç†è½¯ä»¶ä¸­,éƒ½æä¾›äº†è¿™ç§å®šé‡è‰²å½©çš„æ–¹å¼. 1.1.3 é¢œè‰²æ¨¡åž‹çš„è½¬æ¢æ— è®ºé‡‡ç”¨ä»€ä¹ˆé¢œè‰²æ¨¡åž‹æ¥è¡¨ç¤ºå½©è‰²å›¾å½¢ä¸Žå›¾åƒ,ç”±äºŽæ‰€æœ‰çš„æ˜¾ç¤ºå™¨éƒ½éœ€è¦RGBå€¼æ¥é©±åŠ¨,æ‰€ä»¥åœ¨æ˜¾ç¤ºæ¯ä¸ªåƒç´ ä¹‹å‰,å¿…é¡»è¦æŠŠå½©è‰²åˆ†é‡å€¼è½¬æ¢æˆRGBå€¼. 1.1.3.1 YUVä¸ŽRGBé¢œè‰²æ¨¡åž‹å˜æ¢RGBä¸ŽYUVçš„å¯¹åº”å…³ç³»å¯ä»¥è¿‘ä¼¼åœ°ç”¨ä¸‹é¢çš„æ–¹ç¨‹è¡¨ç¤º: Y = 0.299R + 0.587G + 0.114B U = -0.147R - 0.289G + 0.436B V = 0.615R - 0.515G - 0.096B1.1.3.2 YIQä¸ŽRGBé¢œè‰²æ¨¡åž‹å˜æ¢YIQä¸ŽRGBçš„å¯¹åº”å…³ç³»å¯ä»¥è¿‘ä¼¼åœ°ç”¨ä¸‹é¢çš„æ–¹ç¨‹è¡¨ç¤º: Y = 0.229R + 0.587G + 0.114B I = 0.596R - 0.275G - 0.321B Q = 0.212R - 0.523G + 0.311B HSI ä¸Ž RGBé¢œè‰²å˜æ¢HSIä¸ŽRGBç©ºé—´çš„è½¬æ¢å…³ç³»å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹ç¨‹è¡¨ç¤º: H = [90 - arctan(F/sqr(3)) + [0, G&gt;B;180,G&lt;B]]/360 S = 1 - min(R,G,B)/I I = (R+G+B)/3 å…¶ä¸­,F=(2R-G-B)/(G-B),sqrä¸ºæ±‚å¹³æ–¹æ ¹ 1.2å›¾å½¢ä¸Žå›¾åƒçš„åŸºæœ¬å±žæ€§ä¸€å¹…å½©è‰²å›¾åƒå¯ä»¥çœ‹æˆäºŒç»´è¿žç»­å‡½æ•°f(x,y),å…¶å½©è‰²å¹…åº¦æ˜¯ä½ç½®(x,y)çš„å‡½æ•°.è®¡ç®—æœºå¤šåª’ä½“æŠ€æœ¯ä»Žå…¶å›¾åƒçš„ç”Ÿæˆ,æ˜¾ç¤º,å¤„ç†å’Œå­˜å‚¨çš„æœºåˆ¶å‡ºå‘,éœ€è¦å¯¹å½©è‰²å›¾åƒæ•°å­—åŒ–.æ•°å­—åŒ–ä¸€å¹…å½©è‰²å›¾åƒå°±æ˜¯è¦æŠŠè¿žç»­å‡½æ•°f(x,y)åœ¨ç©ºé—´çš„åæ ‡å’Œå½©è‰²å¹…åº¦è¿›è¡Œç¦»æ•£å’Œé‡åŒ–.ç©ºé—´åæ ‡x,yçš„ç¦»æ•£åŒ–é€šå¸¸ä»¥åˆ†è¾¨çŽ‡æ¥è¡¨å¾,è€Œå½©è‰²å¹…åº¦çš„ç¦»æ•£åŒ–åˆ™ç”±åƒç´ çš„é¢œè‰²æ·±åº¦æ¥è¡¨å¾. 1.2.1åˆ†è¾¨çŽ‡åˆ†è¾¨çŽ‡æ˜¯ä¸€ä¸ªç»Ÿç§°,åˆ†ä¸ºæ˜¾ç¤ºåˆ†è¾¨çŽ‡,å›¾åƒåˆ†è¾¨çŽ‡,æ‰«æåˆ†è¾¨çŽ‡å’Œæ‰“å°åˆ†è¾¨çŽ‡ç­‰. 1.2.1.1æ˜¾ç¤ºåˆ†è¾¨çŽ‡æ˜¯æŒ‡æŸä¸€ç§æ˜¾ç¤ºæ–¹å¼ä¸‹,æ˜¾ç¤ºå±ä¸Šèƒ½å¤Ÿæ˜¾ç¤ºå‡ºçš„åƒç´ æ•°ç›®,ä»¥æ°´å¹³å’Œåž‚ç›´çš„åƒç´ è¡¨ç¤º.ä¾‹å¦‚,æ˜¾ç¤ºåˆ†è¾¨çŽ‡ä¸º640*480è¡¨ç¤ºæ˜¾ç¤ºå±åˆ†æˆ480è¡Œ,æ¯è¡Œæ˜¾ç¤º640ä¸ªåƒç´ ,æ•´ä¸ªæ˜¾ç¤ºå±å°±å«æœ‰307200ä¸ªæ˜¾åƒç‚¹.å±å¹•ä¸Šçš„åƒç´ è¶Šå¤š,åˆ†è¾¨çŽ‡å°±è¶Šé«˜,æ˜¾ç¤ºå‡ºæ¥çš„å›¾åƒä¹Ÿå°±è¶Šç»†è…»,æ˜¾ç¤ºçš„å›¾åƒè´¨é‡ä¹Ÿå°±çº¦é«˜.å±å¹•èƒ½å¤Ÿæ˜¾ç¤ºçš„æœ€å¤§åƒç´ æ•°ç›®è¶Šå¤š,ä¹Ÿè¯´æ˜Žæ˜¾ç¤ºè®¾å¤‡çš„æœ€å¤§åˆ†è¾¨çŽ‡è¶Šé«˜.æ˜¾ç¤ºå±ä¸Šçš„æ¯ä¸ªå½©è‰²åƒç´ ç”±ä»£è¡¨R,G,Bè¿™3ç§æ¨¡æ‹Ÿä¿¡å·çš„ç›¸å¯¹å¼ºåº¦å†³å®š,è¿™äº›å½©è‰²åƒç´ ç‚¹å°±æž„æˆä¸€å¹…å½©è‰²å›¾åƒ. 1.2.1.2å›¾åƒåˆ†è¾¨çŽ‡å›¾åƒåˆ†è¾¨çŽ‡æŒ‡æ•°å­—åŒ–å›¾åƒçš„å¤§å°,ä»¥æ°´å¹³å’Œåž‚ç›´çš„åƒç´ æ•°è¡¨ç¤º.å¦‚æžœç»„æˆå›¾åƒçš„åƒç´ æ•°ç›®è¶Šå¤š,åˆ™è¯´æ˜Žå›¾åƒçš„åˆ†è¾¨çŽ‡è¶Šé«˜,çœ‹èµ·æ¥å°±è¶Šé€¼çœŸ,å›¾åƒåˆ†è¾¨çŽ‡å®žé™…ä¸Šå†³å®šäº†å›¾åƒçš„æ˜¾ç¤ºè´¨é‡,ä¹Ÿå°±æ˜¯è¯´,å³ä½¿æé«˜äº†æ˜¾ç¤ºåˆ†è¾¨çŽ‡,ä¹Ÿæ— æ³•çœŸæ­£æ”¹å–„å›¾åƒçš„è´¨é‡.å›¾åƒåˆ†è¾¨çŽ‡ä¸Žæ˜¾ç¤ºåˆ†è¾¨çŽ‡æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µ.å›¾åƒåˆ†è¾¨çŽ‡çš„ç¡®å®šç»„æˆä¸€å¹…å›¾åƒçš„åƒç´ æ•°ç›®,è€Œæ˜¾ç¤ºåˆ†è¾¨çŽ‡æ˜¯ç¡®å®šæ˜¾ç¤ºå›¾åƒçš„åŒºåŸŸå¤§å°.å½“å›¾åƒåˆ†è¾¨çŽ‡ä¸Žå±å¹•åˆ†è¾¨çŽ‡ä¸€è‡´æ—¶,å›¾åƒæ­£å¥½å æ®æ»¡å±;å½“å›¾åƒåˆ†è¾¨çŽ‡å°äºŽå±å¹•åˆ†è¾¨çŽ‡æ—¶,å›¾åƒå æ®å±å¹•çš„ä¸€éƒ¨åˆ†;å½“å›¾åƒåˆ†è¾¨çŽ‡å¤§äºŽå±å¹•åˆ†è¾¨çŽ‡æ—¶,åˆ™å±å¹•ä»…èƒ½æ˜¾ç¤ºå›¾åƒçš„ä¸€éƒ¨åˆ†. 1.2.1.3æ‰«æåˆ†è¾¨çŽ‡å’Œæ‰“å°åˆ†è¾¨çŽ‡åœ¨ç”¨äºŽæ‰«æä»ªæ‰«æå›¾åƒæ—¶,é€šå¸¸è¦æŒ‡å®šæ‰«æçš„åˆ†è¾¨çŽ‡,ç”¨æ¯è‹±å¯¸åŒ…å«çš„ç‚¹(d/i,dots per inch)è¡¨ç¤º.å¦‚æžœç”¨300d/iæ¥æ‰«æä¸€å¹…86çš„å½©è‰²å›¾åƒ,å°±å¾—åˆ°ä¸€å¹…24001800ä¸ªåƒç´ çš„å›¾åƒ.åˆ†è¾¨çŽ‡è¶Šé«˜,åƒç´ å°±è¶Šå¤š. æ‰“å°åˆ†è¾¨çŽ‡æ˜¯æŒ‡å›¾åƒæ‰“å°æ—¶æ¯è‹±å¯¸å¯è¯†åˆ«çš„ç‚¹æ•°,ä¹Ÿä½¿ç”¨d/i(dots per inch)ä¸ºè¡¡é‡å•ä½.ä¸¤ç§åˆ†è¾¨çŽ‡ä¹‹é—´æ˜¯æœ‰åŒºåˆ«çš„,æ‰«æåˆ†è¾¨çŽ‡åæ˜ äº†æ‰«æåŽçš„å›¾åƒä¸ŽåŽŸå§‹å›¾åƒä¹‹é—´çš„å·®å¼‚ç¨‹åº¦,åˆ†è¾¨çŽ‡è¶Šé«˜,å·®å¼‚è¶Šå°.æ‰“å°åˆ†è¾¨çŽ‡åæ˜ äº†æ‰“å°çš„å›¾åƒä¸ŽåŽŸæ•°å­—å›¾åƒä¹‹é—´çš„å·®å¼‚ç¨‹åº¦,åˆ†è¾¨çŽ‡è¶ŠæŽ¥è¿‘åŽŸå›¾åƒçš„åˆ†è¾¨çŽ‡,æ‰“å°è´¨é‡è¶Šé«˜.ä¸¤ç§åˆ†è¾¨çŽ‡çš„æœ€é«˜å€¼éƒ½å—åˆ°è®¾å¤‡çš„é™åˆ¶. 1.2.2é¢œè‰²æ·±åº¦é¢œè‰²æ·±åº¦æ˜¯æŒ‡å›¾åƒä¸­æ¯ä¸ªåƒç´ çš„é¢œè‰²(æˆ–äº®åº¦)ä¿¡æ¯æ‰€å çš„äºŒè¿›åˆ¶æ•°ä½æ•°,è®°åšä½/åƒç´ (b/p,bits per pixel).å±å¹•ä¸Šçš„æ¯ä¸€ä¸ªåƒç´ éƒ½å æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä½,ç”¨äºŽå­˜æ”¾ä¸Žå®ƒç›¸å…³çš„é¢œè‰²ä¿¡æ¯.é¢œè‰²æ·±åº¦å†³å®šäº†æž„æˆå›¾åƒçš„æ¯ä¸ªåƒç´ å¯èƒ½å‡ºçŽ°çš„æœ€å¤§é¢œè‰²æ•°,å› è€Œé¢œè‰²æ·±åº¦å€¼è¶Šé«˜,æ˜¾ç¤ºçš„å›¾åƒè‰²å½©è¶Šä¸°å¯Œ.åä¹‹,é¢œè‰²æ·±åº¦å¤ªæµ…,ä¼šå½±å“å›¾åƒçš„è´¨é‡,å›¾åƒçœ‹èµ·æ¥è®©äººè§‰å¾—å¾ˆç²—ç³™å’Œå¾ˆä¸è‡ªç„¶.å¸¸è§é¢œè‰²æ·±åº¦æœ‰ä¸€ä¸‹5ç§: 4bit:è¿™æ˜¯VGAæ ‡å‡†æ”¯æŒçš„é¢œè‰²æ·±åº¦,å…±2çš„å››æ¬¡æ–¹16ç§é¢œè‰²; 8bit:è¿™æ˜¯å¤šåª’ä½“åº”ç”¨ä¸­çš„æœ€ä½Žé¢œè‰²æ·±åº¦,å…±2çš„8æ¬¡æ–¹256ç§é¢œè‰²,ç§°ä¸ºç´¢å¼•å½©è‰²å›¾(ç”±é¢œè‰²æŸ¥æ‰¾å†³å®š); 16bit:åœ¨16bitä¸­,ç”¨å…¶ä¸­çš„15bitè¡¨ç¤ºRGBè¿™3ç§é¢œè‰²,æ¯ç§é¢œè‰²5bit,ç”¨å‰©ä½™çš„ä»¥ä¸ºè¡¨ç¤ºå›¾åƒçš„å…¶ä»–å±žæ€§,å¦‚é€æ˜Žåº¦.æ‰€ä»¥16bitçš„é¢œè‰²æ·±åº¦å®žé™…å¯ä»¥è¡¨ç¤ºä¸º2çš„15æ¬¡æ–¹323232å…±32768ç§é¢œè‰².ç§°ä¸ºHI-Color(é«˜å½©è‰²)å›¾åƒ. 24bit:ç”¨3ä¸ª8bitåˆ†åˆ«è¡¨ç¤ºRGB,å¯ç”Ÿæˆçš„é¢œè‰²æ•°2çš„24æ¬¡16777216ç§,çº¦16Mç§é¢œè‰²,è¿™å·²ç»æˆä¸ºçœŸå½©è‰²; 32bit:åŒ24bité¢œè‰²æ·±åº¦ä¸€æ ·,ä¹Ÿæ˜¯ç”¨3ä¸ªbitåˆ†åˆ«è¡¨ç¤ºRGBè¿™ä¸‰ç§é¢œè‰²,å‰©ä½™çš„8bitç”¨æ¥è¡¨ç¤ºå›¾åƒçš„å…¶ä»–å±žæ€§,å¦‚é€æ˜Žåº¦ç­‰. è™½ç„¶åƒç´ çš„é¢œè‰²é¢œè‰²æ·±åº¦å€¼è¶Šå¤§å›¾åƒè‰²å½©è¶Šä¸°å¯Œ,ä½†ç”±äºŽè®¾å¤‡çš„é™åˆ¶,äººçœ¼åˆ†è¾¨çŽ‡çš„é™åˆ¶,ä¸ä¸€å®šè¦è¿½æ±‚ç‰¹åˆ«æ·±çš„é¢œè‰²æ·±åº¦,ä¸€èˆ¬æ¥è¯´,32bitçš„é¢œè‰²æ·±åº¦å·²ç»è¶³å¤Ÿ.æ­¤å¤–,åƒç´ é¢œè‰²æ·±åº¦è¶Šæ·±,æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´è¶Šå¤§. ä¸€ä¸ªåƒç´ çš„é¢œè‰²æ·±åº¦ä½æ•°é™¤R,G,Båˆ†é‡å ç”¨å›ºå®šbitæ•°è¡¨ç¤ºé¢œè‰²å¤–,ä¸€èˆ¬è¦è…¾å‡º1bitæˆ–å‡ bitä½œä¸ºå±žæ€§(Attribute)ä½.å±žæ€§ä½ç”¨æ¥æŒ‡å®šè¯¥åƒç´ åº”å…·æœ‰çš„æ€§è´¨.ä¾‹å¦‚,åƒç´ çš„é¢œè‰²æ·±åº¦ä¸º32bitæ—¶,R,G,Båˆ†åˆ«ç”¨8bitè¡¨ç¤º,é‚£ä¹ˆä½™ä¸‹çš„8bitå¸¸ç§°ä¸ºaé€šé“(Alpha Channel)ä½,æˆ–ç§°ä¸ºè¦†ç›–(Overlay)ä½,ä¸­æ–­ä½,å±žæ€§ä½,å®ƒç”¨æ¥æŽ§åˆ¶è¯¥åƒç´ ç‚¹çš„é€æ˜Žåº¦.å‡å¦‚å®šä¹‰ä¸€ä¸ªåƒç´ å€¼(A,R,G,B)çš„4ä¸ªåˆ†é‡(å…¶ä¸­Aä¸ºAlphaå±žæ€§ä½æ•°å€¼)éƒ½ç”¨å½’ä¸€åŒ–çš„æ•°å€¼è¡¨ç¤º,é‚£ä¹ˆåƒç´ 91,1,0,0)æ—¶æ˜¾ç¤ºçº¢è‰².å½“åƒç´ ä¸º(0.5,1,0,0)æ—¶,é¢„ä¹˜çš„ç»“æžœå°±å˜æˆäº†(0.5.0.5,0,0),è¿™è¡¨ç¤ºçŽ°åœ¨æ˜¾ç¤ºçš„çº¢è‰²çš„å¼ºåº¦å‡ä½Žä¸€åŠ.ç”¨è¿™ç§å®šä¹‰åƒç´ å±žæ€§çš„åŠžæ³•å¯ä»¥å®žçŽ°ä¸¤å¹…å½©è‰²å›¾åƒä¹‹é—´çš„é€æ˜Žå åŠ æ•ˆæžœ.å½“Alphaæ•°å€¼å¾ˆå°æ—¶,æ¸²æŸ“å‡ºæ¥çš„æ•ˆæžœæ˜¯å‡ ä¹Žé€æ˜Žçš„,å¦‚çŽ»ç’ƒ;å½“Alphaæ•°å€¼å¤„äºŽä¸­é—´çš„ä½ç½®æ—¶,åˆ™å¯ä»¥å¾—åˆ°ä¸€ç§åŠé€æ˜Žçš„æ•ˆæžœ;å½“Alphaæ•°å€¼æŽ¥è¿‘255æ—¶,æ˜¯å‡ ä¹Žä¸é€æ˜Žçš„æ•ˆæžœ.è¿™ç§å±žæ€§ä½çš„åŠ å…¥ä¸ºå®žçŽ°é€æ˜Žå’ŒåŠé€æ˜Žçš„æ˜¾ç¤ºæŽ‰è¿‡å¸¦æ¥äº†æ–¹ä¾¿. 1.2.3æ–‡ä»¶çš„å¤§å°å›¾å½¢å’Œå›¾åƒæ–‡ä»¶çš„å¤§å°(ä¹Ÿç§°ä¸ºæ•°æ®é‡)æ˜¯æŒ‡åœ¨ç£ç›˜ä¸Šå­˜å‚¨æ•´å¹…å›¾åƒæ‰€æœ‰ç‚¹çš„å­—èŠ‚æ•°(Bytes),åæ˜ äº†å›¾åƒæ‰€éœ€æ•°æ®å­˜å‚¨ç©ºé—´çš„å¤§å°,å¯æŒ‰ä¸‹é¢çš„å…¬å¼è®¡ç®—: æ–‡ä»¶å­—èŠ‚æ•° = å›¾åƒåˆ†è¾¨çŽ‡ * å›¾åƒæ·±åº¦/8 ä»Žå…¬å¼çœ‹,å›¾åƒæ–‡ä»¶çš„å¤§å°ä¸Žå›¾åƒçš„é¢œè‰²å’Œå†…å®¹æ— å…³.å…¶å®žåœ¨å®žé™…åº”ç”¨ä¸­,ä¸ºäº†èŠ‚çœå­˜å‚¨ç©ºé—´,æ€»è¦å¯¹å›¾åƒåº”ç”¨æŸç§åŽ‹ç¼©æ–‡ä»¶æ ¼å¼.è¿™æ ·,ä¸åŒçš„å›¾åƒä¼šå› ä¸ºå†…å®¹çš„ä¸åŒè€Œä½¿æ–‡ä»¶çš„å¤§å°æœ‰æ‰€ä¸åŒ.ç›¸å¯¹äºŽé¢œè‰²å±‚æ¬¡å¤š,å›¾å½¢å¤æ‚çš„å›¾åƒæ–‡ä»¶è¾ƒå¤§.ä½†å„ç§å›¾åƒæ–‡ä»¶çš„æœ€å¤§å€¼(æ–‡ä»¶å­—èŠ‚æ•°)éƒ½ä¸ä¼šè¶…è¶Šç”±ä¸Šå¼å†³å®šçš„å­—èŠ‚æ•°. 1.2.4 çœŸå½©è‰²,ä¼ªå½©è‰²ä¸Žç›´æŽ¥è‰² çœŸå½©è‰²(True Color):çœŸå½©è‰²æ˜¯æŒ‡åœ¨ç»„æˆä¸€å¹…å½©è‰²å›¾åƒçš„æ¯ä¸ªåƒç´ å€¼ä¸­,æœ‰R,G,Bè¿™3ä¸ªåŸºè‰²åˆ†é‡,æ¯ä¸ªåŸºè‰²åˆ†é‡ç›´æŽ¥å†³å®šæ˜¾ç¤ºè®¾å¤‡çš„åŸºè‰²å¼ºåº¦,è¿™æ ·äº§ç”Ÿçš„å½©è‰²ç§°ä¸ºçœŸå½©è‰².ä¾‹å¦‚,ç”¨RGBçš„8:8:8æ–¹å¼è¡¨ç¤ºä¸€å¹…å½©è‰²å›¾åƒ,å°±æ˜¯R,G,Béƒ½ç”¨8bitæ¥è¡¨ç¤º,æ¯ä¸ªåŸºè‰²åˆ†é‡å ä¸€ä¸ªå­—èŠ‚,å…±3ä¸ªå­—èŠ‚,æ¯ä¸ªåƒç´ çš„é¢œè‰²å°±æ˜¯ç”±è¿™3å­—èŠ‚ä¸­çš„æ•°å€¼ç›´æŽ¥å†³å®š,å¯ç”Ÿæˆçš„é¢œè‰²æ•°å°±æ˜¯2çš„24æ¬¡ä¸­,å…±è®¡16777216ä¸­. ä¼ªå½©è‰²(Pseudo Color) ä¼ªå½©è‰²å›¾åƒæ˜¯æ¯ä¸ªåƒç´ çš„é¢œè‰²ä¸æ˜¯ç”±æ¯ä¸ªåŸºè‰²åˆ†é‡çš„æ•°å€¼ç›´æŽ¥å†³å®š,è€Œæ˜¯æŠŠåƒç´ å€¼å½“åšå½©è‰²æŸ¥æ‰¾è¡¨(CLUT,Color-Look-Up Table)çš„è¡¨é¡¹å…¥å£åœ°å€,åŽ»æŸ¥æ‰¾ä¸€ä¸ªæ˜¾ç¤ºå›¾åƒæ—¶ä½¿ç”¨çš„RGBå¼ºåº¦å€¼,ç”¨æŸ¥æ‰¾å‡ºçš„R,G,Bå¼ºåº¦å€¼äº§ç”Ÿçš„å½©è‰²ç§°ä¸ºä¼ªå½©è‰².å½©è‰²æŸ¥æ‰¾è¡¨æ˜¯ä¸€ä¸ªäº‹å…ˆåˆ¶ä½œå¥½çš„è¡¨,è¡¨é¡¹å…¥å£åœ°å€ä¹Ÿç§°ä¸ºç´¢å¼•å·.å½©è‰²å›¾åƒæœ¬èº«çš„åƒç´ å€¼å’Œå½©è‰²æŸ¥æ‰¾è¡¨ä¸­çš„ç´¢å¼•å·æœ‰ä¸€ä¸ªå˜æ¢å…³ç³»,ä¹Ÿå¯ä»¥æ˜¯ç”¨è‡ªå·±å®šä¹‰çš„å˜æ¢å…³ç³».ä½¿ç”¨æŸ¥æ‰¾å¾—åˆ°çš„æ•°å€¼åœ¨æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºçš„é¢œè‰²æ˜¯çœŸçš„,ä½†ä¸æ˜¯å›¾åƒæœ¬èº«çœŸæ­£çš„é¢œè‰²,å› æ­¤ç§°å…¶ä¸ºä¼ªå½©è‰²; ç›´æŽ¥è‰²(Direct Color):æŠŠåƒç´ å€¼çš„R,G,Båˆ†é‡ä½œä¸ºå•ç‹¬çš„ç´¢å¼•å€¼,é€šè¿‡ç›¸åº”çš„å½©è‰²å˜æ¢è¡¨æ‰¾å‡ºR,G,Bå„è‡ªçš„åŸºè‰²ç¨‹åº¦,ç”¨è¿™ä¸ªå¼ºåº¦å€¼äº§ç”Ÿçš„å½©è‰²ç§°å…¶ä¸ºç›´æŽ¥è‰².çœŸå½©è‰²ç³»ç»Ÿè™½ç„¶ä¹Ÿæ˜¯é‡‡ç”¨R,G,Båˆ†é‡æ¥å†³å®šåŸºè‰²å¼ºåº¦,ä½†è¿™æ˜¯ç”±R,G,Bç»å˜æ¢åŽå†³å®šçš„,è¿™ä¸Žç›´æŽ¥ç”¨R,G,Bå†³å®šåŸºè‰²åŸºè‰²å¼ºåº¦äº§ç”Ÿçš„é¢œè‰²å°±æœ‰å·®åˆ«.æ¯”è¾ƒè€Œè¨€,ç›´æŽ¥è‰²åœ¨æ˜¾ç¤ºå™¨ä¸Šæ˜¾ç¤ºå½©è‰²å›¾åƒçœ‹èµ·æ¥æ›´çœŸå®ž,æ›´è‡ªç„¶. ä¼ªå½©è‰²ç³»ç»Ÿæ˜¯æŠŠæ•´ä¸ªåƒç´ å½“åšæŸ¥æ‰¾è¡¨çš„ç´¢å¼•å€¼è¿›è¡Œå½©è‰²å˜æ¢,è€Œç›´æŽ¥è‰²ç³»ç»Ÿæ˜¯å¯¹R,G,Båˆ†é‡åˆ†åˆ«é‡‡ç”¨æŸ¥æ‰¾è¡¨è¿›è¡Œå˜æ¢,å› æ­¤ä¼ªå½©è‰²ç³»ç»Ÿè‰²å½©è¿˜åŽŸåº¦è‡ªç„¶å°±æŸ¥å¤šäº†. 1.3å›¾å½¢ä¸Žå›¾åƒçš„åŸºæœ¬ç±»åž‹1.3.1ä½å›¾ä¸ŽçŸ¢é‡å›¾ ä½å›¾(Bit-mapped Graphics) çŸ¢é‡å›¾(Vector Graphic) ä½å›¾å’ŒçŸ¢é‡å›¾çš„å…³ç³» 1.3.2 å›¾å½¢ä¸Žå›¾åƒçš„åŒºåˆ«ä¸Žè”ç³»2.å›¾å½¢ä¸Žå›¾åƒçš„å¤„ç†2.1å›¾å½¢ä¸Žå›¾åƒçš„èŽ·å–2.1.1 å›¾å½¢ä¸Žå›¾åƒçš„æ•°å­—åŒ–2.1.2 å›¾å½¢çš„èŽ·å–2.1.3 å›¾åƒçš„èŽ·å–2.2å›¾å½¢ä¸Žå›¾åƒçš„å­˜å‚¨2.2.1é™æ€å›¾å½¢ä¸Žå›¾åƒå¸¸è§æ–‡ä»¶å­˜å‚¨æ ¼å¼2.2.2 åŠ¨æ€å›¾å½¢ä¸Žå›¾åƒå¸¸è§æ–‡ä»¶å­˜å‚¨æ ¼å¼2.2.3 æ–‡ä»¶å­˜å‚¨æ ¼å¼çš„æ•°æ®ç»“æž„2.3å›¾å½¢ä¸Žå›¾åƒçš„æ˜¾ç¤º2.3.1æ˜ å°„æ˜¾ç¤ºåŽŸç†2.3.2ç¡¬å¤åˆ¶è®¾å¤‡2.4å›¾å½¢ä¸Žå›¾åƒçš„å¤„ç†2.4.1 å›¾å½¢ä¸Žå›¾åƒå¤„ç†çš„åŸºæœ¬å†…å®¹2.4.2 å›¾åƒå¤„ç†å®žä¾‹åˆ†æž-å›¾åƒè¯†åˆ«2.4.3 å›¾å½¢ä¸Žå›¾åƒå¤„ç†è½¯ä»¶3.è®¡ç®—æœºåŠ¨ç”»3.1è®¡ç®—æœºåŠ¨ç”»çš„åŽŸç†3.2è®¡ç®—æœºåŠ¨ç”»çš„ç±»åž‹3.3è®¡ç®—æœºåŠ¨ç”»çš„åˆ¶ä½œ3.4è™šæ‹ŸçŽ°å®žåŠ¨ç”»æŠ€æœ¯]]></content>
      <categories>
        <category>media</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[macä¸‹æ‰“åŒ…qtç¨‹åºæˆdmg]]></title>
    <url>%2F2017%2F06%2F18%2Ftips-qt-pack%2F</url>
    <content type="text"><![CDATA[å‚è€ƒhttp://doc.qt.digia.com/4.7-snapshot/appicon.html å›¾ç‰‡æ ¼å¼åœ¨çº¿è½¬æ¢http://iconverticons.com/ï¼Œå¯ä»¥ç”Ÿæˆicnsæ ¼å¼å›¾ç‰‡ã€‚ Test.proä¸­æ·»åŠ macx{ICON = Test.icns} ï¼ˆè®°å¾—æŠŠTest.icnsæ·»åŠ åˆ°å·¥ç¨‹ä¸­ï¼‰ å‘å¸ƒdmbåŒ… QTåœ¨macä¸‹æœ‰ä¸ªå‘å¸ƒå‘½ä»¤ï¼šmacdeployqt æˆ‘çš„macä¸Šmacdeployqtç›®å½•å¦‚ä¸‹ï¼š/Users/duobianxing/QtSDK/Desktop/Qt/4.8.1/gcc/bin å°†macdeployqtçš„è·¯å¾„æ·»åŠ åˆ°çŽ¯å¢ƒå˜é‡é‡Œé¢ ç»ˆç«¯é‡Œ vim /etc/profileï¼ˆå¦‚æžœåœ¨ä¿å­˜æ—¶æœ‰é—®é¢˜ï¼Œå¯ä»¥ç”¨ sudo vim /etc/profileï¼‰1234567891011121314#åœ¨æœ€åŽæ·»åŠ ä¸€è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š# System-wide .profile for sh(1)if [ -x /usr/libexec/path_helper ]; then eval `/usr/libexec/path_helper -s`fiif [ &quot;$&#123;BASH-no&#125;&quot; != &quot;no&quot; ]; then [ -r /etc/bashrc ] &amp;&amp; . /etc/bashrcfi export PATH=/Users/duobianxing/QtSDK/Desktop/Qt/4.8.1/gcc/bin:$PATH cdè¿›å…¥åˆ°Test.appæ‰€åœ¨ç›®å½•ï¼Œç„¶åŽæ‰§è¡Œmacdeployqt extractor.app -verbose=1 -dmgï¼Œå³å¯ç”ŸæˆTest.dmgåŒ…ã€‚]]></content>
      <categories>
        <category>QT</category>
      </categories>
      <tags>
        <tag>QT</tag>
        <tag>MAC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mpegç¼–ç seektoæ–¹æ³•ç²¾ç¡®å®šä½åˆ°æŒ‡å®šå¸§]]></title>
    <url>%2F2017%2F06%2F18%2Ftips-seekto%2F</url>
    <content type="text"><![CDATA[MediaExtractoræœ‰ä¸€ä¸ªæ–¹æ³•å¦‚ä¸‹: 12//All selected tracks seek near the requested time according to the specified mode.public void seekTo (long timeUs, int mode) timeUsæ˜¯è¦seekçš„æ—¶é—´æˆ³ï¼Œmodeæ˜¯seekçš„æ¨¡å¼ï¼Œå¯ä»¥æ˜¯SEEK_TO_PREVIOUS_SYNC, SEEK_TO_CLOSEST_SYNC, SEEK_TO_NEXT_SYNCï¼Œåˆ†åˆ«æ˜¯seekæŒ‡å®šå¸§çš„ä¸Šä¸€å¸§ï¼Œæœ€è¿‘å¸§å’Œä¸‹ä¸€å¸§ã€‚ æ­¤æ–¹æ³•å¯ç”¨äºŽè§†é¢‘æ’­æ”¾æ—¶åŠ¨æ€å®šä½æ’­æ”¾å¸§ï¼Œç”¨äºŽåŠ¨æ€æ”¹å˜è§†é¢‘æ’­æ”¾è¿›åº¦ï¼Œæ¯”å¦‚ä½¿ç”¨seekBaræ¥è·Ÿè¸ªè§†é¢‘æ’­æ”¾è¿›åº¦ï¼ŒåŒæ—¶å¯æ‹–åŠ¨æ¥åŠ¨æ€æ”¹å˜æ’­æ”¾è¿›åº¦ã€‚ mpegç¼–ç å†³å®šseekToæ–¹æ³•æ— æ³•ç²¾ç¡®å®šä½åˆ°æŒ‡å®šå¸§ã€‚å³ä½¿ä½¿ç”¨çš„æ˜¯æŸä¸€å¸§ç²¾ç¡®çš„æ—¶é—´æˆ³ä½œä¸ºseekToæ–¹æ³•çš„è¾“å…¥å‚æ•°ä¹Ÿæ— æ³•å®žçŽ°ç²¾ç¡®å®šä½ã€‚ åœ¨google, stackoverlfowæŸ¥è¯¢å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼šåœ¨æ¯æ¬¡seekToæ–¹æ³•è°ƒç”¨åŽï¼ŒMediaCodecå¿…é¡»ä»Žå…³é”®å¸§å¼€å§‹è§£ç ã€‚å› æ­¤seekToæ–¹æ³•åªä¼šseekåˆ°æœ€è¿‘çš„ï¼ä¸Šä¸€ä¸ªï¼ä¸‹ä¸€ä¸ªå…³é”®å¸§ï¼Œä¹Ÿå°±æ˜¯I-Frame(key frame = I frame = sync frame)ã€‚ä¹‹æ‰€ä»¥è¦ä»Žå…³é”®å¸§å¼€å§‹è§£ç ï¼Œæ˜¯å› ä¸ºæ¯ä¸€å¸§ä¸ä¸€å®šæ˜¯å•ç‹¬ç¼–ç çš„ï¼Œåªæœ‰I frameæ‰æ˜¯å¸§å†…ç¼–ç ï¼Œè€ŒP, B frameéƒ½æ˜¯è¦å‚è€ƒåˆ«çš„å¸§æ¥è¿›è¡Œç¼–ç ï¼Œå› æ­¤å•ç‹¬æ‹¿å‡ºæ¥æ˜¯ä¸å®Œæ•´çš„ä¸€å¸§ã€‚ stackoverflowä¸Šæœ‰äººå¯¹æ­¤çš„åšæ³•æ˜¯ï¼šseekToçš„è¾“å…¥å‚æ•°modeè®¾ç½®ä¸ºSEEK_TO_PREVIOUS_SYNC,å³seekçš„æ˜¯æŒ‡å®šå¸§çš„ä¸Šä¸€ä¸ªå…³é”®å¸§ã€‚ç„¶åŽåˆ¤æ–­å½“å‰çš„æ—¶é—´æˆ³æ˜¯å¦å°äºŽå®šä½å…³é”®å¸§çš„æ—¶é—´æˆ³ï¼Œå¦‚æžœæ˜¯å°±è°ƒç”¨MediaExtractorçš„advanceæ–¹æ³•ï¼Œâ€œå¿«è¿›â€åˆ°æŒ‡å®šå¸§ã€‚ 1234extractor.seekTo(expectedPts, MediaExtractor.SEEK_TO_PREVIOUS_SYNC); while (currentPts &lt; expectedPts) &#123; extractor.advance(); &#125; ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä»ä¸ç†æƒ³ï¼Œå¦‚æžœseekçš„ä½ç½®å’Œå½“å‰ä½ç½®æ¯”è¾ƒè¿œçš„è¯ï¼Œä¼šæœ‰ä¸€å®šå»¶è¿Ÿã€‚è€Œä¸”è§†é¢‘å†…å®¹å¶å°”ä¼šå‡ºçŽ°ä¸å®Œæ•´çš„å¸§çš„é—ªçŽ°ã€‚ ç»è¿‡ä¸€æ®µæ—¶é—´çš„ç ”ç©¶ï¼Œç»ˆäºŽè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ŒçŽ°åœ¨æ’­æ”¾æ—¶å¯ä»¥æ ¹æ®seekBaréšæ—¶æ‹–åŠ¨åˆ°è§†é¢‘ä»»ä½•ä¸€å¸§ï¼Œä¸ä¼šæœ‰ä»»ä½•å»¶è¿Ÿï¼Œç”šè‡³å¯ä»¥å®žçŽ°å€’æ’­äº†ã€‚ å› ä¸ºä¹‹å‰æ’­æ”¾è§†é¢‘çš„æ˜¯è‡ªå·±ç”¨MediaCodec, MediaMuxerç­‰ç¼–ç åˆæˆçš„è§†é¢‘æ–‡ä»¶ï¼Œåœ¨ç¼–ç å‚æ•°è®¾ç½®çš„æ—¶å€™ï¼Œå°†å…³é”®å¸§é—´éš”KEY_I_FRAME_INTERVALè®¾ç½®ä¸ºäº†1ï¼ˆå› ä¸ºè¦æ±‚å‚æ•°ä¸ºæ•´æ•°ï¼‰ã€‚æ³¨æ„è¿™ä¸ªå‚æ•°çš„å•ä½æ˜¯ç§’ï¼Œè€Œä¸æ˜¯å¸§æ•°ï¼ç½‘ä¸Šçœ‹åˆ°å¾ˆå¤šä¾‹å­åŒ…æ‹¬faddençš„bigflakeå’ŒGrafikaä¸Šéƒ½å°†è¿™é‡Œè®¾ç½®ä¸ºäº†20å‡ ã€‚æžå¾—æˆ‘ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯æ¯éš”äºŒåå‡ å¸§å°±æœ‰ä¸€ä¸ªå…³é”®å¸§ã€‚å¦‚æžœè®¾ç½®ä¸º20å‡ ï¼Œé‚£ä¹ˆå°±æ˜¯è¯´ä½ ç”¨MediaCodecç¼–ç å½•åˆ¶ä¸€æ®µ20å¤šç§’çš„è§†é¢‘ï¼Œåªæœ‰å¼€å¤´çš„ä¸€ä¸ªå…³é”®å¸§ï¼å‰©ä¸‹çš„éƒ½æ˜¯Pæˆ–è€…Bå¸§ã€‚ è¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚ä¸€èˆ¬æ¥è¯´æ˜¯æ¯éš”1ç§’æœ‰ä¸€ä¸ªå…³é”®å¸§ï¼Œè¿™æ ·å°±å¯ä»¥seekåˆ°å¯¹åº”ç§’çš„å…³é”®å¸§ã€‚æˆ–è€…è¯´1ç§’å†…å¦‚æžœæœ‰30å¸§ï¼Œé‚£ä¹ˆè¿™30å¸§è‡³å°‘æœ‰ä¸€ä¸ªå…³é”®å¸§ã€‚å› æ­¤æˆ‘å°†KEY_I_FRAME_INTERVALè®¾ç½®ä¸ºäº†1ã€‚ 1mediaFormat.setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, 1); è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨æ’­æ”¾ç”¨è¿™ç§å‚æ•°ç¼–ç çš„è§†é¢‘çš„æ—¶å€™ï¼Œä½¿ç”¨seekToæ–¹æ³•ä¸èƒ½å‡†ç¡®å®šä½å¸§äº†ã€‚ä¹‹å‰æœ‰è®²ï¼ŒseekToæ˜¯å®šä½åˆ°å…³é”®å¸§çš„ï¼Œå¦‚æžœä¸æ˜¯å…³é”®å¸§ï¼Œé‚£ä¹ˆå®ƒä¼šåŽ»æ‰¾ä¸Šä¸€ä¸ªï¼æœ€è¿‘ä¸€ä¸ªï¼ä¸‹ä¸€ä¸ªå…³é”®å¸§ï¼Œè¿™å–å†³äºŽä½ è¾“å…¥å‚æ•°modeçš„è®¾ç½®ã€‚ å› æ­¤å¦‚æžœæƒ³ä½¿ç”¨seekBarå‡†ç¡®æ‹–åŠ¨å®šä½åˆ°ä»»ä½•ä¸€å¸§æ’­æ”¾ï¼Œå¿…é¡»ä¿è¯æ¯ä¸€å¸§éƒ½æ˜¯å…³é”®å¸§ã€‚ äºŽæ˜¯ï¼Œæˆ‘å°†KEY_I_FRAME_INTERVALè®¾ç½®ä¸ºäº†0ï¼š 1mediaFormat.setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, 0); äº‹å®žä¹Ÿè¯æ˜Žè¿™æ ·å¯ä»¥ä¿è¯å½•åˆ¶çš„æ¯ä¸€å¸§éƒ½æ˜¯å…³é”®å¸§ï¼Œå› æ­¤åœ¨ä½¿ç”¨seekToæ–¹æ³•çš„æ—¶å€™ç»ˆäºŽå¯ä»¥å‡†ç¡®å®šä½ä»»ä½•ä¸€å¸§äº†ã€‚æ‹–åŠ¨seekBarçš„æ—¶å€™è§†é¢‘å†…å®¹ä¹Ÿä¼šç«‹åˆ»æ”¹å˜ï¼Œæ— è®ºæ˜¯å¾€å‰è¿˜æ˜¯å¾€åŽï¼Œéƒ½ä¸ä¼šæœ‰ä»»ä½•å»¶è¿Ÿå’Œç”»é¢ä¸å®Œæ•´çš„æƒ…å†µ. ä½†æ˜¯ï¼ŒæŠŠè§†é¢‘æ¯ä¸€å¸§éƒ½è®¾ç½®ä¸ºå…³é”®å¸§æ˜¯å¦åˆç†å‘¢ï¼Ÿæ˜¯å¦ä¼šå å¤ªå¤§ç©ºé—´å‘¢ï¼Ÿ å¸¦ç€è¿™ä¸ªç–‘é—®ï¼Œæˆ‘ä½¿ç”¨ffmpegæŸ¥çœ‹äº†æˆ‘æµ‹è¯•ä½¿ç”¨çš„æ‰‹æœºï¼ˆLenovo X2)å†…ç½®ç›¸æœºå½•åˆ¶çš„è§†é¢‘ã€‚ åªéœ€ä¸€è¡Œä»£ç ï¼š 1ffprobe -show_frames video.mp4 &gt; frames.txt æ‰“å¼€frames.txtå¯ä»¥çœ‹åˆ°æ¯ä¸€å¸§çš„key_frame=1ï¼Œè¡¨ç¤ºæ˜¯å…³é”®å¸§ è¿™è¯´æ˜Žäº†æ‰‹æœºæœ¬æ¥å½•åƒå°±æ˜¯æŠŠæ¯ä¸€å¸§éƒ½ä½œä¸ºå…³é”®å¸§çš„ã€‚ å½“ç„¶ï¼Œä¸èƒ½ä»¥åæ¦‚å…¨ï¼ŒäºŽæ˜¯æˆ‘ä½¿ç”¨iPhone 6så½•åˆ¶çš„ä¸€æ®µæ™®é€šè§†é¢‘å’Œæ…¢åŠ¨ä½œè§†é¢‘ã€‚ä½¿ç”¨ffmpegæŸ¥çœ‹ï¼Œå‘çŽ°æ¯ä¸€å¸§ä¹Ÿéƒ½æ˜¯å…³é”®å¸§ï¼ˆæ…¢åŠ¨ä½œè§†é¢‘1ç§’æœ‰240å¸§ä¹Ÿéƒ½å…¨éƒ¨ä½œä¸ºå…³é”®å¸§ä¹Ÿæ˜¯è›®æ‹¼çš„ï¼‰ã€‚ ç›®å‰æˆ‘æµ‹è¯•çš„ä¸¤éƒ¨æ‰‹æœºéƒ½æ˜¯å¦‚æ­¤ï¼Œå…·ä½“ä¸ºä»€ä¹ˆæ‰‹æœºå½•çš„è§†é¢‘æ¯ä¸€å¸§éƒ½æ˜¯å…³é”®å¸§æˆ‘ä¹Ÿä¸æ˜Žç™½ã€‚è€Œè§†é¢‘æ–‡ä»¶ä½“ç§¯å¤§å°å’Œæ˜¯å¦å°†æ¯ä¸€å¸§è®¾ä¸ºå…³é”®å¸§ä¼¼ä¹Žä¸æˆçº¿æ€§å…³ç³»ï¼Œæ‰€ä»¥å°†KEY_I_FRAME_INTERVALè®¾ç½®ä¸º0çš„æ–¹æ¡ˆæ˜¯å¯è¡Œçš„ã€‚ å› æ­¤åªè¦ä¿è¯è§†é¢‘æ¯å¸§éƒ½æ˜¯å…³é”®å¸§ï¼Œé‚£ä¹ˆseekToæ–¹æ³•å°±å¯ä»¥ç²¾ç¡®å®šä½æŒ‡å®šå¸§äº†ã€‚]]></content>
      <categories>
        <category>media</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>Android</tag>
        <tag>Mpeg</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šåª’ä½“æŠ€æœ¯ç®€ä»‹]]></title>
    <url>%2F2017%2F06%2F07%2Fmedia-intro%2F</url>
    <content type="text"><![CDATA[å…³é”®å¸§é—´éš”å…³é”®å¸§åŒ…å«äº†æ˜¾ç¤ºå¸§éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ æ‰€æœ‰çš„è§†é¢‘éƒ½è‡³å°‘åŒ…å«ä¸€ä¸ªå…³é”®å¸§ï¼Œä½œä¸ºæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªå¸§ã€‚å…¶å®ƒçš„å…³é”®å¸§å¯ç”¨æ¥æ”¹å–„è§†é¢‘çš„è´¨é‡ï¼Œä¸è¿‡å®ƒä»¬ä¹Ÿä¼šå¢žåŠ æ–‡ä»¶å¤§å°ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ¯ä¸€ç§’è§†é¢‘è‡³å°‘éœ€è¦ä½¿ç”¨ 1 ä¸ªå…³é”®å¸§ã€‚è‹¥ä½¿ç”¨æ­¤å…¬å¼ï¼Œåœ¨æ¯ç§’æ’­æ”¾ 25ä¸ªå¸§çš„è§†é¢‘ä¸­ï¼Œæ¯ 25 ä¸ªå¸§å°±ä¼šæœ‰ 1 ä¸ªå…³é”®å¸§ã€‚å¢žåŠ å…³é”®å¸§ä¸ªæ•°å¯æ”¹å–„è´¨é‡ï¼Œä½†æ˜¯åŒæ—¶å¢žåŠ å¸¦å®½å’Œç½‘ç»œè´Ÿè½½ã€‚ ä¸¤ç§å½©ç”µè§†é¢‘åˆ¶å¼ï¼š NTSC (525 lines @ 59.94 Hz) 29.97 fps PAL (625 lines @ 50 Hz) 25 fps NTSCå’ŒPALå±žäºŽå…¨çƒä¸¤å¤§ä¸»è¦çš„ç”µè§†å¹¿æ’­åˆ¶å¼ï¼Œä½†æ˜¯ç”±äºŽç³»ç»ŸæŠ•å°„é¢œè‰²å½±åƒçš„é¢‘çŽ‡è€Œæœ‰æ‰€ä¸åŒã€‚NTSCæ˜¯National Television System Committeeçš„ç¼©å†™ï¼Œå…¶æ ‡å‡†ä¸»è¦åº”ç”¨äºŽæ—¥æœ¬ã€ç¾Žå›½ï¼ŒåŠ æ‹¿å¤§ã€å¢¨è¥¿å“¥ç­‰ç­‰ï¼ŒPAL åˆ™æ˜¯Phase Alternating Lineçš„ç¼©å†™ï¼Œä¸»è¦åº”ç”¨äºŽä¸­å›½ï¼Œé¦™æ¸¯ã€ä¸­ä¸œåœ°åŒºå’Œæ¬§æ´²ä¸€å¸¦ã€‚ GOPæœ€å¤§å¯å«å¸§æ•°ç›®ï¼š18 (NTSC) / 15 (PAL) GOPæ˜¯ç”±å›ºå®šæ¨¡å¼çš„ä¸€ç³»åˆ—Iå¸§ã€På¸§ã€Bå¸§ç»„æˆã€‚ Iå¸§ç¼–ç æ˜¯ä¸ºäº†å‡å°‘ç©ºé—´åŸŸå†—ä½™ï¼ŒPå¸§å’ŒBå¸§æ˜¯ä¸ºäº†å‡å°‘æ—¶é—´åŸŸå†—ä½™ã€‚ å¸¸ç”¨çš„ç»“æž„ç”±15ä¸ªå¸§ç»„æˆï¼Œå…·æœ‰ä»¥ä¸‹å½¢å¼IBBPBBPBBPBBPBBã€‚ç®€ç§°GOP(4,2)ï¼ŒæŒ‡çš„æ˜¯è¯¥å›¾åƒç»„é™¤äº†ä¸€ä¸ªIå¸§å¤–ï¼ŒåŒ…å«äº†4ä¸ªPå¸§ï¼Œå¹¶ä¸”ä»»ä½•ä¸¤ä¸ªPå¸§æˆ–è€…Iã€Pä¹‹é—´éƒ½æœ‰ä¸¤ä¸ªBå¸§ã€‚ GOPï¼ˆGroup of Picturesï¼‰ç­–ç•¥å½±å“ç¼–ç è´¨é‡ï¼šæ‰€è°“GOPï¼Œæ„æ€æ˜¯ç”»é¢ç»„ï¼Œä¸€ä¸ªGOPå°±æ˜¯ä¸€ç»„è¿žç»­çš„ç”»é¢ã€‚MPEGç¼–ç å°†ç”»é¢ï¼ˆå³å¸§ï¼‰åˆ†ä¸ºIã€Pã€Bä¸‰ç§ï¼ŒIæ˜¯å†…éƒ¨ç¼–ç å¸§ï¼ŒPæ˜¯å‰å‘é¢„æµ‹å¸§ï¼ŒBæ˜¯åŒå‘å†…æ’å¸§ã€‚ç®€å•åœ°è®²ï¼ŒIå¸§æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”»é¢ï¼Œè€ŒPå¸§å’ŒBå¸§è®°å½•çš„æ˜¯ç›¸å¯¹äºŽIå¸§çš„å˜åŒ–ã€‚æ²¡æœ‰Iå¸§ï¼ŒPå¸§å’ŒBå¸§å°±æ— æ³•è§£ç ï¼Œè¿™å°±æ˜¯MPEGæ ¼å¼éš¾ä»¥ç²¾ç¡®å‰ªè¾‘çš„åŽŸå› ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹æ‰€ä»¥è¦å¾®è°ƒå¤´å’Œå°¾çš„åŽŸå› ã€‚ MPEG-2 å¸§ç»“æž„ MPEG-2åŽ‹ç¼©çš„å¸§ç»“æž„æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯GOPï¼ˆGroup Of Pictureï¼‰å›¾åƒç»„çš„é•¿åº¦ï¼Œä¸€èˆ¬å¯æŒ‰ç¼–ç æ–¹å¼ä»Ž1ï¼15ï¼›å¦ä¸€ä¸ªæ˜¯Iå¸§å’ŒPå¸§ä¹‹é—´Bå¸§çš„æ•°é‡ï¼Œä¸€èˆ¬æ˜¯1ï¼2ä¸ªã€‚å‰è€…åœ¨ç†è®ºä¸Šè®°å½•ä¸ºNï¼Œå³å¤šå°‘å¸§é‡Œé¢å‡ºçŽ°ä¸€æ¬¡Iå¸§ï¼›åŽè€…æè¿°ä¸ºå¤šå°‘å¸§é‡Œå‡ºçŽ°ä¸€æ¬¡På¸§ï¼Œè®°å½•ä¸ºMã€‚]]></content>
      <categories>
        <category>media</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>éŸ³è§†é¢‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[jniä»‹ç»]]></title>
    <url>%2F2017%2F06%2F07%2Fjni-intro%2F</url>
    <content type="text"><![CDATA[1.Cå›žè°ƒJAVA cä¸­è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸² 1ï¼ˆ*envï¼‰-&gt;NewStringUTF(env,&quot;Huazi åŽä»”&quot;); cä¸­è¿”å›žä¸€ä¸ªæ•°ç»„ 12345678910..................... int i = 0; jintArray array; array =(*env)-&gt;NewIntArray(env,8); for(;i&lt;8;i++) // èµ‹å€¼æˆ 0 ~ 7 (*env)-&gt;SetObjectArrayElement(env,array,i,i); &#125; return array; cä¸­ä½¿ç”¨è°ƒç”¨ä¼ å…¥çš„å‚æ•°æ˜¯æ•°ç»„array æ˜¯ä¼ å…¥çš„æ•°ç»„ 123456789......... int sum =0, i; int len = (*env)-&gt;GetArrayLength(env,array); jint *element =(*env)-&gt;GetIntArrayElement(env,array,0); for(i=0;i&lt;len;i++) &#123; sum+= *(element+i); &#125; return sum; cä¸­è°ƒç”¨javaä¸­ç±»çš„æ–¹æ³• æ²¡æœ‰å‚æ•° åªæœ‰è¿”å›žå€¼String 1234567//()Ljava/lang/String;&quot; è¡¨ç¤ºå‚æ•°ä¸ºç©º è¿”å›žå€¼æ˜¯Stringç±»åž‹ JNIEXPORT jstring JNICALLJava_com_huazi_Demo_getCallBack(JNIENV env,jobject object)&#123; jmethodID mid; jclass cls =(*env)-&gt;FindClass(env,&quot;com/huazi/Demo&quot;); //åŽé¢æ˜¯åŒ…å+ç±»å mid =(*env)-&gt;GetMethodID(env,cls,&quot;TestMethod&quot;,&quot;()Ljava/lang/String;&quot;);//TestMethod javaä¸­çš„æ–¹æ³•å jstring msg =(*env)-&gt;CallObjectMethod(env,object,mid); //object æ³¨æ„ä¸‹æ˜¯jniä¼ è¿‡æ¥çš„jobject return msg; cä¸­è°ƒç”¨javaä¸­ç±»çš„é™æ€æ–¹æ³• æ²¡æœ‰å‚æ•° åªæœ‰è¿”å›žå€¼String 12345678//@&quot;()Ljava/lang/String;&quot; è¡¨ç¤ºå‚æ•°ä¸ºç©º è¿”å›žå€¼æ˜¯Stringç±»åž‹JNIEXPORT jstring JNICALLJava_com_huazi_Demo_getCallBack(JNIENV env,jobject object)&#123; jmethodID mid; jclass cls =(*env)-&gt;FindClass(env,&quot;com/huazi/Demo&quot;); //åŽé¢æ˜¯åŒ…å+ç±»å mid =(*env)-&gt;GeStatictMethodID(env,cls,&quot;TestMethod&quot;,&quot;()Ljava/lang/String;&quot;);// TestMethod javaä¸­çš„æ–¹æ³•å jstring msg =(*env)-&gt;CallStaticObjectMethod(env,cls,mid); //object æ³¨æ„ä¸‹æ˜¯jniä¼ è¿‡æ¥çš„jobject return msg; &#125;]]></content>
      <tags>
        <tag>Android</tag>
        <tag>JNI</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[FFMPEGç¼–è¯‘ä¹‹Mac]]></title>
    <url>%2F2017%2F06%2F07%2Fffmpeg-compile-mac%2F</url>
    <content type="text"><![CDATA[Macä¸‹FFMPEGä½¿ç”¨There are a few ways to get FFmpeg on OS X. One is to build it yourself. Compiling on Mac OS X is as easy as any other *nix machine, there are just a few caveats(è­¦å‘Š). The general procedure is get the source, then ./configure ; make &amp;&amp; sudo make install, though specific configure flags are possible. Another is to use some â€œbuild helperâ€ tool, to install it for you. For example, homebrew or macports, see the homebrew section in this document. Alternatively, if you are unable to compile, or do not want to install homebrew, you can simply download a static build for OS X, but it may not contain the features you want. Typically this involves unzipping an FFmpeg distribution file [like .zip file], then running it from within the newly extracted files/directories. æ‰‹åŠ¨ç¼–è¯‘FFMPEG1.ä¸‹è½½FFMPEGæºç ä½¿ç”¨git clone https://github.com/FFmpeg/FFmpegä»Žgithubä¸‹è½½ffmpegæºç ,åˆ‡æ¢åˆ°è¦ä½¿ç”¨çš„ç›®æ ‡åˆ†æ”¯(è¿™é‡Œä½¿ç”¨release/3.3):git checkout -b r3.3 origin/release/3.3,æˆ–è€…ç›´æŽ¥ä»Žgithubä¸‹è½½åˆ†æ”¯release/3.3çš„åŽ‹ç¼©åŒ…,è§£åŽ‹. 2.å‡†å¤‡XcodeStarting with Lion 10.7, Xcode is available for free from the Mac App Store and is required to compile anything on your Mac. Make sure you install the Command Line Tools from Preferences &gt; Downloads &gt; Components. Older versions are still available with an AppleID and free Developer account at â€‹developer.apple.com. 3.å‡†å¤‡HomeBrewå·¥å…·To get ffmpeg for OS X, you first have to install â€‹Homebrew. If you donâ€™t want to use Homebrew, see the section below. 1ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; Then: 12brew install automake fdk-aac git lame libass libtool libvorbis libvpx \opus sdl shtool texi2html theora wget x264 x265 xvid yasm Mac OS X Lion comes with Freetype already installed (older versions may need â€˜X11â€™ selected during installation), but in an atypical location: /usr/X11. Running freetype-config in Terminal can give the locations of the individual folders, like headers, and libraries, so be prepared to add lines like CFLAGS=freetype-config --cflags LDFLAGS=freetype-config --libs PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib/pkgconfig:/usr/lib/pkgconfig:/usr/X11/lib/pkgconfig before ./configure or add them to your $HOME/.profile file. 4.ç¼–è¯‘Once you have compiled all of the codecs/libraries you want, you can now download the FFmpeg source either with Git or the from release tarball links on the website. Study the output of ./configure â€“help and make sure youâ€™ve enabled all the features you want, remembering that â€“enable-nonfree and â€“enable-gpl will be necessary for some of the dependencies above. A sample command is: 123456git clone http://source.ffmpeg.org/git/ffmpeg.git ffmpegcd ffmpeg./configure --prefix=/usr/local/ffmpeg --enable-gpl --enable-nonfree --enable-libass \--enable-libfdk-aac --enable-libfreetype --enable-libmp3lame \--enable-libtheora --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265 --enable-libopus --enable-libxvidmake &amp;&amp; sudo make install --prefixæŒ‡å®šç¼–è¯‘å®ŒæˆåŽå®‰è£…è·¯å¾„,è¿™é‡ŒæŒ‡å®šåˆ°/usr/local/ffmpeg,å®‰è£…å®Œæˆä¼šåœ¨/usr/local/ffmpegä¸‹ç”Ÿæˆ:bin,include,lib,shareå››ä¸ªç›®å½• å®‰è£…çŽ¯å¢ƒä»‹ç»A package consists of several related files which are installed in several directories. The configure step usually allows the user to specify the so-called install prefix, and is usually specified through the configure option configure â€“prefix=PREFIX, where PREFIX usually is by default /usr/local. The prefix specifies the common directory where all the components are installed. The following directories are usually involved in the installation: PREFIX/bin: contains the generated binaries (e.g. ffmpeg, ffplay, ffprobe etc. in the case of FFmpeg) PREFIX/include: contains the library headers (e.g. libavutil/avstring.h, libavcodec/avcodec.h, libavformat/avformat.h etc. in case of FFmpeg) required to compile applications linked against the package libraries PREFIX/lib: contains the generated libraries (e.g. libavutil, libavcodec, libavformat etc. in the case of FFmpeg) PREFIX/share: contains various system-independent components; especially documentation files and examples By specifying the prefix it is possible to define the installation layout. By using a shared prefix like /usr/local/, different packages will be installed in the same directory, so in general it will be more difficult to revert the installation. Using a prefix like /opt/PROJECT/, the project will be installed in a dedicated directory, and to remove from the system you can simply remove the /opt/PREFIX path. On the other hand, such installation will require to edit all the environment variables to point to the custom path. Environment variablesSeveral variables defined in the environment affect your package install. In particular, depending on your installation prefix, you may need to update some of these variables in order to make sure that the installed components can be found by the system tools. The list of environment variables can be shown through the command env. A list of the affected variables follows: PATH: defines the list of :-separated paths where the system looks for binaries. For example if you install your package in /usr/local/, you should update the PATH so that it will contain /usr/local/bin. This can be done for example through the command export PATH=/usr/local/bin:$PATH. LD_LIBRARY_PATH: contains the :-separated paths where the system looks for libraries. For example if you install your package in /usr/local/, you should update the LD_LIBRARY_PATH so that it will contain /usr/local/lib. This can be done for example through the command export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH. This variable is sometimes deprecated in favor of the use of ldconfig. CFLAGS: contains flags used by the C compiler, and usually includes preprocessing directives like -IPREFIX/include or compilation flags. Custom CFLAGS are usually prefixed to the source package compiler flags by the source package build system. Alternatively many build systems allow to specify the configure option -extra-cflags. LDFLAGS: these are directives used by the linker, and usually include linking directives like -LPREFIX/lib needed to find libraries installed in custom paths. Custom LDFLAGS are usually prefixed to the source package linker flags by the source package build system. Alternatively, many build systems allow to specify the configure option -extra-ldflags. PKG_CONFIG_PATH: contains the :-separated paths used by pkg-config to detect the pkg-config files used by many build systems to detect the custom CFLAGS/LDFLAGS used by a specific library. In case you installed a package in a non standard path, you need to update these environment libraries so that system tools will be able to detect the package components. This is especially required when running a configure script for a package relying on other installed libraries/headers/tools. Environment variables are usually defined in the profile file, for example .profile defined in the user directory for sh/bash users, and in /etc/profile. This file can be edited to permanently set the custom environment. Alternatively, the variables can be set in a script or in a particular shell session. Remember to export the variables to the child process, e.g. using the export command. Read the fine documentation of your shell for more detailed information. MACä¸‹çš„åŠ¨æ€é“¾æŽ¥åº“æ‰©å±•åWindowsä¸‹.DLL,Linuxä¸‹.so,Mac OS Xä¸‹çš„æ‰©å±•åæ˜¯.dylibã€‚ .dylibæ˜¯Mach-Oæ ¼å¼ï¼Œä¹Ÿå°±æ˜¯Mac OS Xä¸‹çš„äºŒè¿›åˆ¶æ–‡ä»¶æ ¼å¼ã€‚Mac OS Xæä¾›äº†ä¸€ç³»åˆ— å·¥å…·ï¼Œç”¨äºŽåˆ›å»ºå’Œè®¿é—®åŠ¨æ€é“¾æŽ¥åº“ã€‚ ç¼–è¯‘å™¨/usr/bin/ccï¼Œä¹Ÿå°±æ˜¯gccäº†ï¼ŒAppleæ”¹è¿‡çš„ã€‚è¿™ä¸ªä¸»è¦è¿˜æ˜¯ä¸€ä¸ªå£³ï¼ŒåŽ»è°ƒç”¨å…¶ä»– çš„ä¸€äº›éƒ¨ä»¶ã€‚å½“ç„¶åŒæ—¶è¿˜æœ‰/usr/bin/c++ï¼Œç­‰ç­‰ã€‚ æ±‡ç¼–å™¨/usr/bin/as é“¾æŽ¥å™¨/usr/bin/ld MACä¸‹åˆ›å»ºåŠ¨æ€é“¾æŽ¥åº“æ­¥éª¤: é¦–å…ˆæ˜¯ç”Ÿæˆmoduleæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯.oæ–‡ä»¶ã€‚è¿™è·Ÿä¸€èˆ¬çš„unixæ²¡ä»€ä¹ˆåŒºåˆ«ã€‚ä¾‹å¦‚cc -c a.c b.c,å°±å¾—åˆ°a.oå’Œb.o å¯ä»¥ç”¨ldæ¥åˆå¹¶.oæ–‡ä»¶ï¼Œæ¯”å¦‚ld -r -o c.o a.o b.o ç„¶åŽå¯ä»¥ç”¨libtoolæ¥åˆ›å»ºåŠ¨æ€é“¾æŽ¥åº“:libtool -dynamic -o c.dylib a.o b.o.ï¼ˆ è¿™é‡Œä¹Ÿå¯ä»¥ç”¨libtool -static -o c.a a.o b.oå°±åˆ›å»ºé™æ€åº“ï¼‰ å¦‚æžœç”¨gccç›´æŽ¥ç¼–è¯‘ï¼Œæˆ‘è®°å¾—linuxä¸‹ä¸€èˆ¬æ˜¯å¯ä»¥: gcc -shared -o c.so a.c b.c è€Œåœ¨Mac OS Xä¸‹éœ€è¦: gcc -dynamiclib -o c.dylib a.c b.c åŠ¨æ€é“¾æŽ¥åº“çš„å·¥å…·nmæ˜¯æœ€å¸¸ç”¨çš„ï¼Œè¿™ä¸ªç”¨æ³•è·Ÿlinuxä¸‹å·®ä¸å¤š:nm c.dylib,å¯ä»¥çœ‹åˆ°å¯¼å‡ºç¬¦å·è¡¨ï¼Œç­‰ç­‰ã€‚ å¦ä¸€ä¸ªå¸¸ç”¨çš„å·¥å…·æ˜¯otoolï¼Œè¿™ä¸ªæ˜¯Mac OS Xç‹¬æœ‰çš„ã€‚æ¯”å¦‚æƒ³çœ‹çœ‹c.dylibçš„ä¾èµ–å…³ç³»otool -L c.dylib å®˜ç½‘æ–¹æ³• CompilationGuide-Generic CompilationGuide-MacOSX ç¼–è¯‘ffmpeg3.3ç»“æžœæ²¡æœ‰ffplayå› ä¸ºç³»ç»Ÿæ²¡æœ‰sdlçŽ¯å¢ƒæˆ–sdlç‰ˆæœ¬ä¸åŒ¹é…,ffmpeg3.3éœ€è¦sdl2 http://www.libsdl.org/download-2.0.php ä¸‹è½½Source Code SDL2-2.0.5.zip - GPG signed,è§£åŽ‹ç¼©,æ‰§è¡Œå‘½ä»¤: 123./configure make sudo make install è¿›è¡Œç¼–è¯‘]]></content>
      <categories>
        <category>FFMPEG</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>FFMPEG</tag>
        <tag>Mac</tag>
        <tag>éŸ³è§†é¢‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OpenGL Frame Buffer Object(FBO)]]></title>
    <url>%2F2017%2F06%2F03%2Fgl-fbo%2F</url>
    <content type="text"><![CDATA[Update: Framebuffer object extension is promoted as a core feature of OpenGL version 3.0, and is approved by ARB combining the following extensions; EXT_framebuffer_object EXT_framebuffer_blit EXT_framebuffer_multisample EXT_packed_depth_stencil OverviewIn OpenGL rendering pipeline, the geometry data and textures are transformed and passed several tests, and then finally rendered onto a screen as 2D pixels. The final rendering destination of the OpenGL pipeline is called framebuffer. Framebuffer is a collection of 2D arrays or storages utilized by OpenGL; colour buffers, depth buffer, stencil buffer and accumulation buffer. By default, OpenGL uses the framebuffer as a rendering destination that is created and managed entirely by the window system. This default framebuffer is called window-system-provided framebuffer. åœ¨OpenGLæ¸²æŸ“ç®¡çº¿ä¸­ï¼Œå‡ ä½•æ•°æ®å’Œçº¹ç†ç»è¿‡å¤šæ¬¡è½¬åŒ–å’Œå¤šæ¬¡æµ‹è¯•ï¼Œæœ€åŽä»¥äºŒç»´åƒç´ çš„å½¢å¼æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚OpenGLç®¡çº¿çš„æœ€ç»ˆæ¸²æŸ“ç›®çš„åœ°è¢«ç§°ä½œå¸§ç¼“å­˜ï¼ˆframebufferï¼‰ã€‚å¸§ç¼“å†²æ˜¯ä¸€äº›äºŒç»´æ•°ç»„å’ŒOpenGæ‰€ä½¿ç”¨çš„å­˜å‚¨åŒºçš„é›†åˆï¼šé¢œè‰²ç¼“å­˜ã€æ·±åº¦ç¼“å­˜ã€æ¨¡æ¿ç¼“å­˜å’Œç´¯è®¡ç¼“å­˜ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¸§ç¼“å­˜å®Œå…¨ç”±windowç³»ç»Ÿç”Ÿæˆå’Œç®¡ç†ï¼Œç”±OpenGLä½¿ç”¨ã€‚è¿™ä¸ªé»˜è®¤çš„å¸§ç¼“å­˜è¢«ç§°ä½œâ€œwindowç³»ç»Ÿç”Ÿæˆâ€ï¼ˆwindow-system-providedï¼‰çš„å¸§ç¼“å­˜ã€‚ The OpenGL extension, GL_ARB_framebuffer_object provides an interface to create additional non-displayable framebuffer objects (FBO). This framebuffer is called application-created framebuffer in order to distinguish from the default window-system-provided framebuffer. By using framebuffer object (FBO), an OpenGL application can redirect the rendering output to the application-created framebuffer object (FBO) other than the traditional window-system-provided framebuffer. And, it is fully controlled by OpenGL. åœ¨OpenGLæ‰©å±•ä¸­ï¼ŒGL_EXT_framebuffer_objectæä¾›äº†ä¸€ç§åˆ›å»ºé¢å¤–çš„ä¸èƒ½æ˜¾ç¤ºçš„å¸§ç¼“å­˜å¯¹è±¡çš„æŽ¥å£ã€‚ä¸ºäº†å’Œé»˜è®¤çš„â€œwindowç³»ç»Ÿç”Ÿæˆâ€çš„å¸§ç¼“å­˜åŒºåˆ«ï¼Œè¿™ç§å¸§ç¼“å†²æˆä¸ºåº”ç”¨ç¨‹åºå¸§ç¼“å­˜ï¼ˆapplication-createdframebufferï¼‰ã€‚é€šè¿‡ä½¿ç”¨å¸§ç¼“å­˜å¯¹è±¡ï¼ˆFBOï¼‰ï¼ŒOpenGLå¯ä»¥å°†æ˜¾ç¤ºè¾“å‡ºåˆ°å¼•ç”¨ç¨‹åºå¸§ç¼“å­˜å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„â€œwindowç³»ç»Ÿç”Ÿæˆâ€å¸§ç¼“å­˜ã€‚è€Œä¸”ï¼Œå®ƒå®Œå…¨å—OpenGLæŽ§åˆ¶ã€‚ Similar to window-system-provided framebuffer, a FBO contains a collection of rendering destinations; color, depth and stencil buffer. (Note that accumulation buffer is not defined in FBO.) These logical buffers in a FBO are called framebuffer-attachable images, which are 2D arrays of pixels that can be attached to a framebuffer object. ç›¸ä¼¼äºŽwindowç³»ç»Ÿæä¾›çš„å¸§ç¼“å­˜ï¼Œä¸€ä¸ªFBOä¹ŸåŒ…å«ä¸€äº›å­˜å‚¨é¢œè‰²ã€æ·±åº¦å’Œæ¨¡æ¿æ•°æ®çš„åŒºåŸŸã€‚ï¼ˆæ³¨æ„ï¼šæ²¡æœ‰ç´¯ç§¯ç¼“å­˜ï¼‰æˆ‘ä»¬æŠŠFBOä¸­è¿™äº›é€»è¾‘ç¼“å­˜ç§°ä¹‹ä¸ºâ€œå¸§ç¼“å­˜å…³è”å›¾åƒâ€ï¼Œå®ƒä»¬æ˜¯ä¸€äº›èƒ½å¤Ÿå’Œä¸€ä¸ªå¸§ç¼“å­˜å¯¹è±¡å…³è”èµ·æ¥çš„äºŒç»´æ•°ç»„åƒç´ ã€‚ There are two types of framebuffer-attachable images; texture images and renderbuffer images. If an image of a texture object is attached to a framebuffer, OpenGL performs â€œrender to textureâ€. And if an image of a renderbuffer object is attached to a framebuffer, then OpenGL performs â€œoffscreen renderingâ€. æœ‰ä¸¤ç§ç±»åž‹çš„â€œå¸§ç¼“å­˜å…³è”å›¾åƒâ€ï¼šçº¹ç†å›¾åƒï¼ˆtexture imagesï¼‰å’Œæ¸²æŸ“ç¼“å­˜å›¾åƒï¼ˆrenderbuffer imagesï¼‰ã€‚å¦‚æžœçº¹ç†å¯¹è±¡çš„å›¾åƒæ•°æ®å…³è”åˆ°å¸§ç¼“å­˜ï¼ŒOpenGLæ‰§è¡Œçš„æ˜¯â€œæ¸²æŸ“åˆ°çº¹ç†â€ï¼ˆrender to textureï¼‰æ“ä½œã€‚å¦‚æžœæ¸²æŸ“ç¼“å­˜çš„å›¾åƒæ•°æ®å…³è”åˆ°å¸§ç¼“å­˜ï¼ŒOpenGLæ‰§è¡Œçš„æ˜¯ç¦»çº¿æ¸²æŸ“ï¼ˆoffscreen renderingï¼‰ã€‚ By the way, renderbuffer object is a new type of storage object defined in GL_ARB_framebuffer_object extension. It is used as a rendering destination for a single 2D image during rendering process. è¿™é‡Œè¦æåˆ°çš„æ˜¯ï¼Œæ¸²æŸ“ç¼“å­˜å¯¹è±¡æ˜¯åœ¨GL_EXT_framebuffer_objectæ‰©å±•ä¸­å®šä¹‰çš„ä¸€ç§æ–°çš„å­˜å‚¨ç±»åž‹ã€‚åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å®ƒè¢«ç”¨ä½œå­˜å‚¨å•å¹…äºŒç»´å›¾åƒã€‚ The following diagram shows the connectivity among the framebuffer object, texture object and renderbuffer object. Multiple texture objects or renderbuffer objects can be attached to a framebuffer object through the attachment points. ä¸‹é¢è¿™å¹…å›¾æ˜¾ç¤ºäº†å¸§ç¼“å­˜å¯¹è±¡ã€çº¹ç†å¯¹è±¡å’Œæ¸²æŸ“ç¼“å­˜å¯¹è±¡ä¹‹é—´çš„è”ç³»ã€‚å¤šå¤šä¸ªçº¹ç†å¯¹è±¡æˆ–è€…æ¸²æŸ“ç¼“å­˜å¯¹è±¡èƒ½å¤Ÿé€šè¿‡å…³è”ç‚¹å…³è”åˆ°ä¸€ä¸ªå¸§ç¼“å­˜å¯¹è±¡ä¸Šã€‚ There are multiple color attachment points (GL_COLOR_ATTACHMENT0,â€¦, GL_COLOR_ATTACHMENTn), one depth attachment point (GL_DEPTH_ATTACHMENT), and one stencil attachment point (GL_STENCIL_ATTACHMENT) in a framebuffer object. The number of color attachment points is implementation dependent, but each FBO must have at least one color attachement point. You can query the maximum number of color attachement points with GL_MAX_COLOR_ATTACHMENTS, which are supported by a graphics card. The reason that a FBO has multiple color attachement points is to allow to render the color buffer to multiple destinations at the same time. This â€œmultiple render targetsâ€ (MRT) can be accomplished by GL_ARB_draw_buffers extension. Notice that the framebuffer object itself does not have any image storage(array) in it, but, it has only multiple attachment points. åœ¨ä¸€ä¸ªå¸§ç¼“å­˜å¯¹è±¡ä¸­æœ‰å¤šä¸ªé¢œè‰²å…³è”ç‚¹ï¼ˆGL_COLOR_ATTACHMENT0_EXT,â€¦,GL_COLOR_ATTACHMENTn_EXTï¼‰ï¼Œä¸€ä¸ªæ·±åº¦å…³è”ç‚¹ï¼ˆGL_DEPTH_ATTACHMENT_EXTï¼‰ï¼Œå’Œä¸€ä¸ªæ¨¡æ¿å…³è”ç‚¹ï¼ˆGL_STENCIL_ATTACHMENT_EXTï¼‰ã€‚æ¯ä¸ªFBOä¸­è‡³å°‘æœ‰ä¸€ä¸ªé¢œè‰²å…³è”ç‚¹ï¼Œå…¶æ•°ç›®ä¸Žå®žä½“æ˜¾å¡ç›¸å…³ã€‚å¯ä»¥é€šè¿‡GL_MAX_COLOR_ATTACHMENTS_EXTæ¥æŸ¥è¯¢é¢œè‰²å…³è”ç‚¹çš„æœ€å¤§æ•°ç›®ã€‚FBOæœ‰å¤šä¸ªé¢œè‰²å…³è”ç‚¹çš„åŽŸå› æ˜¯è¿™æ ·å¯ä»¥åŒæ—¶å°†é¢œè‰²è€Œæ¢æˆæ¸²æŸ“åˆ°å¤šä¸ªFBOå…³è”åŒºã€‚è¿™ç§â€œå¤šæ¸²æŸ“ç›®æ ‡â€ï¼ˆmultiple rendertargets,MRTï¼‰å¯ä»¥é€šè¿‡GL_ARB_draw_buffersæ‰©å±•å®žçŽ°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šFBOæœ¬èº«å¹¶æ²¡æœ‰ä»»ä½•å›¾åƒå­˜å‚¨åŒºï¼Œåªæœ‰å¤šä¸ªå…³è”ç‚¹ã€‚ Framebuffer object (FBO) provides an efficient switching mechanism; detach the previous framebuffer-attachable image from a FBO, and attach a new framebuffer-attachable image to the FBO. Switching framebuffer-attachable images is much faster than switching between FBOs. FBO provides glFramebufferTexture2D() to switch 2D texture objects, and glFramebufferRenderbuffer() to switch renderbuffer objects. FBOæä¾›äº†ä¸€ç§é«˜æ•ˆçš„åˆ‡æ¢æœºåˆ¶ï¼›å°†å‰é¢çš„å¸§ç¼“å­˜å…³è”å›¾åƒä»ŽFBOåˆ†ç¦»ï¼Œç„¶åŽæŠŠæ–°çš„å¸§ç¼“å­˜å…³è”å›¾åƒå…³è”åˆ°FBOã€‚åœ¨å¸§ç¼“å­˜å…³è”å›¾åƒä¹‹é—´åˆ‡æ¢æ¯”åœ¨FBOä¹‹é—´åˆ‡æ¢è¦å¿«å¾—å¤šã€‚FBOæä¾›äº†glFramebufferTexture2DEXT()æ¥åˆ‡æ¢2Dçº¹ç†å¯¹è±¡å’ŒglFramebufferRenderbufferEXT()æ¥åˆ‡æ¢æ¸²æŸ“ç¼“å­˜å¯¹è±¡ã€‚ Creating Frame Buffer Object (FBO)Creating framebuffer objects is similar to generating vertex buffer objects (VBO). åˆ›å»ºFBOå’Œäº§ç”ŸVBOç±»ä¼¼ã€‚ 12void glGenFramebuffers(GLsizei n, GLuint* ids)void glDeleteFramebuffers(GLsizei n, const GLuint* ids) glGenFramebuffers() requires 2 parameters; the first one is the number of framebuffers to create, and the second parameter is the pointer to a GLuint variable or an array to store a single ID or multiple IDs. It returns the IDs of unused framebuffer objects. ID 0 means the default framebuffer, which is the window-system-provided framebuffer. glGenFramebuffersEXT()éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯è¦åˆ›å»ºçš„å¸§ç¼“å­˜çš„æ•°ç›®ï¼Œç¬¬äºŒä¸ªæ˜¯æŒ‡å‘å­˜å‚¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªIDçš„å˜é‡æˆ–æ•°ç»„çš„æŒ‡é’ˆã€‚å®ƒè¿”å›žæœªä½¿ç”¨çš„FBOçš„IDã€‚IDä¸º0è¡¨ç¤ºé»˜è®¤å¸§ç¼“å­˜ï¼Œå³windowç³»ç»Ÿæä¾›çš„å¸§ç¼“å­˜ã€‚ And, FBO may be deleted by calling glDeleteFramebuffers() when it is not used anymore. å½“FBOä¸å†è¢«ä½¿ç”¨æ—¶ï¼ŒFBOå¯ä»¥é€šè¿‡è°ƒç”¨glDeleteFrameBuffersEXT()æ¥åˆ é™¤ã€‚ 1glBindFramebuffer() Once a FBO is created, it has to be bound before using it. ä¸€æ—¦ä¸€ä¸ªFBOè¢«åˆ›å»ºï¼Œåœ¨ä½¿ç”¨å®ƒä¹‹å‰å¿…é¡»ç»‘å®šã€‚ 1void glBindFramebuffer(GLenum target, GLuint id) The first parameter, target, should be GL_FRAMEBUFFER, and the second parameter is the ID of a framebuffer object. Once a FBO is bound, all OpenGL operations affect onto the current bound framebuffer object. The object ID 0 is reserved for the default window-system provided framebuffer. Therefore, in order to unbind the current framebuffer (FBO), use ID 0 in glBindFramebuffer(). ç¬¬ä¸€ä¸ªå‚æ•°targetåº”è¯¥æ˜¯GL_FRAMEBUFFER_EXTï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯FBOçš„IDå·ã€‚ä¸€æ—¦FBOè¢«ç»‘å®šï¼Œä¹‹åŽçš„æ‰€æœ‰çš„OpenGLæ“ä½œéƒ½ä¼šå¯¹å½“å‰æ‰€ç»‘å®šçš„FBOé€ æˆå½±å“ã€‚IDå·ä¸º0è¡¨ç¤ºç¼ºçœå¸§ç¼“å­˜ï¼Œå³é»˜è®¤çš„windowæä¾›çš„å¸§ç¼“å­˜ã€‚å› æ­¤ï¼Œåœ¨glBindFramebufferEXT()ä¸­å°†IDå·è®¾ç½®ä¸º0å¯ä»¥è§£ç»‘å®šå½“å‰FBOã€‚ Renderbuffer ObjectIn addition, renderbuffer object is newly introduced for offscreen rendering. It allows to render a scene directly to a renderbuffer object, instead of rendering to a texture object. Renderbuffer is simply a data storage object containing a single image of a renderable internal format. It is used to store OpenGL logical buffers that do not have corresponding texture format, such as stencil or depth buffer. å¦å¤–ï¼Œæ¸²æŸ“ç¼“å­˜æ˜¯ä¸ºç¦»çº¿æ¸²æŸ“è€Œæ–°å¼•è¿›çš„ã€‚å®ƒå…è®¸å°†ä¸€ä¸ªåœºæ™¯ç›´æŽ¥æ¸²æŸ“åˆ°ä¸€ä¸ªæ¸²æŸ“ç¼“å­˜å¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯æ¸²æŸ“åˆ°çº¹ç†å¯¹è±¡ä¸­ã€‚æ¸²æŸ“ç¼“å­˜å¯¹è±¡æ˜¯ç”¨äºŽå­˜å‚¨å•å¹…å›¾åƒçš„æ•°æ®å­˜å‚¨åŒºåŸŸã€‚è¯¥å›¾åƒæŒ‰ç…§ä¸€ç§å¯æ¸²æŸ“çš„å†…éƒ¨æ ¼å¼å­˜å‚¨ã€‚å®ƒç”¨äºŽå­˜å‚¨æ²¡æœ‰ç›¸å…³çº¹ç†æ ¼å¼çš„OpenGLé€»è¾‘ç¼“å­˜ï¼Œæ¯”å¦‚æ¨¡æ¿ç¼“å­˜æˆ–è€…æ·±åº¦ç¼“å­˜ã€‚ glGenRenderbuffers()12void glGenRenderbuffers(GLsizei n, GLuint* ids)void glDeleteRenderbuffers(GLsizei n, const Gluint* ids) Once a renderbuffer is created, it returns non-zero positive integer. ID 0 is reserved for OpenGL. ä¸€æ—¦ä¸€ä¸ªæ¸²æŸ“ç¼“å­˜è¢«åˆ›å»ºï¼Œå®ƒè¿”å›žä¸€ä¸ªéžé›¶çš„æ­£æ•´æ•°ã€‚IDä¸º0æ˜¯OpenGLä¿ç•™å€¼ã€‚ glBindRenderbuffer()1void glBindRenderbuffer(GLenum target, GLuint id) Same as other OpenGL objects, you have to bind the current renderbuffer object before referencing it. The target parameter should be GL_RENDERBUFFER for renderbuffer object. å’ŒOpenGLä¸­å…¶ä»–å¯¹è±¡ä¸€æ ·ï¼Œåœ¨å¼•ç”¨æ¸²æŸ“ç¼“å­˜ä¹‹å‰å¿…é¡»ç»‘å®šå½“å‰æ¸²æŸ“ç¼“å­˜å¯¹è±¡ã€‚ä»–targetå‚æ•°åº”è¯¥æ˜¯GL_RENDERBUFFER_EXTã€‚ glRenderbufferStorage()1234void glRenderbufferStorage(GLenum target, GLenum internalFormat, GLsizei width, GLsizei height) When a renderbuffer object is created, it does not have any data storage, so we have to allocate a memory space for it. This can be done by using glRenderbufferStorage(). The first parameter must be GL_RENDERBUFFER. The second parameter would be color-renderable (GL_RGB, GL_RGBA, etc.), depth-renderable (GL_DEPTH_COMPONENT), or stencil-renderable formats (GL_STENCIL_INDEX). The width and height are the dimension of the renderbuffer image in pixels. å½“ä¸€ä¸ªæ¸²æŸ“ç¼“å­˜è¢«åˆ›å»ºï¼Œå®ƒæ²¡æœ‰ä»»ä½•æ•°æ®å­˜å‚¨åŒºåŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦ä¸ºä»–åˆ†é…ç©ºé—´ã€‚è¿™å¯ä»¥é€šè¿‡ç”¨glRenderbufferStorageEXT()å®žçŽ°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯GL_RENDERBUFFER_EXTã€‚ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ç”¨äºŽé¢œè‰²çš„ï¼ˆGL_RGBï¼ŒGL_RGBAï¼Œetc.ï¼‰ï¼Œç”¨äºŽæ·±åº¦çš„ï¼ˆGL_DEPTH_COMPONENTï¼‰ï¼Œæˆ–è€…æ˜¯ç”¨äºŽæ¨¡æ¿çš„æ ¼å¼ï¼ˆGL_STENCIL_INDEXï¼‰ã€‚Widthå’Œheightæ˜¯æ¸²æŸ“ç¼“å­˜å›¾åƒçš„åƒç´ ç»´åº¦ã€‚ The width and height should be less than GL_MAX_RENDERBUFFER_SIZE, otherwise, it generates GL_INVALID_VALUE error. widthå’Œheightå¿…é¡»æ¯”GL_MAX_RENDERBUFFER_SIZE_EXTå°ï¼Œå¦åˆ™å°†ä¼šäº§ç”ŸGL_UNVALID_VALUEé”™è¯¯ã€‚ glGetRenderbufferParameteriv()123void glGetRenderbufferParameteriv(GLenum target, GLenum param, GLint* value) You also get various parameters of the currently bound renderbuffer object. target should be GL_RENDERBUFFER, and the second parameter is the name of parameter. The last is the pointer to an integer variable to store the returned value. The available names of the renderbuffer parameters are; æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—åˆ°å½“å‰ç»‘å®šçš„æ¸²æŸ“ç¼“å­˜å¯¹è±¡çš„ä¸€äº›å‚æ•°ã€‚Targetåº”è¯¥æ˜¯GL_RENDERBUFFER_EXTï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦å¾—åˆ°çš„å‚æ•°åå­—ã€‚æœ€åŽä¸€ä¸ªæ˜¯æŒ‡å‘å­˜å‚¨è¿”å›žå€¼çš„æ•´åž‹é‡çš„æŒ‡é’ˆã€‚æ¸²æŸ“ç¼“å­˜çš„å˜é‡åæœ‰å¦‚ä¸‹: 12345678910GL_RENDERBUFFER_WIDTHGL_RENDERBUFFER_HEIGHTGL_RENDERBUFFER_INTERNAL_FORMATGL_RENDERBUFFER_RED_SIZEGL_RENDERBUFFER_GREEN_SIZEGL_RENDERBUFFER_BLUE_SIZEGL_RENDERBUFFER_ALPHA_SIZEGL_RENDERBUFFER_DEPTH_SIZEGL_RENDERBUFFER_STENCIL_SIZE Attaching images to FBOFBO itself does not have any image storage(buffer) in it. Instead, we must attach framebuffer-attachable images (texture or renderbuffer objects) to the FBO. This mechanism allows that FBO quickly switch (detach and attach) the framebuffer-attachable images in a FBO. It is much faster to switch framebuffer-attachable images than to switch between FBOs. And, it saves unnecessary data copies and memory consumption. For example, a texture can be attached to multiple FBOs, and its image storage can be shared by multiple FBOs. FBOæœ¬èº«æ²¡æœ‰å›¾åƒå­˜å‚¨åŒºã€‚æˆ‘ä»¬å¿…é¡»å¸§ç¼“å­˜å…³è”å›¾åƒï¼ˆçº¹ç†æˆ–æ¸²æŸ“å¯¹è±¡ï¼‰å…³è”åˆ°FBOã€‚è¿™ç§æœºåˆ¶å…è®¸FBOå¿«é€Ÿåœ°åˆ‡æ¢ï¼ˆåˆ†ç¦»å’Œå…³è”ï¼‰å¸§ç¼“å­˜å…³è”å›¾åƒã€‚åˆ‡æ¢å¸§ç¼“å­˜å…³è”å›¾åƒæ¯”åœ¨FBOä¹‹é—´åˆ‡æ¢è¦å¿«å¾—å¤šã€‚è€Œä¸”ï¼Œå®ƒèŠ‚çœäº†ä¸å¿…è¦çš„æ•°æ®æ‹·è´å’Œå†…å­˜æ¶ˆè€—ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªçº¹ç†å¯ä»¥è¢«å…³è”åˆ°å¤šä¸ªFBOä¸Šï¼Œå›¾åƒå­˜å‚¨åŒºå¯ä»¥è¢«å¤šä¸ªFBOå…±äº«ã€‚ Attaching a 2D texture image to FBO12345glFramebufferTexture2D(GLenum target, GLenum attachmentPoint, GLenum textureTarget, GLuint textureId, GLint level) glFramebufferTexture2D() is to attach a 2D texture image to a FBO. The first parameter must be GL_FRAMEBUFFER, and the second parameter is the attachment point where to connect the texture image. A FBO has multiple color attachment points (GL_COLOR_ATTACHMENT0, â€¦, GL_COLOR_ATTACHMENTn), GL_DEPTH_ATTACHMENT, and GL_STENCIL_ATTACHMENT. The third parameter, â€œtextureTargetâ€ is GL_TEXTURE_2D in most cases. The fourth parameter is the identifier of the texture object. The last parameter is the mipmap level of the texture to be attached. glFramebufferTexture2DEXT()æŠŠä¸€å¹…çº¹ç†å›¾åƒå…³è”åˆ°ä¸€ä¸ªFBOã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸€å®šæ˜¯GL_FRAMEBUFFER_EXTï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å…³è”çº¹ç†å›¾åƒçš„å…³è”ç‚¹ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°textureTargetåœ¨å¤šæ•°æƒ…å†µä¸‹æ˜¯GL_TEXTURE_2Dã€‚ç¬¬å››ä¸ªå‚æ•°æ˜¯çº¹ç†å¯¹è±¡çš„IDå·ã€‚æœ€åŽä¸€ä¸ªå‚æ•°æ˜¯è¦è¢«å…³è”çš„çº¹ç†çš„mipmapç­‰çº§ If the textureId parameter is set to 0, then, the texture image will be detached from the FBO. If a texture object is deleted while it is still attached to a FBO, then, the texture image will be automatically detached from the currently bound FBO. However, if it is attached to multiple FBOs and deleted, then it will be detached from only the bound FBO, but will not be detached from any other un-bound FBOs. å¦‚æžœå‚æ•°textureIdè¢«è®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆçº¹ç†å›¾åƒå°†ä¼šè¢«ä»ŽFBOåˆ†ç¦»ã€‚å¦‚æžœçº¹ç†å¯¹è±¡åœ¨ä¾ç„¶å…³è”åœ¨FBOä¸Šæ—¶è¢«åˆ é™¤ï¼Œé‚£ä¹ˆçº¹ç†å¯¹è±¡å°†ä¼šè‡ªåŠ¨ä»Žå½“å‰å¸®çš„FBOä¸Šåˆ†ç¦»ã€‚ç„¶è€Œï¼Œå¦‚æžœå®ƒè¢«å…³è”åˆ°å¤šä¸ªFBOä¸Šç„¶åŽè¢«åˆ é™¤ï¼Œé‚£ä¹ˆå®ƒå°†åªè¢«ä»Žç»‘å®šçš„FBOä¸Šåˆ†ç¦»ï¼Œè€Œä¸ä¼šè¢«ä»Žå…¶ä»–éžç»‘å®šçš„FBOä¸Šåˆ†ç¦»ã€‚ Attaching a Renderbuffer image to FBO1234void glFramebufferRenderbuffer(GLenum target, GLenum attachmentPoint, GLenum renderbufferTarget, GLuint renderbufferId) A renderbuffer image can be attached by calling glFramebufferRenderbuffer(). The first and second parameters are same as glFramebufferTexture2D(). The third parameter must be GL_RENDERBUFFER, and the last parameter is the ID of the renderbuffer object. é€šè¿‡è°ƒç”¨glFramebufferRenderbufferEXT()å¯ä»¥å…³è”æ¸²æŸ“ç¼“å­˜å›¾åƒã€‚å‰ä¸¤ä¸ªå‚æ•°å’ŒglFramebufferTexture2DEXT()ä¸€æ ·ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°åªèƒ½æ˜¯GL_RENDERBUFFER_EXTï¼Œæœ€åŽä¸€ä¸ªå‚æ•°æ˜¯æ¸²æŸ“ç¼“å­˜å¯¹è±¡çš„IDå·ã€‚ If renderbufferId parameter is set to 0, the renderbuffer image will be detached from the attachment point in the FBO. If a renderbuffer object is deleted while it is still attached in a FBO, then it will be automatically detached from the bound FBO. However, it will not be detached from any other non-bound FBOs. å¦‚æžœå‚æ•°renderbufferIdè¢«è®¾ç½®ä¸º0ï¼Œæ¸²æŸ“ç¼“å­˜å›¾åƒå°†ä¼šä»ŽFBOçš„å…³è”ç‚¹åˆ†ç¦»ã€‚å¦‚æžœæ¸²æŸ“ç¼“å­˜å›¾åƒåœ¨ä¾ç„¶å…³è”åœ¨FBOä¸Šæ—¶è¢«åˆ é™¤ï¼Œé‚£ä¹ˆçº¹ç†å¯¹è±¡å°†ä¼šè‡ªåŠ¨ä»Žå½“å‰ç»‘å®šçš„FBOä¸Šåˆ†ç¦»ï¼Œè€Œä¸ä¼šä»Žå…¶ä»–éžç»‘å®šçš„FBOä¸Šåˆ†ç¦»ã€‚ FBO with MSAA (Multi Sample Anti Aliasing)When you render to a FBO, anti-aliasing is not automatically enabled even if you properly create a OpenGL rendering context with the multisampling attribute (SAMPLEBUFFERS_ARB) for window-system-provided framebuffer. In order to activate multisample anti-aliasing mode for rendering to a FBO, you need to prepare and attach multisample images to a FBOâ€™s color and/or depth attachement points. FBO extension provides glRenderbufferStorageMultisample() to create a renderbuffer image for multisample anti-aliasing rendering mode. 12345void glRenderbufferStorageMultisample(GLenum target, GLsizei samples, GLenum internalFormat, GLsizei width, GLsizei height) It adds new parameter, samples on top of glRenderbufferStorage(), which is the number of multisamples for anti-aliased rendering mode. If it is 0, then no MSAA mode is enabled and glRenderbufferStorage() is called instead. You can query the maximum number of samples with GL_MAX_SAMPLES token in glGetIntegerv(). The following code is to create a FBO with multisample colorbuffer and depthbuffer images. Note that if multiple images are attached to a FBO, then all images must have the same number of multisamples. Otherwise, the FBO status is incomplete. 12345678910111213141516171819202122232425262728293031323334// create a 4x MSAA renderbuffer object for colorbufferint msaa = 4;GLuint rboColorId;glGenRenderbuffers(1, &amp;rboColorId);glBindRenderbuffer(GL_RENDERBUFFER, rboColorId);glRenderbufferStorageMultisample(GL_RENDERBUFFER, msaa, GL_RGB8, width, height);// create a 4x MSAA renderbuffer object for depthbufferGLuint rboDepthId;glGenRenderbuffers(1, &amp;rboDepthId);glBindRenderbuffer(GL_RENDERBUFFER, rboDepthId);glRenderbufferStorageMultisample(GL_RENDERBUFFER, msaa, GL_DEPTH_COMPONENT, width, height);// create a 4x MSAA framebuffer objectGLuint fboId;glGenFramebuffers(1, &amp;fboMsaaId);glBindFramebuffer(GL_FRAMEBUFFER, fboMsaaId);// attach colorbuffer image to FBOglFramebufferRenderbuffer(GL_FRAMEBUFFER, // 1. fbo target: GL_FRAMEBUFFER GL_COLOR_ATTACHMENT0, // 2. color attachment point GL_RENDERBUFFER, // 3. rbo target: GL_RENDERBUFFER rboColorId); // 4. rbo ID// attach depthbuffer image to FBOglFramebufferRenderbuffer(GL_FRAMEBUFFER, // 1. fbo target: GL_FRAMEBUFFER GL_DEPTH_ATTACHMENT, // 2. depth attachment point GL_RENDERBUFFER, // 3. rbo target: GL_RENDERBUFFER rboDepthId); // 4. rbo ID// check FBO statusGLenum status = glCheckFramebufferStatus(GL_FRAMEBUFFER);if(status != GL_FRAMEBUFFER_COMPLETE) fboUsed = false; It is important to know that glRenderbufferStorageMultisample() only enables MSAA rendering to FBO. However, you cannot directly use the result from MSAA FBO. If you need to transfer the result to a texture or other non-multisampled framebuffer, you have to convert (downsample) the result to single-sample image using glBlitFramebuffer(). 1234void glBlitFramebuffer(GLint srcX0, GLint srcY0, GLint srcX1, GLint srcY1, // source rectangle GLint dstX0, GLint dstY0, GLint dstX1, GLint dstY1, // destination rect GLbitfield mask, GLenum filter) glBlitFramebuffer() copies a rectangle of images from the source (GL_READ_BUFFER) to the destination framebuffer (GL_DRAW_BUFFER). The â€œmaskâ€ parameter is to specify which buffers are copied, GL_COLOR_BUFFER_BIT, GL_DEPTH_BUFFER_BIT and/or GL_STENCIL_BUFFER_BIT. The last parameter, â€œfilterâ€ is to specify the interpolation mode if the source and destination rectangles are not same. It is either GL_NEAREST or GL_LINEAR. The following code is to transfer a multisampled image from a FBO to another non-multisampled FBO. Notice it requires an additional FBO to get the result of MSAA rendering. Please see fboMsaa.zip for details to perform render-to-texture with MSAA. 12345678910// copy rendered image from MSAA (multi-sample) to normal (single-sample)// NOTE: The multi samples at a pixel in read buffer will be converted// to a single sample at the target pixel in draw buffer.glBindFramebuffer(GL_READ_FRAMEBUFFER, fboMsaaId); // src FBO (multi-sample)glBindFramebuffer(GL_DRAW_FRAMEBUFFER, fboId); // dst FBO (single-sample)glBlitFramebuffer(0, 0, width, height, // src rect 0, 0, width, height, // dst rect GL_COLOR_BUFFER_BIT, // buffer mask GL_LINEAR); // scale filter Checking FBO StatusOnce attachable images (textures and renderbuffers) are attached to a FBO and before performing FBO operation, you must validate if the FBO status is complete or incomplete by using glCheckFramebufferStatus(). If the FBO is not complete, then any drawing and reading command (glBegin(), glCopyTexImage2D(), etc) will be failed. ä¸€æ—¦å…³è”å›¾åƒï¼ˆçº¹ç†å’Œæ¸²æŸ“ç¼“å­˜ï¼‰è¢«å…³è”åˆ°FBOä¸Šï¼Œåœ¨æ‰§è¡ŒFBOçš„æ“ä½œä¹‹å‰ï¼Œä½ å¿…é¡»æ£€æŸ¥FBOçš„çŠ¶æ€ï¼Œè¿™å¯ä»¥é€šè¿‡è°ƒç”¨glCheckFramebufferStatusEXT()å®žçŽ°ã€‚å¦‚æžœè¿™ä¸ªFBObuildingå®Œæ•´ï¼Œé‚£ä¹ˆä»»ä½•ç»˜åˆ¶å’Œè¯»å–å‘½ä»¤ï¼ˆglBegin(),glCopyTexImage2D(), etcï¼‰éƒ½ä¼šå¤±è´¥ã€‚ 1GLenum glCheckFramebufferStatus(GLenum target) glCheckFramebufferStatus() validates all its attached images and framebuffer parameters on the currently bound FBO. And, this function cannot be called within glBegin()/glEnd() pair. The target parameter should be GL_FRAMEBUFFER. It returns non-zero value after checking the FBO. If all requirements and rules are satisfied, then it returns GL_FRAMEBUFFER_COMPLETE. Otherwise, it returns a relevant error value, which tells what rule is violated. glCheckFramebufferStatusEXT()æ£€æŸ¥å½“å‰å¸§ç¼“å­˜çš„å…³è”å›¾åƒå’Œå¸§ç¼“å­˜å‚æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸èƒ½åœ¨glBegin()/glEnd()ä¹‹é—´è°ƒç”¨ã€‚Targetå‚æ•°å¿…é¡»ä¸ºGL_FRAMEBUFFER_EXTã€‚å®ƒè¿”å›žä¸€ä¸ªéžé›¶å€¼ã€‚å¦‚æžœæ‰€æœ‰è¦æ±‚å’Œå‡†åˆ™éƒ½æ»¡è¶³ï¼Œå®ƒè¿”å›žGL_FRAMEBUFFER_COMPLETE_EXTã€‚å¦åˆ™ï¼Œè¿”å›žä¸€ä¸ªç›¸å…³é”™è¯¯ä»£ç å‘Šè¯‰æˆ‘ä»¬å“ªæ¡å‡†åˆ™æ²¡æœ‰æ»¡è¶³ã€‚ The rules of FBO completeness are: The width and height of framebuffer-attachable image must be not zero. If an image is attached to a color attachment point, then the image must have a color-renderable internal format. (GL_RGBA, GL_DEPTH_COMPONENT, GL_LUMINANCE, etc) If an image is attached to GL_DEPTH_ATTACHMENT, then the image must have a depth-renderable internal format. (GL_DEPTH_COMPONENT, GL_DEPTH_COMPONENT24, etc) If an image is attached to GL_STENCIL_ATTACHMENT, then the image must have a stencil-renderable internal format. (GL_STENCIL_INDEX, GL_STENCIL_INDEX8, etc) FBO must have at least one image attached. All images attached a FBO must have the same width and height. All images attached the color attachment points must have the same internal format. FBOå®Œæ•´æ€§å‡†åˆ™æœ‰ï¼š å¸§ç¼“å­˜å…³è”å›¾åƒçš„å®½åº¦å’Œé«˜åº¦å¿…é¡»éžé›¶ã€‚ å¦‚æžœä¸€å¹…å›¾åƒè¢«å…³è”åˆ°ä¸€ä¸ªé¢œè‰²å…³è”ç‚¹ï¼Œé‚£ä¹ˆè¿™å¹…å›¾åƒå¿…é¡»æœ‰é¢œè‰²å¯æ¸²æŸ“çš„å†…éƒ¨æ ¼å¼ï¼ˆGL_RGBA, GL_DEPTH_COMPONENT, GL_LUMINANCE, etc)ã€‚ å¦‚æžœä¸€å¹…è¢«å›¾åƒå…³è”åˆ°GL_DEPTH_ATTACHMENT_EXTï¼Œé‚£ä¹ˆè¿™å¹…å›¾åƒå¿…é¡»æœ‰æ·±åº¦å¯æ¸²æŸ“çš„å†…éƒ¨æ ¼å¼(GL_DEPTH_COMPONENT,GL_DEPTH_COMPONENT24_EXT, etc)ã€‚ å¦‚æžœä¸€å¹…è¢«å›¾åƒå…³è”åˆ°GL_STENCIL_ATTACHMENT_EXTï¼Œé‚£ä¹ˆè¿™å¹…å›¾åƒå¿…é¡»æœ‰æ¨¡æ¿å¯æ¸²æŸ“çš„å†…éƒ¨æ ¼å¼(GL_STENCIL_INDEX,GL_STENCIL_INDEX8_EXT, etc)ã€‚ FBOè‡³å°‘æœ‰ä¸€å¹…å›¾åƒå…³è”ã€‚ è¢«å…³è”åˆ°FBOçš„ç¼©å½±å›¾åƒå¿…é¡»æœ‰ç›¸åŒçš„å®½åº¦å’Œé«˜åº¦ã€‚ è¢«å…³è”åˆ°é¢œè‰²å…³è”ç‚¹ä¸Šçš„æ‰€æœ‰å›¾åƒå¿…é¡»æœ‰ç›¸åŒçš„å†…éƒ¨æ ¼å¼ã€‚ Note that even though all of the above conditions are satisfied, your OpenGL driver may not support some combinations of internal formats and parameters. If a particular implementation is not supported by OpenGL driver, then glCheckFramebufferStatus() returns GL_FRAMEBUFFER_UNSUPPORTED. æ³¨æ„ï¼šå³ä½¿ä»¥ä¸Šæ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ï¼Œä½ çš„OpenGLé©±åŠ¨ä¹Ÿå¯èƒ½ä¸æ”¯æŒæŸäº›æ ¼å¼å’Œå‚æ•°çš„ç»„åˆã€‚å¦‚æžœä¸€ç§ç‰¹åˆ«çš„å®žçŽ°ä¸è¢«OpenGLé©±åŠ¨æ”¯æŒï¼Œé‚£ä¹ˆglCheckFramebufferStatusEXT()è¿”å›žGL_FRAMEBUFFER_UNSUPPORTED_EXTã€‚ The sample code provides some utility functions to report the information of the current FBO; printFramebufferInfo() and checkFramebufferStatus(). Java Code Examples for javax.media.opengl.GL.GL_FRAMEBUFFER_COMPLETE_EXT GL_EXT_discard_framebufferOverviewThis extension provides a new command, DiscardFramebufferEXT, which causes the contents of the named framebuffer attachable images to become undefined. The contents of the specified buffers are undefined until a subsequent operation modifies the content, and only the modified region is guaranteed to hold valid content. Effective usage of this command may provide an implementation with new optimization opportunities. Some OpenGL ES implementations cache framebuffer images in a small pool of fast memory. Before rendering, these implementations must load the existing contents of one or more of the logical buffers (color, depth, stencil, etc.) into this memory. After rendering, some or all of these buffers are likewise stored back to external memory so their contents can be used again in the future. In many applications, some or all of the logical buffers are cleared at the start of rendering. If so, the effort to load or store those buffers is wasted. Even without this extension, if a frame of rendering begins with a full-screen Clear, an OpenGL ES implementation may optimize away the loading of framebuffer contents prior to rendering the frame. With this extension, an application can use DiscardFramebufferEXT to signal that framebuffer contents will no longer be needed. In this case an OpenGL ES implementation may also optimize away the storing back of framebuffer contents after rendering the frame. Issues1) Should DiscardFramebufferEXTâ€™s argument be a list of COLOR_ATTACHMENTx enums, or should it use the same bitfield from Clear and BlitFramebuffer? RESOLVED: Weâ€™ll use a sized list of framebuffer attachments. This will give us some future-proofing for when MRTs and multisampled FBOs are supported. 2) What happens if the app discards only one of the depth and stencil attachments, but those are backed by the same packed_depth_stencil buffer? a) Generate an error b) Both images become undefined c) Neither image becomes undefined d) Only one of the images becomes undefined RESOLVED: (b) which sort of falls out of Issue 4. 3) How should DiscardFramebufferEXT interact with the default framebuffer? a) Generate an error b) Ignore the hint silently c) The contents of the specified attachments become undefined RESOLVED: (c), with appropriate wording to map FBO attachments to the corresponding default framebufferâ€™s logical buffers 4) What happens when you discard an attachment that doesnâ€™t exist? This is the case where a framebuffer is complete but doesnâ€™t have, for example, a stencil attachment, yet the app tries to discard the stencil attachment. a) Generate an error b) Ignore the hint silently RESOLVED: (b) for two reasons. First, this is just a hint anyway, and if we required error detection, then suddenly an implementation canâ€™t trivially ignore it. Second, this is consistent with Clear, which ignores specified buffers that arenâ€™t present. Example: Render To TextureSometimes, you need to generate dynamic textures on the fly. The most common examples are generating mirroring/reflection effects, dynamic cube/environment maps and shadow maps. Dynamic texturing can be accomplished by rendering the scene to a texture. A traditional way of render-to-texture is to draw a scene to the framebuffer as normal, and then copy the framebuffer image to a texture by using glCopyTexSubImage2D(). æœ‰æ—¶å€™ï¼Œä½ éœ€è¦äº§ç”ŸåŠ¨æ€çº¹ç†ã€‚æ¯”è¾ƒå¸¸è§çš„ä¾‹å­æ˜¯äº§ç”Ÿé•œé¢åå°„æ•ˆæžœã€åŠ¨æ€çŽ¯å¢ƒè´´å›¾å’Œé˜´å½±ç­‰æ•ˆæžœã€‚åŠ¨æ€çº¹ç†å¯ä»¥é€šè¿‡æŠŠåœºæ™¯æ¸²æŸ“åˆ°çº¹ç†æ¥å®žçŽ°ã€‚æ¸²æŸ“åˆ°çº¹ç†çš„ä¸€ç§ä¼ ç»Ÿæ–¹å¼æ˜¯å°†åœºæ™¯ç»˜åˆ¶åˆ°æ™®é€šçš„å¸§ç¼“å­˜ä¸Šï¼Œç„¶åŽè°ƒç”¨glCopyTexSubImage2D()æ‹·è´å¸§ç¼“å­˜å›¾åƒè‡³çº¹ç†ã€‚ Using FBO, we can render a scene directly onto a texture, so we donâ€™t have to use the window-system-provided framebuffer at all. Further more, we can eliminate an additional data copy (from framebuffer to texture). ä½¿ç”¨FBOï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†åœºæ™¯ç›´æŽ¥æ¸²æŸ“åˆ°çº¹ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¿…ä½¿ç”¨windowç³»ç»Ÿæä¾›çš„å¸§ç¼“å­˜ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬èƒ½å¤ŸåŽ»é™¤é¢å¤–çš„æ•°æ®æ‹·è´ï¼ˆä»Žå¸§ç¼“å­˜åˆ°çº¹ç†ï¼‰ï¼›ã€‚ This demo program performs render to texture operation with/without FBO, and compares the performance difference. Other than performance gain, there is another advantage of using FBO. If the texture resolution is larger than the size of the rendering window in traditional render-to-texture mode (without FBO), then the area out of the window region will be clipped. However, FBO does not suffer from this clipping problem. You can create a framebuffer-renderable image larger than the display window. è¿™ä¸ªdemoå®žçŽ°äº†ä½¿ç”¨FBOå’Œä¸ä½¿ç”¨FBOä¸¤ç§æƒ…å†µä¸‹æ¸²æŸ“åˆ°çº¹ç†çš„æ“ä½œï¼Œå¹¶ä¸”æ¯”è¾ƒäº†æ€§èƒ½å·®å¼‚ã€‚é™¤äº†èƒ½å¤ŸèŽ·å¾—æ€§èƒ½ä¸Šçš„æå‡ï¼Œä½¿ç”¨FBOçš„è¿˜æœ‰å¦å¤–ä¸€ä¸ªä¼˜ç‚¹ã€‚åœ¨ä¼ ç»Ÿçš„æ¸²æŸ“åˆ°çº¹ç†çš„æ¨¡å¼ä¸­ï¼ˆä¸ä½¿ç”¨FBOï¼‰ï¼Œå¦‚æžœçº¹ç†åˆ†è¾¨çŽ‡æ¯”æ¸²æŸ“çª—å£çš„å°ºå¯¸å¤§ï¼Œè¶…å‡ºçª—å£åŒºåŸŸçš„éƒ¨åˆ†å°†è¢«å‰ªåˆ‡æŽ‰ã€‚ç„¶åŽï¼Œä½¿ç”¨FBOå°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚ä½ å¯ä»¥äº§ç”Ÿæ¯”æ˜¾ç¤ºçª—å£å¤§çš„å¸§ç¼“å­˜æ¸²æŸ“å›¾åƒã€‚ The following codes is to setup a FBO and framebuffer-attachable images before the rendering loop is started. Note that not only a texture image is attached to the FBO, but also, a renderbuffer image is attached to the depth attachment point of the FBO. We do not actually use this depth buffer, however, the FBO itself needs it for depth test. If we donâ€™t attach this depth renderable image to the FBO, then the rendering output will be corrupted because of missing depth test. If stencil test is also required during FBO rendering, then additional renderbuffer image should be attached to GL_STENCIL_ATTACHMENT. ä»¥ä¸‹ä»£ç åœ¨æ¸²æŸ“å¾ªçŽ¯å¼€å§‹ä¹‹å‰ï¼Œå¯¹FBOå’Œå¸§ç¼“å­˜å…³è”å›¾åƒè¿›è¡Œäº†åˆå§‹åŒ–ã€‚æ³¨æ„åªæœ‰ä¸€å¹…çº¹ç†å›¾åƒè¢«å…³è”åˆ°FBOï¼Œä½†æ˜¯ï¼Œä¸€ä¸ªæ·±åº¦æ¸²æŸ“å›¾åƒè¢«å…³è”åˆ°FBOçš„æ·±åº¦å…³è”ç‚¹ã€‚å®žé™…ä¸Šæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªæ·±åº¦ç¼“å­˜ï¼Œä½†æ˜¯FBOæœ¬èº«éœ€è¦å®ƒè¿›è¡Œæ·±åº¦æµ‹è¯•ã€‚å¦‚æžœæˆ‘ä»¬ä¸æŠŠè¿™ä¸ªæ·±åº¦å¯æ¸²æŸ“çš„å›¾åƒå…³è”åˆ°FBOï¼Œé‚£ä¹ˆç”±äºŽç¼ºå°‘æ·±åº¦æµ‹è¯•æ¸²æŸ“è¾“å‡ºç»“æžœæ˜¯ä¸æ­£ç¡®çš„ã€‚å¦‚æžœåœ¨FBOæ¸²æŸ“æœŸé—´æ¨¡æ¿æµ‹è¯•ä¹Ÿæ˜¯å¿…è¦çš„ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦æŠŠé¢å¤–çš„æ¸²æŸ“å›¾åƒå’ŒGL_STENCIL_ATTACHMENT_EXTå…³è”èµ·æ¥ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748...// create a texture objectGLuint textureId;glGenTextures(1, &amp;textureId);glBindTexture(GL_TEXTURE_2D, textureId);glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);glTexParameteri(GL_TEXTURE_2D, GL_GENERATE_MIPMAP, GL_TRUE); // automatic mipmapglTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA8, TEXTURE_WIDTH, TEXTURE_HEIGHT, 0, GL_RGBA, GL_UNSIGNED_BYTE, 0);glBindTexture(GL_TEXTURE_2D, 0);// create a renderbuffer object to store depth infoGLuint rboId;glGenRenderbuffers(1, &amp;rboId);glBindRenderbuffer(GL_RENDERBUFFER, rboId);glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT, TEXTURE_WIDTH, TEXTURE_HEIGHT);glBindRenderbuffer(GL_RENDERBUFFER, 0);// create a framebuffer objectGLuint fboId;glGenFramebuffers(1, &amp;fboId);glBindFramebuffer(GL_FRAMEBUFFER, fboId);// attach the texture to FBO color attachment pointglFramebufferTexture2D(GL_FRAMEBUFFER, // 1. fbo target: GL_FRAMEBUFFER GL_COLOR_ATTACHMENT0, // 2. attachment point GL_TEXTURE_2D, // 3. tex target: GL_TEXTURE_2D textureId, // 4. tex ID 0); // 5. mipmap level: 0(base)// attach the renderbuffer to depth attachment pointglFramebufferRenderbuffer(GL_FRAMEBUFFER, // 1. fbo target: GL_FRAMEBUFFER GL_DEPTH_ATTACHMENT, // 2. attachment point GL_RENDERBUFFER, // 3. rbo target: GL_RENDERBUFFER rboId); // 4. rbo ID// check FBO statusGLenum status = glCheckFramebufferStatus(GL_FRAMEBUFFER);if(status != GL_FRAMEBUFFER_COMPLETE) fboUsed = false;// switch back to window-system-provided framebufferglBindFramebuffer(GL_FRAMEBUFFER, 0);... The rendering procedure of render-to-texture is almost same as normal drawing. We only need to switch the rendering destination from the window-system-provided to the non-displayable, application-created framebuffer (FBO). æ¸²æŸ“åˆ°çº¹ç†çš„è¿‡ç¨‹å’Œæ™®é€šçš„ç»˜åˆ¶è¿‡ç¨‹åŸºæœ¬ä¸€æ ·ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠæ¸²æŸ“çš„ç›®çš„åœ°ç”±windowç³»ç»Ÿæä¾›çš„å¸§ç¼“å­˜æ”¹æˆä¸å¯æ˜¾ç¤ºçš„åº”ç”¨ç¨‹åºåˆ›å»ºçš„å¸§ç¼“å­˜ï¼ˆFBOï¼‰å°±å¯ä»¥äº†ã€‚ 123456789101112131415161718192021...// set rendering destination to FBOglBindFramebuffer(GL_FRAMEBUFFER, fboId);// clear buffersglClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);// draw a scene to a texture directlydraw();// unbind FBOglBindFramebuffer(GL_FRAMEBUFFER, 0);// trigger mipmaps generation explicitly// NOTE: If GL_GENERATE_MIPMAP is set to GL_TRUE, then glCopyTexSubImage2D()// triggers mipmap generation automatically. However, the texture attached// onto a FBO should generate mipmaps manually via glGenerateMipmap().glBindTexture(GL_TEXTURE_2D, textureId);glGenerateMipmap(GL_TEXTURE_2D);glBindTexture(GL_TEXTURE_2D, 0);... Note that glGenerateMipmap() is also included as part of FBO extension in order to generate mipmaps explicitly after modifying the base level texture image. If GL_GENERATE_MIPMAP is set to GL_TRUE, then glTex{Sub}Image2D() and glCopyTex{Sub}Image2D() trigger automatic mipmap generation (in OpenGL version 1.4 or greater). However, FBO operation does not generate its mipmaps automatically when the base level texture is modified because FBO does not call glCopyTex{Sub}Image2D() to modify the texture. Therefore, glGenerateMipmap() must be explicitly called for mipmap generation. æ³¨æ„åˆ°ï¼ŒglGenerateMipmapEXT()ä¹Ÿæ˜¯ä½œä¸ºFBOæ‰©å±•çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥åœ¨æ”¹å˜äº†çº¹ç†å›¾åƒçš„åŸºçº§ä¹‹åŽæ˜¾å¼ç”Ÿæˆmipmapçš„ã€‚å¦‚æžœGL_GENERATE_MIPMAPè¢«è®¾ç½®ä¸ºGL_TRUEï¼Œé‚£ä¹ˆglTex{Sub}Image2D()å’Œ glCopyTex{Sub}Image2D()å°†ä¼šå¯ç”¨è‡ªåŠ¨mipmapç”Ÿæˆï¼ˆåœ¨OpenGLç‰ˆæœ¬1.4æˆ–è€…æ›´é«˜ç‰ˆæœ¬ä¸­ï¼‰ã€‚ç„¶åŽï¼Œå½“çº¹ç†åŸºçº§è¢«æ”¹å˜æ—¶ï¼ŒFBOæ“ä½œä¸ä¼šè‡ªåŠ¨äº§ç”Ÿmipmapsã€‚å› ä¸ºFBOä¸ä¼šè°ƒç”¨glCopyTex{Sub}Image2D()æ¥ä¿®æ”¹çº¹ç†ã€‚å› æ­¤ï¼Œè¦äº§ç”Ÿmipmapï¼ŒglGenerateMipmapEXT()å¿…é¡»è¢«æ˜¾ç¤ºè°ƒç”¨ã€‚ If you need to a post processing of the texture, it is possible to combine with Pixel Buffer Object (PBO) to modify the texture efficiently.PBuffer vs FBOopengles2.0æ¸²æŸ“åˆ°çº¹ç†çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼š ä½¿ç”¨glCopyTexImage2Dæˆ–è€…glCopyTexSubImage2Dï¼Œè¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå¤åˆ¶framebufferä¸­çš„åƒç´ åˆ°çº¹ç†ç¼“å­˜é‡Œé¢ï¼Œä½†è¿™ä¸¤ä¸ªå‡½æ•°æ€§èƒ½æ¯”è¾ƒä½Žä¸‹ï¼Œå¹¶ä¸”è¦æ±‚çº¹ç†çš„å°ºå¯¸å¿…é¡»å°äºŽç­‰äºŽframebufferçš„å°ºå¯¸ã€‚ ä½¿ç”¨ä¸€ä¸ªé™„åŠ åˆ°çº¹ç†çš„pbufferï¼Œæ¥æ‰§è¡Œæ¸²æŸ“åˆ°çº¹ç†çš„æ“ä½œã€‚æˆ‘ä»¬çŸ¥é“ï¼Œçª—å£ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„surfaceå¿…é¡»æ·»åŠ åˆ°ä¸€ä¸ªæ¸²æŸ“çŽ¯å¢ƒé‡Œé¢ï¼Œä½†æ˜¯ï¼Œåœ¨æŸäº›å¹³å°ä¸Šè¦æ±‚æ¯ä¸ªpbufferå’Œçª—å£ç³»ç»Ÿæä¾›çš„surfaceéƒ½éœ€è¦ä¸€ä¸ªå•ç‹¬çš„contextï¼Œæ‰€ä»¥å¦‚æžœè¦æ¸²æŸ“åˆ°pbufferé‡Œé¢çš„è¯ï¼Œå°±ä¼šå‘ç”Ÿcontextçš„åˆ‡æ¢ï¼Œè¿™ç§åˆ‡æ¢æ“ä½œæ—¶å¾ˆè€—æ—¶çš„ã€‚ ä½¿ç”¨fboï¼Œrboç­‰ï¼Œè¿™ç§æ˜¯æœ€é«˜æ•ˆçš„ã€‚ pbufferè·ŸframebufferåŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ç”¨æ¥åšæ¸²æŸ“åˆ°ä¸€ä¸ªoff-screen surfaceä¸Šçš„ï¼Œä½†æ˜¯å¦‚æžœè¦åšçš„æ˜¯æ¸²æŸ“åˆ°ä¸€ä¸ªçº¹ç†ä¸Šï¼Œè¿˜æ˜¯ä½¿ç”¨framebufferï¼Œæ•ˆçŽ‡é«˜äº›ã€‚pbufferçš„ç”¨é€”æ˜¯ï¼šæ¸²æŸ“åˆ°çº¹ç†ä¸Šï¼ŒéšåŽè¿™ä¸ªçº¹ç†å¯ä»¥ç»™å…¶ä»–APIç”¨çš„ï¼Œæ¯”å¦‚openVGã€‚åˆ›å»ºpbufferçš„è¿‡ç¨‹è·Ÿåˆ›å»ºçª—å£surfaceå·®ä¸å¤šçš„ï¼š 1EGLSurface eglCreatePbufferSurface(EGLDisplay display,EGLConfig config,const EGLint *attribList); éœ€è¦åœ¨attribListæŒ‡å®šä¸€äº›pbufferçš„å±žæ€§ã€‚é€‰æ‹©configçš„æ—¶å€™éœ€è¦æŒ‡å®šï¼šEGL_SURFACE_TYPEï¼šEGL_PBUFFER_BIT é¢‘ç¹çš„åœ¨è‡ªå·±åˆ›å»ºçš„fboå’Œçª—å£ç³»ç»Ÿåˆ›å»ºçš„vboä¹‹é—´åˆ‡æ¢ï¼Œæ¯”è¾ƒå½±å“æ€§èƒ½ã€‚ä¸è¦åœ¨æ¯ä¸€å¸§éƒ½åŽ»åˆ›å»ºï¼Œé”€æ¯fboï¼Œvboå¯¹è±¡ã€‚è¦ä¸€æ¬¡åˆ›å»ºå¤šæ¬¡ä½¿ç”¨ã€‚å¦‚æžœä¸€ä¸ªçº¹ç†attachåˆ°ä¸€ä¸ªfboçš„attachment pointï¼Œå°±è¦å°½é‡é¿å…è°ƒç”¨glTexImage2Dæˆ–glTexSubImage2D,glCopyTexImage2Dç­‰åŽ»ä¿®æ”¹çº¹ç†çš„å€¼ã€‚ Presumably eglSwapBuffers has no effect on PBufferSurface (since it is not double-buffer surface) but if it is you would try to read pixels from undefined buffer, with undefined result..å¼•ç”¨ åŽŸæ–‡ è¯‘æ–‡ GL_EXT_discard_framebuffer]]></content>
      <categories>
        <category>OpenGL</category>
      </categories>
      <tags>
        <tag>OpenGL</tag>
        <tag>ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[android textureviewå¤„ç†é¢„è§ˆæ‘„åƒå¤´å˜å½¢é—®é¢˜]]></title>
    <url>%2F2017%2F05%2F04%2Fandroid-view-textureview%2F</url>
    <content type="text"><![CDATA[å½“TextureViewçš„å¤§å°å’ŒåŒ¹é…åˆ°çš„æ‘„åƒå¤´PreviewSizeå®½é«˜æ¯”ä¾‹ä¸å®Œå…¨ä¸€è‡´æ—¶,TextureViewå¯é€šè¿‡setTransformå‡½æ•°å¯¹é¢„è§ˆç”»é¢è¿›è¡Œå¤„ç†åŽå†æ˜¾ç¤ºåˆ°TextureView,å¦‚ä¸‹å¯¹å›¾å½¢å±…ä¸­è£å‰ª: 1234567891011121314151617181920212223242526272829303132333435363738public void sizeNotify(Camera.Size size) &#123; float viewWidth = getWidth(); float viewHeight = getHeight(); float scaleX = 1.0f; float scaleY = 1.0f; int mPreviewWidth = size.width; int mPreviewHeight = size.height; if(viewWidth &lt; viewHeight) &#123; mPreviewWidth = size.height; mPreviewHeight = size.width; &#125; if (mPreviewWidth &gt; viewWidth &amp;&amp; mPreviewHeight &gt; viewHeight) &#123; scaleX = mPreviewWidth / viewWidth; scaleY = mPreviewHeight / viewHeight; &#125; else if (mPreviewWidth &lt; viewWidth &amp;&amp; mPreviewHeight &lt; viewHeight) &#123; scaleY = viewWidth / mPreviewWidth; scaleX = viewHeight / mPreviewHeight; &#125; else if (viewWidth &gt; mPreviewWidth) &#123; scaleY = (viewWidth / mPreviewWidth) / (viewHeight / mPreviewHeight); &#125; else if (viewHeight &gt; mPreviewHeight) &#123; scaleX = (viewHeight / mPreviewHeight) / (viewWidth / mPreviewWidth); &#125; // Calculate pivot points, in our case crop from center int pivotPointX = (int) (viewWidth / 2); int pivotPointY = (int) (viewHeight / 2); Matrix matrix = new Matrix(); matrix.setScale(scaleX, scaleY, pivotPointX, pivotPointY); /*Log.e(TAG, &quot;viewsize:&quot; + viewWidth + &quot; * &quot; + viewHeight + &quot;;prviewSize:&quot; + mPreviewWidth + &quot; * &quot; + mPreviewHeight + &quot;;scale:&quot; + scaleX + &quot; * &quot; + scaleY + &quot;;pivot:&quot; + pivotPointX + &quot; * &quot; + pivotPointY);*/ setTransform(matrix); &#125; TextureViewä¸­setTransformå‡½æ•°è¯´æ˜Ž: Sets the transform to associate with this texture view. The specified transform applies to the underlying surface texture and does not affect the size or position of the view itself, only of its content. Some transforms might prevent the content from drawing all the pixels contained within this viewâ€™s bounds. In such situations, make sure this texture view is not marked opaque.]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>android</tag>
        <tag>view</tag>
        <tag>TextureView</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webrtcä¹‹Native APIs]]></title>
    <url>%2F2017%2F05%2F03%2Fwebrtc-nativeapis%2F</url>
    <content type="text"><![CDATA[Block diagram Calling sequencesSet up a call Receive a call Close down a call Threading modelWebRTC native APIs use two globally available threads: the signaling thread and the worker thread. Depending on how the PeerConnection factory is created, the application can either provide those 2 threads or just let them be created internally. The calls to the Stream APIs and the PeerConnection APIs will be proxied to the signaling thread which means that the application can call those APIs from whatever thread. All callbacks will be made on the signaling thread. The application should return the callback as quickly as possible to avoid blocking the signaling thread. Resource intensive processes should be posted to a different thread. The worker thread is used to handle more resource intensive processes such as data streaming. https://sites.google.com/site/webrtc/native-code/native-apis]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webrtcæºç èµ°è¯»ä¹‹api]]></title>
    <url>%2F2017%2F05%2F02%2Fwebrtc-source-api%2F</url>
    <content type="text"><![CDATA[apiç›®å½•ä¸‹å°è£…äº†webrtcç›¸å…³çš„ä¾›å¤–éƒ¨è°ƒç”¨æŽ¥å£. datachannel.h123// Including this file is deprecated. It is no longer part of the public API.// This only includes the file in its new location for backwards compatibility.#include &quot;webrtc/pc/datachannel.h&quot; datachannelinterface.h DataChannelObserver:Used to implement RTCDataChannel events.The code responding to these callbacks should unwind the stack before using any other webrtc APIs; re-entrancy is not supported. DataChannelInterface: dtmfsenderinterface.h DtmfSenderObserverInterface:DtmfSender callback interface, used to implement RTCDtmfSender events.Applications should implement this interface to get notifications from the DtmfSender. DtmfSenderInterface:The interface of native implementation of the RTCDTMFSender defined by the WebRTC W3C Editorâ€™s Draft. fakemetricsobserver.h/cc FakeMetricsObserver jsep.h IceCandidateInterface:Class representation of an ICE candidate.An instance of this interface is supposed to be owned by one class at a time and is therefore not expected to be thread safe.An instance can be created by CreateIceCandidate. IceCandidateCollection:This class represents a collection of candidates for a specific m= section.Used in SessionDescriptionInterface. SessionDescriptionInterface:Class representation of an SDP session description.An instance of this interface is supposed to be owned by one class at a time and is therefore not expected to be thread safe.An instance can be created by CreateSessionDescription. CreateSessionDescriptionObserver:CreateOffer and CreateAnswer callback interface. SetSessionDescriptionObserver:SetLocalDescription and SetRemoteDescription callback interface. jsepicecandidate.h JsepIceCandidate:ç»§æ‰¿è‡ªIceCandidateInterface JsepCandidateCollection:ç»§æ‰¿è‡ªIceCandidateCollection jsepsessiondescription.h JsepSessionDescription:Implementation of SessionDescriptionInterface. mediaconstraintsinterface.h/cc MediaConstraintsInterface:Interface used for passing arguments about media constraints to the MediaStream and PeerConnection implementation.Constraints may be either â€œmandatoryâ€, which means that unless satisfied,the method taking the constraints should fail, or â€œoptionalâ€, which means they may not be satisfied.. mediastream.h123// Including this file is deprecated. It is no longer part of the public API.// This only includes the file in its new location for backwards compatibility.#include &quot;webrtc/pc/mediastream.h&quot; mediastreaminterface.h/cc OberverInterface NotifierInterface MediaSourceInterface:Base class for sources. A MediaStreamTrack has an underlying source that provides media. A source can be shared by multiple tracks.ç»§æ‰¿è‡ªnotifierInterface MediaStreamTrackInterface:ç»§æ‰¿è‡ªnotifierInterface VideoTrackSourceInterface:VideoTrackSourceInterface is a reference counted source used for VideoTracks. The same source can be used by multiple VideoTracks.ç»§æ‰¿è‡ªMediaSourceinterfaceä¸ŽVideoSourceInterface VideoTrackInterface: ç»§æ‰¿è‡ªMediaStreamTrackInterfaceä¸ŽVideoSourceInterface AudioTrackSinkinterface: AudioSourceInterface:AudioSourceInterface is a reference counted source used for AudioTracks.The same source can be used by multiple AudioTracks.ç»§æ‰¿è‡ªMediaSourceInterface. AudioProcessorInterface:Interface of the audio processor used by the audio track to collect statistics. AudioTrackInterface:ç»§æ‰¿è‡ªMediaStreamTrackInterface MediaStreamInterface: A major difference is that remote audio/video tracks (received by a PeerConnection/RtpReceiver) are not synchronized simply by adding them to the same stream; a session description with the correct â€œa=msidâ€ attributes must be pushed down.Thus, this interface acts as simply a container for tracks. mediastreamproxy.hMove this to .cc file and out of api/. What threads methods // are called on is an implementation detail. mediastreamtrack.h123// Including this file is deprecated. It is no longer part of the public API.// This only includes the file in its new location for backwards compatibility.#include &quot;webrtc/pc/mediastreamtrack.h&quot; mediatypes.h/ccmediatypeåˆ°stringè½¬æ¢ notifier.h Notifier: peerconnectionfactoryproxy.hpeerconnectioninterface.h12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// This file contains the PeerConnection interface as defined in// http://dev.w3.org/2011/webrtc/editor/webrtc.html#peer-to-peer-connections.//// The PeerConnectionFactory class provides factory methods to create// PeerConnection, MediaStream and MediaStreamTrack objects.//// The following steps are needed to setup a typical call using WebRTC://// 1. Create a PeerConnectionFactoryInterface. Check constructors for more// information about input parameters.//// 2. Create a PeerConnection object. Provide a configuration struct which// points to STUN and/or TURN servers used to generate ICE candidates, and// provide an object that implements the PeerConnectionObserver interface,// which is used to receive callbacks from the PeerConnection.//// 3. Create local MediaStreamTracks using the PeerConnectionFactory and add// them to PeerConnection by calling AddTrack (or legacy method, AddStream).//// 4. Create an offer, call SetLocalDescription with it, serialize it, and send// it to the remote peer//// 5. Once an ICE candidate has been gathered, the PeerConnection will call the// observer function OnIceCandidate. The candidates must also be serialized and// sent to the remote peer.//// 6. Once an answer is received from the remote peer, call// SetRemoteDescription with the remote answer.//// 7. Once a remote candidate is received from the remote peer, provide it to// the PeerConnection by calling AddIceCandidate.//// The receiver of a call (assuming the application is &quot;call&quot;-based) can decide// to accept or reject the call; this decision will be taken by the application,// not the PeerConnection.//// If the application decides to accept the call, it should://// 1. Create PeerConnectionFactoryInterface if it doesn&apos;t exist.//// 2. Create a new PeerConnection.//// 3. Provide the remote offer to the new PeerConnection object by calling// SetRemoteDescription.//// 4. Generate an answer to the remote offer by calling CreateAnswer and send it// back to the remote peer.//// 5. Provide the local answer to the new PeerConnection by calling// SetLocalDescription with the answer.//// 6. Provide the remote ICE candidates by calling AddIceCandidate.//// 7. Once a candidate has been gathered, the PeerConnection will call the// observer function OnIceCandidate. Send these candidates to the remote peer. StreamCollectionInterface StatsObserver PeerConnectionInterface PeerConnectionObserver:PeerConnection callback interface, used for RTCPeerConnection events. Application should implement these methods. PeerConnectionFactoryInterface:PeerConnectionFactoryInterface is the factory interface used for creating PeerConnection, MediaStream and MediaStreamTrack objects.The simplest method for obtaiing one, CreatePeerConnectionFactory will create the required libjingle threads, socket and network manager factory classes for networking if none are provided, though it requires that the application runs a message loop on the thread that called the method (see explanation below) If an application decides to provide its own threads and/or implementation of networking classes, it should use the alternate CreatePeerConnectionFactory method which accepts threads as input, and use the CreatePeerConnection version that takes a PortAllocator as an argument. peerconnectionproxy.hproxy.h12345678910111213141516171819202122232425262728293031323334353637383940// This file contains Macros for creating proxies for webrtc MediaStream and// PeerConnection classes.// TODO(deadbeef): Move this to pc/; this is part of the implementation.//// Example usage://// class TestInterface : public rtc::RefCountInterface &#123;// public:// std::string FooA() = 0;// std::string FooB(bool arg1) const = 0;// std::string FooC(bool arg1) = 0;// &#125;;//// Note that return types can not be a const reference.//// class Test : public TestInterface &#123;// ... implementation of the interface.// &#125;;//// BEGIN_PROXY_MAP(Test)// PROXY_SIGNALING_THREAD_DESTRUCTOR()// PROXY_METHOD0(std::string, FooA)// PROXY_CONSTMETHOD1(std::string, FooB, arg1)// PROXY_WORKER_METHOD1(std::string, FooC, arg1)// END_PROXY_MAP()//// Where the destructor and first two methods are invoked on the signaling// thread, and the third is invoked on the worker thread.//// The proxy can be created using//// TestProxy::Create(Thread* signaling_thread, Thread* worker_thread,// TestInterface*).//// The variant defined with BEGIN_SIGNALING_PROXY_MAP is unaware of// the worker thread, and invokes all methods on the signaling thread.//// The variant defined with BEGIN_OWNED_PROXY_MAP does not use// refcounting, and instead just takes ownership of the object being proxied. rtcerror.h/ccrtcerror_unittest.ccrtpparameters.hrtpreceiverinterface.hrtpsender.hrtpsenderinterface.hstatstypes.h/ccstreamcollection.humametrics.hvideosourceproxy.hvideotracksource.hwebrtcsdp.haudio/audio_mixer.h AudioMixer:This class is under development and is not yet intended for for use outside of WebRtc/Libjingle. audio_codecs/audio_decoder.h/cc AudioDecoder audio_codecs/audio_decoder_factory.h AudioDecoderFactory audio_codecs/audio_encoder.h/cc-AudioEncoder: his is the interface class for encoders in AudioCoding module. Each codec type must have an implementation of this class. audio_codecs/audio_encoder_factory.h AudioEncoderFactory audio_codecs/audio_format.h/ccaudio_codecs/builtin_audio_encoder_factory.h/ccaudio_codecs/builtin_audio_decoder_factory.h/cccall/audio_sink.hcall/transport.hortc/mediadescription.h/ccortc/mediadescription_unittest.ccortc/ortcfactoryinterface.hortc/ortcrtpreceiverinterface.hortc/ortcrtpsenderinterface.hortc/packettransportinterface.hortc/rtptransportcontrollerinterface.hortc/rtptransportinterface.hortc/sessiondecription.h/ccortc/sessiondescription_unittest.ccortc/srtptransportinerface.hortc/udptransportinterface.h]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webrtcæºç èµ°è¯»ä¹‹base]]></title>
    <url>%2F2017%2F05%2F02%2Fwebrtc-source-base%2F</url>
    <content type="text"><![CDATA[src/webrtc/baseæ˜¯webrtcåŸºç¡€å¹³å°åº“ï¼ŒåŒ…æ‹¬çº¿ç¨‹ã€é”ã€socket,æ™ºèƒ½æŒ‡é’ˆç­‰. æ™ºèƒ½æŒ‡é’ˆrefcount.hå®šä¹‰äº†rtc::RefCountInterface: 123456789101112131415#include &quot;webrtc/base/refcountedobject.h&quot;namespace rtc &#123;// Reference count interface.class RefCountInterface &#123; public: virtual int AddRef() const = 0; virtual int Release() const = 0; protected: virtual ~RefCountInterface() &#123;&#125;&#125;;&#125; // namespace rtc refcountedobject.hä¸‹å®šä¹‰äº†RefCountedObject: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &lt;utility&gt;#include &quot;webrtc/base/atomicops.h&quot;namespace rtc &#123;template &lt;class T&gt;class RefCountedObject : public T &#123; public: RefCountedObject() &#123;&#125; template &lt;class P0&gt; explicit RefCountedObject(P0&amp;&amp; p0) : T(std::forward&lt;P0&gt;(p0)) &#123;&#125; template &lt;class P0, class P1, class... Args&gt; RefCountedObject(P0&amp;&amp; p0, P1&amp;&amp; p1, Args&amp;&amp;... args) : T(std::forward&lt;P0&gt;(p0), std::forward&lt;P1&gt;(p1), std::forward&lt;Args&gt;(args)...) &#123;&#125; virtual int AddRef() const &#123; return AtomicOps::Increment(&amp;ref_count_); &#125; virtual int Release() const &#123; int count = AtomicOps::Decrement(&amp;ref_count_); if (!count) &#123; delete this; &#125; return count; &#125; // Return whether the reference count is one. If the reference count is used // in the conventional way, a reference count of 1 implies that the current // thread owns the reference and no other thread shares it. This call // performs the test for a reference count of one, and performs the memory // barrier needed for the owning thread to act on the object, knowing that it // has exclusive access to the object. virtual bool HasOneRef() const &#123; return AtomicOps::AcquireLoad(&amp;ref_count_) == 1; &#125; protected: virtual ~RefCountedObject() &#123;&#125; mutable volatile int ref_count_ = 0;&#125;;&#125; // namespace rtc çº¿ç¨‹Threadç½‘ç»œSocket]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
        <tag>æºç </tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webrtcä¹‹sdpåè®®]]></title>
    <url>%2F2017%2F04%2F27%2Fwebrtc-sdp%2F</url>
    <content type="text"><![CDATA[Session Description Protocol(ä¼šè¯æè¿°åè®®)RFCå®šä¹‰SDPçš„åè®®æœ‰ä¸¤ä¸ª: RFC3264: An Offer/Answer Model with the session Description Protocol(SDP),ç”¨æ¥æ¦‚è¿°ä¸€ä¸ªè¯·æ±‚/å“åº”æ¨¡åž‹ RFC2327: SDP:Session Description Protocol,æè¿°æ•°æ®æ ¼å¼. 1.RFC23271.1.æ¦‚è¿°SDP å®Œå…¨æ˜¯ä¸€ç§ä¼šè¯æè¿°æ ¼å¼ â€• å®ƒä¸å±žäºŽä¼ è¾“åè®® â€• å®ƒåªä½¿ç”¨ä¸åŒçš„é€‚å½“çš„ä¼ è¾“åè®®ï¼ŒåŒ…æ‹¬ä¼šè¯é€šçŸ¥åè®®ï¼ˆSAPï¼‰ã€ä¼šè¯åˆå§‹åè®®ï¼ˆSIPï¼‰ã€å®žæ—¶æµåè®®ï¼ˆRTSPï¼‰ã€MIME æ‰©å±•åè®®çš„ç”µå­é‚®ä»¶ä»¥åŠè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰ã€‚SDPåè®®æ˜¯ä¹Ÿæ˜¯åŸºäºŽæ–‡æœ¬çš„åè®®ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åè®®çš„å¯æ‰©å±•æ€§æ¯”è¾ƒå¼ºï¼Œè¿™æ ·å°±ä½¿å…¶å…·æœ‰å¹¿æ³›çš„åº”ç”¨èŒƒå›´ã€‚SDP ä¸æ”¯æŒä¼šè¯å†…å®¹æˆ–åª’ä½“ç¼–ç çš„åå•†ï¼Œæ‰€ä»¥åœ¨æµåª’ä½“ä¸­åªç”¨æ¥æè¿°åª’ä½“ä¿¡æ¯ã€‚åª’ä½“åå•†è¿™ä¸€å—è¦ç”¨RTSPæ¥å®žçŽ°ï¼Ž SDPåŒ…æ‹¬ä»¥ä¸‹ä¸€äº›æ–¹é¢ï¼š ä¼šè¯çš„åç§°å’Œç›®çš„ ä¼šè¯å­˜æ´»æ—¶é—´ åŒ…å«åœ¨ä¼šè¯ä¸­çš„åª’ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š åª’ä½“ç±»åž‹(video, audio, etc) ä¼ è¾“åè®®(RTP/UDP/IP, H.320, etc) åª’ä½“æ ¼å¼(H.261 video, MPEG video, etc) å¤šæ’­æˆ–è¿œç«¯ï¼ˆå•æ’­ï¼‰åœ°å€å’Œç«¯å£ ä¸ºæŽ¥æ”¶åª’ä½“è€Œéœ€çš„ä¿¡æ¯(addresses, ports, formats and so on) ä½¿ç”¨çš„å¸¦å®½ä¿¡æ¯ å¯ä¿¡èµ–çš„æŽ¥æ´½ä¿¡æ¯ï¼ˆContact informationï¼‰ 1.2.SDPåè®®æ ¼å¼SDPæè¿°ç”±è®¸å¤šæ–‡æœ¬è¡Œç»„æˆï¼Œæ–‡æœ¬è¡Œçš„æ ¼å¼ä¸º&lt;ç±»åž‹&gt;=&lt;å€¼&gt;ï¼Œ&lt;ç±»åž‹&gt;æ˜¯ä¸€ä¸ªå­—æ¯ï¼Œ&lt;å€¼&gt;æ˜¯ç»“æž„åŒ–çš„æ–‡æœ¬ä¸²ï¼Œå…¶æ ¼å¼ä¾&lt;ç±»åž‹&gt;è€Œå®šã€‚ ï¼œtypeï¼ž=[CRLF] 1.2.1.fieldsåˆ†ç±» Seeesion Description v(Protocol Version),mnd,The current protocol version.Always â€œ0â€ using RFC4566 o(Origin),Mnd,The session originatorâ€™s name and session identifiers. s(Session Name), Mnd,The textural session Name i(Session Information), opt,Textural information about the session u(Uri),opt, A pointer to supplemental session Information e(Email Address), opt, Email contract information for the person responsible. P(phone Address),opt,Phone contract information for the person responsible c(Connection Data),C,The connection type and Address b(Bandwidth),opt,Proposed bandwidth limits. z(Time Zones), opt, Accounts for daylight saving information k(Encryption Keys),opt,A simple mechanism for exchanging keys, Rarely used. Timing Description t(Timing),mnd, start and end times. r(Repeat Times),opt, Specified the duration and intervals for any session repeats. Media Description m(Media Description),mnd, Media definitions including media type(e.g.â€audioâ€),transport details and formats. i(Session Information),opt c(Connection Data),c b(Bandwidth):opt k( Encryption keys),opt a(Attributes),opt 1.2.2.å…¸åž‹æ ¼å¼1234567891011121314151617181920212223242526Session description v= (protocol version) o= (owner/creator and session identifier) s= (session name) i=* (session information) u=* (URI of description) e=* (email address) p=* (phone number) c=* (connection information - not required if included in all media) b=* (zero or more bandwidth information lines) One or more time descriptions (&quot;t=&quot; and &quot;r=&quot; lines, see below) z=* (time zone adjustments) k=* (encryption key) a=* (zero or more session attribute lines) Zero or more media descriptionsTime description t= (time the session is active) r=* (zero or more repeat times)Media description, if present m= (media name and transport address) i=* (media title) c=* (connection information - optional if included at session-level) b=* (zero or more bandwidth information lines) k=* (encryption key) a=* (zero or more media attribute lines) å¸¦&quot;*&quot;å·çš„æ˜¯å¯é€‰çš„,å…¶ä½™çš„æ˜¯å¿…é¡»çš„ã€‚ä¸€èˆ¬é¡ºåºä¹ŸæŒ‰ç…§ä¸Šé¢çš„é¡ºåºæ¥æŽ’åˆ—ã€‚ 1.2.3.å„typeå¯¹åº”å€¼çš„ç»“æž„åŒ–æ–‡æœ¬ä¸² v= å…¶ä¸­ï¼šnettypeæ˜¯IN,ä»£è¡¨internet,addrtypeæ˜¯IP4æˆ–IP6ã€‚unicast-addressä»»åŠ¡åˆ›å»ºè®¡ç®—æœºçš„åœ°å€ã€‚ æ•´ä¸ªè¿™ä¸ªå±žæ€§ï¼Œæ˜¯å”¯ä¸€è¡¨ç¤ºä¸€ä¸ªä»»åŠ¡ã€‚ e=123@126.com æˆ– p=+1 616 555-6011 å¯¹äºŽä¸€ä¸ªä»»åŠ¡åªèƒ½ä¸¤è€…ä¹‹ä¸­çš„ä¸€ä¸ªï¼Œè¡¨ç¤ºä¼šè®®æŽ§åˆ¶è€…çš„è”ç³»æ–¹å¼ã€‚é‚®ä»¶åœ°å€å¯ä»¥æ˜¯[email]j.doe@example.com[/email] (Jane Doe)å½¢å¼ï¼Œæ‹¬å·é‡Œé¢çš„æ˜¯æè¿°è”ç³»äººçš„åç§°ï¼Œæˆ–è€…Jane Doe &lt;[email]j.doe@example.com[/email]&gt;ï¼Œå‰é¢çš„æ˜¯è”ç³»äººçš„åç§°ã€‚ c= è¿™ä¸ªè¿žæŽ¥æ•°æ®ï¼Œå¯ä»¥æ˜¯ä¼ è¯çº§åˆ«çš„è¿žæŽ¥æ•°æ®ï¼Œæˆ–è€…æ˜¯å•ç‹¬ä¸€ä¸ªåª’ä½“æ•°æ®çš„è¿žæŽ¥æ•°æ®ã€‚åœ¨æ˜¯å¤šæ’­æ—¶ï¼Œconnection-addresså°±è¯¥æ˜¯ä¸€ä¸ªå¤šæ’­ç»„åœ°å€ï¼Œå½“æ˜¯å•æ’­æ—¶ï¼Œconnection-addresså°±è¯¥æ˜¯ä¸€ä¸ªå•æ’­åœ°å€ã€‚å¯¹äºŽaddrtypeæ˜¯IP4çš„æƒ…å†µä¸‹ï¼Œconnection-addressä¸ä»…åŒ…å«IPåœ°å€ï¼Œå¹¶ä¸”è¿˜è¦åŒ…å«a time to live value(TTL 0-255)ï¼Œå¦‚ï¼šc=IN IP4 224.2.36.42/128ï¼ŒIP6æ²¡æœ‰è¿™ä¸ªTTLå€¼ã€‚è¿˜å…è®¸è±¡è¿™æ ·çš„[/]/æ ¼å¼çš„connection-addressã€‚å¦‚ï¼šc=IN IP4 224.2.1.1/127/3ç­‰åŒäºŽåŒ…å«c=IN IP4 224.2.1.1/127, c=IN IP4 224.2.1.2/127, c=IN IP4 224.2.1.3/127ä¸‰è¡Œå†…å®¹ã€‚ b=: bwtypeå¯ä»¥æ˜¯CTæˆ–ASï¼ŒCTæ–¹å¼æ˜¯è®¾ç½®æ•´ä¸ªä¼šè®®çš„å¸¦å®½ï¼ŒASæ˜¯è®¾ç½®å•ä¸ªä¼šè¯çš„å¸¦å®½ã€‚ç¼ºçœå¸¦å®½æ˜¯åƒæ¯”ç‰¹æ¯ç§’ã€‚ t= ï¼Œè¿™ä¸ªå¯ä»¥æœ‰è¡Œï¼ŒæŒ‡å®šå¤šä¸ªä¸è§„åˆ™æ—¶é—´æ®µï¼Œå¦‚æžœæ˜¯è§„åˆ™çš„æ—¶é—´æ®µï¼Œåˆ™r=å±žæ€§å¯ä»¥ä½¿ç”¨ã€‚start-timeå’Œstop- timeéƒ½éµä»ŽNTP(Network Time Protocol),æ˜¯ä»¥ç§’ä¸ºå•ä½ï¼Œè‡ªä»Ž1900ä»¥æ¥çš„æ—¶é—´ã€‚è¦è½¬æ¢ä¸ºUNIXæ—¶é—´ï¼Œå‡åŽ»2208988800ã€‚å¦‚æžœstop-timeè®¾ç½®ä¸º0,åˆ™ä¼šè¯æ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚å¦‚æžœstart-timeä¹Ÿè®¾ç½®ä¸º0ï¼Œåˆ™ä¼šè¯è¢«è®¤ä¸ºæ˜¯æ°¸ä¹…çš„ã€‚ b=: bwtypeå¯ä»¥æ˜¯CTæˆ–ASï¼ŒCTæ–¹å¼æ˜¯è®¾ç½®æ•´ä¸ªä¼šè®®çš„å¸¦å®½ï¼ŒASæ˜¯è®¾ç½®å•ä¸ªä¼šè¯çš„å¸¦å®½ã€‚ç¼ºçœå¸¦å®½æ˜¯åƒæ¯”ç‰¹æ¯ç§’ã€‚ t= ï¼Œè¿™ä¸ªå¯ä»¥æœ‰è¡Œï¼ŒæŒ‡å®šå¤šä¸ªä¸è§„åˆ™æ—¶é—´æ®µï¼Œå¦‚æžœæ˜¯è§„åˆ™çš„æ—¶é—´æ®µï¼Œåˆ™r=å±žæ€§å¯ä»¥ä½¿ç”¨ã€‚start-timeå’Œstop- timeéƒ½éµä»ŽNTP(Network Time Protocol),æ˜¯ä»¥ç§’ä¸ºå•ä½ï¼Œè‡ªä»Ž1900ä»¥æ¥çš„æ—¶é—´ã€‚è¦è½¬æ¢ä¸ºUNIXæ—¶é—´ï¼Œå‡åŽ»2208988800ã€‚å¦‚æžœstop-timeè®¾ç½®ä¸º0,åˆ™ä¼šè¯æ²¡æœ‰æ—¶é—´é™åˆ¶ã€‚å¦‚æžœstart-timeä¹Ÿè®¾ç½®ä¸º0ï¼Œåˆ™ä¼šè¯è¢«è®¤ä¸ºæ˜¯æ°¸ä¹…çš„ã€‚ r= é‡å¤æ¬¡æ•°åœ¨æ—¶é—´è¡¨ç¤ºé‡Œé¢å¯ä»¥å¦‚ä¸‹è¡¨ç¤ºï¼š d - days (86400 seconds) h - hours (3600 seconds) m - minutes (60 seconds) s - seconds (allowed for completeness) z=&lt;adjustment time&gt; &lt;offset&gt; &lt;adjustment time&gt; &lt;offset&gt; .... k=&lt;method&gt; k=&lt;method&gt;:&lt;encryption key&gt; a=&lt;attribute&gt; a=&lt;attribute&gt;:&lt;value&gt; m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt&gt; ... m=&lt;media&gt; &lt;port&gt;/&lt;number of ports&gt; &lt;proto&gt; &lt;fmt&gt; ... a=cat:åˆ†ç±»ï¼Œæ ¹æ®åˆ†ç±»æŽ¥æ”¶è€…éš”ç¦»ç›¸åº”çš„ä¼šè¯ a=keywds:å…³é”®å­—ï¼Œæ ¹æ®å…³é”®å­—éš”ç¦»ç›¸åº”çš„ä¼šè¯ a=tool:åˆ›å»ºä»»åŠ¡æè¿°çš„å·¥å…·çš„åç§°åŠç‰ˆæœ¬å· a=ptime:åœ¨ä¸€ä¸ªåŒ…é‡Œé¢çš„ä»¥æ¯«ç§’ä¸ºå•ä½çš„åª’ä½“é•¿åº¦ a=maxptime:ä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œèƒ½å¤ŸåŽ‹ç¼©è¿›ä¸€ä¸ªåŒ…çš„åª’ä½“é‡ã€‚ a=rtpmap: / [/] a=recvonly a=sendrecv a=sendonly a=inactiveï¼Œ a=orient:å…¶å¯èƒ½çš„å€¼ï¼Œâ€portraitâ€, â€œlandscapeâ€ and â€œseascapeâ€ ã€‚ a=type:,å»ºè®®å€¼æ˜¯ï¼Œâ€broadcastâ€, â€œmeetingâ€, â€œmoderatedâ€, â€œtestâ€ and â€œH332â€ã€‚ a=charset: a=sdplang:æŒ‡å®šä¼šè¯æˆ–è€…æ˜¯åª’ä½“çº§åˆ«ä½¿ç”¨çš„è¯­è¨€ a=framerate:è®¾ç½®æœ€å¤§è§†é¢‘å¸§é€ŸçŽ‡ a=quality:å€¼æ˜¯0-10 a=fmtp: åœ¨SIPåè®®çš„åŒ…å«çš„å†…å®¹æ˜¯SDPæ—¶ï¼Œåº”è¯¥æŠŠContent-Typeè®¾ç½®æˆapplication/sdpã€‚1.3.SDPåè®®ä¾‹å­1.3.1.helixæµåª’ä½“æœåŠ¡å™¨çš„RTSPåè®®ä¸­çš„SDPåè®®:12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152v=0 //SDP version// o fieldå®šä¹‰çš„æºçš„ä¸€äº›ä¿¡æ¯ã€‚å…¶æ ¼å¼ä¸ºï¼šo=&lt;username&gt; &lt;sess-id&gt; &lt;sess-version&gt; &lt;nettype&gt; &lt;addrtype&gt; &lt;unicast-address&gt;o=- 1271659412 1271659412 IN IP4 10.56.136.37 s=&lt;No title&gt;i=&lt;No author&gt; &lt;No copyright&gt; //sessionçš„ä¿¡æ¯c=IN IP4 0.0.0.0 //connect çš„ä¿¡æ¯ï¼Œåˆ†åˆ«æè¿°äº†ï¼šç½‘ç»œåè®®ï¼Œåœ°å€çš„ç±»åž‹ï¼Œè¿žæŽ¥åœ°å€ã€‚c=IN IP4 0.0.0.0t=0 0 //æ—¶é—´ä¿¡æ¯ï¼Œåˆ†åˆ«è¡¨ç¤ºå¼€å§‹çš„æ—¶é—´å’Œç»“æŸçš„æ—¶é—´ï¼Œä¸€èˆ¬åœ¨æµåª’ä½“çš„ç›´æ’­çš„æ—¶ç§»ä¸­è§çš„æ¯”è¾ƒå¤šã€‚a=SdpplinVersion:1610641560 //æè¿°æ€§çš„ä¿¡æ¯a=StreamCount:integer;2 //ç”¨æ¥æè¿°åª’ä½“æµçš„ä¿¡æ¯ï¼Œè¡¨ç¤ºæœ‰ä¸¤ä¸ªåª’ä½“æµã€‚integerè¡¨ç¤ºä¿¡æ¯çš„æ ¼å¼ä¸ºæ•´æ•°ã€‚a=control:*a=DefaultLicenseValue:integer;0 //Licenseä¿¡æ¯a=FileType:string;&quot;MPEG4&quot; ////ç”¨æ¥æè¿°åª’ä½“æµçš„ä¿¡æ¯è¯´æ˜Žå½“å‰åå•†çš„æ–‡ä»¶æ˜¯mpeg4æ ¼å¼çš„æ–‡ä»¶a=LicenseKey:string;&quot;license.Summary.Datatypes.RealMPEG4.Enabled&quot;a=range:npt=0-72.080000 //ç”¨æ¥è¡¨ç¤ºåª’ä½“æµçš„é•¿åº¦m=audio 0 RTP/AVP 96 //åšä¸ºåª’ä½“æè¿°ä¿¡æ¯çš„é‡è¦ç»„æˆéƒ¨åˆ†æè¿°äº†åª’ä½“ä¿¡æ¯çš„è¯¦ç»†å†…å®¹ï¼šè¡¨ç¤ºsessionçš„audioæ˜¯é€šè¿‡RTPæ¥æ ¼å¼ä¼ é€çš„ï¼Œå…¶payloadå€¼ä¸º96ä¼ é€çš„ç«¯å£è¿˜æ²¡æœ‰å®šã€‚b=as:24 //audio çš„bitrateb=RR:1800b=RS:600a=control:streamid=1 //é€šè¿‡åª’ä½“æµ1æ¥å‘é€éŸ³é¢‘a=range:npt=0-72.080000 //è¯´æ˜Žåª’ä½“æµçš„é•¿åº¦ã€‚a=length:npt=72.080000a=rtpmap:96 MPEG4-GENERIC/32000/2 //rtpmapçš„ä¿¡æ¯ï¼Œè¡¨ç¤ºéŸ³é¢‘ä¸ºAACçš„å…¶sampleä¸º32000a=fmtp:96 profile-level-id=15;mode=AAC-hbr;sizelength=13;indexlength=3;indexdeltalength=3;config=1210 //configä¸ºAACçš„è¯¦ç»†æ ¼å¼ä¿¡æ¯a=mimetype:string;&quot;audio/MPEG4-GENERIC&quot;a=Helix-Adaptation-Support:1a=AvgBitRate:integer;48000a=HasOutOfOrderTS:integer;1a=MaxBitRate:integer;48000a=Preroll:integer;1000a=OpaqueData:buffer;&quot;A4CAgCIAAAAEgICAFEAVABgAAAC7gAAAu4AFgICAAhKIBoCAgAEC&quot;a=StreamName:string;&quot;Audio Track&quot;ä¸‹é¢æ˜¯videoçš„ä¿¡æ¯åŸºæœ¬å’Œaudioçš„ä¿¡æ¯ç›¸å¯¹ç§°ï¼Œè¿™é‡Œå°±ä¸å†è¯´äº†ã€‚m=video 0 RTP/AVP 97b=as:150b=RR:11250b=RS:3750a=control:streamid=2a=range:npt=0-72.080000a=length:npt=72.080000a=rtpmap:97 MP4V-ES/2500a=fmtp:97 profile-level-id=1;a=mimetype:string;&quot;video/MP4V-ES&quot;a=Helix-Adaptation-Support:1a=AvgBitRate:integer;300000a=HasOutOfOrderTS:integer;1a=Height:integer;240 //å½±ç‰‡çš„é•¿åº¦a=MaxBitRate:integer;300000a=MaxPacketSize:integer;1400a=Preroll:integer;1000a=Width:integer;320 //å½±ç‰‡çš„å®½åº¦a=OpaqueData:buffer;&quot;AzcAAB8ELyARAbd0AAST4AAEk+AFIAAAAbDzAAABtQ7gQMDPAAABAAAAASAAhED6KFAg8KIfBgEC&quot;a=StreamName:string;&quot;Video Track&quot; 1.3.2.Webrtc SDPç¤ºä¾‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152v=0o=- 0 0 IN IP4 127.0.0.1s=WX-RTC-SERVERt=0 0a=group:BUNDLE audio videoa=msid-semantic: WMS ryODEhTpFzm=audio 1 UDP/TLS/RTP/SAVPF 0 126c=IN IP4 0.0.0.0a=rtcp:1 IN IP4 0.0.0.0a=candidate:1 1 udp 2013266431 192.168.0.68 42739 typ host generation 0a=ice-ufrag:T+0ca=ice-pwd:FzV1T/5PiBI78s630cwSb6a=fingerprint:sha-256 2D:38:ED:09:73:36:F9:18:A6:CB:BC:ED:FB:C5:60:B3:F1:6C:FC:BD:97:57:AD:A6:38:11:9D:D4:8F:77:D6:C3a=setup:activea=recvonlya=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-levela=mid:audioa=rtcp-muxa=rtpmap:0 PCMU/8000a=rtpmap:126 telephone-event/8000m=video 1 UDP/TLS/RTP/SAVPF 124 125 96c=IN IP4 0.0.0.0a=rtcp:1 IN IP4 0.0.0.0a=candidate:1 1 udp 2013266431 192.168.0.68 42739 typ host generation 0a=ice-ufrag:T+0ca=ice-pwd:FzV1T/5PiBI78s630cwSb6a=extmap:2 urn:ietf:params:rtp-hdrext:toffseta=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-timea=extmap:4 urn:3gpp:video-orientationa=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/playout-delaya=fingerprint:sha-256 2D:38:ED:09:73:36:F9:18:A6:CB:BC:ED:FB:C5:60:B3:F1:6C:FC:BD:97:57:AD:A6:38:11:9D:D4:8F:77:D6:C3a=setup:activea=recvonlya=mid:videoa=rtcp-muxa=rtpmap:124 H264/90000a=rtcp-fb:124 ccm fira=rtcp-fb:124 nacka=rtcp-fb:124 nack plia=rtcp-fb:124 goog-remba=fmtp:124 x-google-max-bitrate=800;x-google-min-bitrate=150;x-google-start-bitrate=300a=rtpmap:125 H264/90000a=rtcp-fb:125 ccm fira=rtcp-fb:125 nacka=rtcp-fb:125 nack plia=rtcp-fb:125 goog-remba=fmtp:125 x-google-max-bitrate=800;x-google-min-bitrate=150;x-google-start-bitrate=300a=rtpmap:96 VP8/90000a=rtcp-fb:96 ccm fira=rtcp-fb:96 nacka=rtcp-fb:96 nack plia=rtcp-fb:96 goog-remb 2.RFC3264An Offer/Answer Model with the Session Description Protocol (SDP) 2.1æƒ…æ€åŠ¨è¯å®šä¹‰åœ¨RFC2119: â€œMUSTâ€ï¼Œå¿…é¡»ã€ä¸€å®šè¦ï¼› â€œMUST NOTâ€ï¼Œç¦æ­¢ï¼› â€œREQUIREDâ€ï¼Œéœ€è¦ï¼› â€œSHALLâ€ã€â€SHOULDâ€ï¼Œåº”è¯¥ï¼› â€œSHALL NOTâ€ã€â€SHOULD NOTâ€ï¼Œä¸åº”è¯¥ï¼› â€œRECOMMENDEDâ€ï¼ŒæŽ¨èï¼› â€œMAYâ€ï¼Œå¯ä»¥2.2æœ¯è¯­ åª’ä½“æµï¼ˆMedia Streamï¼‰ï¼Œæˆ–ç§°ä¸ºåª’ä½“ç±»åž‹ï¼ˆMedia Typeï¼‰ï¼Œå³æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„éŸ³é¢‘æµã€è§†é¢‘æµç­‰ï¼Œæ‰€æœ‰é€šä¿¡å®žä½“è¦è¿›è¡Œåª’ä½“äº¤äº’ä¹‹å‰éƒ½å¿…é¡»è¿›è¡Œåª’ä½“æ³¨çš„åå•† åª’ä½“æ ¼å¼ï¼ˆMedia Formatï¼‰ï¼Œæ¯ç§åª’ä½“æµéƒ½æœ‰ä¸åŒçš„ç¼–ç æ ¼å¼ï¼ŒåƒéŸ³é¢‘æœ‰G711ã€G712ç¼–ç ï¼Œè§†é¢‘æœ‰H261ã€H264ç­‰ï¼ŒåƒçŽ°åœ¨æ‰€è°“çš„é«˜æ¸…è§†é¢‘é‡‡ç”¨æ˜¯720Pã€1070Pç­‰ã€‚ å•ä¸€ä¼šè¯ï¼ˆUnitcast Sessionï¼‰ å¤šä¼šè¯ï¼ˆMulticast Sessionsï¼‰ å•ä¸€åª’ä½“æµï¼ˆUnitcast Streamsï¼‰ å¤šåª’ä½“æµï¼ˆMulticast Streamsï¼‰2.3offer/answerrfc3264åè®®[1]ä¸»è¦æ¦‚è¿°ä¸€ä¸ªè¯·æ±‚/å“åº”æ¨¡åž‹ï¼ˆoffer/answerï¼Œä»¥ä¸‹å™è¿°é‡‡ç”¨è‹±æ–‡ï¼‰ï¼ŒåŒ…æ‹¬è¯·æ±‚/å“åº”çš„å®žä½“å’Œä¸åŒé˜¶æ®µçš„æ“ä½œè¡Œä¸ºï¼Œå¦‚åˆå§‹åå•†è¿‡ç¨‹å’Œé‡åå•†è¿‡ç¨‹ï¼Œå¹¶ç®€å•ä»‹ç»æ¶ˆæ¯ä¸­å„ç§å‚æ•°çš„å«ä¹‰ã€‚å…·ä½“å„ä¸ªå‚æ•°çš„è¯¦ç»†è¯´æ˜Žè§rfc2327åè®®[2]2.3.1.å®žä½“,æ¶ˆæ¯Offer/Answeræ¨¡åž‹åŒ…æ‹¬ä¸¤ä¸ªå®žä½“ï¼Œä¸€ä¸ªæ˜¯è¯·æ±‚ä¸»ä½“Offererï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å“åº”å®žä½“Answererï¼Œä¸¤ä¸ªå®žä½“åªæ˜¯åœ¨é€»è¾‘ä¸Šè¿›è¡ŒåŒºåˆ†ï¼Œåœ¨ä¸€å®šæ¡ä»¶å¯ä»¥è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œæ‰‹æœºAå‘èµ·åª’ä½“åå•†è¯·æ±‚ï¼Œé‚£ä¹ˆAå°±æ˜¯Offererï¼Œåä¹‹å¦‚æžœAä¸ºæŽ¥æ”¶è¯·æ±‚åˆ™ä¸ºOffererã€‚ Offererå‘ç»™Answererçš„è¯·æ±‚æ¶ˆæ¯ç§°ä¸ºè¯·æ±‚offerï¼Œå†…å®¹åŒ…æ‹¬åª’ä½“æµç±»åž‹ã€å„ä¸ªåª’ä½“æµä½¿ç”¨çš„ç¼–ç é›†ï¼Œä»¥åŠå°†è¦ç”¨äºŽæŽ¥æ”¶åª’ä½“æµçš„IPå’Œç«¯å£ã€‚ Answereræ”¶åˆ°offerä¹‹åŽï¼Œå›žå¤ç»™Offererçš„æ¶ˆæ¯ç§°ä¸ºå“åº”ï¼Œå†…å®¹åŒ…æ‹¬è¦ä½¿ç”¨çš„åª’ä½“ç¼–ç ï¼Œæ˜¯å¦æŽ¥æ”¶è¯¥åª’ä½“æµä»¥åŠå‘Šè¯‰Offererå…¶ç”¨äºŽæŽ¥æ”¶åª’ä½“æµçš„IPå’Œç«¯å£ã€‚2.3.2.SDPå„ä¸ªå‚æ•°ç®€å•ä»‹ç»ä¸‹é¢ç¤ºä¾‹æ‘˜è‡ª3264åè®®[1] v=0 o=carol 28908764872 28908764872 IN IP4 100.3.6.6 //ä¼šè¯IDå·å’Œç‰ˆæœ¬ s=- //ç”¨äºŽä¼ é€’ä¼šè¯ä¸»é¢˜ t=0 0 //ä¼šè¯æ—¶é—´ï¼Œä¸€èˆ¬ç”±å…¶å®ƒä¿¡ä»¤æ¶ˆæ¯æŽ§åˆ¶ï¼Œå› æ­¤å¡«0 c=IN IP4 192.0.2.4 //æè¿°æœ¬ç«¯å°†ç”¨äºŽä¼ è¾“åª’ä½“æµçš„IP m=audio 0 RTP/AVP 0 1 3 //åª’ä½“ç±»åž‹ ç«¯å£å· æœ¬ç«¯åª’ä½“ä½¿ç”¨çš„ç¼–ç æ ‡è¯†ï¼ˆPayloadï¼‰é›† a=rtpmap:0 PCMU/8000 //rtpmapæ˜ å°„è¡¨ï¼Œå„ç§ç¼–ç è¯¦ç»†æè¿°å‚æ•°ï¼ŒåŒ…æ‹¬ä½¿ç”¨å¸¦å®½ï¼ˆbandwidthï¼‰ a=rtpmap:1 1016/8000 a=rtpmap:3 GSM/8000 a=sendonly //è¯´æ˜Žæœ¬ç«¯åª’ä½“æµçš„æ–¹å‘ï¼Œå–å€¼åŒ…æ‹¬sendonly/recvonly/sendrecv/inactive a=ptime:20 //è¯´æ˜Žåª’ä½“æµæ‰“åŒ…æ—¶é•¿ m=video 0 RTP/AVP 31 34 a=rtpmap:31 H261/90000 a=rtpmap:34 H263/900002.3.3.å®žä½“è¡Œä¸ºã€æ“ä½œè¿‡ç¨‹2.3.3.1.åˆå§‹åå•†çš„Offerè¯·æ±‚å®žä½“A &lt;-&gt; å®žä½“Bï¼Œå®žä½“é¦–å…ˆå‘èµ·Offerè¯·æ±‚ï¼Œå†…å®¹å¦‚2èŠ‚æ‰€ç¤ºï¼Œå¯¹äºŽä½œä½•ä¸€ä¸ªåª’ä½“æµ/åª’ä½“é€šé“ï¼Œè¿™æ—¶å®žä½“Aå¿…é¡»ï¼š å¦‚æžœåª’ä½“æµæ–¹å‘æ ‡ä¸ºrecvonly/sendrecvï¼Œå³a=recvonlyæˆ–a=sendrecvï¼Œåˆ™Aå¿…é¡»ï¼ˆMUSTï¼‰å‡†å¤‡å¥½åœ¨è¿™ä¸ªIPå’Œç«¯å£ä¸ŠæŽ¥æ”¶å®žä½“Bå‘æ¥çš„åª’ä½“æµï¼› å¦‚æžœåª’ä½“æµæ–¹å‘æ ‡ä¸ºsendonly/inactiveï¼Œå³a=recvonlyæˆ–a=sendrecvï¼Œåˆ™Aä¸éœ€è¦è¿›è¡Œå‡†å¤‡ã€‚2.3.3.1.Answerå“åº”å®žä½“Bæ”¶åˆ°Açš„è¯·æ±‚offeråŽï¼Œæ ¹æ®è‡ªèº«æ”¯æŒçš„åª’ä½“ç±»åž‹å’Œç¼–ç ç­–ç•¥ï¼Œå›žå¤å“åº”ã€‚ å¦‚æžœå®žä½“Bå›žå¤çš„å“åº”ä¸­çš„åª’ä½“æµæ•°é‡å’Œé¡ºåºå¿…é¡»ï¼ˆMUSTï¼‰å’Œè¯·æ±‚offerä¸€è‡´ï¼Œä»¥ä¾¿å®žä½“Aè¿›è¡Œç”„åˆ«å’Œå†³ç­–ã€‚å³mè¡Œçš„æ•°é‡å’Œé¡ºåºå¿…é¡»ä¸€è‡´ï¼ŒBä¸èƒ½ï¼ˆMUST NOTï¼‰æ“…è‡ªå¢žåŠ æˆ–åˆ é™¤åª’ä½“æµã€‚å¦‚æžœBä¸æ”¯æŒæŸä¸ªåª’ä½“æµï¼Œå¯ä»¥åœ¨å¯¹åº”çš„ç«¯å£ç½®0ï¼Œä½†ä¸èƒ½ä¸å¸¦è¿™ä¸ªmè¡Œæè¿°ã€‚ å¯¹äºŽæŸç§åª’ä½“ï¼Œå®žä½“Bå¿…é¡»ï¼ˆMUSTï¼‰ä»Žè¯·æ±‚offerä¸­é€‰å‡ºAæ”¯æŒä¸”è‡ªå·±ä¹Ÿæ”¯æŒçš„è¯¥åª’ä½“çš„ç¼–ç æ ‡è¯†é›†ï¼Œå¹¶ä¸”å¯ä»¥ï¼ˆMAYï¼‰é™„å¸¦è‡ªå·±æ”¯æŒçš„å…¶å®ƒç±»åž‹ç¼–ç ã€‚ å¯¹äºŽå“åº”æ¶ˆæ¯ä¸­å„ä¸ªåª’ä½“çš„æ–¹å‘ï¼š å¦‚æžœè¯·æ±‚æŸåª’ä½“æµçš„æ–¹å‘ä¸ºsendonlyï¼Œé‚£ä¹ˆå“åº”ä¸­å¯¹åº”åª’ä½“çš„æ–¹å‘å¿…é¡»ä¸ºrecvonlyï¼› å¦‚æžœè¯·æ±‚æŸåª’ä½“æµçš„æ–¹å‘ä¸ºrecvonlyï¼Œé‚£ä¹ˆå“åº”ä¸­å¯¹åº”åª’ä½“çš„æ–¹å‘å¿…é¡»ä¸ºsendonlyï¼› å¦‚æžœè¯·æ±‚æŸåª’ä½“æµçš„æ–¹å‘ä¸ºsendrecvï¼Œé‚£ä¹ˆå“åº”ä¸­å¯¹åº”åª’ä½“çš„æ–¹å‘å¯ä»¥ä¸ºsendrecv/sendonly/recvonly/inactiveä¸­çš„ä¸€ç§ï¼› å¦‚æžœè¯·æ±‚æŸåª’ä½“æµçš„æ–¹å‘ä¸ºinactiveï¼Œé‚£ä¹ˆå“åº”ä¸­å¯¹åº”åª’ä½“çš„æ–¹å‘å¿…é¡»ä¸ºinactiveï¼› å“åº”answeré‡Œæä¾›IPå’Œç«¯å£ï¼ŒæŒ‡ç¤ºOffereræœ¬ç«¯æœŸæœ›ç”¨äºŽæŽ¥æ”¶åª’ä½“æµçš„IPå’Œç«¯å£ï¼Œä¸€æ—¦å“åº”å‘å‡ºä¹‹åŽï¼ŒOffererå¿…é¡»ï¼ˆMUSTï¼‰å‡†å¤‡å¥½åœ¨è¿™ä¸ªIPå’Œç«¯å£ä¸ŠæŽ¥æ”¶å®žä½“Aå‘æ¥çš„åª’ä½“æµã€‚ å¦‚æžœè¯·æ±‚offerä¸­å¸¦äº†ptimeï¼ˆåª’ä½“æµæ‰“åŒ…é—´éš”ï¼‰çš„aè¡Œæˆ–å¸¦å®½çš„aè¡Œï¼Œåˆ™å“åº”answerä¹Ÿåº”è¯¥ï¼ˆSHOULDï¼‰ç›¸åº”çš„æºå¸¦ã€‚ å®žä½“B Offereråº”è¯¥ï¼ˆSHOULDï¼‰ä½¿ç”¨å®žä½“Aæ¯”è¾ƒæœŸæœ›çš„ç¼–ç ç”Ÿæˆåª’ä½“æµå‘é€ã€‚ä¸€èˆ¬æ¥è¯´å¯¹äºŽmè¡Œï¼Œå¦‚m=video 0 RTP/AVP 31 34ï¼ŒæŽ’å……è¶Šé å‰çš„ç¼–ç è¡¨ç¤ºè¯¥å®žä½“è¶Šå¸Œæœ›ä»¥è¿™ä¸ªç¼–ç ä½œä¸ºè½½ä½“ï¼Œè¿™é‡Œç¤ºä¾‹31(H261)ï¼Œ34ï¼ˆH263ï¼‰ä¸­H261ä¸ºAæ›´æœŸæœ›ä½¿ç”¨çš„ç¼–ç ç±»åž‹ã€‚åŒç†ï¼Œå½“å®žä½“Aæ”¶åˆ°å“åº”answeråŽä¹Ÿæ˜¯è¿™æ ·ç†è§£çš„ã€‚2.3.3.2.å®žä½“æ”¶åˆ°å“åº”åŽçš„å¤„ç†å½“å®žä½“Aæ”¶åˆ°Bå›žå¤çš„å“åº”åŽï¼Œå¯ä»¥ï¼ˆMAYï¼‰å¼€å§‹å‘é€åª’ä½“æµï¼Œå¦‚æžœåª’ä½“æµæ–¹å‘ä¸ºsendonly/sendrecvï¼Œ å¿…é¡»ï¼ˆMUSTï¼‰ä½¿ç”¨answeråˆ—ä¸¾çš„åª’ä½“ç±»åž‹/ç¼–ç ç”Ÿæˆåª’ä½“å‘é€ï¼› åº”è¯¥ï¼ˆSHOULDï¼‰ä½¿ç”¨answerä¸­çš„ptimeå’Œbandwidthæ¥æ‰“åŒ…å‘é€åª’ä½“æµï¼› å¯ä»¥ï¼ˆMAYï¼‰ç«‹å³åœæ­¢ç›‘å¬ç«¯å£ï¼Œè¯¥ç«¯å£ä¸ºofferæ”¯æŒanswerä¸æ”¯æŒçš„åª’ä½“æ‰€ä½¿ç”¨çš„ç«¯å£ã€‚ 2.3.4.ä¿®æ”¹åª’ä½“æµï¼ˆä¼šè¯ï¼‰ä¿®æ”¹åª’ä½“æµçš„offer-answeræ“ä½œå¿…é¡»åŸºäºŽä¹‹å‰åå•†çš„åª’ä½“å½¢å¼ï¼ˆéŸ³é¢‘ã€è§†é¢‘ç­‰ï¼‰ï¼Œä¸èƒ½ï¼ˆMUST NOTï¼‰å¯¹å·²æœ‰åª’ä½“æµè¿›è¡Œåˆ å‡ã€‚ 2.3.4.1.åˆ é™¤åª’ä½“æµå¦‚æžœå®žä½“è®¤å®šæ–°çš„ä¼šè¯ä¸æ”¯æŒä¹‹å‰åª’å•†çš„æŸä¸ªåª’ä½“ï¼Œæ–°çš„offeråªé¡»å¯¹è¿™ç§åª’ä½“æ‰€åœ¨mè¡Œçš„ç«¯å£ç½®0ï¼Œä½†ä¸èƒ½ä¸æè¿°è¿™ç§åª’ä½“ï¼Œå³ä¸å¸¦å¯¹åº”mè¡Œã€‚å½“answereræ”¶åˆ°å“åº”ä¹‹åŽï¼Œå¤„ç†åŒåˆå§‹åå•†ä¸€æ ·ã€‚ 2.3.4.2.å¢žåŠ åª’ä½“æµå¦‚æžœå®žä½“æ‰“ç®—æ–°å¢žåª’ä½“æµï¼Œåœ¨offeré‡Œåªé¡»åŠ ä¸Šæè¿°å³å¯æˆ–è€…å ç”¨ä¹‹å‰ç«¯å£è¢«ç½®0çš„åª’ä½“æµï¼Œå³ç”¨æ–°çš„åª’ä½“æè¿°mè¡Œæ›¿æ¢æ—§çš„ã€‚å½“answereræ”¶åˆ°offerè¯·æ±‚åŽï¼Œå‘çŽ°æœ‰æ–°å¢žåª’ä½“æè¿°ï¼Œæˆ–è€…è¿‡äºŽç«¯å£è¢«ç½®0çš„åª’ä½“è¡Œè¢«æ–°çš„åª’ä½“æè¿°æ›¿æ¢ï¼Œå³çŸ¥é“å½“å‰ä¸ºæ–°å¢žåª’ä½“æµï¼Œå¤„ç†åŒåˆå§‹åå•†ã€‚ 2.3.4.3.ä¿®æ”¹åª’ä½“æµä¿®æ”¹åª’ä½“æ³¨ä¸»è¦æ˜¯é’ˆå¯¹åˆå§‹åå•†ç»“æžœï¼Œå¦‚æžœæœ‰å˜æ›´å³è¿›å…¥ä¿®æ”¹æµç¨‹å¤„ç†ï¼Œå¯èƒ½çš„å˜æ›´åŒ…æ‹¬IPåœ°å€ã€ç«¯å£ï¼Œåª’ä½“æ ¼å¼ï¼ˆç¼–ç ï¼‰ï¼Œåª’ä½“ç±»åž‹ï¼ˆéŸ³ã€è§†é¢‘ï¼‰ï¼Œåª’ä½“å±žæ€§ï¼ˆptimeï¼Œbandwidthï¼Œåª’ä½“æµæ–¹å‘å˜æ›´ç­‰ï¼‰ã€‚]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
        <tag>åè®®</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webrtcä¹‹å…¥é—¨]]></title>
    <url>%2F2017%2F04%2F27%2Fwebrtc-introduce%2F</url>
    <content type="text"><![CDATA[webrtc developersThe WebRTC APIsThree main tasks Acquiring audio and video Communicating audio and video Communicating arbitrary data Three main JavaScript APIs MediaStream(aka getUserMedia) RTCPeerConnection RTCDataChannel MediaStream(Acquiring audio and video) MediaStream Pepresent a stream of audio and/or video Can contain multiple â€˜tracksâ€™ Obtain a MediaStream with navigator.getUserMedia() Constraints Controls the contents of the MediaStream Media type, resolution, frame rateRTCPeerConnection(Audio and video communication between peers)RTCPeerConnection does a lot Signal processing Codec handling Peer to peer communication Security Bandwidth managementWebRTC architecture RTCDataChannel(Bidirectional communication of arbitrary data between peers) RTCDataChannel Same API as WebSockets Ultra-low latency Unreliable or reliable Secure Servers and Protocols(Peer to peer â€” but we need servers :) Abstract Signaling Need to exchange â€˜session descriptionâ€™ objects: What formats I support, what I want to send Network information for peer-to-peer setup Can use any messaging mechanism Can use any messaging protocol STUN and TRUN(P2P in the age of firewalls and NATs) An ideal world The real world STUN Tell me what my public IP address is Simple server, cheap to run Data flows peer-to-peer TURN Provide a cloud fallback if peer-to-peer communication fails Data is sent through server, uses server bandwidth Ensures the call works in almost all environments ICE ICE: a framework for connecting peers Tries to find the best path for each call Vast majority of calls can use STUN (webrtcstats.com): Deploying STUN/TURN stun.l.google.com:19302 WebRTC stunserver, turnserver rfc5766-turn-server restund SecuritySecurity throughout WebRTC Mandatory encryption for media and data Secure UI, explicit opt-in Sandboxed, no plugins WebRTC Security Architecture ArchitecturesPeer to Peer : one-to-one callclientA &lt;â€”â€”â€“&gt; clientB Mesh: small N-way call123456clientA &lt;-------------&gt; clientB /|\ \ / /|\ | \ / | | / \ | \|/ / \|/clientC &lt;--------------&gt; clientD Star: medium N-way call123clientA &lt;---------&gt; clientBclientA &lt;---------&gt; clientCclientA &lt;---------&gt; clientD MCU: large N-way call1234567MCU &lt;--------------&gt;clientAMCU &lt;--------------&gt;clientBMCU &lt;--------------&gt;clientCMCU &lt;--------------&gt;clientDMCU &lt;--------------&gt;clientEMCU &lt;--------------&gt;clientFMCU &lt;--------------&gt;clientG]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webrtcä¹‹æºç ç®¡ç†å·¥å…·gclient]]></title>
    <url>%2F2017%2F04%2F27%2Fwebrtc-gclient%2F</url>
    <content type="text"><![CDATA[googleçš„chromiumé¡¹ç›®æ˜¯ç”¨gclientæ¥ç®¡ç†æºç çš„checkout, updateç­‰ã€‚ gclientæ˜¯googleä¸“é—¨ä¸ºè¿™ç§å¤šæºé¡¹ç›®ç¼–å†™çš„è„šæœ¬ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªæºç ç®¡ç†ç³»ç»Ÿä¸­çš„ä»£ç æ”¾åœ¨ä¸€èµ·ç®¡ç†ã€‚ç”šè‡³åŒ…æ‹¬å°†Gitå’Œsvnä»£ç æ”¾åœ¨ä¸€èµ·ã€‚ webrtcä¹Ÿæ˜¯ä½¿ç”¨gclientç®¡ç†ä»£ç . gclientçš„syncï¼Œupdateç­‰å‘½ä»¤å¯†åˆ‡ç›¸å…³çš„ä¸¤ç±»æ–‡ä»¶.gclientå’ŒDEPSã€‚ .gclientæ–‡ä»¶æ˜¯gclientçš„æŽ§åˆ¶æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ”¾åœ¨å·¥ä½œç›®å½•çš„æœ€ä¸Šå±‚(webrtcçŽ¯å¢ƒä¸‹ä¸Žsrcç»Ÿè®¡ç›®å½•)ã€‚â€.gclientâ€æ–‡ä»¶æ˜¯ä¸€ä¸ªPythonçš„è„šæœ¬ï¼Œå®šä¹‰äº†ä¸€ç»„â€solutionsâ€ï¼Œæ ¼å¼ç±»ä¼¼å¦‚ä¸‹ 1234567891011solutions = [ &#123; &quot;name&quot; : &quot;src&quot;, &quot;url&quot; : &quot;svn://svnserver/component/trunk/src&quot;, &quot;custom_deps&quot; : &#123; # To use the trunk of a component instead of what&apos;s in DEPS: #&quot;component&quot;: &quot;https://svnserver/component/trunk/&quot;, # To exclude a component from your working copy: #&quot;data/really_large_component&quot;: None, &#125; &#125;, ] name:checkoutå‡ºæºç çš„åå­— url:æºç æ‰€åœ¨çš„ç›®å½•,gclientå¸Œæœ›checkoutå‡ºçš„æºç ä¸­åŒ…æ‹¬ä¸€ä¸ªDEPSçš„æ–‡ä»¶,è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å¿…é¡»checkoutåˆ°å·¥ä½œç›®å½•çš„æºç ä¿¡æ¯; deps_file:è¿™æ˜¯ä¸€ä¸ªæ–‡ä»¶å(ä¸åŒ…æ‹¬è·¯å¾„),æŒ‡åœ¨å·¥ç¨‹ç›®å½•ä¸­åŒ…å«ä¾èµ–åˆ—è¡¨çš„æ–‡ä»¶,è¯¥é¡¹å¯é€‰,é»˜è®¤å€¼ä¸ºâ€DEPSâ€ custom_deps:è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å­—å…¸å¯¹è±¡,ä¼šè¦†ç›–å·¥ç¨‹çš„â€DEPSâ€æ–‡ä»¶å®šä¹‰çš„æ¡ç›®.ä¸€èˆ¬å®ƒç”¨ä½œæœ¬åœ°ç›®å½•ä¸­,é‚£äº›ä¸ç”¨checkoutçš„ä»£ç ,æˆ–è€…è®©æœ¬åœ°ç›®å½•ä»Žä¸åŒä½ç½®checkoutä¸€ä¸ªæ–°çš„ä»£ç å‡ºæ¥,æˆ–è€…checkoutä¸åŒçš„åˆ†æ”¯,ç‰ˆæœ¬ç­‰.ä¹Ÿå¯ä»¥ç”¨äºŽå¢žåŠ åœ¨DEPSä¸­ä¸å­˜åœ¨çš„æ–°çš„é¡¹ç›®.å¦‚: 12345678&quot;custom_deps&quot;: &#123; &quot;src/content/test/data/layout_tests/LayoutTests&quot;: None, &quot;src/chrome/tools/test/reference_build/chrome_win&quot;: None, &quot;src/chrome_frame/tools/test/reference_build/chrome_win&quot;: None, &quot;src/chrome/tools/test/reference_build/chrome_linux&quot;: None, &quot;src/chrome/tools/test/reference_build/chrome_mac&quot;: None, &quot;src/third_party/hunspell_dictionaries&quot;: None, &#125;, target_os:è¿™ä¸ªå¯é€‰çš„æ¡ç›®å¯ä»¥æŒ‡å‡ºç‰¹æ®Šçš„å¹³å°,æ ¹æ®å¹³å°ç±»checkoutå‡ºä¸åŒä»£ç ,å¦‚: 1target_os = [&apos;android&apos;] å¦‚æžœtarget_os_onlyå€¼ä¸ºTrueçš„è¯,é‚£ä¹ˆ,ä»…ä»…checkoutå‡ºå¯¹åº”çš„ä»£ç ,å¦‚: 12target_os = [ &quot;ios&quot; ] target_os_only = True åœ¨æ¯ä¸ªcheckoutå‡ºçš„å·¥ç¨‹ä¸­ï¼ŒgclientæœŸæœ›å‘çŽ°ä¸€ä¸ªDEPSæ–‡ä»¶ï¼ˆç”±deps_fileæ¥ç»™å®šï¼‰ï¼Œå®ƒå®šä¹‰äº†å·¥ç¨‹ä¸åŒéƒ¨åˆ†éƒ½æ˜¯å¦‚ä½•checkoutå‡ºæ¥ã€‚ â€œDEPSâ€ä¹Ÿæ˜¯ä¸€ä¸ªpythonè„šæœ¬ï¼Œæœ€ç®€å•çš„ï¼Œå¦‚ä¸‹ï¼š 12345deps = &#123; &quot;src/outside&quot; : &quot;http://outside-server/trunk@1234&quot;, &quot;src/component&quot; : &quot;svn://svnserver/component/trunk/src@77829&quot;, &quot;src/relative&quot; : &quot;/trunk/src@77829&quot;, &#125; depsçš„æ¯ä¸ªæ¡ç›®éƒ½åŒ…å«ä¸€ä¸ªkey-valueå¯¹ï¼Œkeyæ˜¯è¢«checkoutçš„æœ¬åœ°ç›®å½•ï¼Œè€Œvalueå°±æ˜¯å¯¹åº”çš„è¿œç¨‹URLã€‚å¦‚æžœè·¯å¾„æ˜¯ä»¥â€™/â€˜å¼€å¤´çš„ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸€ä¸ªç›¸å¯¹URLï¼Œç›¸å¯¹ä¸Ž.gclientä¸­URLåœ°å€ã€‚ URLé€šå¸¸åŒ…å«ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œä»¥ä¾¿é”å®šæºç åœ¨ç‰¹å®šç‰ˆæœ¬ä¸Šã€‚å½“ç„¶ï¼Œè¿™æ˜¯å¯é€‰çš„ã€‚å¦‚æžœæ²¡æœ‰ï¼Œé‚£ä¹ˆå®ƒå°†èŽ·å–æŒ‡å®šåˆ†æ”¯ä¸Šæœ€æ–°çš„ç‰ˆæœ¬ã€‚ DEPSè¿˜å¯ä»¥åŒ…å«å…¶ä»–ç±»åž‹çš„æ•°æ®ï¼Œå¦‚vars, 12345678910111213vars = &#123; &apos;pymox&apos;: &apos;http://pymox.googlecode.com/svn&apos;, &apos;sfntly&apos;: &apos;http://sfntly.googlecode.com/svn&apos;, &apos;eyes-free&apos;: &apos;http://eyes-free.googlecode.com/svn&apos;, &apos;rlz&apos;: &apos;http://rlz.googlecode.com/svn&apos;, &apos;smhasher&apos;: &apos;http://smhasher.googlecode.com/svn&apos;,...&#125; varså®šä¹‰äº†ä¸€ç»„å˜é‡ï¼Œåœ¨åŽé¢ï¼Œå¯ä»¥é€šè¿‡Var(xxx)æ¥è®¿é—®ã€‚Var(xxx)è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ•…æ­¤ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ“ä½œï¼Œå¦‚ 1234&apos;src/third_party/cros_dbus_cplusplus/source&apos;:Var(&quot;git.chromium.org&quot;) + &apos;/chromiumos/third_party/dbus-cplusplus.git@5e8f6d9db5c2abfb91d91f751184f25bb5cd0900&apos;,&apos;src/third_party/WebKit&apos;:Var(&quot;webkit_trunk&quot;)[:-6] + &apos;/branches/chromium/1548@153044&apos;, ç¬¬äºŒä¸ªè‡ªç«‹ï¼ŒVar(â€œwebkit_trunkâ€)[:-6]æ˜¯ä¸€ä¸ªpythonè¡¨è¾¾å¼ï¼Œè¡¨ç¤ºå–å¾—â€webkit_trunkâ€è¡¨ç¤ºçš„å­—ç¬¦ä¸²çš„æœ€åŽ6ä¸ª Hooksï¼šDEPSåŒ…å«å¯é€‰çš„å†…å®¹ hooksï¼Œä¹Ÿæœ‰é‡è¦çš„ä½œç”¨ï¼Œå®ƒè¡¨ç¤ºåœ¨sync, updateæˆ–è€…recertåŽï¼Œæ‰§è¡Œä¸€ä¸ªhookæ“ä½œã€‚ å¦‚æžœä½¿ç”¨ â€“nohooksé€‰é¡¹ï¼ˆhooké»˜è®¤æ‰§è¡Œï¼‰ï¼Œé‚£ä¹ˆåœ¨gclient syncæˆ–è€…å…¶ä»–æ“ä½œåŽï¼Œä¸ä¼šæ‰§è¡Œhookã€‚ä½ å¯ä»¥é€šè¿‡gclient runhooksæ¥å•ç‹¬æ‰§è¡Œï¼› å¦‚æžœæœ‰ gclient sync â€“forceï¼Œé‚£ä¹ˆï¼Œæ— è®ºsyncæ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šæ‰§è¡Œhookã€‚ hookåœ¨DEPSä¸­çš„å†™æ³•ï¼Œä¸€èˆ¬æ˜¯ï¼š 1234567hooks = [ &#123; &quot;pattern&quot;: &quot;\\.(gif|jpe?g|pr0n|png)$&quot;, &quot;action&quot;: [&quot;python&quot;, &quot;image_indexer.py&quot;, &quot;--all&quot;]&#125;, &#123; &quot;pattern&quot;: &quot;.&quot;, &quot;name&quot;: &quot;gyp&quot;, &quot;action&quot;: [&quot;python&quot;, &quot;src/build/gyp_chromium&quot;]&#125;,] hooksåŒ…å«ä¸€ç»„hookï¼Œæ¯ä¸ªhookæœ‰å‡ ä¸ªé‡è¦é¡¹: pattern æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨æ¥åŒ¹é…å·¥ç¨‹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œactioné¡¹å°±ä¼šæ‰§è¡Œ action æè¿°ä¸€ä¸ªæ ¹æ®ç‰¹å®šå‚æ•°è¿è¡Œçš„å‘½ä»¤è¡Œã€‚è¿™ä¸ªå‘½ä»¤åœ¨æ¯æ¬¡gclientæ—¶ï¼Œæ— è®ºå¤šå°‘æ–‡ä»¶åŒ¹é…ï¼Œè‡³å¤šè¿è¡Œä¸€æ¬¡ã€‚è¿™ä¸ªå‘½ä»¤å’Œ.gclientåœ¨åŒä¸€ç›®å½•ä¸‹è¿è¡Œã€‚å¦‚æžœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯â€pythonâ€ï¼Œé‚£ä¹ˆï¼Œå½“å‰çš„pythonè§£é‡Šå™¨å°†è¢«ä½¿ç”¨ã€‚å¦‚æžœåŒ…å«å­—ç¬¦ä¸² â€œ$matching_filesâ€ï¼Œå®ƒå°†è¯¥å­—ç¬¦ä¸²æ‰©å±•ä¸ºåŒ¹é…å‡ºçš„æ–‡ä»¶åˆ—è¡¨ã€‚ name å¯é€‰ï¼Œæ ‡è®°å‡ºhookæ‰€å±žçš„ç»„ï¼Œå¯ä»¥è¢«ç”¨æ¥è¦†ç›–å’Œé‡æ–°ç»„ç»‡ã€‚ deps_osï¼š DEPSä¸­å®šä¹‰ä¸åŒå¹³å°ä¾èµ–å…³ç³»çš„é¡¹ç›®ï¼Œå¦‚ 1234567891011121314151617181920212223deps_os = &#123; &quot;win&quot;: &#123; &quot;src/chrome/tools/test/reference_build/chrome_win&quot;: &quot;/trunk/deps/reference_builds/chrome_win@197743&quot;, &quot;src/third_party/cygwin&quot;: &quot;/trunk/deps/third_party/cygwin@133786&quot;,..... &#125;, &quot;ios&quot;: &#123; &quot;src/third_party/GTM&quot;: (Var(&quot;googlecode_url&quot;) % &quot;google-toolbox-for-mac&quot;) + &quot;/trunk@&quot; + Var(&quot;gtm_revision&quot;), &quot;src/third_party/nss&quot;: &quot;/trunk/deps/third_party/nss@&quot; + Var(&quot;nss_revision&quot;),.... &#125;,...&#125; deps_osæŒ‡å®šä¸åŒå¹³å°çš„ä¾èµ–ï¼Œå®ƒå¯ä»¥åŒ…å«å¤šç§å¹³å°ï¼Œå’Œ.gclientä¸­çš„target_oså¯¹åº”ã€‚è¿™ç§å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š 12345678910111213DEPS_OS_CHOICES = &#123; &quot;win32&quot;: &quot;win&quot;, &quot;win&quot;: &quot;win&quot;, &quot;cygwin&quot;: &quot;win&quot;, &quot;darwin&quot;: &quot;mac&quot;, &quot;mac&quot;: &quot;mac&quot;, &quot;unix&quot;: &quot;unix&quot;, &quot;linux&quot;: &quot;unix&quot;, &quot;linux2&quot;: &quot;unix&quot;, &quot;linux3&quot;: &quot;unix&quot;, &quot;android&quot;: &quot;android&quot;,&#125; ä¸‹è½½webrtc androidä»£ç çš„.gclientæ–‡ä»¶(ä¸ŽsrcåŒçº§ç›®å½•): 12345678910solutions = [ &#123; &quot;url&quot;: &quot;https://chromium.googlesource.com/external/webrtc.git&quot;, &quot;managed&quot;: False, &quot;name&quot;: &quot;src&quot;, &quot;deps_file&quot;: &quot;DEPS&quot;, &quot;custom_deps&quot;: &#123;&#125;, &#125;,]target_os = [&quot;android&quot;, &quot;unix&quot;] srcåŒçº§ç›®å½•ä¸‹.gclient_entrieså®šä¹‰äº†å„æ¨¡å—åŠå¯¹åº”åœ°å€ 1234567891011121314151617181920212223242526272829303132333435363738394041424344entries = &#123; &apos;src&apos;: &apos;https://chromium.googlesource.com/external/webrtc.git&apos;, &apos;src/base&apos;: &apos;https://chromium.googlesource.com/chromium/src/base@413df39df4640665d7ee1e8c198be1e91cedb4d9&apos;, &apos;src/build&apos;: &apos;https://chromium.googlesource.com/chromium/src/build@98f2769027214c848094d0d58156474eada3bc1b&apos;, &apos;src/buildtools&apos;: &apos;https://chromium.googlesource.com/chromium/buildtools.git@98f00fa10dbad2cdbb2e297a66c3d6d5bc3994f3&apos;, &apos;src/testing&apos;: &apos;https://chromium.googlesource.com/chromium/src/testing@3eab1a4b0951ac1fcb2be8bf9cb24143b509ea52&apos;, &apos;src/testing/gmock&apos;: &apos;https://chromium.googlesource.com/external/googlemock.git@0421b6f358139f02e102c9c332ce19a33faf75be&apos;, &apos;src/testing/gtest&apos;: &apos;https://chromium.googlesource.com/external/github.com/google/googletest.git@6f8a66431cb592dad629028a50b3dd418a408c87&apos;, &apos;src/third_party&apos;: &apos;https://chromium.googlesource.com/chromium/src/third_party@939f3a2eae486dd7cf3b31eae38642d2bc243737&apos;, &apos;src/third_party/android_tools&apos;: &apos;https://chromium.googlesource.com/android_tools.git@b65c4776dac2cf1b80e969b3b2d4e081b9c84f29&apos;, &apos;src/third_party/boringssl/src&apos;: &apos;https://boringssl.googlesource.com/boringssl.git@777fdd6443d5f01420b67137118febdf56a1c8e4&apos;, &apos;src/third_party/catapult&apos;: &apos;https://chromium.googlesource.com/external/github.com/catapult-project/catapult.git@6939b1db033bf35f4adf1ee55824b6edb3e324d6&apos;, &apos;src/third_party/ced/src&apos;: &apos;https://chromium.googlesource.com/external/github.com/google/compact_enc_det.git@e21eb6aed10b9f6e2727f136c52420033214d458&apos;, &apos;src/third_party/colorama/src&apos;: &apos;https://chromium.googlesource.com/external/colorama.git@799604a1041e9b3bc5d2789ecbd7e8db2e18e6b8&apos;, &apos;src/third_party/ffmpeg&apos;: &apos;https://chromium.googlesource.com/chromium/third_party/ffmpeg.git@28a5cdde5c32bcf66715343c10f74e85713f7aaf&apos;, &apos;src/third_party/gflags&apos;: &apos;https://chromium.googlesource.com/external/webrtc/deps/third_party/gflags@892576179b45861b53e04a112996a738309cf364&apos;, &apos;src/third_party/gflags/src&apos;: &apos;https://chromium.googlesource.com/external/github.com/gflags/gflags@03bebcb065c83beff83d50ae025a55a4bf94dfca&apos;, &apos;src/third_party/gtest-parallel&apos;: &apos;https://chromium.googlesource.com/external/github.com/google/gtest-parallel@7eb02a6415979ea59e765c34fe9da6c792f53e26&apos;, &apos;src/third_party/icu&apos;: &apos;https://chromium.googlesource.com/chromium/deps/icu.git@b34251f8b762f8e2112a89c587855ca4297fed96&apos;, &apos;src/third_party/jsoncpp/source&apos;: &apos;https://chromium.googlesource.com/external/github.com/open-source-parsers/jsoncpp.git@f572e8e42e22cfcf5ab0aea26574f408943edfa4&apos;, &apos;src/third_party/jsr-305/src&apos;: &apos;https://chromium.googlesource.com/external/jsr-305.git@642c508235471f7220af6d5df2d3210e3bfc0919&apos;, &apos;src/third_party/junit/src&apos;: &apos;https://chromium.googlesource.com/external/junit.git@64155f8a9babcfcf4263cf4d08253a1556e75481&apos;, &apos;src/third_party/libFuzzer/src&apos;: &apos;https://chromium.googlesource.com/chromium/llvm-project/llvm/lib/Fuzzer.git@16f5f743c188c836d32cdaf349d5d3effb8a3518&apos;, &apos;src/third_party/libjpeg_turbo&apos;: &apos;https://chromium.googlesource.com/chromium/deps/libjpeg_turbo.git@7260e4d8b8e1e40b17f03fafdf1cd83296900f76&apos;, &apos;src/third_party/libsrtp&apos;: &apos;https://chromium.googlesource.com/chromium/deps/libsrtp.git@ccf84786f8ef803cb9c75e919e5a3976b9f5a672&apos;, &apos;src/third_party/libvpx/source/libvpx&apos;: &apos;https://chromium.googlesource.com/webm/libvpx.git@f22b828d685adee4c7a561990302e2d21b5e0047&apos;, &apos;src/third_party/libyuv&apos;: &apos;https://chromium.googlesource.com/libyuv/libyuv.git@fc02cc3806a394a6b887979ba74aa49955f3199b&apos;, &apos;src/third_party/lss&apos;: &apos;https://chromium.googlesource.com/linux-syscall-support.git@63f24c8221a229f677d26ebe8f3d1528a9d787ac&apos;, &apos;src/third_party/mockito/src&apos;: &apos;https://chromium.googlesource.com/external/mockito/mockito.git@de83ad4598ad4cf5ea53c69a8a8053780b04b850&apos;, &apos;src/third_party/openh264/src&apos;: &apos;https://chromium.googlesource.com/external/github.com/cisco/openh264@0fd88df93c5dcaf858c57eb7892bd27763f0f0ac&apos;, &apos;src/third_party/openmax_dl&apos;: &apos;https://chromium.googlesource.com/external/webrtc/deps/third_party/openmax.git@7acede9c039ea5d14cf326f44aad1245b9e674a7&apos;, &apos;src/third_party/requests/src&apos;: &apos;https://chromium.googlesource.com/external/github.com/kennethreitz/requests.git@f172b30356d821d180fa4ecfa3e71c7274a32de4&apos;, &apos;src/third_party/robolectric/robolectric&apos;: &apos;https://chromium.googlesource.com/external/robolectric.git@2a0b6ba221c14f3371813a676ce06143353e448d&apos;, &apos;src/third_party/ub-uiautomator/lib&apos;: &apos;https://chromium.googlesource.com/chromium/third_party/ub-uiautomator.git@00270549ce3161ae72ceb24712618ea28b4f9434&apos;, &apos;src/third_party/usrsctp/usrsctplib&apos;: &apos;https://chromium.googlesource.com/external/github.com/sctplab/usrsctp@8679f2b0bf063ac894dc473debefd61dbbebf622&apos;, &apos;src/third_party/yasm/source/patched-yasm&apos;: &apos;https://chromium.googlesource.com/chromium/deps/yasm/patched-yasm.git@7da28c6c7c6a1387217352ce02b31754deb54d2a&apos;, &apos;src/tools&apos;: &apos;https://chromium.googlesource.com/chromium/src/tools@4718dd2b6d53fb68819b3fd23676b40935f4f31e&apos;, &apos;src/tools/gyp&apos;: &apos;https://chromium.googlesource.com/external/gyp.git@eb296f67da078ec01f5e3a9ea9cdc6d26d680161&apos;, &apos;src/tools/swarming_client&apos;: &apos;https://chromium.googlesource.com/external/swarming.client.git@11e31afa5d330756ff87aa12064bb5d032896cb5&apos;, &apos;src/buildtools/clang_format/script&apos;: &apos;https://chromium.googlesource.com/chromium/llvm-project/cfe/tools/clang-format.git@c09c8deeac31f05bd801995c475e7c8070f9ecda&apos;, &apos;src/buildtools/third_party/libc++/trunk&apos;: &apos;https://chromium.googlesource.com/chromium/llvm-project/libcxx.git@b1ece9c037d879843b0b0f5a2802e1e9d443b75a&apos;, &apos;src/buildtools/third_party/libc++abi/trunk&apos;: &apos;https://chromium.googlesource.com/chromium/llvm-project/libcxxabi.git@0edb61e2e581758fc4cd4cd09fc588b3fc91a653&apos;, &apos;src/third_party/android_tools/ndk&apos;: &apos;https://chromium.googlesource.com/android_ndk.git@26d93ec07f3ce2ec2cdfeae1b21ee6f12ff868d8&apos;,&#125;]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webrtcä¹‹ä¿¡ä»¤äº¤äº’æµç¨‹]]></title>
    <url>%2F2017%2F04%2F27%2Fwebrtc-signalling%2F</url>
    <content type="text"><![CDATA[æ— è®ºæ˜¯ä½¿ç”¨å‰ç«¯JSçš„WebRTC APIæŽ¥å£ï¼Œè¿˜æ˜¯åœ¨WebRTCæºç ä¸Šæž„å»ºè‡ªå·±çš„å¯¹èŠæ¡†æž¶ï¼Œéƒ½éœ€è¦éµå¾ªä»¥ä¸‹æ‰§è¡Œæµç¨‹ï¼š ä¸Šè¿°åºåˆ—ä¸­ï¼ŒWebRTCå¹¶ä¸æä¾›StunæœåŠ¡å™¨å’ŒSignalæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦è‡ªå·±å®žçŽ°ã€‚StunæœåŠ¡å™¨å¯ä»¥ç”¨googleæä¾›çš„å®žçŽ°stunåè®®çš„æµ‹è¯•æœåŠ¡å™¨ï¼ˆstun:stun.l.google.com:19302ï¼‰ï¼ŒSignalæœåŠ¡å™¨åˆ™å®Œå…¨éœ€è¦è‡ªå·±å®žçŽ°äº†ï¼Œå®ƒéœ€è¦åœ¨ClientAå’ŒClientBä¹‹é—´ä¼ é€å½¼æ­¤çš„SDPä¿¡æ¯å’Œcandidateä¿¡æ¯ï¼ŒClientAå’ŒClientBé€šè¿‡è¿™äº›ä¿¡æ¯å»ºç«‹P2Pè¿žæŽ¥æ¥ä¼ é€éŸ³è§†é¢‘æ•°æ®ã€‚ stun/turnã€relayæœåŠ¡å™¨çš„å®žçŽ°åœ¨WebRTCæºç ä¸­éƒ½æœ‰ç¤ºä¾‹ã€‚ ä¸Šè¿°åºåˆ—ä¸­ï¼Œæ ‡æ³¨çš„åœºæ™¯æ˜¯ClientAå‘ClientBå‘èµ·å¯¹èŠè¯·æ±‚ï¼Œè°ƒç”¨æè¿°å¦‚ä¸‹ï¼š ClientAé¦–å…ˆåˆ›å»ºPeerConnectionå¯¹è±¡ï¼Œç„¶åŽæ‰“å¼€æœ¬åœ°éŸ³è§†é¢‘è®¾å¤‡ï¼Œå°†éŸ³è§†é¢‘æ•°æ®å°è£…æˆMediaStreamæ·»åŠ åˆ°PeerConnectionä¸­ã€‚ ClientAè°ƒç”¨PeerConnectionçš„CreateOfferæ–¹æ³•åˆ›å»ºä¸€ä¸ªç”¨äºŽofferçš„SDPå¯¹è±¡ï¼ŒSDPå¯¹è±¡ä¸­ä¿å­˜å½“å‰éŸ³è§†é¢‘çš„ç›¸å…³å‚æ•°ã€‚ClientAé€šè¿‡PeerConnectionçš„SetLocalDescriptionæ–¹æ³•å°†è¯¥SDPå¯¹è±¡ä¿å­˜èµ·æ¥ï¼Œå¹¶é€šè¿‡SignalæœåŠ¡å™¨å‘é€ç»™ClientBã€‚ ClientBæŽ¥æ”¶åˆ°ClientAå‘é€è¿‡çš„offer SDPå¯¹è±¡ï¼Œé€šè¿‡PeerConnectionçš„SetRemoteDescriptionæ–¹æ³•å°†å…¶ä¿å­˜èµ·æ¥ï¼Œå¹¶è°ƒç”¨PeerConnectionçš„CreateAnsweræ–¹æ³•åˆ›å»ºä¸€ä¸ªåº”ç­”çš„SDPå¯¹è±¡ï¼Œé€šè¿‡PeerConnectionçš„SetLocalDescriptionçš„æ–¹æ³•ä¿å­˜è¯¥åº”ç­”SDPå¯¹è±¡å¹¶å°†å®ƒé€šè¿‡SignalæœåŠ¡å™¨å‘é€ç»™ClientAã€‚ ClientAæŽ¥æ”¶åˆ°ClientBå‘é€è¿‡æ¥çš„åº”ç­”SDPå¯¹è±¡ï¼Œå°†å…¶é€šè¿‡PeerConnectionçš„SetRemoteDescriptionæ–¹æ³•ä¿å­˜èµ·æ¥ã€‚ åœ¨SDPä¿¡æ¯çš„offer/answeræµç¨‹ä¸­ï¼ŒClientAå’ŒClientBå·²ç»æ ¹æ®SDPä¿¡æ¯åˆ›å»ºå¥½ç›¸åº”çš„éŸ³é¢‘Channelå’Œè§†é¢‘Channelå¹¶å¼€å¯Candidateæ•°æ®çš„æ”¶é›†ï¼ŒCandidateæ•°æ®å¯ä»¥ç®€å•åœ°ç†è§£æˆClientç«¯çš„IPåœ°å€ä¿¡æ¯ï¼ˆæœ¬åœ°IPåœ°å€ã€å…¬ç½‘IPåœ°å€ã€RelayæœåŠ¡ç«¯åˆ†é…çš„åœ°å€ï¼‰ã€‚ å½“ClientAæ”¶é›†åˆ°Candidateä¿¡æ¯åŽï¼ŒPeerConnectionä¼šé€šè¿‡OnIceCandidateæŽ¥å£ç»™ClientAå‘é€é€šçŸ¥ï¼ŒClientAå°†æ”¶åˆ°çš„Candidateä¿¡æ¯é€šè¿‡SignalæœåŠ¡å™¨å‘é€ç»™ClientBï¼ŒClientBé€šè¿‡PeerConnectionçš„AddIceCandidateæ–¹æ³•ä¿å­˜èµ·æ¥ã€‚åŒæ ·çš„æ“ä½œClientBå¯¹ClientAå†æ¥ä¸€æ¬¡ã€‚ è¿™æ ·ClientAå’ŒClientBå°±å·²ç»å»ºç«‹äº†éŸ³è§†é¢‘ä¼ è¾“çš„P2Pé€šé“ï¼ŒClientBæŽ¥æ”¶åˆ°ClientAä¼ é€è¿‡æ¥çš„éŸ³è§†é¢‘æµï¼Œä¼šé€šè¿‡PeerConnectionçš„OnAddStreamå›žè°ƒæŽ¥å£è¿”å›žä¸€ä¸ªæ ‡è¯†ClientAç«¯éŸ³è§†é¢‘æµçš„MediaStreamå¯¹è±¡ï¼Œåœ¨ClientBç«¯æ¸²æŸ“å‡ºæ¥å³å¯ã€‚åŒæ ·æ“ä½œä¹Ÿé€‚åº”ClientBåˆ°ClientAçš„éŸ³è§†é¢‘æµçš„ä¼ è¾“ã€‚]]></content>
      <categories>
        <category>webrtc</category>
      </categories>
      <tags>
        <tag>webrtc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[gitæœåŠ¡æ­å»º]]></title>
    <url>%2F2017%2F04%2F25%2Fserver-git%2F</url>
    <content type="text"><![CDATA[çº¯git serverè½¯ä»¶å®‰è£…çŽ¯å¢ƒ:ubuntu16.0.4 å®‰è£…Git-Core:sudo apt-get install python-setuptools å®‰è£…openssh-serverå’Œopenssh-client:sudo apt-get install openssh-server openssh-client å®‰è£…python tool:sudo apt-get install python-setuptools å®‰è£…gitosis:12345git clone https://github.com/res0nat0r/gitosis.gitcd gitosis/sudo python setup.py install æ·»åŠ ç®¡ç†è´¦å·12345678sudo adduser \ --system \ --shell /bin/sh \ --gecos &apos;git version control&apos; \ --group \ --disabled-password \ --home /home/git \ git å¦‚æžœå·²æœ‰gitè´¦æˆ·,å¯ä»¥æ›¿æ¢æˆgitmanager åˆ›å»ºé“¾æŽ¥æ˜ å°„ç”±äºŽgitosisé»˜è®¤çŠ¶æ€ä¸‹ä¼šå°†ä»“åº“æ”¾åœ¨ç”¨æˆ·çš„repositoriesç›®å½•ä¸‹ï¼Œä¾‹å¦‚gitmanagerç”¨æˆ·çš„ä»“åº“åœ°å€é»˜è®¤åœ¨ /home/gitmanager/repositories/ç›®å½•ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªé“¾æŽ¥æ˜ å°„ã€‚è®©ä»–æŒ‡å‘æˆ‘ä»¬å‰é¢åˆ›å»ºçš„ä¸“é—¨ç”¨äºŽå­˜æ”¾é¡¹ç›®çš„ä»“åº“ç›®å½•/home/gitrepositoryã€‚ 1sudo ln -s /home/gitrepository /home/gitmanager/repositories åˆå§‹åŒ–ç®¡ç†ç”¨æˆ· æ‹·è´ç®¡ç†ç”¨æˆ·å…¬é’¥åˆ°/tmp/ä¸‹,å¦‚: 1scp ~/.ssh/id_rsa.pub gitmanager@192.168.0.68:/tmp/ ä½¿ç”¨æ‹·è´æ¥çš„å…¬é’¥åˆå§‹åŒ–gitosis: 12sudo -H -u gitmanager gitosis-init &lt; /tmp/id_ras.pubsudo chmod 755 /home/gitmanager/repositories/gitosis-admin.git/hooks/post-update é…ç½®è´¦å· éªŒè¯ssh1234ssh gitmanager@192.168.0.68TY allocation request failed on channel 0ERROR:gitosis.serve.main:Need SSH_ORIGINAL_COMMAND in environment. Connection to gitserver closed. è¯´æ˜Ž Gitosis è®¤å‡ºäº†è¯¥ç”¨æˆ·çš„èº«ä»½ï¼Œä½†ç”±äºŽæ²¡æœ‰è¿è¡Œä»»ä½• Git å‘½ä»¤ï¼Œæ‰€ä»¥å®ƒåˆ‡æ–­äº†è¿žæŽ¥ã€‚ å…‹éš†gitosisç®¡ç†ä»“åº“:1git clone gitmanager@192.168.0.68:gitosis-admin.git è¿™ä¼šå¾—åˆ°ä¸€ä¸ªåä¸º gitosis-admin çš„å·¥ä½œç›®å½•ï¼Œä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š 12./gitosis.conf./keydir gitosis.conf æ–‡ä»¶æ˜¯ç”¨æ¥è®¾ç½®ç”¨æˆ·ã€ä»“åº“å’Œæƒé™çš„æŽ§åˆ¶æ–‡ä»¶ã€‚keydir ç›®å½•åˆ™æ˜¯ä¿å­˜æ‰€æœ‰å…·æœ‰è®¿é—®æƒé™ç”¨æˆ·å…¬é’¥çš„åœ°æ–¹â€” æ¯äººä¸€ä¸ªã€‚åœ¨ keydir é‡Œçš„æ–‡ä»¶åï¼ˆæ¯”å¦‚ä¸Šé¢çš„ qingkouwei.pubï¼‰ ä¼šè‡ªåŠ¨ä»Žä½¿ç”¨ gitosis-init è„šæœ¬å¯¼å…¥çš„å…¬é’¥å°¾éƒ¨çš„æè¿°ä¸­èŽ·å–è¯¥åå­—ã€‚ çœ‹ä¸€ä¸‹ gitosis.conf æ–‡ä»¶çš„å†…å®¹ï¼Œå®ƒåº”è¯¥åªåŒ…å«ä¸Žåˆšåˆšå…‹éš†çš„ gitosis-admin ç›¸å…³çš„ä¿¡æ¯ï¼š 12345[gitosis][group gitosis-admin]members = qingkouweiwritable = gitosis-admin è¦åˆ›å»ºé¡¹ç›®demo,åœ¨é‡Œé¢åŠ å…¥: 123[group demo]members = qingkouweiwritable = demo è¦ä¸ºdemoé¡¹ç›®æ·»åŠ ç”¨æˆ·user1: 123[group demo]members = qingkouwei user1writable = demo å¹¶å°†ç”¨æˆ·user1çš„å…¬é’¥è®¡å…¥åˆ°keydir,å¹¶ä¸”å…¬é’¥å.pubå’Œmembersé‡Œé¢çš„åå­—å¯¹åº”. è¦æ·»åŠ å¯¹demoé¡¹ç›®åªè¯»çš„ç”¨æˆ·: 1234567[group demo]members = qingkouwei user1writable = demo[group demo]members = user2readonly = demo ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶å’Œkeydir,ä½¿ç”¨git pushåˆ°gitosis-adminæœåŠ¡å™¨.å³å¯ç›´æŽ¥git add remote add suervename gitmanager@192.168.0.68:demo.git,ç„¶åŽç›´æŽ¥å°†æœ¬åœ°ç›®å½•æŽ¨é€åˆ°demoä»“åº“,ä¸éœ€è¦å†æœåŠ¡å™¨æ‰‹åŠ¨åˆ›å»ºdemoä»“åº“,gitosisä¼šå¸®å¿™è‡ªåŠ¨åˆ›å»º. å¸¸è§é—®é¢˜ ERROR:gitosis.serve.main:Repository read access denied åŽŸå› : gitosis.confä¸­çš„membersä¸Žkeydirä¸­çš„ç”¨æˆ·åä¸ä¸€è‡´ï¼Œå¦‚gitosisä¸­çš„members = foo@barï¼Œä½†keydirä¸­çš„å…¬å¯†åå´å«foo.pub è§£å†³æ–¹æ³•: ä½¿keydirçš„åç§°ä¸Žgitosisä¸­membersæ‰€æŒ‡çš„åç§°ä¸€è‡´ã€‚ æ”¹ä¸ºmembers = foo æˆ– å…¬å¯†åç§°æ”¹ä¸ºfoo@bar.pub cloneæ—¶æŠ¥does not appear to be a git repository åŽŸå› : cloneæ—¶ä¸èƒ½ç”¨ç»å¯¹è·¯å¾„ï¼Œç›´æŽ¥å†™gitosis-admin.gitå³å¯. å‚è€ƒ:https://git-scm.com/book/zh/v1/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-Gitosis gitlabæœåŠ¡æ­å»º]]></content>
      <categories>
        <category>server</category>
      </categories>
      <tags>
        <tag>server</tag>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[VMwareä¸­Bridged,NAT,host-onlyä¸‰ç§ç½‘ç»œè¿žæŽ¥æ¨¡å¼çš„åŽŸç†å’ŒåŒºåˆ«]]></title>
    <url>%2F2017%2F04%2F22%2Fvmware-network-mode%2F</url>
    <content type="text"><![CDATA[ä¸åŒè™šæ‹Ÿäº¤æ¢æœºåº”ç”¨åœ¨ä¸åŒçš„è”ç½‘æ¨¡å¼Bridgedã€NATã€host-onlyã€customå››ç§æ¨¡å¼ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»å…¶å…·ä½“åˆ†é…ï¼š VMnet0ï¼šè¿™æ˜¯VMwareç”¨äºŽè™šæ‹Ÿæ¡¥æŽ¥ç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœºï¼› VMnet1ï¼šè¿™æ˜¯VMwareç”¨äºŽè™šæ‹ŸHost-Onlyç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœºï¼› VMnet8ï¼šè¿™æ˜¯VMwareç”¨äºŽè™šæ‹ŸNATç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœºï¼› VMnet2~VMnet7åŠVMnet9ï¼šæ˜¯VMwareç”¨äºŽè™šæ‹Ÿè‡ªå®šä¹‰customç½‘ç»œä¸‹çš„è™šæ‹Ÿäº¤æ¢æœºï¼› VMware Network Adapter VMnet1ï¼šè¿™æ˜¯å®¿ä¸»æœºç”¨äºŽä¸ŽHost-Onlyè™šæ‹Ÿç½‘ç»œè¿›è¡Œé€šä¿¡çš„å®¿ä¸»æœºä½¿ç”¨çš„è™šæ‹Ÿç½‘å¡ï¼› VMware Network Adapter VMnet8ï¼šè¿™æ˜¯å®¿ä¸»æœºç”¨äºŽä¸ŽNATè™šæ‹Ÿç½‘ç»œè¿›è¡Œé€šä¿¡çš„å®¿ä¸»æœºä½¿ç”¨çš„è™šæ‹Ÿç½‘å¡ï¼› VMware Network Adapter VMnet1ä¸ŽVMware Network Adapter VMnet8å¯ä»¥åœ¨å®¿ä¸»æœºç½‘ç»œè¿žæŽ¥ä¸­çœ‹åˆ°. 1.Bridgedæ¡¥æŽ¥æ¨¡å¼VMwareåœ¨æ¡¥æŽ¥æ¨¡å¼ä¸‹ï¼Œè™šæ‹Ÿæœºä½¿ç”¨VMwareä¸ºè¯¥è™šæ‹Ÿæœºåˆ†é…çš„è™šæ‹Ÿç½‘å¡ï¼Œå®¿ä¸»æœºä½¿ç”¨è‡ªèº«çš„ç‰©ç†ç½‘å¡ï¼ˆæœ‰çº¿æˆ–æ— çº¿éƒ½è¡Œï¼‰ï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨è™šæ‹Ÿäº¤æ¢æœºVMnet0æ¥è¿žæŽ¥è™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘å¡å’Œå®¿ä¸»æœºçš„ç‰©ç†ç½‘å¡ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹æ²¡æœ‰å±€åŸŸç½‘åŠ¨æ€åœ°å€åˆ†é…DHCPæœåŠ¡å™¨ï¼Œä¹Ÿæ²¡æœ‰ç½‘ç»œåœ°å€è½¬æ¢ï¼®ï¼¡ï¼´æœåŠ¡å™¨ï¼Œè™šæ‹Ÿäº¤æ¢æœºæ²¡æœ‰è¿žæŽ¥DHCPæœåŠ¡å™¨å’Œï¼®ï¼¡ï¼´æœåŠ¡å™¨ã€‚å®¿ä¸»æœºçš„ç½‘å£ï¼ˆæ’ç½‘çº¿çš„é‚£ä¸ªå£ï¼‰ä¸Žå®¿ä¸»æœºç‰©ç†ç½‘å¡ç›¸è¿žï¼ŒåŒæ—¶ä¹Ÿå°±å’Œè™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘å¡ç›¸è¿žï¼Œä¹Ÿå°±æ˜¯å’Œè™šæ‹Ÿäº¤æ¢æœºç›¸è¿žï¼Œæ‰€ä»¥è™šæ‹Ÿæœºç›¸å½“äºŽåœ¨å®¿ä¸»æœºæ‰€åœ¨å±€åŸŸç½‘å†…çš„ä¸€ä¸ªå•ç‹¬çš„ä¸»æœºï¼Œä»–çš„è¡Œä¸ºå’Œå®¿ä¸»æœºæ˜¯åŒç­‰åœ°ä½çš„ï¼Œæ²¡æœ‰ä¾å­˜å…³ç³»ã€‚æ‰€æœ‰æ¡¥æŽ¥ä¸‹çš„ç½‘å¡ä¸Žç½‘å¡éƒ½æ˜¯äº¤æ¢æ¨¡å¼çš„ï¼Œç›¸äº’å¯ä»¥è®¿é—®è€Œä¸å¹²æ‰°ã€‚åœ¨æ¡¥æŽ¥æ¨¡å¼ä¸‹ï¼Œè™šæ‹Ÿæœºipåœ°å€éœ€è¦ä¸Žä¸»æœºåœ¨åŒä¸€ä¸ªç½‘æ®µï¼Œå¦‚æžœéœ€è¦è”ç½‘ï¼Œåˆ™ç½‘å…³ä¸ŽDNSéœ€è¦ä¸Žä¸»æœºç½‘å¡ä¸€è‡´åŽŸç†å›¾å¦‚ä¸‹ï¼š é…ç½®è™šæ‹Ÿæœºç½‘å¡,ç¼–è¾‘/etc/sysconfig/network-scripts/ifcfg-eth0: 1234567891011DEVICE=eth0HWADDR=00:0C:29:DA:E9:99TYPE=EthernetUUID=0711466f-ae1f-aa83-825cb3dfb5f7ONBOOT=yesMM_CONTROLLED=yesBOOTPROTO=noneIPADDR=192.168.31.128 #è®¾ç½®è™šæ‹Ÿæœºipåœ°å€,ä¸Žä¸»æœºipåœ°å€åœ¨åŒä¸€ç½‘æ®µNETMASK=255.255.255.0 #è®¾ç½®å­ç½‘æŽ©ç GATEWAY=192.168.31.1#è®¾ç½®è™šæ‹Ÿç½‘å…³,ä¸Žä¸»æœºç›¸åŒDNS1=192.168.31.1 #è®¾ç½®è™šæ‹ŸæœºDNS,ä¸Žä¸»æœºç›¸åŒ æ‰§è¡Œ/etc/init.d/network restarté‡å¯è™šæ‹Ÿæœºç½‘å¡,pingå†…ç½‘ä¸Žå¤–ç½‘æµ‹è¯•. 2.NATç½‘ç»œåœ°å€è½¬æ¢æ¨¡å¼ï¼š æ³¨æ„ï¼šçº¢è‰²çš„æ–¹æ¡†æ˜¯natæœåŠ¡å™¨ï¼ŒnatæœåŠ¡å™¨æœ‰ä¸¤ä¸ªç½‘å¡ä¸€ä¸ªæ˜¯è™šæ‹Ÿå†…ç½‘ç½‘å¡ï¼Œä¸€ä¸ªæ˜¯å®¿ä¸»æœºçš„ç‰©ç†ç½‘å¡ã€‚ç¦ç”¨VmNet8ï¼Œè™šæ‹Ÿæœºä»ç„¶å¯ä»¥ä¸Šç½‘ï¼Œpingé€šä¸»æœºï¼Œä½†æ˜¯ä¸»æœºpingä¸é€šè™šæ‹Ÿæœºçš„ç½‘å¡ã€‚åœ¨NATæ¨¡å¼ä¸­ï¼Œä¸»æœºç½‘å¡ç›´æŽ¥ä¸Žè™šæ‹ŸNATè®¾å¤‡ç›¸è¿žï¼Œç„¶åŽè™šæ‹ŸNATè®¾å¤‡ä¸Žè™šæ‹ŸDHCPæœåŠ¡å™¨ä¸€èµ·è¿žæŽ¥åœ¨è™šæ‹Ÿäº¤æ¢æœºVMnet8ä¸Šï¼Œè¿™æ ·å°±å®žçŽ°äº†è™šæ‹Ÿæœºè”ç½‘ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¼šè§‰å¾—å¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿç½‘å¡VMware Network Adapter VMnet8å‘¢ï¼ŸåŽŸæ¥æˆ‘ä»¬çš„VMware Network Adapter VMnet8è™šæ‹Ÿç½‘å¡ä¸»è¦æ˜¯ä¸ºäº†å®žçŽ°ä¸»æœºä¸Žè™šæ‹Ÿæœºä¹‹é—´çš„é€šä¿¡ã€‚å¼¥è¡¥äº†NATåè®®ä¸­å¤–ç½‘ä¸èƒ½è®¿é—®å±€åŸŸç½‘çš„ç¼ºç‚¹ã€‚ å…·ä½“é…ç½®: 123456789101112DEVICE=eth0HWADDR=00:0C:29:DA:E9:99TYPE=EthernetUUID=0711466f-ae1f-aa83-825cb3dfb5f7ONBOOT=yesMM_CONTROLLED=yesBOOTPROTO=dhcp #åŠ¨æ€èŽ·å–ipåœ°å€,å¦‚æžœæ­¤å¤„è®¾ç½®ä¸ºé™æ€,åˆ™ä¸‹é¢æ‰‹åŠ¨é…ç½®ipéœ€è¦åœ¨DHCPåœ°å€èŒƒå›´å†…#NATæ¨¡å¼ä¹Ÿå¯ä»¥è®¾ç½®é™æ€ip,ä½†éœ€è¦åœ¨DHCPåœ°å€èŒƒå›´å†…IPADDR=192.168.31.128NETMASK=255.255.255.0GATEWAY=192.168.31.1DNS1=192.168.31.1 3.Host-Onlyæ–¹å¼ æ³¨æ„ï¼šä¸Šå›¾ä¸­çš„VmNet8åº”è¯¥ä¸ºVmNet1ã€‚å…¶å®žè·Ÿnatæ¨¡å¼çš„å›¾ç‰‡æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯å°‘äº†natæœåŠ¡ã€‚ æ‰€ä»¥host-onlyä¸Šä¸äº†å¤–ç½‘ï¼Œåªèƒ½å®žçŽ°ä¸»æœºçš„VmNet1ç½‘å¡å’Œè™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘å¡é€šä¿¡ã€‚ NATä»‹ç»NATï¼ˆNetwork Address Translationï¼Œç½‘ç»œåœ°å€è½¬æ¢ï¼‰æ˜¯1994å¹´æå‡ºçš„ã€‚å½“åœ¨ä¸“ç”¨ç½‘å†…éƒ¨çš„ä¸€äº›ä¸»æœºæœ¬æ¥å·²ç»åˆ†é…åˆ°äº†æœ¬åœ°IPåœ°å€ï¼ˆå³ä»…åœ¨æœ¬ä¸“ç”¨ç½‘å†…ä½¿ç”¨çš„ä¸“ç”¨åœ°å€ï¼‰ï¼Œä½†çŽ°åœ¨åˆæƒ³å’Œå› ç‰¹ç½‘ä¸Šçš„ä¸»æœºé€šä¿¡ï¼ˆå¹¶ä¸éœ€è¦åŠ å¯†ï¼‰æ—¶ï¼Œå¯ä½¿ç”¨NATæ–¹æ³•ã€‚ è¿™ç§æ–¹æ³•éœ€è¦åœ¨ä¸“ç”¨ç½‘è¿žæŽ¥åˆ°å› ç‰¹ç½‘çš„è·¯ç”±å™¨ä¸Šå®‰è£…NATè½¯ä»¶ã€‚è£…æœ‰NATè½¯ä»¶çš„è·¯ç”±å™¨å«åšNATè·¯ç”±å™¨ï¼Œå®ƒè‡³å°‘æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å¤–éƒ¨å…¨çƒIPåœ°å€ã€‚è¿™æ ·ï¼Œæ‰€æœ‰ä½¿ç”¨æœ¬åœ°åœ°å€çš„ä¸»æœºåœ¨å’Œå¤–ç•Œé€šä¿¡æ—¶ï¼Œéƒ½è¦åœ¨NATè·¯ç”±å™¨ä¸Šå°†å…¶æœ¬åœ°åœ°å€è½¬æ¢æˆå…¨çƒIPåœ°å€ï¼Œæ‰èƒ½å’Œå› ç‰¹ç½‘è¿žæŽ¥ã€‚ å¦å¤–ï¼Œè¿™ç§é€šè¿‡ä½¿ç”¨å°‘é‡çš„å…¬æœ‰IP åœ°å€ä»£è¡¨è¾ƒå¤šçš„ç§æœ‰IP åœ°å€çš„æ–¹å¼ï¼Œå°†æœ‰åŠ©äºŽå‡ç¼“å¯ç”¨çš„IPåœ°å€ç©ºé—´çš„æž¯ç«­ã€‚ åŠŸèƒ½NATä¸ä»…èƒ½è§£å†³äº†lPåœ°å€ä¸è¶³çš„é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½å¤Ÿæœ‰æ•ˆåœ°é¿å…æ¥è‡ªç½‘ç»œå¤–éƒ¨çš„æ”»å‡»ï¼Œéšè—å¹¶ä¿æŠ¤ç½‘ç»œå†…éƒ¨çš„è®¡ç®—æœºã€‚ å®½å¸¦åˆ†äº«ï¼šè¿™æ˜¯ NAT ä¸»æœºçš„æœ€å¤§åŠŸèƒ½ã€‚ å®‰å…¨é˜²æŠ¤ï¼šNAT ä¹‹å†…çš„ PC è”æœºåˆ° Internet ä¸Šé¢æ—¶ï¼Œä»–æ‰€æ˜¾ç¤ºçš„ IP æ˜¯ NAT ä¸»æœºçš„å…¬å…± IPï¼Œæ‰€ä»¥ Client ç«¯çš„ PC å½“ç„¶å°±å…·æœ‰ä¸€å®šç¨‹åº¦çš„å®‰å…¨äº†ï¼Œå¤–ç•Œåœ¨è¿›è¡Œ portscanï¼ˆç«¯å£æ‰«æï¼‰ çš„æ—¶å€™ï¼Œå°±ä¾¦æµ‹ä¸åˆ°æºClient ç«¯çš„ PC ã€‚ å®žçŽ°æ–¹å¼NATçš„å®žçŽ°æ–¹å¼æœ‰ä¸‰ç§ï¼Œå³é™æ€è½¬æ¢Static Natã€åŠ¨æ€è½¬æ¢Dynamic Natå’Œç«¯å£å¤šè·¯å¤ç”¨OverLoadã€‚ é™æ€è½¬æ¢æ˜¯æŒ‡å°†å†…éƒ¨ç½‘ç»œçš„ç§æœ‰IPåœ°å€è½¬æ¢ä¸ºå…¬æœ‰IPåœ°å€ï¼ŒIPåœ°å€å¯¹æ˜¯ä¸€å¯¹ä¸€çš„ï¼Œæ˜¯ä¸€æˆä¸å˜çš„ï¼ŒæŸä¸ªç§æœ‰IPåœ°å€åªè½¬æ¢ä¸ºæŸä¸ªå…¬æœ‰IPåœ°å€ã€‚å€ŸåŠ©äºŽé™æ€è½¬æ¢ï¼Œå¯ä»¥å®žçŽ°å¤–éƒ¨ç½‘ç»œå¯¹å†…éƒ¨ç½‘ç»œä¸­æŸäº›ç‰¹å®šè®¾å¤‡ï¼ˆå¦‚æœåŠ¡å™¨ï¼‰çš„è®¿é—®ã€‚ åŠ¨æ€è½¬æ¢æ˜¯æŒ‡å°†å†…éƒ¨ç½‘ç»œçš„ç§æœ‰IPåœ°å€è½¬æ¢ä¸ºå…¬ç”¨IPåœ°å€æ—¶ï¼ŒIPåœ°å€æ˜¯ä¸ç¡®å®šçš„ï¼Œæ˜¯éšæœºçš„ï¼Œæ‰€æœ‰è¢«æŽˆæƒè®¿é—®ä¸ŠInternetçš„ç§æœ‰IPåœ°å€å¯éšæœºè½¬æ¢ä¸ºä»»ä½•æŒ‡å®šçš„åˆæ³•IPåœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æŒ‡å®šå“ªäº›å†…éƒ¨åœ°å€å¯ä»¥è¿›è¡Œè½¬æ¢ï¼Œä»¥åŠç”¨å“ªäº›åˆæ³•åœ°å€ä½œä¸ºå¤–éƒ¨åœ°å€æ—¶ï¼Œå°±å¯ä»¥è¿›è¡ŒåŠ¨æ€è½¬æ¢ã€‚åŠ¨æ€è½¬æ¢å¯ä»¥ä½¿ç”¨å¤šä¸ªåˆæ³•å¤–éƒ¨åœ°å€é›†ã€‚å½“ISPæä¾›çš„åˆæ³•IPåœ°å€ç•¥å°‘äºŽç½‘ç»œå†…éƒ¨çš„è®¡ç®—æœºæ•°é‡æ—¶ã€‚å¯ä»¥é‡‡ç”¨åŠ¨æ€è½¬æ¢çš„æ–¹å¼ã€‚ ç«¯å£å¤šè·¯å¤ç”¨ï¼ˆPort address Translation,PAT)æ˜¯æŒ‡æ”¹å˜å¤–å‡ºæ•°æ®åŒ…çš„æºç«¯å£å¹¶è¿›è¡Œç«¯å£è½¬æ¢ï¼Œå³ç«¯å£åœ°å€è½¬æ¢ï¼ˆPATï¼ŒPort Address Translation).é‡‡ç”¨ç«¯å£å¤šè·¯å¤ç”¨æ–¹å¼ã€‚å†…éƒ¨ç½‘ç»œçš„æ‰€æœ‰ä¸»æœºå‡å¯å…±äº«ä¸€ä¸ªåˆæ³•å¤–éƒ¨IPåœ°å€å®žçŽ°å¯¹Internetçš„è®¿é—®ï¼Œä»Žè€Œå¯ä»¥æœ€å¤§é™åº¦åœ°èŠ‚çº¦IPåœ°å€èµ„æºã€‚åŒæ—¶ï¼Œåˆå¯éšè—ç½‘ç»œå†…éƒ¨çš„æ‰€æœ‰ä¸»æœºï¼Œæœ‰æ•ˆé¿å…æ¥è‡ªinternetçš„æ”»å‡»ã€‚å› æ­¤ï¼Œç›®å‰ç½‘ç»œä¸­åº”ç”¨æœ€å¤šçš„å°±æ˜¯ç«¯å£å¤šè·¯å¤ç”¨æ–¹å¼ã€‚ ALGï¼ˆApplication Level Gatewayï¼‰ï¼Œå³åº”ç”¨ç¨‹åºçº§ç½‘å…³æŠ€æœ¯ï¼šä¼ ç»Ÿçš„NATæŠ€æœ¯åªå¯¹IPå±‚å’Œä¼ è¾“å±‚å¤´éƒ¨è¿›è¡Œè½¬æ¢å¤„ç†ï¼Œä½†æ˜¯ä¸€äº›åº”ç”¨å±‚åè®®ï¼Œåœ¨åè®®æ•°æ®æŠ¥æ–‡ä¸­åŒ…å«äº†åœ°å€ä¿¡æ¯ã€‚ä¸ºäº†ä½¿å¾—è¿™äº›åº”ç”¨ä¹Ÿèƒ½é€æ˜Žåœ°å®ŒæˆNATè½¬æ¢ï¼ŒNATä½¿ç”¨ä¸€ç§ç§°ä½œALGçš„æŠ€æœ¯ï¼Œå®ƒèƒ½å¯¹è¿™äº›åº”ç”¨ç¨‹åºåœ¨é€šä¿¡æ—¶æ‰€åŒ…å«çš„åœ°å€ä¿¡æ¯ä¹Ÿè¿›è¡Œç›¸åº”çš„NATè½¬æ¢ã€‚ä¾‹å¦‚ï¼šå¯¹äºŽFTPåè®®çš„PORT/PASVå‘½ä»¤ã€DNSåè®®çš„ â€œAâ€ å’Œ â€œPTRâ€ querieså‘½ä»¤å’Œéƒ¨åˆ†ICMPæ¶ˆæ¯ç±»åž‹ç­‰éƒ½éœ€è¦ç›¸åº”çš„ALGæ¥æ”¯æŒã€‚ å¦‚æžœåè®®æ•°æ®æŠ¥æ–‡ä¸­ä¸åŒ…å«åœ°å€ä¿¡æ¯ï¼Œåˆ™å¾ˆå®¹æ˜“åˆ©ç”¨ä¼ ç»Ÿçš„NATæŠ€æœ¯æ¥å®Œæˆé€æ˜Žçš„åœ°å€è½¬æ¢åŠŸèƒ½ï¼Œé€šå¸¸æˆ‘ä»¬ä½¿ç”¨çš„å¦‚ä¸‹åº”ç”¨å°±å¯ä»¥ç›´æŽ¥åˆ©ç”¨ä¼ ç»Ÿçš„NATæŠ€æœ¯ï¼šHTTPã€TELNETã€FINGERã€NTPã€NFSã€ARCHIEã€RLOGINã€RSHã€RCPç­‰ã€‚ å·¥ä½œåŽŸç†å€ŸåŠ©äºŽNATï¼Œç§æœ‰ï¼ˆä¿ç•™ï¼‰åœ°å€çš„â€å†…éƒ¨â€ç½‘ç»œé€šè¿‡è·¯ç”±å™¨å‘é€æ•°æ®åŒ…æ—¶ï¼Œç§æœ‰åœ°å€è¢«è½¬æ¢æˆåˆæ³•çš„IPåœ°å€ï¼Œä¸€ä¸ªå±€åŸŸç½‘åªéœ€ä½¿ç”¨å°‘é‡IPåœ°å€ï¼ˆç”šè‡³æ˜¯1ä¸ªï¼‰å³å¯å®žçŽ°ç§æœ‰åœ°å€ç½‘ç»œå†…æ‰€æœ‰è®¡ç®—æœºä¸ŽInternetçš„é€šä¿¡éœ€æ±‚ã€‚ NATå°†è‡ªåŠ¨ä¿®æ”¹IPæŠ¥æ–‡çš„æºIPåœ°å€å’Œç›®çš„IPåœ°å€ï¼ŒIpåœ°å€æ ¡éªŒåˆ™åœ¨NATå¤„ç†è¿‡ç¨‹ä¸­è‡ªåŠ¨å®Œæˆã€‚æœ‰äº›åº”ç”¨ç¨‹åºå°†æºIPåœ°å€åµŒå…¥åˆ°IPæŠ¥æ–‡çš„æ•°æ®éƒ¨åˆ†ä¸­ï¼Œæ‰€ä»¥è¿˜éœ€è¦åŒæ—¶å¯¹æŠ¥æ–‡çš„æ•°æ®éƒ¨åˆ†è¿›è¡Œä¿®æ”¹ï¼Œä»¥åŒ¹é…IPå¤´ä¸­å·²ç»ä¿®æ”¹è¿‡çš„æºIPåœ°å€ã€‚å¦åˆ™ï¼Œåœ¨æŠ¥æ–‡æ•°æ®éƒ¨åˆ†åµŒå…¥IPåœ°å€çš„åº”ç”¨ç¨‹åºå°±ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚ NAPTNAPTï¼ˆNetwork Address Port Translationï¼‰ï¼Œå³ç½‘ç»œç«¯å£åœ°å€è½¬æ¢ï¼Œå¯å°†å¤šä¸ªå†…éƒ¨åœ°å€æ˜ å°„ä¸ºä¸€ä¸ªåˆæ³•å…¬ç½‘åœ°å€ï¼Œä½†ä»¥ä¸åŒçš„åè®®ç«¯å£å·ä¸Žä¸åŒçš„å†…éƒ¨åœ°å€ç›¸å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯&lt;å†…éƒ¨åœ°å€+å†…éƒ¨ç«¯å£&gt;ä¸Ž&lt;å¤–éƒ¨åœ°å€+å¤–éƒ¨ç«¯å£&gt;ä¹‹é—´çš„è½¬æ¢ã€‚NAPTæ™®éç”¨äºŽæŽ¥å…¥è®¾å¤‡ä¸­ï¼Œå®ƒå¯ä»¥å°†ä¸­å°åž‹çš„ç½‘ç»œéšè—åœ¨ä¸€ä¸ªåˆæ³•çš„IPåœ°å€åŽé¢ã€‚NAPTä¹Ÿè¢«ç§°ä¸ºâ€œå¤šå¯¹ä¸€â€çš„NATï¼Œæˆ–è€…å«PATï¼ˆPort Address Translationsï¼Œç«¯å£åœ°å€è½¬æ¢ï¼‰ã€åœ°å€è¶…è½½ï¼ˆaddress overloadingï¼‰ã€‚ NAPTä¸ŽåŠ¨æ€åœ°å€NATä¸åŒï¼Œå®ƒå°†å†…éƒ¨è¿žæŽ¥æ˜ å°„åˆ°å¤–éƒ¨ç½‘ç»œä¸­çš„ä¸€ä¸ªå•ç‹¬çš„IPåœ°å€ä¸Šï¼ŒåŒæ—¶åœ¨è¯¥åœ°å€ä¸ŠåŠ ä¸Šä¸€ä¸ªç”±NATè®¾å¤‡é€‰å®šçš„TCPç«¯å£å·ã€‚NAPTç®—å¾—ä¸Šæ˜¯ä¸€ç§è¾ƒæµè¡Œçš„NATå˜ä½“ï¼Œé€šè¿‡è½¬æ¢TCPæˆ–UDPåè®®ç«¯å£å·ä»¥åŠåœ°å€æ¥æä¾›å¹¶å‘æ€§ã€‚é™¤äº†ä¸€å¯¹æºå’Œç›®çš„IPåœ°å€ä»¥å¤–ï¼Œè¿™ä¸ªè¡¨è¿˜åŒ…æ‹¬ä¸€å¯¹æºå’Œç›®çš„åè®®ç«¯å£å·ï¼Œä»¥åŠNATç›’ä½¿ç”¨çš„ä¸€ä¸ªåè®®ç«¯å£å·ã€‚ NAPTçš„ä¸»è¦ä¼˜åŠ¿åœ¨äºŽï¼Œèƒ½å¤Ÿä½¿ç”¨ä¸€ä¸ªå…¨çƒæœ‰æ•ˆIPåœ°å€èŽ·å¾—é€šç”¨æ€§ã€‚ä¸»è¦ç¼ºç‚¹åœ¨äºŽå…¶é€šä¿¡ä»…é™äºŽTCPæˆ–UDPã€‚å½“æ‰€æœ‰é€šä¿¡éƒ½é‡‡ç”¨TCPæˆ–UDPï¼ŒNAPTå…è®¸ä¸€å°å†…éƒ¨è®¡ç®—æœºè®¿é—®å¤šå°å¤–éƒ¨è®¡ç®—æœºï¼Œå¹¶å…è®¸å¤šå°å†…éƒ¨ä¸»æœºè®¿é—®åŒä¸€å°å¤–éƒ¨è®¡ç®—æœºï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šå‘ç”Ÿå†²çªã€‚ NATç©¿é€æ–¹æ³•ç›®å‰å¸¸ç”¨çš„é’ˆå¯¹UDPçš„NAT ç©¿é€ï¼ˆNAT Traversalï¼‰æ–¹æ³•ä¸»è¦æœ‰ï¼šSTUNã€TURNã€ICEã€uPnPç­‰ã€‚å…¶ä¸­ICEæ–¹å¼ç”±äºŽå…¶ç»“åˆäº†STUNå’ŒTURNçš„ç‰¹ç‚¹ï¼Œæ‰€ä»¥ä½¿ç”¨æœ€ä¸ºå¹¿æ³›ã€‚é’ˆå¯¹TCPçš„NATç©¿é€æŠ€æœ¯ç›®å‰ä»ä¸ºéš¾ç‚¹ã€‚å®žç”¨çš„æŠ€æœ¯ä»ç„¶ä¸å¤šã€‚ é…ç½®åœ¨é…ç½®NAT(ç½‘ç»œåœ°å€è½¬æ¢)ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦äº†è§£å†…éƒ¨æœ¬åœ°åœ°å€å’Œå†…éƒ¨å…¨å±€åœ°å€çš„åˆ†é…æƒ…å†µã€‚æ ¹æ®ä¸åŒçš„éœ€æ±‚ï¼Œæ‰§è¡Œä»¥ä¸‹ä¸åŒçš„é…ç½®ä»»åŠ¡ã€‚ å†…éƒ¨æºåœ°å€NATé…ç½® å†…éƒ¨æºåœ°å€NAPTé…ç½® é‡å åœ°å€NATé…ç½® TCPè´Ÿè½½å‡è¡¡]]></content>
      <categories>
        <category>linuxç®¡ç†</category>
      </categories>
      <tags>
        <tag>ç½‘ç»œ</tag>
        <tag>è™šæ‹ŸåŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[linuxç½‘å¡é…ç½®]]></title>
    <url>%2F2017%2F04%2F22%2Flinux-networkcard%2F</url>
    <content type="text"><![CDATA[linuxç½‘å¡å¯ä»¥é€šè¿‡å‘½ä»¤å’Œé…ç½®æ–‡ä»¶é…ç½®,å¦‚æžœæ˜¯æ¡Œé¢çŽ¯å¢ƒè¿˜å¯ä»¥é€šè¿‡å›¾å½¢åŒ–ç•Œé¢é…ç½®. 1.ifconfig(interfaces config)å‘½ä»¤æ–¹å¼é€šå¸¸éœ€è¦ä»¥rootèº«ä»½ç™»å½•æˆ–ä½¿ç”¨sudoä»¥ä¾¿åœ¨Linuxæœºå™¨ä¸Šä½¿ç”¨ifconfigå·¥å…·ã€‚ä¾èµ–äºŽifconfigå‘½ä»¤ä¸­ä½¿ç”¨ä¸€äº›é€‰é¡¹å±žæ€§ï¼Œifconfigå·¥å…·ä¸ä»…å¯ä»¥è¢«ç”¨æ¥ç®€å•åœ°èŽ·å–ç½‘ç»œæŽ¥å£é…ç½®ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ä¿®æ”¹è¿™äº›é…ç½®(ç”¨ifconfigå‘½ä»¤é…ç½®çš„ç½‘å¡ä¿¡æ¯ï¼Œåœ¨ç½‘å¡é‡å¯åŽæœºå™¨é‡å¯åŽï¼Œé…ç½®å°±ä¸å­˜åœ¨)ã€‚ 1.1å‘½ä»¤æ ¼å¼1ifconfig [ç½‘ç»œè®¾å¤‡] [å‚æ•°] 1.2å‘½ä»¤åŠŸèƒ½ifconfig å‘½ä»¤ç”¨æ¥æŸ¥çœ‹å’Œé…ç½®ç½‘ç»œè®¾å¤‡ã€‚å½“ç½‘ç»œçŽ¯å¢ƒå‘ç”Ÿæ”¹å˜æ—¶å¯é€šè¿‡æ­¤å‘½ä»¤å¯¹ç½‘ç»œè¿›è¡Œç›¸åº”çš„é…ç½®ã€‚ 1.3å‘½ä»¤å‚æ•° up å¯åŠ¨æŒ‡å®šç½‘ç»œè®¾å¤‡/ç½‘å¡ã€‚ down å…³é—­æŒ‡å®šç½‘ç»œè®¾å¤‡/ç½‘å¡ã€‚è¯¥å‚æ•°å¯ä»¥æœ‰æ•ˆåœ°é˜»æ­¢é€šè¿‡æŒ‡å®šæŽ¥å£çš„IPä¿¡æ¯æµï¼Œå¦‚æžœæƒ³æ°¸ä¹…åœ°å…³é—­ä¸€ä¸ªæŽ¥å£ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä»Žæ ¸å¿ƒè·¯ç”±è¡¨ä¸­å°†è¯¥æŽ¥å£çš„è·¯ç”±ä¿¡æ¯å…¨éƒ¨åˆ é™¤ã€‚ arp è®¾ç½®æŒ‡å®šç½‘å¡æ˜¯å¦æ”¯æŒARPåè®®ã€‚ -promisc è®¾ç½®æ˜¯å¦æ”¯æŒç½‘å¡çš„promiscuousæ¨¡å¼ï¼Œå¦‚æžœé€‰æ‹©æ­¤å‚æ•°ï¼Œç½‘å¡å°†æŽ¥æ”¶ç½‘ç»œä¸­å‘ç»™å®ƒæ‰€æœ‰çš„æ•°æ®åŒ… -allmulti è®¾ç½®æ˜¯å¦æ”¯æŒå¤šæ’­æ¨¡å¼ï¼Œå¦‚æžœé€‰æ‹©æ­¤å‚æ•°ï¼Œç½‘å¡å°†æŽ¥æ”¶ç½‘ç»œä¸­æ‰€æœ‰çš„å¤šæ’­æ•°æ®åŒ… -a æ˜¾ç¤ºå…¨éƒ¨æŽ¥å£ä¿¡æ¯ -s æ˜¾ç¤ºæ‘˜è¦ä¿¡æ¯ï¼ˆç±»ä¼¼äºŽ netstat -iï¼‰ add ç»™æŒ‡å®šç½‘å¡é…ç½®IPv6åœ°å€ del åˆ é™¤æŒ‡å®šç½‘å¡çš„IPv6åœ°å€ &lt;ç¡¬ä»¶åœ°å€&gt; é…ç½®ç½‘å¡æœ€å¤§çš„ä¼ è¾“å•å…ƒ mtu&lt;å­—èŠ‚æ•°&gt; è®¾ç½®ç½‘å¡çš„æœ€å¤§ä¼ è¾“å•å…ƒ (bytes) netmask&lt;å­ç½‘æŽ©ç &gt; è®¾ç½®ç½‘å¡çš„å­ç½‘æŽ©ç ã€‚æŽ©ç å¯ä»¥æ˜¯æœ‰å‰ç¼€0xçš„32ä½åå…­è¿›åˆ¶æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨ç‚¹åˆ†å¼€çš„4ä¸ªåè¿›åˆ¶æ•°ã€‚å¦‚æžœä¸æ‰“ç®—å°†ç½‘ç»œåˆ†æˆå­ç½‘ï¼Œå¯ä»¥ä¸ç®¡è¿™ä¸€é€‰é¡¹ï¼›å¦‚æžœè¦ä½¿ç”¨å­ç½‘ï¼Œé‚£ä¹ˆè¯·è®°ä½ï¼Œç½‘ç»œä¸­æ¯ä¸€ä¸ªç³»ç»Ÿå¿…é¡»æœ‰ç›¸åŒå­ç½‘æŽ©ç ã€‚ tunel å»ºç«‹éš§é“ dstaddr è®¾å®šä¸€ä¸ªè¿œç«¯åœ°å€ï¼Œå»ºç«‹ç‚¹å¯¹ç‚¹é€šä¿¡ -broadcast&lt;åœ°å€&gt; ä¸ºæŒ‡å®šç½‘å¡è®¾ç½®å¹¿æ’­åè®® -pointtopoint&lt;åœ°å€&gt; ä¸ºç½‘å¡è®¾ç½®ç‚¹å¯¹ç‚¹é€šè®¯åè®® multicast ä¸ºç½‘å¡è®¾ç½®ç»„æ’­æ ‡å¿— address ä¸ºç½‘å¡è®¾ç½®IPv4åœ°å€ txqueuelen&lt;é•¿åº¦&gt; ä¸ºç½‘å¡è®¾ç½®ä¼ è¾“åˆ—é˜Ÿçš„é•¿åº¦ 1.4ä½¿ç”¨å®žä¾‹1.4.1æ˜¾ç¤ºç½‘ç»œè®¾å¤‡ä¿¡æ¯ï¼ˆæ¿€æ´»çŠ¶æ€çš„ï¼‰å‘½ä»¤:ifcofig è¾“å‡º: 12345678910111213141516[root@localhost ~]# ifconfigeth0 Link encap:Ethernet HWaddr 00:50:56:BF:26:20 inet addr:192.168.120.204 Bcast:192.168.120.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:8700857 errors:0 dropped:0 overruns:0 frame:0 TX packets:31533 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:596390239 (568.7 MiB) TX bytes:2886956 (2.7 MiB)lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:68 errors:0 dropped:0 overruns:0 frame:0 TX packets:68 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:2856 (2.7 KiB) TX bytes:2856 (2.7 KiB) è¯´æ˜Ž eth0 è¡¨ç¤ºç¬¬ä¸€å—ç½‘å¡ï¼Œ å…¶ä¸­ HWaddr è¡¨ç¤ºç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰è¿™ä¸ªç½‘å¡çš„ç‰©ç†åœ°å€(MACåœ°å€ï¼‰æ˜¯ 00:50:56:BF:26:20 inet addr ç”¨æ¥è¡¨ç¤ºç½‘å¡çš„IPåœ°å€ï¼Œæ­¤ç½‘å¡çš„ IPåœ°å€æ˜¯ 192.168.120.204ï¼Œå¹¿æ’­åœ°å€ï¼Œ Bcast:192.168.120.255ï¼ŒæŽ©ç åœ°å€Mask:255.255.255.0 lo æ˜¯è¡¨ç¤ºä¸»æœºçš„å›žååœ°å€ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯ç”¨æ¥æµ‹è¯•ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œä½†åˆä¸æƒ³è®©å±€åŸŸç½‘æˆ–å¤–ç½‘çš„ç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹ï¼Œåªèƒ½åœ¨æ­¤å°ä¸»æœºä¸Šè¿è¡Œå’ŒæŸ¥çœ‹æ‰€ç”¨çš„ç½‘ç»œæŽ¥å£ã€‚æ¯”å¦‚æŠŠ HTTPDæœåŠ¡å™¨çš„æŒ‡å®šåˆ°å›žååœ°å€ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥ 127.0.0.1 å°±èƒ½çœ‹åˆ°ä½ æ‰€æž¶WEBç½‘ç«™äº†ã€‚ä½†åªæ˜¯æ‚¨èƒ½çœ‹å¾—åˆ°ï¼Œå±€åŸŸç½‘çš„å…¶å®ƒä¸»æœºæˆ–ç”¨æˆ·æ— ä»ŽçŸ¥é“ã€‚ ç¬¬ä¸€è¡Œï¼šè¿žæŽ¥ç±»åž‹ï¼šEthernetï¼ˆä»¥å¤ªç½‘ï¼‰HWaddrï¼ˆç¡¬ä»¶macåœ°å€ï¼‰ ç¬¬äºŒè¡Œï¼šç½‘å¡çš„IPåœ°å€ã€å­ç½‘ã€æŽ©ç  ç¬¬ä¸‰è¡Œï¼šUPï¼ˆä»£è¡¨ç½‘å¡å¼€å¯çŠ¶æ€ï¼‰RUNNINGï¼ˆä»£è¡¨ç½‘å¡çš„ç½‘çº¿è¢«æŽ¥ä¸Šï¼‰MULTICASTï¼ˆæ”¯æŒç»„æ’­ï¼‰MTU:1500ï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰ï¼š1500å­—èŠ‚ ç¬¬å››ã€äº”è¡Œï¼šæŽ¥æ”¶ã€å‘é€æ•°æ®åŒ…æƒ…å†µç»Ÿè®¡ ç¬¬ä¸ƒè¡Œï¼šæŽ¥æ”¶ã€å‘é€æ•°æ®å­—èŠ‚æ•°ç»Ÿè®¡ä¿¡æ¯ã€‚ 1.4.2å¯åŠ¨å…³é—­æŒ‡å®šç½‘å¡å‘½ä»¤ï¼š ifconfig eth0 up ifconfig eth0 down è¾“å‡ºï¼š è¯´æ˜Žï¼š ifconfig eth0 up ä¸ºå¯åŠ¨ç½‘å¡eth0 ï¼›ifconfig eth0 down ä¸ºå…³é—­ç½‘å¡eth0ã€‚sshç™»é™†linuxæœåŠ¡å™¨æ“ä½œè¦å°å¿ƒï¼Œå…³é—­äº†å°±ä¸èƒ½å¼€å¯äº†ï¼Œé™¤éžä½ æœ‰å¤šç½‘å¡ã€‚ 1.4.3ä¸ºç½‘å¡é…ç½®å’Œåˆ é™¤IPv6åœ°å€å‘½ä»¤ï¼š ifconfig eth0 add 33ffe:3240:800:1005::2/64 ifconfig eth0 del 33ffe:3240:800:1005::2/64 è¾“å‡ºï¼š è¯´æ˜Žï¼š ifconfig eth0 add 33ffe:3240:800:1005::2/64 ä¸ºç½‘å¡eth0é…ç½®IPv6åœ°å€ï¼› ifconfig eth0 add 33ffe:3240:800:1005::2/64 ä¸ºç½‘å¡eth0åˆ é™¤IPv6åœ°å€ï¼› ç»ƒä¹ çš„æ—¶å€™ï¼Œsshç™»é™†linuxæœåŠ¡å™¨æ“ä½œè¦å°å¿ƒï¼Œå…³é—­äº†å°±ä¸èƒ½å¼€å¯äº†ï¼Œé™¤éžä½ æœ‰å¤šç½‘å¡ã€‚ 1.4.4ç”¨ifconfigä¿®æ”¹MACåœ°å€å‘½ä»¤ï¼š ifconfig eth0 hw ether 00:AA:BB:CC:DD:EE è¾“å‡ºï¼š 12345678910111213141516171819202122232425262728293031323334353637[root@localhost ~]# ifconfig eth0 down //å…³é—­ç½‘å¡[root@localhost ~]# ifconfig eth0 hw ether 00:AA:BB:CC:DD:EE //ä¿®æ”¹MACåœ°å€[root@localhost ~]# ifconfig eth0 up //å¯åŠ¨ç½‘å¡[root@localhost ~]# ifconfigeth0 Link encap:Ethernet HWaddr 00:AA:BB:CC:DD:EE inet addr:192.168.120.204 Bcast:192.168.120.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:8700857 errors:0 dropped:0 overruns:0 frame:0 TX packets:31533 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:596390239 (568.7 MiB) TX bytes:2886956 (2.7 MiB)lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:68 errors:0 dropped:0 overruns:0 frame:0 TX packets:68 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:2856 (2.7 KiB) TX bytes:2856 (2.7 KiB)[root@localhost ~]# ifconfig eth0 hw ether 00:50:56:BF:26:20 //å…³é—­ç½‘å¡å¹¶ä¿®æ”¹MACåœ°å€[root@localhost ~]# ifconfig eth0 up //å¯åŠ¨ç½‘å¡[root@localhost ~]# ifconfigeth0 Link encap:Ethernet HWaddr 00:50:56:BF:26:20 inet addr:192.168.120.204 Bcast:192.168.120.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:8700857 errors:0 dropped:0 overruns:0 frame:0 TX packets:31533 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:596390239 (568.7 MiB) TX bytes:2886956 (2.7 MiB)lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:68 errors:0 dropped:0 overruns:0 frame:0 TX packets:68 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:2856 (2.7 KiB) TX bytes:2856 (2.7 KiB) 1.4.5é…ç½®IPåœ°å€è¾“å‡º: 123[root@localhost ~]# ifconfig eth0 192.168.120.56[root@localhost ~]# ifconfig eth0 192.168.120.56 netmask 255.255.255.0[root@localhost ~]# ifconfig eth0 192.168.120.56 netmask 255.255.255.0 broadcast 192.168.120.255 è¯´æ˜Ž: ifconfig eth0 192.168.120.56 ç»™eth0ç½‘å¡é…ç½®IPåœ°ï¼š192.168.120.56 ifconfig eth0 192.168.120.56 netmask 255.255.255.0 ç»™eth0ç½‘å¡é…ç½®IPåœ°å€ï¼š192.168.120.56 ï¼Œå¹¶åŠ ä¸Šå­æŽ©ç ï¼š255.255.255.0 ifconfig eth0 192.168.120.56 netmask 255.255.255.0 broadcast 192.168.120.255 /ç»™eth0ç½‘å¡é…ç½®IPåœ°å€ï¼š192.168.120.56ï¼ŒåŠ ä¸Šå­æŽ©ç ï¼š255.255.255.0ï¼ŒåŠ ä¸Šä¸ªå¹¿æ’­åœ°å€ï¼š 192.168.120.255 1.4.6å¯ç”¨å’Œå…³é—­ARPåè®®å‘½ä»¤ï¼š ifconfig eth0 arp ifconfig eth0 -arp è¾“å‡ºï¼š 12[root@localhost ~]# ifconfig eth0 arp[root@localhost ~]# ifconfig eth0 -arp è¯´æ˜Ž ifconfig eth0 arp å¼€å¯ç½‘å¡eth0 çš„arpåè®®ï¼› ifconfig eth0 -arp å…³é—­ç½‘å¡eth0 çš„arpåè®®ï¼› 1.4.7 è®¾ç½®æœ€å¤§ä¼ è¾“å•å…ƒå‘½ä»¤ï¼š ifconfig eth0 mtu 1500 è¾“å‡ºï¼š 12345678910111213141516171819202122232425262728293031323334353637[root@localhost ~]# ifconfig eth0 mtu 1480[root@localhost ~]# ifconfigeth0 Link encap:Ethernet HWaddr 00:50:56:BF:26:1F inet addr:192.168.120.203 Bcast:192.168.120.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1480 Metric:1 RX packets:8712395 errors:0 dropped:0 overruns:0 frame:0 TX packets:36631 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:597062089 (569.4 MiB) TX bytes:2643973 (2.5 MiB)lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:9973 errors:0 dropped:0 overruns:0 frame:0 TX packets:9973 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:518096 (505.9 KiB) TX bytes:518096 (505.9 KiB)[root@localhost ~]# ifconfig eth0 mtu 1500[root@localhost ~]# ifconfigeth0 Link encap:Ethernet HWaddr 00:50:56:BF:26:1F inet addr:192.168.120.203 Bcast:192.168.120.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:8712548 errors:0 dropped:0 overruns:0 frame:0 TX packets:36685 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:597072333 (569.4 MiB) TX bytes:2650581 (2.5 MiB)lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:9973 errors:0 dropped:0 overruns:0 frame:0 TX packets:9973 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:518096 (505.9 KiB) TX bytes:518096 (505.9 KiB)[root@localhost ~]# è¯´æ˜Ž: è®¾ç½®èƒ½é€šè¿‡çš„æœ€å¤§æ•°æ®åŒ…å¤§å°ä¸º1500bytes 2.é…ç½®æ–‡ä»¶æ–¹å¼ubuntué…ç½®æ–‡ä»¶:/etc/network/interfaces 1234567auto loiface lo inet loopbackauto eth0 #é…ç½®é™æ€ipiface eth0 inet staticaddress 192.168.1.100netmask 255.255.255.0gateway 192.168.1.1 centosé…ç½®æ–‡ä»¶:/etc/sysconfig/network-scripts/ifcfg-eth0 123456789101112DEVICE=eth0(é»˜è®¤)HWADDR=00:0C:29:2E:36:16(é»˜è®¤)TYPE=Ethernet(é»˜è®¤)UUID=XXXXXXX(é»˜è®¤)ONBOOT=yes(é»˜è®¤ä¸ºno,ä¿®æ”¹ä¸ºyesæ„ä¸ºæ¯æ¬¡rebootåŽ ifup eth0)MM_CONTROLLED=yes(é»˜è®¤)#BOOTPROTO=dhcp(dhcpä¸ºè‡ªåŠ¨åˆ†é…ipåœ°å€,æˆ‘ä»¬æŠŠä»–æ³¨é‡Šäº†ï¼Œåœ¨ä¸‹é¢å¦å¤–åŠ )BOOTPROTO=static(æ–°æ·»åŠ )IPV6INIT=no(æ–°æ·»åŠ )USERCTL=no(æ–°æ·»åŠ )IPADDR=192.168.164.100(æ–°æ·»åŠ )NETMASK=255.255.255.0(æ–°æ·»åŠ ) service network restarté‡å¯ç½‘å¡æœåŠ¡ 3.å›¾å½¢ç•Œé¢æ–¹å¼æ·»åŠ è™šæ‹Ÿç½‘å¡ä¸€å°æœåŠ¡å™¨éœ€è¦è®¾ç½®å¤šä¸ªip,ä½†åˆä¸æƒ³æ·»åŠ å¤šå—ç½‘å¡,é‚£å°±éœ€è¦è®¾ç½®è™šæ‹Ÿç½‘å¡.è¿™é‡Œä»‹ç»å‡ ç§æ–¹å¼åœ¨linuxæœåŠ¡å™¨ä¸Šæ·»åŠ è™šæ‹Ÿç½‘å¡. æ¯”å¦‚å‘eth0ä¸­æ·»åŠ ä¸€å—è™šæ‹Ÿç½‘å¡: 1.å¿«é€Ÿåˆ›å»ºåˆ é™¤è™šæ‹Ÿç½‘å¡sudo ifconfig eth0: 192.168.10.10 up ä»¥ä¸Šçš„å‘½ä»¤å°±å¯ä»¥åœ¨eth0ç½‘å¡ä¸Šåˆ›å»ºä¸€ä¸ªå«eth0:0çš„è™šæ‹Ÿç½‘å¡,ä»–çš„åœ°å€æ˜¯:192.168.1.63 å¦‚æžœä¸æƒ³è¦è¿™ä¸ªè™šæ‹Ÿç½‘å¡äº†,å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ é™¤: 1sudo ifconfig eth0:0 down é‡å¯æœåŠ¡å™¨æˆ–è€…ç½‘ç»œåŽ,è™šæ‹Ÿç½‘å¡å°±æ²¡æœ‰äº†. 2.ä¿®æ”¹ç½‘å¡é…ç½®æ–‡ä»¶åœ¨ubuntuä¸‹,ç½‘å¡çš„é…ç½®æ–‡ä»¶æ˜¯/etc/network/interfaces,æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹å®ƒ: sudo vim /etc/network/interfaces åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å¢žåŠ å¦‚ä¸‹å†…å®¹å¹¶ä¿å­˜: 123456auto eth0:0iface eth0:0 inet staticaddress 192.168.10.10netmask 255.255.255.0#network 192.168.10.1#broadcast 192.168.1.255 ä¿å­˜åŽ,æˆ‘ä»¬éœ€è¦é‡å¯ç½‘å¡(é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶)æ‰ä¼šç”Ÿæ•ˆ,ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤é‡å¯:sudo /etc/init.d/networking restart ä»–çš„ä¼˜ç‚¹æ˜¯é‡å¯æœåŠ¡å™¨æˆ–è€…ç½‘å¡é…ç½®ä¸ä¼šä¸¢å¤±ã€‚ 3.åˆ›å»ºtagå‰ä¸¤ç§æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œåˆ›å»ºçš„ç½‘å¡å¯æœ‰ä¸åŒçš„ipåœ°å€ï¼Œä½†æ˜¯Macåœ°å€ç›¸åŒã€‚æ— æ³•ç”¨æ¥åˆ›å»ºè™šæ‹Ÿæœºã€‚ æ·»åŠ è™šæ‹Ÿç½‘å¡tap 1tunctl -b å…¶ä»–é…ç½®å‘½ä»¤: æ˜¾ç¤ºç½‘æ¡¥ä¿¡æ¯:brctl show æ·»åŠ ç½‘æ¡¥:brctl addbr virbr0 æ¿€æ´»ç½‘æ¡¥:ip link set virbr0 up æ·»åŠ è™šæ‹Ÿç½‘å¡tap:tunctl -b tap0 â€”â€”-&gt; æ‰§è¡Œä¸Šé¢ä½¿å‘½å°±ä¼šç”Ÿæˆä¸€ä¸ªtap,åŽç¼€ä»Ž0ï¼Œ1ï¼Œ2ä¾æ¬¡é€’å¢žæ¿€æ´»åˆ›å»ºçš„tap:ip link set tap0 up å°†tap0è™šæ‹Ÿç½‘å¡æ·»åŠ åˆ°æŒ‡å®šç½‘æ¡¥ä¸Š:brctl addif br0 tap0ç»™ç½‘æ¡¥é…åˆ¶ipåœ°å€:ifconfig virbr1 169.254.251.4 up å°†virbr1ç½‘æ¡¥ä¸Šç»‘å®šçš„ç½‘å¡eth5è§£é™¤: brctl delif virb1 eth5 ç»™virbr1ç½‘æ¡¥æ·»åŠ ç½‘å¡eth6:brctl addif virbr1 eth6]]></content>
      <categories>
        <category>linuxç®¡ç†</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidå£°éŸ³æ’­æ”¾ä¸Žå½•åˆ¶]]></title>
    <url>%2F2017%2F04%2F19%2Fissues-android-audio%2F</url>
    <content type="text"><![CDATA[AudioTrackAudioTrackç±»è¯´æ˜Ž:123456789101112131415161718192021222324252627282930313233343536373839/** * The AudioTrack class manages and plays a single audio resource for Java applications. * It allows streaming of PCM audio buffers to the audio sink for playback. This is * achieved by &quot;pushing&quot; the data to the AudioTrack object using one of the * &#123;@link #write(byte[], int, int)&#125;, &#123;@link #write(short[], int, int)&#125;, * and &#123;@link #write(float[], int, int, int)&#125; methods. * * &lt;p&gt;An AudioTrack instance can operate under two modes: static or streaming.&lt;br&gt; * In Streaming mode, the application writes a continuous stream of data to the AudioTrack, using * one of the &#123;@code write()&#125; methods. These are blocking and return when the data has been * transferred from the Java layer to the native layer and queued for playback. The streaming * mode is most useful when playing blocks of audio data that for instance are: * * &lt;ul&gt; * &lt;li&gt;too big to fit in memory because of the duration of the sound to play,&lt;/li&gt; * &lt;li&gt;too big to fit in memory because of the characteristics of the audio data * (high sampling rate, bits per sample ...)&lt;/li&gt; * &lt;li&gt;received or generated while previously queued audio is playing.&lt;/li&gt; * &lt;/ul&gt; * * The static mode should be chosen when dealing with short sounds that fit in memory and * that need to be played with the smallest latency possible. The static mode will * therefore be preferred for UI and game sounds that are played often, and with the * smallest overhead possible. * * &lt;p&gt;Upon creation, an AudioTrack object initializes its associated audio buffer. * The size of this buffer, specified during the construction, determines how long an AudioTrack * can play before running out of data.&lt;br&gt; * For an AudioTrack using the static mode, this size is the maximum size of the sound that can * be played from it.&lt;br&gt; * For the streaming mode, data will be written to the audio sink in chunks of * sizes less than or equal to the total buffer size. * * AudioTrack is not final and thus permits subclasses, but such use is not recommended. */public class AudioTrack extends PlayerBase implements AudioRouting&#123; &#125; æž„é€ æ–¹æ³•è¯´æ˜Ž1234567891011121314151617//æ ¹æ®é‡‡æ ·çŽ‡ï¼Œé‡‡æ ·ç²¾åº¦ï¼Œå•åŒå£°é“æ¥å¾—åˆ°frameçš„å¤§å°ã€‚int bufsize = AudioTrack.getMinBufferSize(8000,//æ¯ç§’8Kä¸ªç‚¹ AudioFormat.CHANNEL_CONFIGURATION_STEREO,//åŒå£°é“AudioFormat.ENCODING_PCM_16BIT);//ä¸€ä¸ªé‡‡æ ·ç‚¹16æ¯”ç‰¹-2ä¸ªå­—èŠ‚//æ³¨æ„ï¼ŒæŒ‰ç…§æ•°å­—éŸ³é¢‘çš„çŸ¥è¯†ï¼Œè¿™ä¸ªç®—å‡ºæ¥çš„æ˜¯ä¸€ç§’é’Ÿbufferçš„å¤§å°ã€‚//åˆ›å»ºAudioTrackAudioTrack trackplayer = new AudioTrack(AudioManager.STREAM_MUSIC, 8000, AudioFormat.CHANNEL_CONFIGURATION_ STEREO, AudioFormat.ENCODING_PCM_16BIT, bufsize,AudioTrack.MODE_STREAM);// trackplayer.play() ;//å¼€å§‹trackplayer.write(bytes_pkg, 0, bytes_pkg.length) ;//å¾€trackä¸­å†™æ•°æ®â€¦.trackplayer.stop();//åœæ­¢æ’­æ”¾trackplayer.release();//é‡Šæ”¾åº•å±‚èµ„æºã€‚ å‚æ•°è¯´æ˜Ž1. AudioTrack.MODE_STREAMçš„æ„æ€ï¼šAudioTrackä¸­æœ‰MODE_STATICå’ŒMODE_STREAMä¸¤ç§åˆ†ç±»ã€‚ STREAMçš„æ„æ€æ˜¯ç”±ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºé€šè¿‡writeæ–¹å¼æŠŠæ•°æ®ä¸€æ¬¡ä¸€æ¬¡å¾—å†™åˆ°audiotrackä¸­ã€‚è¿™ä¸ªå’Œæˆ‘ä»¬åœ¨socketä¸­å‘é€æ•°æ®ä¸€æ ·ï¼Œåº”ç”¨å±‚ä»ŽæŸä¸ªåœ°æ–¹èŽ·å–æ•°æ®ï¼Œä¾‹å¦‚é€šè¿‡ç¼–è§£ç å¾—åˆ°PCMæ•°æ®ï¼Œç„¶åŽwriteåˆ°audiotrackã€‚è¿™ç§æ–¹å¼çš„åå¤„å°±æ˜¯æ€»æ˜¯åœ¨JAVAå±‚å’ŒNativeå±‚äº¤äº’ï¼Œæ•ˆçŽ‡æŸå¤±è¾ƒå¤§ã€‚ è€ŒSTATICçš„æ„æ€æ˜¯ä¸€å¼€å§‹åˆ›å»ºçš„æ—¶å€™ï¼Œå°±æŠŠéŸ³é¢‘æ•°æ®æ”¾åˆ°ä¸€ä¸ªå›ºå®šçš„bufferï¼Œç„¶åŽç›´æŽ¥ä¼ ç»™audiotrackï¼ŒåŽç»­å°±ä¸ç”¨ä¸€æ¬¡æ¬¡å¾—writeäº†ã€‚AudioTrackä¼šè‡ªå·±æ’­æ”¾è¿™ä¸ªbufferä¸­çš„æ•°æ®ã€‚ è¿™ç§æ–¹æ³•å¯¹äºŽé“ƒå£°ç­‰å†…å­˜å ç”¨è¾ƒå°ï¼Œå»¶æ—¶è¦æ±‚è¾ƒé«˜çš„å£°éŸ³æ¥è¯´å¾ˆé€‚ç”¨ã€‚ 2. StreamTypeè¿™ä¸ªåœ¨æž„é€ AudioTrackçš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ä½¿ç”¨ã€‚è¿™ä¸ªå‚æ•°å’ŒAndroidä¸­çš„AudioManageræœ‰å…³ç³»ï¼Œæ¶‰åŠåˆ°æ‰‹æœºä¸Šçš„éŸ³é¢‘ç®¡ç†ç­–ç•¥ã€‚ Androidå°†ç³»ç»Ÿçš„å£°éŸ³åˆ†ä¸ºä»¥ä¸‹å‡ ç±»å¸¸è§çš„ï¼ˆå®šä¹‰åœ¨AudioManager)ï¼š 1234567891011121314151617181920/** The audio stream for phone calls */public static final int STREAM_VOICE_CALL = AudioSystem.STREAM_VOICE_CALL;/** The audio stream for system sounds */public static final int STREAM_SYSTEM = AudioSystem.STREAM_SYSTEM;/** The audio stream for the phone ring */public static final int STREAM_RING = AudioSystem.STREAM_RING;/** The audio stream for music playback */public static final int STREAM_MUSIC = AudioSystem.STREAM_MUSIC;/** The audio stream for alarms */public static final int STREAM_ALARM = AudioSystem.STREAM_ALARM;/** The audio stream for notifications */public static final int STREAM_NOTIFICATION = AudioSystem.STREAM_NOTIFICATION;/** @hide The audio stream for phone calls when connected to bluetooth */public static final int STREAM_BLUETOOTH_SCO = AudioSystem.STREAM_BLUETOOTH_SCO;/** @hide The audio stream for enforced system sounds in certain countries (e.g camera in Japan) */public static final int STREAM_SYSTEM_ENFORCED = AudioSystem.STREAM_SYSTEM_ENFORCED;/** The audio stream for DTMF Tones */public static final int STREAM_DTMF = AudioSystem.STREAM_DTMF;/** @hide The audio stream for text to speech (TTS) */public static final int STREAM_TTS = AudioSystem.STREAM_TTS; å¸¸ç”¨è¯´æ˜Ž: STREAM_ALARMï¼šè­¦å‘Šå£° STREAM_MUSCIï¼šéŸ³ä¹å£°ï¼Œä¾‹å¦‚musicç­‰ STREAM_RINGï¼šé“ƒå£° STREAM_SYSTEMï¼šç³»ç»Ÿå£°éŸ³ STREAM_VOCIE_CALLï¼šç”µè¯å£°éŸ³ ä¸ºä»€ä¹ˆè¦åˆ†è¿™ä¹ˆå¤šå‘¢ï¼Ÿä»¥å‰åœ¨å°å¼æœºä¸Šå¼€å‘çš„æ—¶å€™å¾ˆå°‘çŸ¥é“æœ‰è¿™ä¹ˆå¤šçš„å£°éŸ³ç±»åž‹ï¼Œä¸è¿‡ä»”ç»†æ€è€ƒä¸‹ï¼Œå‘çŽ°è¿™æ ·åšæ˜¯æœ‰é“ç†çš„ã€‚ä¾‹å¦‚ä½ åœ¨å¬musicçš„æ—¶å€™æŽ¥åˆ°ç”µè¯ï¼Œè¿™ä¸ªæ—¶å€™musicæ’­æ”¾è‚¯å®šä¼šåœæ­¢ï¼Œæ­¤æ—¶ä½ åªèƒ½å¬åˆ°ç”µè¯ï¼Œå¦‚æžœä½ è°ƒèŠ‚éŸ³é‡çš„è¯ï¼Œè¿™ä¸ªè°ƒèŠ‚è‚¯å®šåªå¯¹ç”µè¯èµ·ä½œç”¨ã€‚å½“ç”µè¯æ‰“å®Œäº†ï¼Œå†å›žåˆ°musicï¼Œä½ è‚¯å®šä¸ç”¨å†è°ƒèŠ‚éŸ³é‡äº†ã€‚ å…¶å®žç³»ç»Ÿå°†è¿™å‡ ç§å£°éŸ³çš„æ•°æ®åˆ†å¼€ç®¡ç†ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªå‚æ•°å¯¹AudioTrackæ¥è¯´ï¼Œå®ƒçš„å«ä¹‰å°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼Œæˆ‘çŽ°åœ¨æƒ³ä½¿ç”¨çš„æ˜¯å“ªç§ç±»åž‹çš„å£°éŸ³ï¼Œè¿™æ ·ç³»ç»Ÿå°±å¯ä»¥å¯¹åº”ç®¡ç†ä»–ä»¬äº†ã€‚ AudioRecordAudioRecordè¯´æ˜ŽThe AudioRecord class manages the audio resources for Java applications to record audio from the audio input hardware of the platform. This is achieved by â€œpullingâ€ (reading) the data from the AudioRecord object. The application is responsible for polling the AudioRecord object in time using one of the following three methods: read(byte[], int, int), read(short[], int, int) or read(ByteBuffer, int). The choice of which method to use will be based on the audio data storage format that is the most convenient for the user of AudioRecord. Upon creation, an AudioRecord object initializes its associated audio buffer that it will fill with the new audio data. The size of this buffer, specified during the construction, determines how long an AudioRecord can record before â€œover-runningâ€ data that has not been read yet. Data should be read from the audio hardware in chunks of sizes inferior to the total recording buffer size. audiosourceç±»åž‹å®šä¹‰åœ¨MediaRecorderä¸­ 1234567891011121314151617181920212223242526272829/** Default audio source **/ public static final int DEFAULT = 0; /** Microphone audio source */ public static final int MIC = 1; /** Voice call uplink (Tx) audio source */ public static final int VOICE_UPLINK = 2; /** Voice call downlink (Rx) audio source */ public static final int VOICE_DOWNLINK = 3; /** Voice call uplink + downlink audio source */ public static final int VOICE_CALL = 4; /** Microphone audio source with same orientation as camera if available, the main * device microphone otherwise */ public static final int CAMCORDER = 5; /** Microphone audio source tuned for voice recognition if available, behaves like * &#123;@link #DEFAULT&#125; otherwise. */ public static final int VOICE_RECOGNITION = 6; /** Microphone audio source tuned for voice communications such as VoIP. It * will for instance take advantage of echo cancellation or automatic gain control * if available. It otherwise behaves like &#123;@link #DEFAULT&#125; if no voice processing * is applied. */ public static final int VOICE_COMMUNICATION = 7; AudioManagerèŽ·å–ç³»ç»ŸéŸ³é‡ä»£ç  1234567891011121314151617181920212223242526272829//åˆå§‹åŒ–AudioManager:AudioManager mAudioManager = (AudioManager) getSystemService(Context.AUDIO_SERVICE);//é€šè¯éŸ³é‡int max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_VOICE_CALL );int current = mAudioManager.getStreamVolume( AudioManager.STREAM_VOICE_CALL );Log.d(â€œVIOCE_CALLâ€, â€œmax : â€ + max + â€ current : â€ + current);//ç³»ç»ŸéŸ³é‡max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_SYSTEM );current = mAudioManager.getStreamVolume( AudioManager.STREAM_SYSTEM );Log.d(â€œSYSTEMâ€, â€œmax : â€ + max + â€ current : â€ + current);//é“ƒå£°éŸ³é‡max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_RING );current = mAudioManager.getStreamVolume( AudioManager.STREAM_RING );Log.d(â€œRINGâ€, â€œmax : â€ + max + â€ current : â€ + current);//éŸ³ä¹éŸ³é‡max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_MUSIC );current = mAudioManager.getStreamVolume( AudioManager.STREAM_MUSIC );Log.d(â€œMUSICâ€, â€œmax : â€ + max + â€ current : â€ + current);//æç¤ºå£°éŸ³éŸ³é‡max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_ALARM );current = mAudioManager.getStreamVolume( AudioManager.STREAM_ALARM );Log.d(â€œALARMâ€, â€œmax : â€ + max + â€ current : â€ + current); psï¼š æ¸¸æˆè¿‡ç¨‹ä¸­åªå…è®¸è°ƒæ•´å¤šåª’ä½“éŸ³é‡ï¼Œè€Œä¸å…è®¸è°ƒæ•´é€šè¯éŸ³é‡ã€‚ 1setVolumeControlStream(AudioManager.STREAM_MUSIC); æŽ§åˆ¶éŸ³é‡AudioManageræä¾›äº†è®¾ç½®éŸ³é‡çš„æ–¹æ³•ï¼š 1public void setStreamVolume(intstreamType,intindex,intflags) å…¶ä¸­streamTypeæœ‰å†…ç½®çš„å¸¸é‡ï¼ŒåŽ»æ–‡æ¡£é‡Œé¢å°±å¯ä»¥çœ‹åˆ°ã€‚ ä½¿ç”¨ç¤ºä¾‹: 12345678910111213141516171819202122232425//éŸ³é‡æŽ§åˆ¶,åˆå§‹åŒ–å®šä¹‰ AudioManager mAudioManager = (AudioManager) getSystemService(Context.AUDIO_SERVICE); //æœ€å¤§éŸ³é‡ int maxVolume = mAudioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC); //å½“å‰éŸ³é‡ int currentVolume = mAudioManager.getStreamVolume(AudioManager.STREAM_MUSIC);//ç›´æŽ¥æŽ§åˆ¶éŸ³é‡if(isSilent)&#123; mAudioManager.setStreamVolume(AudioManager.STREAM_MUSIC, 0, 0); &#125;else&#123; mAudioManager.setStreamVolume(AudioManager.STREAM_MUSIC, tempVolume, 0); //tempVolume:éŸ³é‡ç»å¯¹å€¼ &#125; //ä»¥ä¸€æ­¥æ­¥é•¿æŽ§åˆ¶éŸ³é‡çš„å¢žå‡ï¼Œå¹¶å¼¹å‡ºç³»ç»Ÿé»˜è®¤éŸ³é‡æŽ§åˆ¶æ¡ï¼š//é™ä½ŽéŸ³é‡ï¼Œè°ƒå‡ºç³»ç»ŸéŸ³é‡æŽ§åˆ¶ if(flag == 0)&#123; mAudioManager.adjustStreamVolume(AudioManager.STREAM_MUSIC,AudioManager.ADJUST_LOWER, AudioManager.FX_FOCUS_NAVIGATION_UP); &#125; //å¢žåŠ éŸ³é‡ï¼Œè°ƒå‡ºç³»ç»ŸéŸ³é‡æŽ§åˆ¶ else if(flag == 1)&#123; mAudioManager.adjustStreamVolume(AudioManager.STREAM_MUSIC,AudioManager.ADJUST_RAISE, AudioManager.FX_FOCUS_NAVIGATION_UP); &#125; ç›‘å¬æŒ‰é”®æ‰‹åŠ¨æŽ§åˆ¶éŸ³é‡ 123456789101112131415161718192021AudioManager audio = (AudioManager) getSystemService(Service.AUDIO_SERVICE);@Overridepublic boolean onKeyDown(int keyCode, KeyEvent event) &#123; switch (keyCode) &#123; case KeyEvent.KEYCODE_VOLUME_UP: audio.adjustStreamVolume( AudioManager.STREAM_MUSIC, AudioManager.ADJUST_RAISE, AudioManager.FLAG_PLAY_SOUND | AudioManager.FLAG_SHOW_UI); return true; case KeyEvent.KEYCODE_VOLUME_DOWN: audio.adjustStreamVolume( AudioManager.STREAM_MUSIC, AudioManager.ADJUST_LOWER, AudioManager.FLAG_PLAY_SOUND | AudioManager.FLAG_SHOW_UI); return true; default: break; &#125; return super.onKeyDown(keyCode, event); æ’å…¥è€³æœºçŠ¶æ€ä»ä½¿ç”¨æ‰¬å£°å™¨å¤–æ”¾éŸ³ä¹æ’å…¥è€³æœºçš„æ—¶å€™ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨æ‰¬å£°å™¨æ’­æ”¾éŸ³ä¹ï¼Œæ¥ç”µé“ƒå£°å°±æ˜¯è¿™ä¹ˆç”¨çš„ã€‚ä½†æ˜¯åªèƒ½ç”¨MediaPlayerï¼Œæ’­æ”¾éŸ³é¢‘æ–‡ä»¶ã€‚ ä½¿ç”¨AudioTrack.writeæ’­æ”¾æ˜¯è¡Œä¸é€šçš„(æœ‰å¾…éªŒè¯)ã€‚æŒ‰ç†è¯´AudioRecordã€AudioTrackç±»ç›¸å¯¹äºŽMediaRecorder mediaPlayeræ¥è¯´ï¼Œæ›´åŠ æŽ¥è¿‘åº•å±‚ï¼Œåº”è¯¥ä¹Ÿè¡Œå¾—é€šçš„ã€‚ æ’å…¥è€³æœºï¼Œé€‰æ‹©å¤–æ”¾çš„ä»£ç å¦‚ä¸‹(å…¼å®¹æ€§éªŒè¯)ï¼š 123456789AudioManager audioManager = (AudioManager) this.getSystemService(Context.AUDIO_SERVICE); audioManager.setMicrophoneMute(false); audioManager.setSpeakerphoneOn(true);//ä½¿ç”¨æ‰¬å£°å™¨å¤–æ”¾ï¼Œå³ä½¿å·²ç»æ’å…¥è€³æœº setVolumeControlStream(AudioManager.STREAM_MUSIC);//æŽ§åˆ¶å£°éŸ³çš„å¤§å° audioManager.setMode(AudioManager.STREAM_MUSIC); //æ’­æ”¾ä¸€æ®µå£°éŸ³ï¼ŒæŸ¥çœ‹æ•ˆæžœ MediaPlayer playerSound = MediaPlayer.create(this, Uri.parse(&quot;file:///system/media/audio/ui/camera_click.ogg&quot;)); playerSound.start(); ä½¿ç”¨STREAM_VOCIE_CALLæ’­æ”¾å£°éŸ³ä¸Žè€³æœºå†²çªä½¿ç”¨STREAM_VOCIE_CALLæ’­æ”¾å£°éŸ³åœ¨æŸäº›æ‰‹æœº,æ¯”å¦‚é­…è“ç­‰ä¸Šé¢ä¼šå¯¼è‡´å£°éŸ³ä»å¤–æ”¾,è€³æœºæ²¡å£°éŸ³çŽ°è±¡. WebRtcä½¿ç”¨STREAM_VOCIE_CALLæ’­æ”¾å£°éŸ³,å¯¼è‡´æŸäº›æ‰‹æœºå£°éŸ³ä½Ž,æ²¡æ³•ä½¿ç”¨éŸ³é‡é”®è°ƒèŠ‚,æ’å…¥è€³æœºå£°éŸ³ä»å¤–æ”¾ç­‰é—®é¢˜.]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>Audio</tag>
        <tag>issue</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MarkDownä¸­åµŒå…¥LaTex]]></title>
    <url>%2F2017%2F04%2F16%2Flatex%2F</url>
    <content type="text"><![CDATA[MarkDownä¸­ä½¿ç”¨æ ‡è¯†ç¬¦$$å’Œ$$$$å³å¯å¼•å…¥LaTeXè¯­æ³•,å‰è€…ä½¿ç”¨æ—¶ä¸æ¢è¡Œ,å³åœ¨æ‰€ä½¿ç”¨ä½ç½®ä½¿ç”¨LaTeXçš„æ ¼å¼,åŽè€…ä¼šæ¢è¡ŒåŽå±…ä¸­ éƒ¨åˆ†å¸Œè…Šå­—æ¯ å‘½ä»¤ æ˜¾ç¤º å‘½ä»¤ æ˜¾ç¤º \alpha Î± A A \beta Î² B B \gamma Î³ \Gamma \varGamma Î“ Î“ delta Î´ \Delta \varDelta Î” Î” \epsilon Ïµ E E \eta Î· H H \theta Î¸ \Theta \varTheta Î˜ Î˜ \kappa Îº K K \lambda Î» \Lambda \varLambda Î› Î› \mu Î¼ M M \nu Î½ N N \pi Ï€ \Pi \varPi Î  Î  \rho Ï P P \sigma Ïƒ \Sigma \varSigma Î£ Î£ \tau Ï„ T T \phi \varphi Ï• Ï† \Phi \varPhi Î¦ Î¦ \omega Ï‰ \Omega \varOmega Î© Î© å…¨éƒ¨24ä¸ªå­—æ¯: åç§° å¤§å†™ Tex å°å†™ Tex alpha A A Î± \alpha beta B B Î²\ beta gamma Î“ \Gamma Î³ \gamma delta Î” \Delta Î´ \delta epsilon E E Ïµ \epsilon zeta Z Z Î¶ \zeta eta H H Î· \eta theta Î˜ \Theta Î¸ \theta iota I I Î¹ \iota kappa K K Îº \kappa lambda Î› \Lambda Î» \lambda mu M M Î¼ \mu nu N N Î½ \nu xi Îž \Xi Î¾ \xi omicron O O Î¿ \omicron pi Î  \Pi Ï€ \pi rho P P Ï \rho sigma Î£ \Sigma Ïƒ \sigma tau T T Ï„ \tau upsilon Î¥ \Upsilon Ï… \upsilon phi Î¦ \Phi Ï• \phi chi X X Ï‡ \chi psi Î¨ \Psi Ïˆ \psi omega Î© \Omega Ï‰ \omega éƒ¨åˆ†è¿ç®—ç¬¦ å‘½ä»¤ æ˜¾ç¤º å‘½ä»¤ æ˜¾ç¤º \pm Â± \mp âˆ“ \times Ã— \div Ã· \circ âˆ˜ \bullet âˆ™ \cdot â‹… \cup âˆª \cap âˆ© \subset âŠ‚ \supset âŠƒ \subseteq âŠ† \supseteq âŠ‡ \leq â‰¤ \geq â‰¥ \propto âˆ å…¶ä»–ç¬¦å· å‘½ä»¤ æ˜¾ç¤º å‘½ä»¤ æ˜¾ç¤º \cdotp â‹… \cdots â‹¯ \ddots â‹± \infty âˆž \partial âˆ‚ \bot âŠ¥ \hat{a} aÌ‚ \tilde{a} aÌƒ \bar{a} aÂ¯ \vec{a} aâƒ— \dot{a} aË™ \sqrt{a} aâ€¾â€¾âˆš \sqrt[3]{2} aâ€¾â€¾âˆš3 a^{3} a3 \frac{1}{a} 1a \lim_{x \to 0} limaâ†’0 é›†åˆå…³ç³»ç¬¦å· è¯´æ˜Ž å‘½ä»¤ é›†åˆçš„å¤§æ‹¬å· { â€¦ }\ é›†åˆä¸­çš„ç«–çº¿$\mid$ \mid å±žäºŽ \in ä¸å±žäºŽ \not\in AåŒ…å«äºŽB A\subset B AçœŸåŒ…å«äºŽB A\subsetneqq B AåŒ…å«B A\supset B AçœŸåŒ…å«B A\supsetneqq B Aä¸åŒ…å«äºŽB A\not\subset B Aäº¤B A\cap B Aå¹¶B A\cup B Açš„é—­åŒ… \overline{A} Aå‡åŽ»B A\setminus B å®žæ•°é›†åˆ \mathbb{R} ç©ºé›† \emptyset è¡¨æ ¼ä¸­ç«–çº¿ç”¨&amp;#124; æ‹¬å·æ€»ç»“ åŠŸèƒ½ è¯­æ³• æ˜¾ç¤º ä¸å¥½çœ‹ ( \frac{1}{2} ) $(\frac{1}{2})$ å¥½ä¸€ç‚¹ \left( \frac{1}{2} \right) $\left ( \frac{1}{2} \right )$ å¯ä»¥ä½¿ç”¨\leftå’Œ\rightæ¥æ˜¾ç¤ºä¸åŒçš„æ‹¬å·ï¼š åŠŸèƒ½ è¯­æ³• æ˜¾ç¤º åœ†æ‹¬å·ï¼Œå°æ‹¬å· \left( \frac{a}{b} \right) $\left( \frac{a}{b} \right)$ æ–¹æ‹¬å·ï¼Œä¸­æ‹¬å· \left[ \frac{a}{b} \right] $\left[ \frac{a}{b} \right]$ èŠ±æ‹¬å·ï¼Œå¤§æ‹¬å· \left\{ \frac{a}{b} \right\} $ \left{ \frac{a}{b} \right}$ è§’æ‹¬å· \left \langle \frac{a}{b} \right \rangle $\left\langle \frac{a}{b} \right \rangle$ å•ç«–çº¿ï¼Œç»å¯¹å€¼ \left ç«–çº¿ \frac{a}{b} \right ç«–çº¿ åŒç«–çº¿ï¼ŒèŒƒ \left \ ç«–çº¿ \frac{a}{b} \right \ ç«–çº¿ å–æ•´å‡½æ•° ï¼ˆFloor functionï¼‰ \left \lfloor \frac{a}{b} \right \rfloor $ \left \lfloor \frac{a}{b} \right \rfloor$ å–é¡¶å‡½æ•° ï¼ˆCeiling function) \left \lceil \frac{c}{d} \right \rceil $ \left \lceil \frac{c}{d} \right \rceil$ æ–œçº¿ä¸Žåæ–œçº¿ \left / \frac{a}{b} \right \backslash $ \left / \frac{a}{b} \right \backslash$ ä¸Šä¸‹ç®­å¤´ \left \uparrow \frac{a}{b} \right \downarrow \left \Uparrow \frac{a}{b} \right \Downarrow \left \updownarrow \frac{a}{b} \right \Updownarrow $\left \uparrow \frac{a}{b} \right \downarrow$ $\left \Uparrow \frac{a}{b} \right \Downarrow$ $\left \updownarrow \frac{a}{b} \right \Updownarrow$ æ··åˆæ‹¬å· \left [ 0,1 \right ) \left \langle \psi ) $\left [ 0,1 \right )$ $ \left \langle \psi \right)$ å•å·¦æ‹¬å· \left \{ \frac{a}{b} \right . $\left { \frac{a}{b} \right .$ å•å³æ‹¬å· \left . \frac{a}{b} \right \} $\left . \frac{a}{b} \right }$ å¤‡æ³¨ï¼š å¯ä»¥ä½¿ç”¨\big, \Big, \bigg, \BiggæŽ§åˆ¶æ‹¬å·çš„å¤§å°ï¼Œæ¯”å¦‚ä»£ç \Bigg ( \bigg [ \Big \{ \big \langle \left | \| \frac{a}{b} \| \right | \big \rangle \Big \} \bigg ] \Bigg )æ˜¾ç¤º $$\Bigg ( \bigg [ \Big { \big \langle \left | | x | \right | \big \rangle \Big } \bigg ] \Bigg )$$ çŸ©é˜µåŸºæœ¬ç”¨æ³•ä½¿ç”¨$$\begin{matrix}â€¦\end{matrix}$$è¿™æ ·çš„å½¢å¼æ¥è¡¨ç¤ºçŸ©é˜µï¼Œåœ¨\beginä¸Ž\endä¹‹é—´åŠ å…¥çŸ©é˜µä¸­çš„å…ƒç´ å³å¯ã€‚çŸ©é˜µçš„è¡Œä¹‹é—´ä½¿ç”¨\\åˆ†éš”ï¼Œåˆ—ä¹‹é—´ä½¿ç”¨&amp;åˆ†éš”ã€‚ 1234567$$ \begin&#123;matrix&#125; 1 &amp; x &amp; x^2 \\ 1 &amp; y &amp; y^2 \\ 1 &amp; z &amp; z^2 \\ \end&#123;matrix&#125;$$ $$ \begin{matrix} 1 &amp; x &amp; x^2 \ 1 &amp; y &amp; y^2 \ 1 &amp; z &amp; z^2 \ \end{matrix} $$ åŠ æ‹¬å·å¦‚æžœè¦å¯¹çŸ©é˜µåŠ æ‹¬å·ï¼Œå¯ä»¥åƒä¸Šæ–‡ä¸­æåˆ°çš„ä¸€æ ·ï¼Œä½¿ç”¨\leftä¸Ž\righté…åˆè¡¨ç¤ºæ‹¬å·ç¬¦å·ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„matrixã€‚å³æ›¿æ¢\begin{matrix}â€¦\end{matrix}ä¸­çš„matrixä¸ºpmatrixï¼Œbmatrixï¼ŒBmatrixï¼Œvmatrix,Vmatrix. çœç•¥å…ƒç´ å¯ä»¥ä½¿ç”¨\cdots â‹¯ \ddots â‹± \vdots â‹® æ¥çœç•¥çŸ©é˜µä¸­çš„å…ƒç´  å¢žå¹¿çŸ©é˜µå¢žå¹¿çŸ©é˜µéœ€è¦ä½¿ç”¨å‰é¢çš„arrayæ¥å®žçŽ° 1234567$$ \left[ \begin&#123;array&#125;&#123;cc|c&#125; 1&amp;2&amp;3\\ 4&amp;5&amp;6 \end&#123;array&#125; \right]$$ $$ \left[ \begin{array}{cc|c} 1&amp;2&amp;3\ 4&amp;5&amp;6 \end{array} \right] $$ è¡¨æ ¼ä½¿ç”¨$$\begin{array}{åˆ—æ ·å¼}â€¦\end{array}$$è¿™æ ·çš„å½¢å¼æ¥åˆ›å»ºè¡¨æ ¼ï¼Œåˆ—æ ·å¼å¯ä»¥æ˜¯clrè¡¨ç¤ºå±…ä¸­ï¼Œå·¦ï¼Œå³å¯¹é½ï¼Œè¿˜å¯ä»¥ä½¿ç”¨|è¡¨ç¤ºä¸€æ¡ç«–çº¿ã€‚è¡¨æ ¼ä¸­ å„è¡Œä½¿ç”¨\\åˆ†éš”ï¼Œå„åˆ—ä½¿ç”¨&amp;åˆ†éš”ã€‚ä½¿ç”¨\hlineåœ¨æœ¬è¡Œå‰åŠ å…¥ä¸€æ¡ç›´çº¿ã€‚ ä¾‹å¦‚ï¼Œ 123456789$$\begin&#123;array&#125;&#123;c|lcr&#125;n &amp; \text&#123;Left&#125; &amp; \text&#123;Center&#125; &amp; \text&#123;Right&#125; \\\hline1 &amp; 0.24 &amp; 1 &amp; 125 \\2 &amp; -1 &amp; 189 &amp; -8 \\3 &amp; -20 &amp; 2000 &amp; 1+10i \\\end&#123;array&#125;$$ ä¸Šæ ‡ä¸Žä¸‹æ ‡ä¸Šæ ‡å’Œä¸‹æ ‡åˆ†åˆ«ä½¿ç”¨^ä¸Ž_ï¼Œä¾‹å¦‚x_i^2ï¼š$x_i^2$ ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸Šä¸‹æ ‡ç¬¦å·ä»…ä»…å¯¹ä¸‹ä¸€ä¸ªç»„èµ·ä½œç”¨ã€‚ä¸€ä¸ªç»„å³å•ä¸ªå­—ç¬¦æˆ–è€…ä½¿ç”¨{..}åŒ…è£¹èµ·æ¥çš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœä½¿ç”¨10^10ï¼Œä¼šå¾—åˆ°$10^10$ ï¼Œè€Œ10^{10}æ‰æ˜¯$10^{10}$ ã€‚åŒæ—¶ï¼Œå¤§æ‹¬å·è¿˜èƒ½æ¶ˆé™¤äºŒä¹‰æ€§ï¼Œå¦‚x^5^6å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå¿…é¡»ä½¿ç”¨å¤§æ‹¬å·æ¥ç•Œå®š^çš„ç»“åˆæ€§ï¼Œå¦‚{x^5}^6ï¼š${x^5}^6$ æˆ–è€… x^{5^6}ï¼š$x^{5^6}$ ã€‚ å¯¹é½çš„å…¬å¼åˆ†ç±»è¡¨è¾¾å¼å®šä¹‰å‡½æ•°çš„æ—¶å€™ç»å¸¸éœ€è¦åˆ†æƒ…å†µç»™å‡ºè¡¨è¾¾å¼ï¼Œå¯ä½¿ç”¨\begin{cases}â€¦\end{cases}ã€‚å…¶ä¸­ï¼Œä½¿ç”¨\æ¥åˆ†ç±»ï¼Œä½¿ç”¨&amp;æŒ‡ç¤ºéœ€è¦å¯¹é½çš„ä½ç½®ã€‚å¦‚ï¼š å¤šé‡ç§¯åˆ†è¿žåˆ†æ•°æ–¹ç¨‹ç»„é¢œè‰²å…¬å¼æ ‡è®°ä¸Žå¼•ç”¨æ±‚å’Œä¸Žç§¯åˆ†åˆ†å¼ä¸Žæ ¹å¼ç‰¹æ®Šå‡½æ•°ä¸Žç¬¦å·ç©ºé—´é¡¶éƒ¨ç¬¦å· å‚è€ƒ http://mlworks.cn/posts/introduction-to-mathjax-and-latex-expression/]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>å·¥å…·</tag>
        <tag>MarkDown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é«˜æ•°1.å‡½æ•°ä¸Žæžé™]]></title>
    <url>%2F2017%2F04%2F13%2Fam-function-and-limitaion%2F</url>
    <content type="text"><![CDATA[1.æ˜ å°„ä¸Žå‡½æ•°1.1 é›†åˆ1.1.1 é›†åˆçš„æ¦‚å¿µé›†åˆ(é›†)æ˜¯æŒ‡å…·æœ‰æŸç§ç‰¹å®šæ€§è´¨çš„äº‹ç‰©çš„æ€»ä½“,ç»„æˆè¿™ä¸ªé›†åˆçš„äº‹ç‰©æˆä¸ºè¯¥é›†åˆçš„å…ƒç´ (ç®€ç§°å…ƒ) è¡¨ç¤º:ç”¨å¤§å†™æ‹‰ä¸å­—æ¯A,B,Câ€¦è¡¨ç¤ºé›†åˆ,å°å†™æ‹‰ä¸å­—æ¯è¡¨ç¤ºé›†åˆçš„å…ƒç´  åˆ†ç±»: æœ‰é™é›† æ— é™é›† è¡¨ç¤ºæ•°é›†çš„å­—æ¯çš„å³ä¸Šè§’æ ‡*è¡¨ç¤ºè¯¥æ•°é›†å†…æŽ’é™¤0çš„é›†,æ ‡ä¸Š+æ¥è¡¨ç¤ºæ•°é›†å†…æŽ’é™¤0å’Œè´Ÿæ•°çš„é›† å¸¸ç”¨è¡¨ç¤º N={0, 1, 2, 3â€¦};å…¨ä½“éžè´Ÿæ•´æ•°å³è‡ªç„¶æ•°çš„é›†åˆ N+={1,2,3,â€¦n,â€¦.};å…¨ä½“æ­£æ•´æ•°çš„é›†åˆ Z={â€¦,-n,â€¦-3, -2,-1, 0, 1, 2, 3,â€¦,nâ€¦};å…¨ä½“æ•´æ•°çš„é›†åˆ $Q=\lbrace \frac{p}{q}|p \in Z,q \in N^{+} \rbrace$;å…¨ä½“æœ‰ç†æ•°é›† å…¨ä½“å®žæ•°è®°åšR,R*ä¸ºæŽ’é™¤0çš„å®žæ•°é›†,R+ä¸ºå…¨ä½“æ­£å®žæ•°é›†. å­é›†æ¦‚å¿µ: å­é›† çœŸå­é›† é›†åˆç›¸ç­‰:äº’ä¸ºå­é›† ç©ºé›† $\emptyset$1.1.2 é›†åˆçš„è¿ç®— 1.1.3 åŒºé—´å’Œé¢†åŸŸ]]></content>
      <categories>
        <category>é«˜æ•°</category>
      </categories>
      <tags>
        <tag>math</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Androidçº¿ç¨‹ä½¿ç”¨æ€»ç»“]]></title>
    <url>%2F2017%2F04%2F10%2Ftips-android-thread%2F</url>
    <content type="text"><![CDATA[1. Threading Performanceåœ¨ç¨‹åºå¼€å‘çš„å®žè·µå½“ä¸­ï¼Œä¸ºäº†è®©ç¨‹åºè¡¨çŽ°å¾—æ›´åŠ æµç•…ï¼Œæˆ‘ä»¬è‚¯å®šä¼šéœ€è¦ä½¿ç”¨åˆ°å¤šçº¿ç¨‹æ¥æå‡ç¨‹åºçš„å¹¶å‘æ‰§è¡Œæ€§èƒ½ã€‚ä½†æ˜¯ç¼–å†™å¤šçº¿ç¨‹å¹¶å‘çš„ä»£ç ä¸€ç›´ä»¥æ¥éƒ½æ˜¯ä¸€ä¸ªç›¸å¯¹æ£˜æ‰‹çš„é—®é¢˜ï¼Œæ‰€ä»¥æƒ³è¦èŽ·å¾—æ›´ä½³çš„ç¨‹åºæ€§èƒ½ï¼Œæˆ‘ä»¬éžå¸¸æœ‰å¿…è¦æŽŒæ¡å¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€æŠ€èƒ½ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼ŒAndroid ç¨‹åºçš„å¤§å¤šæ•°ä»£ç æ“ä½œéƒ½å¿…é¡»æ‰§è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œä¾‹å¦‚ç³»ç»Ÿäº‹ä»¶(ä¾‹å¦‚è®¾å¤‡å±å¹•å‘ç”Ÿæ—‹è½¬)ï¼Œè¾“å…¥äº‹ä»¶(ä¾‹å¦‚ç”¨æˆ·ç‚¹å‡»æ»‘åŠ¨ç­‰)ï¼Œç¨‹åºå›žè°ƒæœåŠ¡ï¼ŒUI ç»˜åˆ¶ä»¥åŠé—¹é’Ÿäº‹ä»¶ç­‰ç­‰ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨ä¸Šè¿°äº‹ä»¶æˆ–è€…æ–¹æ³•ä¸­æ’å…¥çš„ä»£ç ä¹Ÿå°†æ‰§è¡Œåœ¨ä¸»çº¿ç¨‹ã€‚ ä¸€æ—¦æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹é‡Œé¢æ·»åŠ äº†æ“ä½œå¤æ‚çš„ä»£ç ï¼Œè¿™äº›ä»£ç å°±å¾ˆå¯èƒ½é˜»ç¢ä¸»çº¿ç¨‹åŽ»å“åº”ç‚¹å‡»/æ»‘åŠ¨äº‹ä»¶ï¼Œé˜»ç¢ä¸»çº¿ç¨‹çš„ UI ç»˜åˆ¶ç­‰ç­‰ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸ºäº†è®©å±å¹•çš„åˆ·æ–°å¸§çŽ‡è¾¾åˆ° 60fpsï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ 16ms å†…å®Œæˆå•æ¬¡åˆ·æ–°çš„æ“ä½œã€‚ä¸€æ—¦æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹é‡Œé¢æ‰§è¡Œçš„ä»»åŠ¡è¿‡äºŽç¹é‡å°±å¯èƒ½å¯¼è‡´æŽ¥æ”¶åˆ°åˆ·æ–°ä¿¡å·çš„æ—¶å€™å› ä¸ºèµ„æºè¢«å ç”¨è€Œæ— æ³•å®Œæˆè¿™æ¬¡åˆ·æ–°æ“ä½œï¼Œè¿™æ ·å°±ä¼šäº§ç”ŸæŽ‰å¸§çš„çŽ°è±¡ï¼Œåˆ·æ–°å¸§çŽ‡è‡ªç„¶ä¹Ÿå°±è·Ÿç€ä¸‹é™äº†(ä¸€æ—¦åˆ·æ–°å¸§çŽ‡é™åˆ° 20fps å·¦å³ï¼Œç”¨æˆ·å°±å¯ä»¥æ˜Žæ˜¾æ„ŸçŸ¥åˆ°å¡é¡¿ä¸æµç•…äº†)ã€‚ ä¸ºäº†é¿å…ä¸Šé¢æåˆ°çš„æŽ‰å¸§é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒæŠŠé‚£äº›æ“ä½œå¤æ‚çš„ä»»åŠ¡ç§»åŠ¨åˆ°å…¶ä»–çº¿ç¨‹å½“ä¸­æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸å®¹æ˜“é˜»å¡žä¸»çº¿ç¨‹çš„æ“ä½œï¼Œä¹Ÿå°±å‡å°äº†å‡ºçŽ°æŽ‰å¸§çš„å¯èƒ½æ€§ã€‚ ä¸ºä¸»çº¿ç¨‹å‡è½»è´Ÿçš„å¤šçº¿ç¨‹æ–¹æ¡ˆæœ‰å“ªäº›å‘¢ï¼Ÿè¿™äº›æ–¹æ¡ˆåˆ†åˆ«é€‚åˆåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼ŸAndroid ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº†è‹¥å¹²ç»„å·¥å…·ç±»æ¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ AsyncTask: ä¸º UI çº¿ç¨‹ä¸Žå·¥ä½œçº¿ç¨‹ä¹‹é—´è¿›è¡Œå¿«é€Ÿçš„åˆ‡æ¢æä¾›ä¸€ç§ç®€å•ä¾¿æ·çš„æœºåˆ¶ã€‚é€‚ç”¨äºŽå½“ä¸‹ç«‹å³éœ€è¦å¯åŠ¨ï¼Œä½†æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸçŸ­æš‚çš„ä½¿ç”¨åœºæ™¯ã€‚ HandlerThread: ä¸ºæŸäº›å›žè°ƒæ–¹æ³•æˆ–è€…ç­‰å¾…æŸäº›ä»»åŠ¡çš„æ‰§è¡Œè®¾ç½®ä¸€ä¸ªä¸“å±žçš„çº¿ç¨‹ï¼Œå¹¶æä¾›çº¿ç¨‹ä»»åŠ¡çš„è°ƒåº¦æœºåˆ¶ã€‚ ThreadPool: æŠŠä»»åŠ¡åˆ†è§£æˆä¸åŒçš„å•å…ƒï¼Œåˆ†å‘åˆ°å„ä¸ªä¸åŒçš„çº¿ç¨‹ä¸Šï¼Œè¿›è¡ŒåŒæ—¶å¹¶å‘å¤„ç†ã€‚ IntentService: é€‚åˆäºŽæ‰§è¡Œç”± UI è§¦å‘çš„åŽå° Service ä»»åŠ¡ï¼Œå¹¶å¯ä»¥æŠŠåŽå°ä»»åŠ¡æ‰§è¡Œçš„æƒ…å†µé€šè¿‡ä¸€å®šçš„æœºåˆ¶åé¦ˆç»™ UIã€‚ äº†è§£è¿™äº›ç³»ç»Ÿæä¾›çš„å¤šçº¿ç¨‹å·¥å…·ç±»åˆ†åˆ«é€‚åˆåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€‰æ‹©åˆé€‚çš„è§£å†³æ–¹æ¡ˆï¼Œé¿å…å‡ºçŽ°ä¸å¯é¢„æœŸçš„éº»çƒ¦ã€‚è™½ç„¶ä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥æé«˜ç¨‹åºçš„å¹¶å‘é‡ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„å› ä¸ºå¼•å…¥å¤šçº¿ç¨‹è€Œå¯èƒ½ä¼´éšè€Œæ¥çš„å†…å­˜é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ Activity å†…éƒ¨å®šä¹‰çš„ä¸€ä¸ª AsyncTaskï¼Œå®ƒå±žäºŽä¸€ä¸ªå†…éƒ¨ç±»ï¼Œè¯¥ç±»æœ¬èº«å’Œå¤–é¢çš„ Activity æ˜¯æœ‰å¼•ç”¨å…³ç³»çš„ï¼Œå¦‚æžœ Activity è¦é”€æ¯çš„æ—¶å€™ï¼ŒAsyncTask è¿˜ä»ç„¶åœ¨è¿è¡Œï¼Œè¿™ä¼šå¯¼è‡´ Activity æ²¡æœ‰åŠžæ³•å®Œå…¨é‡Šæ”¾ï¼Œä»Žè€Œå¼•å‘å†…å­˜æ³„æ¼ã€‚æ‰€ä»¥è¯´ï¼Œå¤šçº¿ç¨‹æ˜¯æå‡ç¨‹åºæ€§èƒ½çš„æœ‰æ•ˆæ‰‹æ®µä¹‹ä¸€ï¼Œä½†æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹å´éœ€è¦ååˆ†è°¨æ…Žå°å¿ƒï¼Œå¦‚æžœä¸äº†è§£èƒŒåŽçš„æ‰§è¡Œæœºåˆ¶ä»¥åŠä½¿ç”¨çš„æ³¨æ„äº‹é¡¹ï¼Œå¾ˆå¯èƒ½å¼•èµ·ä¸¥é‡çš„é—®é¢˜ã€‚ 2. Understanding Android Threadingé€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹éœ€è¦ç»åŽ†ä¸‰ä¸ªç”Ÿå‘½é˜¶æ®µï¼šå¼€å§‹ï¼Œæ‰§è¡Œï¼Œç»“æŸã€‚çº¿ç¨‹ä¼šåœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åŽç»“æŸï¼Œé‚£ä¹ˆä¸ºäº†ç¡®ä¿çº¿ç¨‹çš„å­˜æ´»ï¼Œæˆ‘ä»¬ä¼šåœ¨æ‰§è¡Œé˜¶æ®µç»™çº¿ç¨‹èµ‹äºˆä¸åŒçš„ä»»åŠ¡ï¼Œç„¶åŽåœ¨é‡Œé¢æ·»åŠ é€€å‡ºçš„æ¡ä»¶ä»Žè€Œç¡®ä¿ä»»åŠ¡èƒ½å¤Ÿæ‰§è¡Œå®Œæ¯•åŽé€€å‡ºã€‚ åœ¨å¾ˆå¤šæ—¶å€™ï¼Œçº¿ç¨‹ä¸ä»…ä»…æ˜¯çº¿æ€§æ‰§è¡Œä¸€ç³»åˆ—çš„ä»»åŠ¡å°±ç»“æŸé‚£ä¹ˆç®€å•çš„ï¼Œæˆ‘ä»¬ä¼šéœ€è¦å¢žåŠ ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œè®©çº¿ç¨‹ä¸æ–­çš„ä»Žä»»åŠ¡é˜Ÿåˆ—ä¸­èŽ·å–ä»»åŠ¡åŽ»è¿›è¡Œæ‰§è¡Œï¼Œå¦å¤–æˆ‘ä»¬è¿˜å¯èƒ½åœ¨çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡è¿‡ç¨‹ä¸­ä¸Žå…¶ä»–çš„çº¿ç¨‹è¿›è¡Œåä½œã€‚å¦‚æžœè¿™äº›ç»†èŠ‚éƒ½äº¤ç»™æˆ‘ä»¬è‡ªå·±æ¥å¤„ç†ï¼Œè¿™å°†ä¼šæ˜¯ä»¶æžå…¶ç¹çåˆå®¹æ˜“å‡ºé”™çš„äº‹æƒ…ã€‚ æ‰€å¹¸çš„æ˜¯ï¼ŒAndroid ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº† Looperï¼ŒHandlerï¼ŒMessageQueue æ¥å¸®åŠ©å®žçŽ°ä¸Šé¢çš„çº¿ç¨‹ä»»åŠ¡æ¨¡åž‹ï¼š Looper: èƒ½å¤Ÿç¡®ä¿çº¿ç¨‹æŒç»­å­˜æ´»å¹¶ä¸”å¯ä»¥ä¸æ–­çš„ä»Žä»»åŠ¡é˜Ÿåˆ—ä¸­èŽ·å–ä»»åŠ¡å¹¶è¿›è¡Œæ‰§è¡Œã€‚ Handler: èƒ½å¤Ÿå¸®åŠ©å®žçŽ°é˜Ÿåˆ—ä»»åŠ¡çš„ç®¡ç†ï¼Œä¸ä»…ä»…èƒ½å¤ŸæŠŠä»»åŠ¡æ’å…¥åˆ°é˜Ÿåˆ—çš„å¤´éƒ¨ï¼Œå°¾éƒ¨ï¼Œè¿˜å¯ä»¥æŒ‰ç…§ä¸€å®šçš„æ—¶é—´å»¶è¿Ÿæ¥ç¡®ä¿ä»»åŠ¡ä»Žé˜Ÿåˆ—ä¸­èƒ½å¤Ÿæ¥å¾—åŠè¢«å–æ¶ˆæŽ‰ã€‚ MessageQueue: ä½¿ç”¨ Intentï¼ŒMessageï¼ŒRunnable ä½œä¸ºä»»åŠ¡çš„è½½ä½“åœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹é—´è¿›è¡Œä¼ é€’ã€‚ æŠŠä¸Šé¢ä¸‰ä¸ªç»„ä»¶æ‰“åŒ…åˆ°ä¸€èµ·è¿›è¡Œåä½œï¼Œè¿™å°±æ˜¯ HandlerThread æˆ‘ä»¬çŸ¥é“ï¼Œå½“ç¨‹åºè¢«å¯åŠ¨ï¼Œç³»ç»Ÿä¼šå¸®å¿™åˆ›å»ºè¿›ç¨‹ä»¥åŠç›¸åº”çš„ä¸»çº¿ç¨‹ï¼Œè€Œè¿™ä¸ªä¸»çº¿ç¨‹å…¶å®žå°±æ˜¯ä¸€ä¸ª HandlerThreadã€‚è¿™ä¸ªä¸»çº¿ç¨‹ä¼šéœ€è¦å¤„ç†ç³»ç»Ÿäº‹ä»¶ï¼Œè¾“å…¥äº‹ä»¶ï¼Œç³»ç»Ÿå›žè°ƒçš„ä»»åŠ¡ï¼ŒUIç»˜åˆ¶ç­‰ç­‰ä»»åŠ¡ï¼Œä¸ºäº†é¿å…ä¸»çº¿ç¨‹ä»»åŠ¡è¿‡é‡ï¼Œæˆ‘ä»¬å°±ä¼šéœ€è¦ä¸æ–­çš„å¼€å¯æ–°çš„å·¥ä½œçº¿ç¨‹æ¥å¤„ç†é‚£äº›å­ä»»åŠ¡ã€‚ 3. Memory &amp; Threadingå¢žåŠ å¹¶å‘çš„çº¿ç¨‹æ•°ä¼šå¯¼è‡´å†…å­˜æ¶ˆè€—çš„å¢žåŠ ï¼Œå¹³è¡¡å¥½è¿™ä¸¤è€…çš„å…³ç³»æ˜¯éžå¸¸é‡è¦çš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¤šçº¿ç¨‹å¹¶å‘è®¿é—®åŒä¸€å—å†…å­˜åŒºåŸŸæœ‰å¯èƒ½å¸¦æ¥å¾ˆå¤šé—®é¢˜ï¼Œä¾‹å¦‚è¯»å†™çš„æƒé™äº‰å¤ºé—®é¢˜ï¼ŒABA é—®é¢˜ç­‰ç­‰ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šéœ€è¦å¼•å…¥é”çš„æ¦‚å¿µã€‚ åœ¨ Android ç³»ç»Ÿä¸­ä¹Ÿæ— æ³•é¿å…å› ä¸ºå¤šçº¿ç¨‹çš„å¼•å…¥è€Œå¯¼è‡´å‡ºçŽ°è¯¸å¦‚ä¸Šæ–‡æåˆ°çš„ç§ç§é—®é¢˜ã€‚Android UI å¯¹è±¡çš„åˆ›å»ºï¼Œæ›´æ–°ï¼Œé”€æ¯ç­‰ç­‰æ“ä½œéƒ½é»˜è®¤æ˜¯æ‰§è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯å¦‚æžœæˆ‘ä»¬åœ¨éžä¸»çº¿ç¨‹å¯¹UIå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œç¨‹åºå°†å¯èƒ½å‡ºçŽ°å¼‚å¸¸ç”šè‡³æ˜¯å´©æºƒã€‚ å¦å¤–ï¼Œåœ¨éž UI çº¿ç¨‹ä¸­ç›´æŽ¥æŒæœ‰ UI å¯¹è±¡çš„å¼•ç”¨ä¹Ÿå¾ˆå¯èƒ½å‡ºçŽ°é—®é¢˜ã€‚ä¾‹å¦‚Workçº¿ç¨‹ä¸­æŒæœ‰æŸä¸ª UI å¯¹è±¡çš„å¼•ç”¨ï¼Œåœ¨ Work çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹å‰ï¼ŒUI å¯¹è±¡åœ¨ä¸»çº¿ç¨‹ä¸­è¢«ä»Ž ViewHierarchy ä¸­ç§»é™¤äº†ï¼Œè¿™ä¸ªæ—¶å€™ UI å¯¹è±¡çš„ä»»ä½•å±žæ€§éƒ½å·²ç»ä¸å†å¯ç”¨äº†ï¼Œå¦å¤–å¯¹è¿™ä¸ª UI å¯¹è±¡çš„æ›´æ–°æ“ä½œä¹Ÿéƒ½æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå®ƒå·²ç»ä»Ž ViewHierarchy ä¸­è¢«ç§»é™¤ï¼Œä¸å†ç»˜åˆ¶åˆ°ç”»é¢ä¸Šäº†ã€‚ ä¸ä»…å¦‚æ­¤ï¼ŒView å¯¹è±¡æœ¬èº«å¯¹æ‰€å±žçš„ Activity æ˜¯æœ‰å¼•ç”¨å…³ç³»çš„ï¼Œå¦‚æžœå·¥ä½œçº¿ç¨‹æŒç»­ä¿æœ‰ View çš„å¼•ç”¨ï¼Œè¿™å°±å¯èƒ½å¯¼è‡´ Activity æ— æ³•å®Œå…¨é‡Šæ”¾ã€‚é™¤äº†ç›´æŽ¥æ˜¾å¼çš„å¼•ç”¨å…³ç³»å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç‰¹åˆ«ç•™æ„éšå¼çš„å¼•ç”¨å…³ç³»ä¹Ÿå¯èƒ½å¯¼è‡´æ³„éœ²ã€‚ä¾‹å¦‚é€šå¸¸æˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨ Activity é‡Œé¢å®šä¹‰çš„ä¸€ä¸ª AsyncTaskï¼Œè¿™ç§ç±»åž‹çš„ AsyncTask ä¸Žå¤–éƒ¨çš„ Activity æ˜¯å­˜åœ¨éšå¼å¼•ç”¨å…³ç³»çš„ï¼Œåªè¦ Task æ²¡æœ‰ç»“æŸï¼Œå¼•ç”¨å…³ç³»å°±ä¼šä¸€ç›´å­˜åœ¨ï¼Œè¿™å¾ˆå®¹æ˜“å¯¼è‡´ Activity çš„æ³„æ¼ã€‚æ›´ç³Ÿç³•çš„æƒ…å†µæ˜¯ï¼Œå®ƒä¸ä»…ä»…å‘ç”Ÿäº†å†…å­˜æ³„æ¼ï¼Œè¿˜å¯èƒ½å¯¼è‡´ç¨‹åºå¼‚å¸¸æˆ–è€…å´©æºƒã€‚ ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è°¨è®°çš„åŽŸåˆ™å°±æ˜¯ï¼šä¸è¦åœ¨ä»»ä½•éž UI çº¿ç¨‹é‡Œé¢åŽ»æŒæœ‰ UI å¯¹è±¡çš„å¼•ç”¨ã€‚ç³»ç»Ÿä¸ºäº†ç¡®ä¿æ‰€æœ‰çš„ UI å¯¹è±¡éƒ½åªä¼šè¢« UI çº¿ç¨‹æ‰€è¿›è¡Œåˆ›å»ºï¼Œæ›´æ–°ï¼Œé”€æ¯çš„æ“ä½œï¼Œç‰¹åœ°è®¾è®¡äº†å¯¹åº”çš„å·¥ä½œæœºåˆ¶(å½“ Activity è¢«é”€æ¯çš„æ—¶å€™ï¼Œç”±è¯¥ Activity æ‰€è§¦å‘çš„éž UI çº¿ç¨‹éƒ½å°†æ— æ³•å¯¹UIå¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå¦è€…å°±ä¼šæŠ›å‡ºç¨‹åºæ‰§è¡Œå¼‚å¸¸çš„é”™è¯¯)æ¥é˜²æ­¢ UI å¯¹è±¡è¢«é”™è¯¯çš„ä½¿ç”¨ã€‚ 4. Good AsyncTask HuntingAsyncTask æ˜¯ä¸€ä¸ªè®©äººæ—¢çˆ±åˆæ¨çš„ç»„ä»¶ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€ä¾¿çš„å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œä½†æ˜¯å®ƒåˆåŒæ—¶å¼•å…¥äº†ä¸€äº›ä»¤äººåŽŒæ¶çš„éº»çƒ¦ã€‚ä¸€æ—¦å¯¹ AsyncTask ä½¿ç”¨ä¸å½“ï¼Œå¾ˆå¯èƒ½å¯¹ç¨‹åºçš„æ€§èƒ½å¸¦æ¥è´Ÿé¢å½±å“ï¼ŒåŒæ—¶è¿˜å¯èƒ½å¯¼è‡´å†…å­˜æ³„éœ²ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¸¸é‡åˆ°çš„ä¸€ä¸ªå…¸åž‹çš„ä½¿ç”¨åœºæ™¯ï¼šç”¨æˆ·åˆ‡æ¢åˆ°æŸä¸ªç•Œé¢ï¼Œè§¦å‘äº†ç•Œé¢ä¸Šçš„å›¾ç‰‡çš„åŠ è½½æ“ä½œï¼Œå› ä¸ºå›¾ç‰‡çš„åŠ è½½ç›¸å¯¹æ¥è¯´è€—æ—¶æ¯”è¾ƒé•¿ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å­çº¿ç¨‹ä¸­å¤„ç†å›¾ç‰‡çš„åŠ è½½ï¼Œå½“å›¾ç‰‡åœ¨å­çº¿ç¨‹ä¸­å¤„ç†å®Œæˆä¹‹åŽï¼Œå†æŠŠå¤„ç†å¥½çš„å›¾ç‰‡è¿”å›žç»™ä¸»çº¿ç¨‹ï¼Œäº¤ç»™ UI æ›´æ–°åˆ°ç”»é¢ä¸Šã€‚ AsyncTask çš„å‡ºçŽ°å°±æ˜¯ä¸ºäº†å¿«é€Ÿçš„å®žçŽ°ä¸Šé¢çš„ä½¿ç”¨åœºæ™¯ï¼ŒAsyncTask æŠŠåœ¨ä¸»çº¿ç¨‹é‡Œé¢çš„å‡†å¤‡å·¥ä½œæ”¾åˆ° onPreExecute()æ–¹æ³•é‡Œé¢è¿›è¡Œæ‰§è¡Œï¼ŒdoInBackground()æ–¹æ³•æ‰§è¡Œåœ¨å·¥ä½œçº¿ç¨‹ä¸­ï¼Œç”¨æ¥å¤„ç†é‚£äº›ç¹é‡çš„ä»»åŠ¡ï¼Œä¸€æ—¦ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šè°ƒç”¨ onPostExecute()æ–¹æ³•è¿”å›žåˆ°ä¸»çº¿ç¨‹ã€‚ ä½¿ç”¨ AsyncTask éœ€è¦æ³¨æ„çš„é—®é¢˜æœ‰å“ªäº›å‘¢ï¼Ÿè¯·å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š é¦–å…ˆï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ AsyncTask ä»»åŠ¡éƒ½æ˜¯è¢«çº¿æ€§è°ƒåº¦æ‰§è¡Œçš„ï¼Œä»–ä»¬å¤„åœ¨åŒä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—å½“ä¸­ï¼ŒæŒ‰é¡ºåºé€ä¸ªæ‰§è¡Œã€‚å‡è®¾ä½ æŒ‰ç…§é¡ºåºå¯åŠ¨20ä¸ª AsyncTaskï¼Œä¸€æ—¦å…¶ä¸­çš„æŸä¸ª AsyncTask æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œé˜Ÿåˆ—ä¸­çš„å…¶ä»–å‰©ä½™ AsyncTask éƒ½å¤„äºŽé˜»å¡žçŠ¶æ€ï¼Œå¿…é¡»ç­‰åˆ°è¯¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åŽæ‰èƒ½å¤Ÿæœ‰æœºä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ ä¸ºäº†è§£å†³ä¸Šé¢æåˆ°çš„çº¿æ€§é˜Ÿåˆ—ç­‰å¾…çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AsyncTask.executeOnExecutor()å¼ºåˆ¶æŒ‡å®š AsyncTask ä½¿ç”¨çº¿ç¨‹æ± å¹¶å‘è°ƒåº¦ä»»åŠ¡ã€‚ å…¶æ¬¡ï¼Œå¦‚ä½•æ‰èƒ½å¤ŸçœŸæ­£çš„å–æ¶ˆä¸€ä¸ª AsyncTask çš„æ‰§è¡Œå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ AsyncTaks æœ‰æä¾› cancel()çš„æ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•å®žé™…ä¸Šåšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿçº¿ç¨‹æœ¬èº«å¹¶ä¸å…·å¤‡ä¸­æ­¢æ­£åœ¨æ‰§è¡Œçš„ä»£ç çš„èƒ½åŠ›ï¼Œä¸ºäº†èƒ½å¤Ÿè®©ä¸€ä¸ªçº¿ç¨‹æ›´æ—©çš„è¢«é”€æ¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ doInBackground()çš„ä»£ç ä¸­ä¸æ–­çš„æ·»åŠ ç¨‹åºæ˜¯å¦è¢«ä¸­æ­¢çš„åˆ¤æ–­é€»è¾‘. ä¸€æ—¦ä»»åŠ¡è¢«æˆåŠŸä¸­æ­¢ï¼ŒAsyncTask å°±ä¸ä¼šç»§ç»­è°ƒç”¨ onPostExecute()ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨ onCancelled()çš„å›žè°ƒæ–¹æ³•åé¦ˆä»»åŠ¡æ‰§è¡Œå–æ¶ˆçš„ç»“æžœã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®ä»»åŠ¡å›žè°ƒåˆ°å“ªä¸ªæ–¹æ³•ï¼ˆæ˜¯ onPostExecute è¿˜æ˜¯ onCancelledï¼‰æ¥å†³å®šæ˜¯å¯¹ UI è¿›è¡Œæ­£å¸¸çš„æ›´æ–°è¿˜æ˜¯æŠŠå¯¹åº”çš„ä»»åŠ¡æ‰€å ç”¨çš„å†…å­˜è¿›è¡Œé”€æ¯ç­‰ã€‚ æœ€åŽï¼Œä½¿ç”¨ AsyncTask å¾ˆå®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œä¸€æ—¦æŠŠ AsyncTask å†™æˆ Activity çš„å†…éƒ¨ç±»çš„å½¢å¼å°±å¾ˆå®¹æ˜“å› ä¸º AsyncTask ç”Ÿå‘½å‘¨æœŸçš„ä¸ç¡®å®šè€Œå¯¼è‡´ Activity å‘ç”Ÿæ³„æ¼ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼ŒAsyncTask è™½ç„¶æä¾›äº†ä¸€ç§ç®€å•ä¾¿æ·çš„å¼‚æ­¥æœºåˆ¶ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¾ˆæœ‰å¿…è¦ç‰¹åˆ«å…³æ³¨åˆ°ä»–çš„ç¼ºç‚¹ï¼Œé¿å…å‡ºçŽ°å› ä¸ºä½¿ç”¨é”™è¯¯è€Œå¯¼è‡´çš„ä¸¥é‡ç³»ç»Ÿæ€§èƒ½é—®é¢˜ã€‚ 5. Getting a HandlerThreadå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒAsyncTask éƒ½èƒ½å¤Ÿæ»¡è¶³å¤šçº¿ç¨‹å¹¶å‘çš„åœºæ™¯éœ€è¦ï¼ˆåœ¨å·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡å¹¶è¿”å›žç»“æžœåˆ°ä¸»çº¿ç¨‹ï¼‰ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯ä¸‡èƒ½çš„ã€‚ä¾‹å¦‚æ‰“å¼€ç›¸æœºä¹‹åŽçš„é¢„è§ˆå¸§æ•°æ®æ˜¯é€šè¿‡ onPreviewFrame()çš„æ–¹æ³•è¿›è¡Œå›žè°ƒçš„ï¼ŒonPreviewFrame()å’Œ open()ç›¸æœºçš„æ–¹æ³•æ˜¯æ‰§è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹çš„ã€‚ å¦‚æžœè¿™ä¸ªå›žè°ƒæ–¹æ³•æ‰§è¡Œåœ¨ UI çº¿ç¨‹ï¼Œé‚£ä¹ˆåœ¨ onPreviewFrame()é‡Œé¢å°†è¦æ‰§è¡Œçš„æ•°æ®è½¬æ¢æ“ä½œå°†å’Œä¸»çº¿ç¨‹çš„ç•Œé¢ç»˜åˆ¶ï¼Œäº‹ä»¶ä¼ é€’ç­‰æ“ä½œäº‰æŠ¢ç³»ç»Ÿèµ„æºï¼Œè¿™å°±æœ‰å¯èƒ½å½±å“åˆ°ä¸»ç•Œé¢çš„è¡¨çŽ°æ€§èƒ½ã€‚ æˆ‘ä»¬éœ€è¦ç¡®ä¿ onPreviewFrame()æ‰§è¡Œåœ¨å·¥ä½œçº¿ç¨‹ã€‚å¦‚æžœä½¿ç”¨ AsyncTaskï¼Œä¼šå› ä¸º AsyncTask é»˜è®¤çš„çº¿æ€§æ‰§è¡Œçš„ç‰¹æ€§(å³ä½¿æ¢æˆå¹¶å‘æ‰§è¡Œ)ä¼šå¯¼è‡´å› ä¸ºæ— æ³•æŠŠä»»åŠ¡åŠæ—¶ä¼ é€’ç»™å·¥ä½œçº¿ç¨‹è€Œå¯¼è‡´ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸­è¢«å»¶è¿Ÿï¼Œç›´åˆ°å·¥ä½œçº¿ç¨‹ç©ºé—²ï¼Œæ‰å¯ä»¥æŠŠä»»åŠ¡åˆ‡æ¢åˆ°å·¥ä½œçº¿ç¨‹ä¸­è¿›è¡Œæ‰§è¡Œã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªæ‰§è¡Œåœ¨å·¥ä½œçº¿ç¨‹ï¼ŒåŒæ—¶åˆèƒ½å¤Ÿå¤„ç†é˜Ÿåˆ—ä¸­çš„å¤æ‚ä»»åŠ¡çš„åŠŸèƒ½ï¼Œè€Œ HandlerThread çš„å‡ºçŽ°å°±æ˜¯ä¸ºäº†å®žçŽ°è¿™ä¸ªåŠŸèƒ½çš„ï¼Œå®ƒç»„åˆäº† Handlerï¼ŒMessageQueueï¼ŒLooper å®žçŽ°äº†ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„çº¿ç¨‹ï¼Œä¸æ–­çš„ä»Žé˜Ÿåˆ—ä¸­èŽ·å–ä»»åŠ¡è¿›è¡Œæ‰§è¡Œçš„åŠŸèƒ½ã€‚ å›žåˆ°åˆšæ‰çš„å¤„ç†ç›¸æœºå›žè°ƒæ•°æ®çš„ä¾‹å­ï¼Œä½¿ç”¨ HandlerThread æˆ‘ä»¬å¯ä»¥æŠŠ open()æ“ä½œä¸Ž onPreviewFrame()çš„æ“ä½œæ‰§è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶è¿˜é¿å…äº† AsyncTask çš„å¼Šç«¯ã€‚å¦‚æžœéœ€è¦åœ¨ onPreviewFrame()é‡Œé¢æ›´æ–° UIï¼Œåªéœ€è¦è°ƒç”¨ runOnUiThread()æ–¹æ³•æŠŠä»»åŠ¡å›žè°ƒç»™ä¸»çº¿ç¨‹å°±å¤Ÿäº†ã€‚ HandlerThread æ¯”è¾ƒåˆé€‚å¤„ç†é‚£äº›åœ¨å·¥ä½œçº¿ç¨‹æ‰§è¡Œï¼Œéœ€è¦èŠ±è´¹æ—¶é—´åé•¿çš„ä»»åŠ¡ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠä»»åŠ¡å‘é€ç»™ HandlerThreadï¼Œç„¶åŽå°±åªéœ€è¦ç­‰å¾…ä»»åŠ¡æ‰§è¡Œç»“æŸçš„æ—¶å€™é€šçŸ¥è¿”å›žåˆ°ä¸»çº¿ç¨‹å°±å¥½äº†ã€‚ å¦å¤–å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œä¸€æ—¦æˆ‘ä»¬ä½¿ç”¨äº† HandlerThreadï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ç»™ HandlerThread è®¾ç½®ä¸åŒçš„çº¿ç¨‹ä¼˜å…ˆçº§ï¼ŒCPU ä¼šæ ¹æ®è®¾ç½®çš„ä¸åŒçº¿ç¨‹ä¼˜å…ˆçº§å¯¹æ‰€æœ‰çš„çº¿ç¨‹è¿›è¡Œè°ƒåº¦ä¼˜åŒ–ã€‚ æŽŒæ¡ HandlerThread ä¸Ž AsyncTask ä¹‹é—´çš„ä¼˜ç¼ºç‚¹ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚ 6. Swimming in Threadpoolsçº¿ç¨‹æ± é€‚åˆç”¨åœ¨æŠŠä»»åŠ¡è¿›è¡Œåˆ†è§£ï¼Œå¹¶å‘è¿›è¡Œæ‰§è¡Œçš„åœºæ™¯ã€‚é€šå¸¸æ¥è¯´ï¼Œç³»ç»Ÿé‡Œé¢ä¼šé’ˆå¯¹ä¸åŒçš„ä»»åŠ¡è®¾ç½®ä¸€ä¸ªå•ç‹¬çš„å®ˆæŠ¤çº¿ç¨‹ç”¨æ¥ä¸“é—¨å¤„ç†è¿™é¡¹ä»»åŠ¡ã€‚ä¾‹å¦‚ä½¿ç”¨ Networking Thread ç”¨æ¥ä¸“é—¨å¤„ç†ç½‘ç»œè¯·æ±‚çš„æ“ä½œï¼Œä½¿ç”¨ IO Thread ç”¨æ¥ä¸“é—¨å¤„ç†ç³»ç»Ÿçš„ I\O æ“ä½œã€‚é’ˆå¯¹é‚£äº›åœºæ™¯ï¼Œè¿™æ ·è®¾è®¡æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå¯¹åº”çš„ä»»åŠ¡å•æ¬¡æ‰§è¡Œçš„æ—¶é—´å¹¶ä¸é•¿è€Œä¸”å¯ä»¥æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚ä½†æ˜¯è¿™ç§ä¸“å±žçš„å•çº¿ç¨‹å¹¶ä¸èƒ½æ»¡è¶³æ‰€æœ‰çš„æƒ…å†µï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ€§ decode 40å¼ å›¾ç‰‡ï¼Œæ¯ä¸ªçº¿ç¨‹éœ€è¦æ‰§è¡Œ 4ms çš„æ—¶é—´ï¼Œå¦‚æžœæˆ‘ä»¬ä½¿ç”¨ä¸“å±žå•çº¿ç¨‹çš„æ–¹æ¡ˆï¼Œæ‰€æœ‰å›¾ç‰‡æ‰§è¡Œå®Œæ¯•ä¼šéœ€è¦èŠ±è´¹ 160ms(40*4)ï¼Œä½†æ˜¯å¦‚æžœæˆ‘ä»¬åˆ›å»º10ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ4ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åªéœ€è¦16mså°±èƒ½å¤ŸæŠŠæ‰€æœ‰çš„å›¾ç‰‡å¤„ç†å®Œæ¯•ã€‚ ä¸ºäº†èƒ½å¤Ÿå®žçŽ°ä¸Šé¢çš„çº¿ç¨‹æ± æ¨¡åž‹ï¼Œç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº† ThreadPoolExecutor å¸®åŠ©ç±»æ¥ç®€åŒ–å®žçŽ°ï¼Œå‰©ä¸‹éœ€è¦åšçš„å°±åªæ˜¯å¯¹ä»»åŠ¡è¿›è¡Œåˆ†è§£å°±å¥½äº†ã€‚ ä½¿ç”¨çº¿ç¨‹æ± éœ€è¦ç‰¹åˆ«æ³¨æ„åŒæ—¶å¹¶å‘çº¿ç¨‹æ•°é‡çš„æŽ§åˆ¶ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä»»æ„ä½ æƒ³è¦çš„å¹¶å‘æ•°é‡ï¼Œä½†æ˜¯è¿™æ ·åšéžå¸¸çš„ä¸å¥½ã€‚å› ä¸º CPU åªèƒ½åŒæ—¶æ‰§è¡Œå›ºå®šæ•°é‡çš„çº¿ç¨‹æ•°ï¼Œä¸€æ—¦åŒæ—¶å¹¶å‘çš„çº¿ç¨‹æ•°é‡è¶…è¿‡ CPU èƒ½å¤ŸåŒæ—¶æ‰§è¡Œçš„é˜ˆå€¼ï¼ŒCPU å°±éœ€è¦èŠ±è´¹ç²¾åŠ›æ¥åˆ¤æ–­åˆ°åº•å“ªäº›çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¯”è¾ƒé«˜ï¼Œéœ€è¦åœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹é—´è¿›è¡Œè°ƒåº¦åˆ‡æ¢ã€‚ ä¸€æ—¦åŒæ—¶å¹¶å‘çš„çº¿ç¨‹æ•°é‡è¾¾åˆ°ä¸€å®šçš„é‡çº§ï¼Œè¿™ä¸ªæ—¶å€™ CPU åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´è¿›è¡Œè°ƒåº¦çš„æ—¶é—´å°±å¯èƒ½è¿‡é•¿ï¼Œåè€Œå¯¼è‡´æ€§èƒ½ä¸¥é‡ä¸‹é™ã€‚å¦å¤–éœ€è¦å…³æ³¨çš„ä¸€ç‚¹æ˜¯ï¼Œæ¯å¼€ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œéƒ½ä¼šè€—è´¹è‡³å°‘ 64K+ çš„å†…å­˜ã€‚ä¸ºäº†èƒ½å¤Ÿæ–¹ä¾¿çš„å¯¹çº¿ç¨‹æ•°é‡è¿›è¡ŒæŽ§åˆ¶ï¼ŒThreadPoolExecutor ä¸ºæˆ‘ä»¬æä¾›äº†åˆå§‹åŒ–çš„å¹¶å‘çº¿ç¨‹æ•°é‡ï¼Œä»¥åŠæœ€å¤§çš„å¹¶å‘æ•°é‡è¿›è¡Œè®¾ç½®ã€‚ å¦å¤–éœ€è¦å…³æ³¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šRuntime.getRuntime().availableProcesser()æ–¹æ³•å¹¶ä¸å¯é ï¼Œä»–è¿”å›žçš„å€¼å¹¶ä¸æ˜¯çœŸå®žçš„ CPU æ ¸å¿ƒæ•°ï¼Œå› ä¸º CPU ä¼šåœ¨æŸäº›æƒ…å†µä¸‹é€‰æ‹©å¯¹éƒ¨åˆ†æ ¸å¿ƒè¿›è¡Œç¡çœ å¤„ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›žçš„æ•°é‡å°±åªèƒ½æ˜¯æ¿€æ´»çš„ CPU æ ¸å¿ƒæ•°ã€‚ 7. The Zen of IntentServiceé»˜è®¤çš„ Service æ˜¯æ‰§è¡Œåœ¨ä¸»çº¿ç¨‹çš„ï¼Œå¯æ˜¯é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™å¾ˆå®¹æ˜“å½±å“åˆ°ç¨‹åºçš„ç»˜åˆ¶æ€§èƒ½(æŠ¢å äº†ä¸»çº¿ç¨‹çš„èµ„æº)ã€‚é™¤äº†å‰é¢ä»‹ç»è¿‡çš„ AsyncTask ä¸Ž HandlerThreadï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ IntentService æ¥å®žçŽ°å¼‚æ­¥æ“ä½œã€‚IntentService ç»§æ‰¿è‡ªæ™®é€š Service åŒæ—¶åˆåœ¨å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ª HandlerThreadï¼Œåœ¨ onHandlerIntent()çš„å›žè°ƒé‡Œé¢å¤„ç†æ‰”åˆ° IntentService çš„ä»»åŠ¡ã€‚æ‰€ä»¥ IntentService å°±ä¸ä»…ä»…å…·å¤‡äº†å¼‚æ­¥çº¿ç¨‹çš„ç‰¹æ€§ï¼Œè¿˜åŒæ—¶ä¿ç•™äº† Service ä¸å—ä¸»é¡µé¢ç”Ÿå‘½å‘¨æœŸå½±å“çš„ç‰¹ç‚¹ã€‚ å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ IntentService é‡Œé¢é€šè¿‡è®¾ç½®é—¹é’Ÿé—´éš”æ€§çš„è§¦å‘å¼‚æ­¥ä»»åŠ¡ï¼Œä¾‹å¦‚åˆ·æ–°æ•°æ®ï¼Œæ›´æ–°ç¼“å­˜çš„å›¾ç‰‡æˆ–è€…æ˜¯åˆ†æžç”¨æˆ·æ“ä½œè¡Œä¸ºç­‰ç­‰ï¼Œå½“ç„¶å¤„ç†è¿™äº›ä»»åŠ¡éœ€è¦å°å¿ƒè°¨æ…Žã€‚ ä½¿ç”¨ IntentService éœ€è¦ç‰¹åˆ«ç•™æ„ä»¥ä¸‹å‡ ç‚¹ï¼š é¦–å…ˆï¼Œå› ä¸º IntentService å†…ç½®çš„æ˜¯ HandlerThread ä½œä¸ºå¼‚æ­¥çº¿ç¨‹ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªäº¤ç»™ IntentService çš„ä»»åŠ¡éƒ½å°†ä»¥é˜Ÿåˆ—çš„æ–¹å¼é€ä¸ªè¢«æ‰§è¡Œåˆ°ï¼Œä¸€æ—¦é˜Ÿåˆ—ä¸­æœ‰æŸä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åŽç»­çš„ä»»åŠ¡éƒ½ä¼šè¢«å»¶è¿Ÿå¤„ç†ã€‚ å…¶æ¬¡ï¼Œé€šå¸¸ä½¿ç”¨åˆ° IntentService çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šç»“åˆä½¿ç”¨ BroadcastReceiver æŠŠå·¥ä½œçº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œç»“æžœè¿”å›žç»™ä¸» UI çº¿ç¨‹ã€‚ä½¿ç”¨å¹¿æ’­å®¹æ˜“å¼•èµ·æ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ LocalBroadcastManager æ¥å‘é€åªåœ¨ç¨‹åºå†…éƒ¨ä¼ é€’çš„å¹¿æ’­ï¼Œä»Žè€Œæå‡å¹¿æ’­çš„æ€§èƒ½ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ runOnUiThread() å¿«é€Ÿå›žè°ƒåˆ°ä¸» UI çº¿ç¨‹ã€‚ æœ€åŽï¼ŒåŒ…å«æ­£åœ¨è¿è¡Œçš„ IntentService çš„ç¨‹åºç›¸æ¯”èµ·çº¯ç²¹çš„åŽå°ç¨‹åºæ›´ä¸å®¹æ˜“è¢«ç³»ç»Ÿæ€æ­»ï¼Œè¯¥ç¨‹åºçš„ä¼˜å…ˆçº§æ˜¯ä»‹äºŽå‰å°ç¨‹åºä¸Žçº¯åŽå°ç¨‹åºä¹‹é—´çš„ã€‚ 8. Threading and Loaderså½“å¯åŠ¨å·¥ä½œçº¿ç¨‹çš„ Activity è¢«é”€æ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥åšç‚¹ä»€ä¹ˆå‘¢ï¼Ÿä¸ºäº†æ–¹ä¾¿çš„æŽ§åˆ¶å·¥ä½œçº¿ç¨‹çš„å¯åŠ¨ä¸Žç»“æŸï¼ŒAndroid ä¸ºæˆ‘ä»¬å¼•å…¥äº† Loader æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“ Activity æœ‰å¯èƒ½å› ä¸ºç”¨æˆ·çš„ä¸»åŠ¨åˆ‡æ¢è€Œé¢‘ç¹çš„è¢«åˆ›å»ºä¸Žé”€æ¯ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å› ä¸ºç±»ä¼¼å±å¹•å‘ç”Ÿæ—‹è½¬ç­‰è¢«åŠ¨åŽŸå› è€Œé”€æ¯å†é‡å»ºã€‚åœ¨ Activity ä¸åœçš„åˆ›å»ºä¸Žé”€æ¯çš„è¿‡ç¨‹å½“ä¸­ï¼Œå¾ˆæœ‰å¯èƒ½å› ä¸ºå·¥ä½œçº¿ç¨‹æŒæœ‰ Activity çš„ View è€Œå¯¼è‡´å†…å­˜æ³„æ¼(å› ä¸ºå·¥ä½œçº¿ç¨‹å¾ˆå¯èƒ½æŒæœ‰ View çš„å¼ºå¼•ç”¨ï¼Œå¦å¤–å·¥ä½œçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸè¿˜æ— æ³•ä¿è¯å’Œ Activity çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œè¿™æ ·å°±å®¹æ˜“å‘ç”Ÿå†…å­˜æ³„æ¼äº†)ã€‚é™¤äº†å¯èƒ½å¼•èµ·å†…å­˜æ³„æ¼ä¹‹å¤–ï¼Œåœ¨ Activity è¢«é”€æ¯ä¹‹åŽï¼Œå·¥ä½œçº¿ç¨‹è¿˜ç»§ç»­æ›´æ–°è§†å›¾æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºæ­¤æ—¶è§†å›¾å·²ç»ä¸åœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºäº†ã€‚ Loader çš„å‡ºçŽ°å°±æ˜¯ä¸ºäº†ç¡®ä¿å·¥ä½œçº¿ç¨‹èƒ½å¤Ÿå’Œ Activity çš„ç”Ÿå‘½å‘¨æœŸä¿æŒä¸€è‡´ï¼ŒåŒæ—¶é¿å…å‡ºçŽ°å‰é¢æåˆ°çš„é—®é¢˜ã€‚ LoaderManager ä¼šå¯¹æŸ¥è¯¢çš„æ“ä½œè¿›è¡Œç¼“å­˜ï¼Œåªè¦å¯¹åº” Cursor ä¸Šçš„æ•°æ®æºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œåœ¨é…ç½®ä¿¡æ¯å‘ç”Ÿæ”¹å˜çš„æ—¶å€™(ä¾‹å¦‚å±å¹•çš„æ—‹è½¬)ï¼ŒLoader å¯ä»¥ç›´æŽ¥æŠŠç¼“å­˜çš„æ•°æ®å›žè°ƒåˆ° onLoadFinished()ï¼Œä»Žè€Œé¿å…é‡æ–°æŸ¥è¯¢æ•°æ®ã€‚å¦å¤–ç³»ç»Ÿä¼šåœ¨ Loader ä¸å†éœ€è¦ä½¿ç”¨åˆ°çš„æ—¶å€™(ä¾‹å¦‚ä½¿ç”¨ Back æŒ‰é’®é€€å‡ºå½“å‰é¡µé¢)å›žè°ƒ onLoaderReset()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåšæ•°æ®çš„æ¸…é™¤ç­‰ç­‰æ“ä½œã€‚ åœ¨ Activity æˆ–è€… Fragment ä¸­ä½¿ç”¨ Loader å¯ä»¥æ–¹ä¾¿çš„å®žçŽ°å¼‚æ­¥åŠ è½½çš„æ¡†æž¶ï¼ŒLoader æœ‰è¯¸å¤šä¼˜ç‚¹ã€‚ä½†æ˜¯å®žçŽ° Loader çš„è¿™å¥—ä»£ç è¿˜æ˜¯ç¨å¾®æœ‰ç‚¹ç‚¹å¤æ‚ï¼ŒAndroid å®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº†ä½¿ç”¨ Loader çš„ç¤ºä¾‹ä»£ç è¿›è¡Œå‚è€ƒå­¦ä¹ ã€‚ 9. The Importance of Thread Priorityç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¯ä»¥åˆ›å»ºå‡ºéžå¸¸å¤šçš„å­çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ï¼Œå¯æ˜¯åŸºäºŽ CPU æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦çš„æœºåˆ¶ï¼Œä¸å¯èƒ½æ‰€æœ‰çš„çº¿ç¨‹éƒ½å¯ä»¥åŒæ—¶è¢«è°ƒåº¦æ‰§è¡Œï¼ŒCPU éœ€è¦æ ¹æ®çº¿ç¨‹çš„ä¼˜å…ˆçº§èµ‹äºˆä¸åŒçš„æ—¶é—´ç‰‡ã€‚ Android ç³»ç»Ÿä¼šæ ¹æ®å½“å‰è¿è¡Œçš„å¯è§çš„ç¨‹åºå’Œä¸å¯è§çš„åŽå°ç¨‹åºå¯¹çº¿ç¨‹è¿›è¡Œå½’ç±»ï¼Œåˆ’åˆ†ä¸º forground çš„é‚£éƒ¨åˆ†çº¿ç¨‹ä¼šå¤§è‡´å ç”¨æŽ‰ CPU çš„90%å·¦å³çš„æ—¶é—´ç‰‡ï¼Œbackground çš„é‚£éƒ¨åˆ†çº¿ç¨‹å°±æ€»å…±åªèƒ½åˆ†äº«åˆ°5%-10%å·¦å³çš„æ—¶é—´ç‰‡ã€‚ä¹‹æ‰€ä»¥è®¾è®¡æˆè¿™æ ·æ˜¯å› ä¸º forground çš„ç¨‹åºæœ¬èº«çš„ä¼˜å…ˆçº§å°±æ›´é«˜ï¼Œç†åº”å¾—åˆ°æ›´å¤šçš„æ‰§è¡Œæ—¶é—´ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°åˆ›å»ºçš„çº¿ç¨‹çš„ä¼˜å…ˆçº§é»˜è®¤å’Œåˆ›å»ºå®ƒçš„æ¯çº¿ç¨‹ä¿æŒä¸€è‡´ã€‚å¦‚æžœä¸» UI çº¿ç¨‹åˆ›å»ºå‡ºäº†å‡ åä¸ªå·¥ä½œçº¿ç¨‹ï¼Œè¿™äº›å·¥ä½œçº¿ç¨‹çš„ä¼˜å…ˆçº§å°±é»˜è®¤å’Œä¸»çº¿ç¨‹ä¿æŒä¸€è‡´äº†ï¼Œä¸ºäº†ä¸è®©æ–°åˆ›å»ºçš„å·¥ä½œçº¿ç¨‹å’Œä¸»çº¿ç¨‹æŠ¢å  CPU èµ„æºï¼Œéœ€è¦æŠŠè¿™äº›çº¿ç¨‹çš„ä¼˜å…ˆçº§è¿›è¡Œé™ä½Žå¤„ç†ï¼Œè¿™æ ·æ‰èƒ½ç»™å¸®ç»„ CPU è¯†åˆ«ä¸»æ¬¡ï¼Œæé«˜ä¸»çº¿ç¨‹æ‰€èƒ½å¾—åˆ°çš„ç³»ç»Ÿèµ„æºã€‚ åœ¨ Android ç³»ç»Ÿé‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ android.os.Process.setThreadPriority(int) è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œå‚æ•°èŒƒå›´ä»Ž-20åˆ°19ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚Android ç³»ç»Ÿè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹çš„ä¸€äº›é¢„è®¾å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™ä¸åŒçš„å·¥ä½œçº¿ç¨‹è®¾ç½®ä¸åŒæ•°å€¼çš„ä¼˜å…ˆçº§æ¥è¾¾åˆ°æ›´ç»†ç²’åº¦çš„æŽ§åˆ¶ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–°åˆ›å»ºçš„çº¿ç¨‹ä¼˜å…ˆçº§ä¼šè¢«è®¾ç½®ä¸ºé»˜è®¤çš„0ï¼Œä¸»çº¿ç¨‹è®¾ç½®ä¸º0çš„æ—¶å€™ï¼Œæ–°åˆ›å»ºçš„çº¿ç¨‹è¿˜å¯ä»¥åˆ©ç”¨ THREAD_PRIORITY_LESS_FAVORABLE æˆ–è€… THREAD_PRIORITY_MORE_FAVORABLE æ¥æŽ§åˆ¶çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚ Android ç³»ç»Ÿé‡Œé¢çš„ AsyncTask ä¸Ž IntentServiceå·²ç»é»˜è®¤å¸®åŠ©æˆ‘ä»¬è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä½†æ˜¯å¯¹äºŽé‚£äº›éžå®˜æ–¹æä¾›çš„å¤šçº¿ç¨‹å·¥å…·ç±»ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«ç•™æ„æ ¹æ®éœ€è¦è‡ªå·±æ‰‹åŠ¨æ¥è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚ 10. Profile GPU Rendering : M Updateä»Ž Android M ç³»ç»Ÿå¼€å§‹ï¼Œç³»ç»Ÿæ›´æ–°äº† GPU Profiling çš„å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬å®šä½ UI çš„æ¸²æŸ“æ€§èƒ½é—®é¢˜ã€‚æ—©æœŸçš„ CPU Profiling å·¥å…·åªèƒ½ç²—ç•¥çš„æ˜¾ç¤ºå‡º Processï¼ŒExecuteï¼ŒUpdate ä¸‰å¤§æ­¥éª¤çš„æ—¶é—´è€—è´¹æƒ…å†µã€‚ ä½†æ˜¯ä»…ä»…æ˜¾ç¤ºä¸‰å¤§æ­¥éª¤çš„æ—¶é—´è€—è´¹æƒ…å†µï¼Œè¿˜æ˜¯ä¸å¤ªèƒ½å¤Ÿæ¸…æ™°å¸®åŠ©æˆ‘ä»¬å®šä½å…·ä½“çš„ç¨‹åºä»£ç é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ Android M ç‰ˆæœ¬å¼€å§‹ï¼ŒGPU Profiling å·¥å…·æŠŠæ¸²æŸ“æ“ä½œæ‹†è§£æˆå¦‚ä¸‹8ä¸ªè¯¦ç»†çš„æ­¥éª¤è¿›è¡Œæ˜¾ç¤ºã€‚ æ—§ç‰ˆæœ¬ä¸­æåˆ°çš„ Procesï¼ŒExecuteï¼ŒUpdate è¿˜æ˜¯ç»§ç»­å¾—åˆ°äº†ä¿ç•™ï¼Œä»–ä»¬çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š æŽ¥ä¸‹åŽ»æˆ‘ä»¬çœ‹ä¸‹å…¶ä»–äº”ä¸ªæ­¥éª¤åˆ†åˆ«ä»£è¡¨äº†ä»€ä¹ˆå«ä¹‰ï¼š Sync &amp; Uploadï¼šé€šå¸¸è¡¨ç¤ºçš„æ˜¯å‡†å¤‡å½“å‰ç•Œé¢ä¸Šæœ‰å¾…ç»˜åˆ¶çš„å›¾ç‰‡æ‰€è€—è´¹çš„æ—¶é—´ï¼Œä¸ºäº†å‡å°‘è¯¥æ®µåŒºåŸŸçš„æ‰§è¡Œæ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘å±å¹•ä¸Šçš„å›¾ç‰‡æ•°é‡æˆ–è€…æ˜¯ç¼©å°å›¾ç‰‡æœ¬èº«çš„å¤§å°ã€‚ Measure &amp; Layoutï¼šè¿™é‡Œè¡¨ç¤ºçš„æ˜¯å¸ƒå±€çš„ onMeasure ä¸Ž onLayout æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œä¸€æ—¦æ—¶é—´è¿‡é•¿ï¼Œå°±éœ€è¦ä»”ç»†æ£€æŸ¥è‡ªå·±çš„å¸ƒå±€æ˜¯ä¸æ˜¯å­˜åœ¨ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ Animationï¼šè¡¨ç¤ºçš„æ˜¯è®¡ç®—æ‰§è¡ŒåŠ¨ç”»æ‰€éœ€è¦èŠ±è´¹çš„æ—¶é—´ï¼ŒåŒ…å«çš„åŠ¨ç”»æœ‰ ObjectAnimatorï¼ŒViewPropertyAnimatorï¼ŒTransition ç­‰ç­‰ã€‚ä¸€æ—¦è¿™é‡Œçš„æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œå°±éœ€è¦æ£€æŸ¥æ˜¯ä¸æ˜¯ä½¿ç”¨äº†éžå®˜æ–¹çš„åŠ¨ç”»å·¥å…·æˆ–è€…æ˜¯æ£€æŸ¥åŠ¨ç”»æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ˜¯ä¸æ˜¯è§¦å‘äº†è¯»å†™æ“ä½œç­‰ç­‰ã€‚ Input Handlingï¼šè¡¨ç¤ºçš„æ˜¯ç³»ç»Ÿå¤„ç†è¾“å…¥äº‹ä»¶æ‰€è€—è´¹çš„æ—¶é—´ï¼Œç²—ç•¥ç­‰äºŽå¯¹äºŽçš„äº‹ä»¶å¤„ç†æ–¹æ³•æ‰€æ‰§è¡Œçš„æ—¶é—´ã€‚ä¸€æ—¦æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œæ„å‘³ç€åœ¨å¤„ç†ç”¨æˆ·çš„è¾“å…¥äº‹ä»¶çš„åœ°æ–¹æ‰§è¡Œäº†å¤æ‚çš„æ“ä½œã€‚ Misc/Vsync Delayï¼šå¦‚æžœç¨åŠ æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼€å‘åº”ç”¨çš„ Log æ—¥å¿—é‡Œé¢çœ‹åˆ°è¿™æ ·ä¸€è¡Œæç¤ºï¼šI/Choreographer(691): Skipped XXX frames! The application may be doing too much work on its main threadã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œäº†å¤ªå¤šçš„ä»»åŠ¡ï¼Œå¯¼è‡´ UI æ¸²æŸ“è·Ÿä¸ä¸Š vSync çš„ä¿¡å·è€Œå‡ºçŽ°æŽ‰å¸§çš„æƒ…å†µã€‚ ä¸Šé¢å…«ç§ä¸åŒçš„é¢œè‰²åŒºåˆ†äº†ä¸åŒçš„æ“ä½œæ‰€è€—è´¹çš„æ—¶é—´ï¼Œä¸ºäº†ä¾¿äºŽæˆ‘ä»¬è¿…é€Ÿæ‰¾å‡ºé‚£äº›æœ‰é—®é¢˜çš„æ­¥éª¤ï¼ŒGPU Profiling å·¥å…·ä¼šæ˜¾ç¤º 16ms çš„é˜ˆå€¼çº¿ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“æ‰¾å‡ºé‚£äº›ä¸åˆç†çš„æ€§èƒ½é—®é¢˜ï¼Œå†ä»”ç»†çœ‹å¯¹åº”å…·ä½“å“ªä¸ªæ­¥éª¤ç›¸å¯¹æ¥è¯´è€—è´¹æ—¶é—´æ¯”ä¾‹æ›´å¤§ï¼Œç»“åˆä¸Šé¢ä»‹ç»çš„ç»†åŒ–æ­¥éª¤ï¼Œä»Žè€Œå¿«é€Ÿå®šä½é—®é¢˜ï¼Œä¿®å¤é—®é¢˜ã€‚ http://bugly.qq.com/bbs/forum.php?mod=viewthread&amp;tid=1022]]></content>
      <categories>
        <category>Android</category>
      </categories>
      <tags>
        <tag>Android</tag>
        <tag>tips</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MP4æ ¼å¼è§£æž]]></title>
    <url>%2F2017%2F04%2F09%2Fm-f-mp4%2F</url>
    <content type="text"><![CDATA[ç›®å‰MP4çš„æ¦‚å¿µè¢«ç‚’å¾—å¾ˆç«ï¼Œä¹Ÿå¾ˆä¹±ã€‚æœ€å¼€å§‹MP4æŒ‡çš„æ˜¯éŸ³é¢‘ï¼ˆMP3çš„å‡çº§ç‰ˆï¼‰ï¼Œå³MPEG-2 AACæ ‡å‡†ã€‚éšåŽMP4æ¦‚å¿µè¢«è½¬ç§»åˆ°è§†é¢‘ä¸Šï¼Œå¯¹åº”çš„æ˜¯MPEG-4æ ‡å‡†ã€‚è€ŒçŽ°åœ¨æˆ‘ä»¬æµè¡Œçš„å«æ³•ï¼Œå¤šåŠæ˜¯æŒ‡èƒ½æ’­æ”¾MPEG-4æ ‡å‡†ç¼–ç æ ¼å¼è§†é¢‘çš„æ’­æ”¾å™¨ã€‚ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä»‹ç»çš„å†…å®¹è·Ÿä¸Šé¢è¿™äº›éƒ½æ— å…³ï¼Œæˆ‘ä»¬è¦è®¨è®ºçš„æ˜¯MP4æ–‡ä»¶å°è£…æ ¼å¼ï¼Œå¯¹åº”çš„æ ‡å‡†ä¸ºISO/IEC 14496-12ï¼Œå³ä¿¡æ¯æŠ€æœ¯ è§†å¬å¯¹è±¡ç¼–ç çš„ç¬¬12éƒ¨åˆ†ï¼šISO åŸºæœ¬åª’ä½“æ–‡ä»¶æ ¼å¼ï¼ˆInformation technology Coding of audio-visual objects Part 12: ISO base media file formatï¼‰ã€‚ISO/IECç»„ç»‡æŒ‡å®šçš„æ ‡å‡†ä¸€èˆ¬ç”¨æ•°å­—è¡¨ç¤ºï¼ŒISO/IEC 14496å³MPEG-4æ ‡å‡†ã€‚ MP4è§†é¢‘æ–‡ä»¶å°è£…æ ¼å¼æ˜¯åŸºäºŽQuickTimeå®¹å™¨æ ¼å¼å®šä¹‰çš„ï¼Œå› æ­¤å‚è€ƒQuickTimeçš„æ ¼å¼å®šä¹‰å¯¹ç†è§£MP4æ–‡ä»¶æ ¼å¼å¾ˆæœ‰å¸®åŠ©ã€‚MP4æ–‡ä»¶æ ¼å¼æ˜¯ä¸€ä¸ªååˆ†å¼€æ”¾çš„å®¹å™¨ï¼Œå‡ ä¹Žå¯ä»¥ç”¨æ¥æè¿°æ‰€æœ‰çš„åª’ä½“ç»“æž„ï¼ŒMP4æ–‡ä»¶ä¸­çš„åª’ä½“æè¿°ä¸Žåª’ä½“æ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œå¹¶ä¸”åª’ä½“æ•°æ®çš„ç»„ç»‡ä¹Ÿå¾ˆè‡ªç”±ï¼Œä¸ä¸€å®šè¦æŒ‰ç…§æ—¶é—´é¡ºåºæŽ’åˆ—ï¼Œç”šè‡³åª’ä½“æ•°æ®å¯ä»¥ç›´æŽ¥å¼•ç”¨å…¶ä»–æ–‡ä»¶ã€‚åŒæ—¶ï¼ŒMP4ä¹Ÿæ”¯æŒæµåª’ä½“ã€‚MP4ç›®å‰è¢«å¹¿æ³›ç”¨äºŽå°è£…h.264è§†é¢‘å’ŒAACéŸ³é¢‘ï¼Œæ˜¯é«˜æ¸…è§†é¢‘çš„ä»£è¡¨ã€‚MP4æ ¼å¼çš„å®˜æ–¹æ–‡ä»¶åŽç¼€åæ˜¯â€œ.mp4â€ï¼Œè¿˜æœ‰å…¶ä»–çš„ä»¥mp4ä¸ºåŸºç¡€è¿›è¡Œçš„æ‰©å±•æˆ–è€…æ˜¯ç¼©æ°´ç‰ˆæœ¬çš„æ ¼å¼ï¼ŒåŒ…æ‹¬ï¼šM4V, 3GP, F4Vç­‰ã€‚ 1.æ¦‚è¿°MP4æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è£…åœ¨boxï¼ˆQuickTimeä¸­ä¸ºatomï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´MP4æ–‡ä»¶ç”±è‹¥å¹²ä¸ªboxç»„æˆï¼Œæ¯ä¸ªboxæœ‰ç±»åž‹å’Œé•¿åº¦ï¼Œå¯ä»¥å°†boxç†è§£ä¸ºä¸€ä¸ªæ•°æ®å¯¹è±¡å—ã€‚boxä¸­å¯ä»¥åŒ…å«å¦ä¸€ä¸ªboxï¼Œè¿™ç§boxç§°ä¸ºcontainer boxã€‚ä¸€ä¸ªMP4æ–‡ä»¶é¦–å…ˆä¼šæœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œftypâ€ç±»åž‹çš„boxï¼Œä½œä¸ºMP4æ ¼å¼çš„æ ‡å¿—å¹¶åŒ…å«å…³äºŽæ–‡ä»¶çš„ä¸€äº›ä¿¡æ¯ï¼›ä¹‹åŽä¼šæœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œmoovâ€ç±»åž‹çš„boxï¼ˆMovie Boxï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§container boxï¼Œå­boxåŒ…å«äº†åª’ä½“çš„metadataä¿¡æ¯ï¼›MP4æ–‡ä»¶çš„åª’ä½“æ•°æ®åŒ…å«åœ¨â€œmdatâ€ç±»åž‹çš„boxï¼ˆMidia Data Boxï¼‰ä¸­ï¼Œè¯¥ç±»åž‹çš„boxä¹Ÿæ˜¯container boxï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ï¼ˆå½“åª’ä½“æ•°æ®å…¨éƒ¨å¼•ç”¨å…¶ä»–æ–‡ä»¶æ—¶ï¼‰ï¼Œåª’ä½“æ•°æ®çš„ç»“æž„ç”±metadataè¿›è¡Œæè¿°ã€‚ ä¸‹é¢æ˜¯ä¸€äº›æ¦‚å¿µï¼š track è¡¨ç¤ºä¸€äº›sampleçš„é›†åˆï¼Œå¯¹äºŽåª’ä½“æ•°æ®æ¥è¯´ï¼Œtrackè¡¨ç¤ºä¸€ä¸ªè§†é¢‘æˆ–éŸ³é¢‘åºåˆ—ã€‚ hint track è¿™ä¸ªç‰¹æ®Šçš„trackå¹¶ä¸åŒ…å«åª’ä½“æ•°æ®ï¼Œè€Œæ˜¯åŒ…å«äº†ä¸€äº›å°†å…¶ä»–æ•°æ®trackæ‰“åŒ…æˆæµåª’ä½“çš„æŒ‡ç¤ºä¿¡æ¯ã€‚ sample å¯¹äºŽéžhint trackæ¥è¯´ï¼Œvideo sampleå³ä¸ºä¸€å¸§è§†é¢‘ï¼Œæˆ–ä¸€ç»„è¿žç»­è§†é¢‘å¸§ï¼Œaudio sampleå³ä¸ºä¸€æ®µè¿žç»­çš„åŽ‹ç¼©éŸ³é¢‘ï¼Œå®ƒä»¬ç»Ÿç§°sampleã€‚å¯¹äºŽhint trackï¼Œsampleå®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæµåª’ä½“åŒ…çš„æ ¼å¼ã€‚ sample table æŒ‡æ˜Žsampeæ—¶åºå’Œç‰©ç†å¸ƒå±€çš„è¡¨ã€‚ chunk ä¸€ä¸ªtrackçš„å‡ ä¸ªsampleç»„æˆçš„å•å…ƒã€‚ ä¸è®¨è®ºæ¶‰åŠhintçš„å†…å®¹ï¼Œåªå…³æ³¨åŒ…å«åª’ä½“æ•°æ®çš„æœ¬åœ°MP4æ–‡ä»¶ã€‚ä¸‹å›¾ä¸ºä¸€ä¸ªå…¸åž‹çš„MP4æ–‡ä»¶çš„ç»“æž„æ ‘ã€‚ 2.Boxboxä¸­çš„å­—èŠ‚åºä¸ºç½‘ç»œå­—èŠ‚åºï¼Œä¹Ÿå°±æ˜¯å¤§ç«¯å­—èŠ‚åºï¼ˆBig-Endianï¼‰ï¼Œç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€ä¸ª32ä½çš„4å­—èŠ‚æ•´æ•°å­˜å‚¨æ–¹å¼ä¸ºé«˜ä½å­—èŠ‚åœ¨å†…å­˜çš„ä½Žç«¯ã€‚Boxç”±headerå’Œbodyç»„æˆï¼Œå…¶ä¸­headerç»Ÿä¸€æŒ‡æ˜Žboxçš„å¤§å°å’Œç±»åž‹ï¼Œbodyæ ¹æ®ç±»åž‹æœ‰ä¸åŒçš„æ„ä¹‰å’Œæ ¼å¼ã€‚ æ ‡å‡†çš„boxå¼€å¤´çš„4ä¸ªå­—èŠ‚ï¼ˆ32ä½ï¼‰ä¸ºbox sizeï¼Œè¯¥å¤§å°åŒ…æ‹¬box headerå’Œbox bodyæ•´ä¸ªboxçš„å¤§å°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ–‡ä»¶ä¸­å®šä½å„ä¸ªboxã€‚å¦‚æžœsizeä¸º1ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªboxçš„å¤§å°ä¸ºlarge sizeï¼ŒçœŸæ­£çš„sizeå€¼è¦åœ¨largesizeåŸŸä¸Šå¾—åˆ°ã€‚ï¼ˆå®žé™…ä¸Šåªæœ‰â€œmdatâ€ç±»åž‹çš„boxæ‰æœ‰å¯èƒ½ç”¨åˆ°large sizeã€‚ï¼‰å¦‚æžœsizeä¸º0ï¼Œè¡¨ç¤ºè¯¥boxä¸ºæ–‡ä»¶çš„æœ€åŽä¸€ä¸ªboxï¼Œæ–‡ä»¶ç»“å°¾å³ä¸ºè¯¥boxç»“å°¾ã€‚ï¼ˆåŒæ ·åªå­˜åœ¨äºŽâ€œmdatâ€ç±»åž‹çš„boxä¸­ã€‚ï¼‰sizeåŽé¢ç´§è·Ÿçš„32ä½ä¸ºbox typeï¼Œä¸€èˆ¬æ˜¯4ä¸ªå­—ç¬¦ï¼Œå¦‚â€œftypâ€ã€â€œmoovâ€ç­‰ï¼Œè¿™äº›box typeéƒ½æ˜¯å·²ç»é¢„å®šä¹‰å¥½çš„ï¼Œåˆ†åˆ«è¡¨ç¤ºå›ºå®šçš„æ„ä¹‰ã€‚å¦‚æžœæ˜¯â€œuuidâ€ï¼Œè¡¨ç¤ºè¯¥boxä¸ºç”¨æˆ·æ‰©å±•ç±»åž‹ã€‚å¦‚æžœbox typeæ˜¯æœªå®šä¹‰çš„ï¼Œåº”è¯¥å°†å…¶å¿½ç•¥ã€‚ 3.File Type Box(ftyp)è¯¥boxæœ‰ä¸”åªæœ‰1ä¸ªï¼Œå¹¶ä¸”åªèƒ½è¢«åŒ…å«åœ¨æ–‡ä»¶å±‚ï¼Œè€Œä¸èƒ½è¢«å…¶ä»–boxåŒ…å«ã€‚è¯¥boxåº”è¯¥è¢«æ”¾åœ¨æ–‡ä»¶çš„æœ€å¼€å§‹ï¼ŒæŒ‡ç¤ºè¯¥MP4æ–‡ä»¶åº”ç”¨çš„ç›¸å…³ä¿¡æ¯ã€‚ â€œftypâ€ bodyä¾æ¬¡åŒ…æ‹¬1ä¸ª32ä½çš„major brandï¼ˆ4ä¸ªå­—ç¬¦ï¼‰ï¼Œ1ä¸ª32ä½çš„minor versionï¼ˆæ•´æ•°ï¼‰å’Œ1ä¸ªä»¥32ä½ï¼ˆ4ä¸ªå­—ç¬¦ï¼‰ä¸ºå•ä½å…ƒç´ çš„æ•°ç»„compatible brandsã€‚è¿™äº›éƒ½æ˜¯ç”¨æ¥æŒ‡ç¤ºæ–‡ä»¶åº”ç”¨çº§åˆ«çš„ä¿¡æ¯ã€‚è¯¥boxçš„å­—èŠ‚å®žä¾‹å¦‚ä¸‹ï¼š 1200000000h: 00 00 00 18 66 74 79 70 6D 70 34 32 00 00 00 01 ; ....ftypmp42....00000010h: 6D 70 34 32 6D 70 34 31 00 00 5A EB 6D 6F 6F 76 ; mp42mp41..Zmoov 4.Movie Box(moov)è¯¥boxåŒ…å«äº†æ–‡ä»¶åª’ä½“çš„metadataä¿¡æ¯ï¼Œâ€œmoovâ€æ˜¯ä¸€ä¸ªcontainer boxï¼Œå…·ä½“å†…å®¹ä¿¡æ¯ç”±å­boxè¯ é‡Šã€‚åŒFile Type Boxä¸€æ ·ï¼Œè¯¥boxæœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œä¸”åªè¢«åŒ…å«åœ¨æ–‡ä»¶å±‚ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œâ€œmoovâ€ä¼šç´§éšâ€œftypâ€å‡ºçŽ°ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼ˆé™äºŽç¯‡å¹…ï¼Œæœ¬æ–‡åªè®²è§£å¸¸è§çš„MP4æ–‡ä»¶ç»“æž„ï¼‰ï¼Œâ€œmoovâ€ä¸­ä¼šåŒ…å«1ä¸ªâ€œmvhdâ€å’Œè‹¥å¹²ä¸ªâ€œtrakâ€ã€‚å…¶ä¸­â€œmvhdâ€ä¸ºheader boxï¼Œä¸€èˆ¬ä½œä¸ºâ€œmoovâ€çš„ç¬¬ä¸€ä¸ªå­boxå‡ºçŽ°ï¼ˆå¯¹äºŽå…¶ä»–container boxæ¥è¯´ï¼Œheader boxéƒ½åº”ä½œä¸ºé¦–ä¸ªå­boxå‡ºçŽ°ï¼‰ã€‚â€œtrakâ€åŒ…å«äº†ä¸€ä¸ªtrackçš„ç›¸å…³ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªcontainer boxã€‚ä¸‹å›¾ä¸ºéƒ¨åˆ†â€œmoovâ€çš„å­—èŠ‚å®žä¾‹ï¼Œå…¶ä¸­çº¢è‰²éƒ¨åˆ†ä¸ºbox headerï¼Œç»¿è‰²ä¸ºâ€œmvhdâ€ï¼Œé»„è‰²ä¸ºä¸€éƒ¨åˆ†â€œtrakâ€ã€‚ 4.1 Movie Header Box(mvhd)â€œmvhdâ€æŽ¥å£å¦‚ä¸‹è¡¨: å­—æ®µ å­—èŠ‚æ•° æ„ä¹‰ box size 4 boxå¤§å° box type 4 boxç±»åž‹ version 1 boxç‰ˆæœ¬ï¼Œ0æˆ–1ï¼Œä¸€èˆ¬ä¸º0ã€‚ï¼ˆä»¥ä¸‹å­—èŠ‚æ•°å‡æŒ‰version=0ï¼‰ flags 3 creation time 4 åˆ›å»ºæ—¶é—´ï¼ˆç›¸å¯¹äºŽUTCæ—¶é—´1904-01-01é›¶ç‚¹çš„ç§’æ•°ï¼‰ modification time 4 ä¿®æ”¹æ—¶é—´ time scale 4 æ–‡ä»¶åª’ä½“åœ¨1ç§’æ—¶é—´å†…çš„åˆ»åº¦å€¼ï¼Œå¯ä»¥ç†è§£ä¸º1ç§’é•¿åº¦çš„æ—¶é—´å•å…ƒæ•° duration 4 è¯¥trackçš„æ—¶é—´é•¿åº¦ï¼Œç”¨durationå’Œtime scaleå€¼å¯ä»¥è®¡ç®—trackæ—¶é•¿ï¼Œæ¯”å¦‚audio trackçš„time scale = 8000, duration = 560128ï¼Œæ—¶é•¿ä¸º70.016ï¼Œvideo trackçš„time scale = 600, duration = 42000ï¼Œæ—¶é•¿ä¸º70 rate 4 æŽ¨èæ’­æ”¾é€ŸçŽ‡ï¼Œé«˜16ä½å’Œä½Ž16ä½åˆ†åˆ«ä¸ºå°æ•°ç‚¹æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†ï¼Œå³[16.16] æ ¼å¼ï¼Œè¯¥å€¼ä¸º1.0ï¼ˆ0x00010000ï¼‰è¡¨ç¤ºæ­£å¸¸å‰å‘æ’­æ”¾ volume 2 ä¸Žrateç±»ä¼¼ï¼Œ[8.8] æ ¼å¼ï¼Œ1.0ï¼ˆ0x0100ï¼‰è¡¨ç¤ºæœ€å¤§éŸ³é‡ reserved 10 ä¿ç•™ä½ matrix 36 è§†é¢‘å˜æ¢çŸ©é˜µ pre-defined 24 next track id 4 ä¸‹ä¸€ä¸ªtrackä½¿ç”¨çš„idå· 4.2Track Box(trak)â€œtrakâ€ä¹Ÿæ˜¯ä¸€ä¸ªcontainer boxï¼Œå…¶å­boxåŒ…å«äº†è¯¥trackçš„åª’ä½“æ•°æ®å¼•ç”¨å’Œæè¿°ï¼ˆhint tracké™¤å¤–ï¼‰ã€‚ä¸€ä¸ªMP4æ–‡ä»¶ä¸­çš„åª’ä½“å¯ä»¥åŒ…å«å¤šä¸ªtrackï¼Œä¸”è‡³å°‘æœ‰ä¸€ä¸ªtrackï¼Œè¿™äº›trackä¹‹é—´å½¼æ­¤ç‹¬ç«‹ï¼Œæœ‰è‡ªå·±çš„æ—¶é—´å’Œç©ºé—´ä¿¡æ¯ã€‚â€œtrakâ€å¿…é¡»åŒ…å«ä¸€ä¸ªâ€œtkhdâ€å’Œä¸€ä¸ªâ€œmdiaâ€ï¼Œæ­¤å¤–è¿˜æœ‰å¾ˆå¤šå¯é€‰çš„boxï¼ˆç•¥ï¼‰ã€‚å…¶ä¸­â€œtkhdâ€ä¸ºtrack header boxï¼Œâ€œmdiaâ€ä¸ºmedia boxï¼Œè¯¥boxæ˜¯ä¸€ä¸ªåŒ…å«ä¸€äº›trackåª’ä½“æ•°æ®ä¿¡æ¯boxçš„container boxã€‚ boxç±»åž‹è¯´æ˜Ž ftypefile type,è¯´æ˜Žæ–‡ä»¶ç±»åž‹ moovmetadata container,å­˜æ”¾åª’ä½“ä¿¡æ¯çš„åœ°æ–¹ mvhdmovie header,æ–‡ä»¶çš„æ€»ä½“ä¿¡æ¯,å¦‚æ—¶é•¿,åˆ›å»ºæ—¶é—´ç­‰ mvhdmovie header,æ–‡ä»¶çš„æ€»ä½“ä¿¡æ¯,å¦‚æ—¶é•¿,åˆ›å»ºæ—¶é—´ç­‰ traktrack or stream container,å­˜æ”¾è§†é¢‘/éŸ³é¢‘æµçš„å®¹å™¨ tkhdtrack header,trackçš„æ€»ä½“ä¿¡æ¯,å¦‚æ—¶é•¿,å®½é«˜ç­‰ mediatrak media information container mdhdmedia header,å®šä¹‰TimeScale,trakéœ€è¦é€šè¿‡TimeScaleè½¬æ¢æˆçœŸå®žæ—¶é—´ hdlrhandler,è¡¨æ˜Žæœ¬trakç±»åž‹,æŒ‡æ˜Žæ˜¯video/audio/è¿˜æ˜¯hint minfmedia information container,æ•°æ®åœ¨å­boxä¸­ stblsample table box,å­˜æ”¾æ—¶é—´/åç§»çš„æ˜ å°„å…³ç³»è¡¨,æ•°æ®åœ¨å­boxä¸­ stsdsample descriptions stts(decoding)time-to-sample,â€æ—¶æˆ³-sampleåºå·â€çš„æ˜ å°„è¡¨ stscsample-to-chunk,sampleå’Œchunkçš„æ˜ å°„è¡¨,è¿™é‡Œçš„ç®—æ³•æ¯”è¾ƒå·§å¦™ stszsample size,æ¯ä¸ªsampleçš„å¤§å° stz2sample size,å¦ä¸€ç§sample sizeçš„å­˜å‚¨ç®—æ³•,æ›´èŠ‚çœç©ºé—´ stsssync sample table,å¯éšæœºè®¿é—®çš„sampleåˆ—è¡¨(å…³é”®å¸§åˆ—è¡¨) stcochunk offset,æ¯ä¸ªchunkçš„åç§»,sampleçš„åç§»å¯æ ¹æ®å…¶ä»–boxæŽ¨ç®—å‡ºæ¥ co6464-bit chunk offset mdatmedia data container,å…·ä½“çš„åª’ä½“æ•°æ® Mdat Boxå¼•ç”¨ http://xhelmboyx.tripod.com/formats/mp4-layout.txt]]></content>
      <categories>
        <category>éŸ³è§†é¢‘å°è£…</category>
      </categories>
      <tags>
        <tag>å¤šåª’ä½“</tag>
        <tag>éŸ³è§†é¢‘</tag>
        <tag>format</tag>
      </tags>
  </entry>
</search>