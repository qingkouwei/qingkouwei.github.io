<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="老司机种菜" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="老司机种菜">
<meta property="og:url" content="http://wodekouwei.com/index.html">
<meta property="og:site_name" content="老司机种菜">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="老司机种菜">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wodekouwei.com/"/>





  <title> 老司机种菜 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2021aa5f03a4203621d42ef374e0d5f7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">老司机种菜</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/27/webrtc-sdp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/27/webrtc-sdp/" itemprop="url">
                  webrtc之sdp协议
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-27T22:47:44+08:00">
                2017-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webrtc/" itemprop="url" rel="index">
                    <span itemprop="name">webrtc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Session-Description-Protocol-会话描述协议"><a href="#Session-Description-Protocol-会话描述协议" class="headerlink" title="Session Description Protocol(会话描述协议)"></a>Session Description Protocol(会话描述协议)</h1><p>RFC定义SDP的协议有两个:</p>
<ul>
<li>RFC3264: An Offer/Answer Model with the session Description Protocol(SDP),用来概述一个请求/响应模型</li>
<li>RFC2327: SDP:Session Description Protocol,描述数据格式.<h2 id="1-RFC2327"><a href="#1-RFC2327" class="headerlink" title="1.RFC2327"></a>1.RFC2327</h2><h3 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1.概述"></a>1.1.概述</h3>SDP 完全是一种会话描述格式 ― 它不属于传输协议 ― 它只使用不同的适当的传输协议，包括会话通知协议（SAP）、会话初始协议（SIP）、实时流协议（RTSP）、MIME 扩展协议的电子邮件以及超文本传输协议（HTTP）。SDP协议是也是基于文本的协议，这样就能保证协议的可扩展性比较强，这样就使其具有广泛的应用范围。SDP 不支持会话内容或媒体编码的协商，所以在流媒体中只用来描述媒体信息。媒体协商这一块要用RTSP来实现．
SDP包括以下一些方面：</li>
<li>会话的名称和目的</li>
<li>会话存活时间</li>
<li>包含在会话中的媒体信息，包括：<ul>
<li>媒体类型(video, audio, etc)</li>
<li>传输协议(RTP/UDP/IP, H.320, etc)</li>
<li>媒体格式(H.261 video, MPEG video, etc)</li>
<li>多播或远端（单播）地址和端口</li>
</ul>
</li>
<li>为接收媒体而需的信息(addresses, ports, formats and so on)</li>
<li>使用的带宽信息</li>
<li>可信赖的接洽信息（Contact information）</li>
</ul>
<h3 id="1-2-SDP协议格式"><a href="#1-2-SDP协议格式" class="headerlink" title="1.2.SDP协议格式"></a>1.2.SDP协议格式</h3><p>SDP描述由许多文本行组成，文本行的格式为&lt;类型&gt;=&lt;值&gt;，&lt;类型&gt;是一个字母，&lt;值&gt;是结构化的文本串，其格式依&lt;类型&gt;而定。
＜type＞=<value>[CRLF]</value></p>
<h4 id="1-2-1-fields分类"><a href="#1-2-1-fields分类" class="headerlink" title="1.2.1.fields分类"></a>1.2.1.fields分类</h4><ol>
<li>Seeesion Description</li>
</ol>
<ul>
<li>v(Protocol Version),mnd,The current protocol version.Always “0” using RFC4566</li>
<li>o(Origin),Mnd,The session originator’s name and session identifiers.</li>
<li>s(Session Name), Mnd,The textural session Name</li>
<li>i(Session Information), opt,Textural information about the session</li>
<li>u(Uri),opt, A pointer to supplemental session Information</li>
<li>e(Email Address), opt, Email contract information for the person responsible.</li>
<li>P(phone Address),opt,Phone contract information for the person responsible</li>
<li>c(Connection Data),C,The connection type and Address</li>
<li>b(Bandwidth),opt,Proposed bandwidth limits.</li>
<li>z(Time Zones), opt, Accounts for daylight saving information</li>
<li>k(Encryption Keys),opt,A simple mechanism for exchanging keys, Rarely used.</li>
</ul>
<ol>
<li>Timing Description</li>
</ol>
<ul>
<li>t(Timing),mnd, start and end times.</li>
<li>r(Repeat Times),opt, Specified the duration and intervals for any session repeats.</li>
</ul>
<ol>
<li>Media Description</li>
</ol>
<ul>
<li>m(Media Description),mnd, Media definitions including media type(e.g.”audio”),transport details and formats.</li>
<li>i(Session Information),opt</li>
<li>c(Connection Data),c</li>
<li>b(Bandwidth):opt</li>
<li>k( Encryption keys),opt</li>
<li>a(Attributes),opt</li>
</ul>
<h4 id="1-2-2-典型格式"><a href="#1-2-2-典型格式" class="headerlink" title="1.2.2.典型格式"></a>1.2.2.典型格式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">Session description</div><div class="line">   v=  (protocol version)</div><div class="line">   o=  (owner/creator and session identifier)</div><div class="line">   s=  (session name)</div><div class="line">   i=* (session information)</div><div class="line">   u=* (URI of description)</div><div class="line">   e=* (email address)</div><div class="line">   p=* (phone number)</div><div class="line">   c=* (connection information - not required if included in all media)</div><div class="line">   b=* (zero or more bandwidth information lines)</div><div class="line">   One or more time descriptions (&quot;t=&quot; and &quot;r=&quot; lines, see below)</div><div class="line">   z=* (time zone adjustments)</div><div class="line">   k=* (encryption key)</div><div class="line">   a=* (zero or more session attribute lines)</div><div class="line">   Zero or more media descriptions</div><div class="line">Time description</div><div class="line">   t=  (time the session is active)</div><div class="line">   r=* (zero or more repeat times)</div><div class="line">Media description, if present</div><div class="line">   m=  (media name and transport address)</div><div class="line">   i=* (media title)</div><div class="line">   c=* (connection information - optional if included at</div><div class="line">        session-level)</div><div class="line">   b=* (zero or more bandwidth information lines)</div><div class="line">   k=* (encryption key)</div><div class="line">   a=* (zero or more media attribute lines)</div></pre></td></tr></table></figure>
<p>带<code>&quot;*&quot;</code>号的是可选的,其余的是必须的。一般顺序也按照上面的顺序来排列。</p>
<h4 id="1-2-3-各type对应值的结构化文本串"><a href="#1-2-3-各type对应值的结构化文本串" class="headerlink" title="1.2.3.各type对应值的结构化文本串"></a>1.2.3.各type对应值的结构化文本串</h4><ol>
<li>v=<username> <sess-id> <sess-version> <nettype> <addrtype> <unicast-address>
其中：nettype是IN,代表internet,addrtype是IP4或IP6。unicast-address任务创建计算机的地址。
整个这个属性，是唯一表示一个任务。</unicast-address></addrtype></nettype></sess-version></sess-id></username></li>
<li><code>e=123@126.com</code> <code>或 p=+1 616 555-6011</code>
对于一个任务只能两者之中的一个，表示会议控制者的联系方式。邮件地址可以是<code>[email]j.doe@example.com[/email] (Jane Doe)</code>形式，括号里面的是描述联系人的名称，或者<code>Jane Doe &lt;[email]j.doe@example.com[/email]&gt;</code>，前面的是联系人的名称。</li>
<li>c=<nettype> <addrtype> <connection-address>
这个连接数据，可以是传话级别的连接数据，或者是单独一个媒体数据的连接数据。在是多播时，connection-address就该是一个多播组地址，当是单播时，connection-address就该是一个单播地址。对于addrtype是IP4的情况下，connection-address不仅包含IP地址，并且还要包含a time to live value(TTL 0-255)，如：c=IN IP4 224.2.36.42/128，IP6没有这个TTL值。还允许象这样的<base multicast="" address="">[/<ttl>]/<number of="" addresses="">格式的connection-address。如：c=IN IP4 224.2.1.1/127/3等同于包含c=IN IP4 224.2.1.1/127, c=IN IP4 224.2.1.2/127, c=IN IP4 224.2.1.3/127三行内容。</number></ttl></connection-address></addrtype></nettype></li>
<li>b=<bwtype>:<bandwidth> bwtype可以是CT或AS，CT方式是设置整个会议的带宽，AS是设置单个会话的带宽。缺省带宽是千比特每秒。
t=<start-time> <stop-time>，这个可以有行，指定多个不规则时间段，如果是规则的时间段，则r=属性可以使用。start-time和stop- time都遵从NTP(Network Time Protocol),是以秒为单位，自从1900以来的时间。要转换为UNIX时间，减去2208988800。如果stop-time设置为0,则会话没有时间限制。如果start-time也设置为0，则会话被认为是永久的。</stop-time></start-time></bandwidth></bwtype></li>
<li>b=<bwtype>:<bandwidth> bwtype可以是CT或AS，CT方式是设置整个会议的带宽，AS是设置单个会话的带宽。缺省带宽是千比特每秒。
t=<start-time> <stop-time>，这个可以有行，指定多个不规则时间段，如果是规则的时间段，则r=属性可以使用。start-time和stop- time都遵从NTP(Network Time Protocol),是以秒为单位，自从1900以来的时间。要转换为UNIX时间，减去2208988800。如果stop-time设置为0,则会话没有时间限制。如果start-time也设置为0，则会话被认为是永久的。</stop-time></start-time></bandwidth></bwtype></li>
<li>r=<repeat-interval> <active duration=""> <offsets from="" start-time="">重复次数在时间表示里面可以如下表示：
   d - days (86400 seconds)
   h - hours (3600 seconds)
   m - minutes (60 seconds)
   s - seconds (allowed for completeness)</offsets></active></repeat-interval></li>
<li>z<code>=&lt;adjustment time&gt; &lt;offset&gt; &lt;adjustment time&gt; &lt;offset&gt; ....</code></li>
<li><code>k=&lt;method&gt;</code></li>
<li><code>k=&lt;method&gt;:&lt;encryption key&gt;</code></li>
<li><code>a=&lt;attribute&gt;</code></li>
<li><code>a=&lt;attribute&gt;:&lt;value&gt;</code></li>
<li><code>m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt&gt; ...</code></li>
<li><code>m=&lt;media&gt; &lt;port&gt;/&lt;number of ports&gt; &lt;proto&gt; &lt;fmt&gt; ...</code></li>
<li>a=cat:<category>分类，根据分类接收者隔离相应的会话</category></li>
<li>a=keywds:<keywords>关键字，根据关键字隔离相应的会话</keywords></li>
<li>a=tool:<name and="" version="" of="" tool="">创建任务描述的工具的名称及版本号</name></li>
<li>a=ptime:<packet time="">在一个包里面的以毫秒为单位的媒体长度</packet></li>
<li>a=maxptime:<maximum packet="" time="">以毫秒为单位，能够压缩进一个包的媒体量。</maximum></li>
<li>a=rtpmap:<payload type=""> <encoding name="">/<clock rate=""> [/<encoding parameters="">]</encoding></clock></encoding></payload></li>
<li>a=recvonly</li>
<li>a=sendrecv</li>
<li>a=sendonly</li>
<li>a=inactive，</li>
<li>a=orient:<orientation>其可能的值，”portrait”, “landscape” and “seascape” 。</orientation></li>
<li>a=type:<conference type="">,建议值是，”broadcast”, “meeting”, “moderated”, “test” and “H332”。</conference></li>
<li>a=charset:<character set=""></character></li>
<li>a=sdplang:<language tag="">指定会话或者是媒体级别使用的语言</language></li>
<li>a=framerate:<frame rate="">设置最大视频帧速率</li>
<li>a=quality:<quality>值是0-10</quality></li>
<li>a=fmtp:<format> <format specific="" parameters="">
在SIP协议的包含的内容是SDP时，应该把Content-Type设置成application/sdp。<h3 id="1-3-SDP协议例子"><a href="#1-3-SDP协议例子" class="headerlink" title="1.3.SDP协议例子"></a>1.3.SDP协议例子</h3><h4 id="1-3-1-helix流媒体服务器的RTSP协议中的SDP协议"><a href="#1-3-1-helix流媒体服务器的RTSP协议中的SDP协议" class="headerlink" title="1.3.1.helix流媒体服务器的RTSP协议中的SDP协议:"></a>1.3.1.helix流媒体服务器的RTSP协议中的SDP协议:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">v=0 //SDP version</div><div class="line">// o field定义的源的一些信息。其格式为：o=&lt;username&gt; &lt;sess-id&gt; &lt;sess-version&gt; &lt;nettype&gt; &lt;addrtype&gt; &lt;unicast-address&gt;</div><div class="line">o=- 1271659412 1271659412 IN IP4 10.56.136.37 s=&lt;No title&gt;</div><div class="line">i=&lt;No author&gt; &lt;No copyright&gt;  //session的信息</div><div class="line">c=IN IP4 0.0.0.0 //connect 的信息，分别描述了：网络协议，地址的类型，连接地址。</div><div class="line">c=IN IP4 0.0.0.0</div><div class="line">t=0 0 //时间信息，分别表示开始的时间和结束的时间，一般在流媒体的直播的时移中见的比较多。</div><div class="line">a=SdpplinVersion:1610641560 //描述性的信息</div><div class="line">a=StreamCount:integer;2 //用来描述媒体流的信息，表示有两个媒体流。integer表示信息的格式为整数。</div><div class="line">a=control:*</div><div class="line">a=DefaultLicenseValue:integer;0 //License信息</div><div class="line">a=FileType:string;&quot;MPEG4&quot; ////用来描述媒体流的信息说明当前协商的文件是mpeg4格式的文件</div><div class="line">a=LicenseKey:string;&quot;license.Summary.Datatypes.RealMPEG4.Enabled&quot;</div><div class="line">a=range:npt=0-72.080000  //用来表示媒体流的长度</div><div class="line">m=audio 0 RTP/AVP 96 //做为媒体描述信息的重要组成部分描述了媒体信息的详细内容：表示session的audio是通过RTP来格式传送的，其payload值为96传送的端口还没有定。</div><div class="line">b=as:24 //audio 的bitrate</div><div class="line">b=RR:1800</div><div class="line">b=RS:600</div><div class="line">a=control:streamid=1  //通过媒体流1来发送音频</div><div class="line">a=range:npt=0-72.080000 //说明媒体流的长度。</div><div class="line">a=length:npt=72.080000</div><div class="line">a=rtpmap:96 MPEG4-GENERIC/32000/2 //rtpmap的信息，表示音频为AAC的其sample为32000</div><div class="line">a=fmtp:96 profile-level-id=15;mode=AAC-hbr;sizelength=13;indexlength=3;indexdeltalength=3;config=1210 //config为AAC的详细格式信息</div><div class="line">a=mimetype:string;&quot;audio/MPEG4-GENERIC&quot;</div><div class="line">a=Helix-Adaptation-Support:1</div><div class="line">a=AvgBitRate:integer;48000</div><div class="line">a=HasOutOfOrderTS:integer;1</div><div class="line">a=MaxBitRate:integer;48000</div><div class="line">a=Preroll:integer;1000</div><div class="line">a=OpaqueData:buffer;&quot;A4CAgCIAAAAEgICAFEAVABgAAAC7gAAAu4AFgICAAhKIBoCAgAEC&quot;</div><div class="line">a=StreamName:string;&quot;Audio Track&quot;</div><div class="line">下面是video的信息基本和audio的信息相对称，这里就不再说了。</div><div class="line">m=video 0 RTP/AVP 97</div><div class="line">b=as:150</div><div class="line">b=RR:11250</div><div class="line">b=RS:3750</div><div class="line">a=control:streamid=2</div><div class="line">a=range:npt=0-72.080000</div><div class="line">a=length:npt=72.080000</div><div class="line">a=rtpmap:97 MP4V-ES/2500</div><div class="line">a=fmtp:97 profile-level-id=1;</div><div class="line">a=mimetype:string;&quot;video/MP4V-ES&quot;</div><div class="line">a=Helix-Adaptation-Support:1</div><div class="line">a=AvgBitRate:integer;300000</div><div class="line">a=HasOutOfOrderTS:integer;1</div><div class="line">a=Height:integer;240 //影片的长度</div><div class="line">a=MaxBitRate:integer;300000</div><div class="line">a=MaxPacketSize:integer;1400</div><div class="line">a=Preroll:integer;1000</div><div class="line">a=Width:integer;320  //影片的宽度</div><div class="line">a=OpaqueData:buffer;&quot;AzcAAB8ELyARAbd0AAST4AAEk+AFIAAAAbDzAAABtQ7gQMDPAAABAAAAASAAhED6KFAg8KIfBgEC&quot;</div><div class="line">a=StreamName:string;&quot;Video Track&quot;</div></pre></td></tr></table></figure>
</format></format></li>
</ol>
<h4 id="1-3-2-Webrtc-SDP示例"><a href="#1-3-2-Webrtc-SDP示例" class="headerlink" title="1.3.2.Webrtc SDP示例"></a>1.3.2.Webrtc SDP示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">v=0</div><div class="line">o=- 0 0 IN IP4 127.0.0.1</div><div class="line">s=WX-RTC-SERVER</div><div class="line">t=0 0</div><div class="line">a=group:BUNDLE audio video</div><div class="line">a=msid-semantic: WMS ryODEhTpFz</div><div class="line">m=audio 1 UDP/TLS/RTP/SAVPF 0 126</div><div class="line">c=IN IP4 0.0.0.0</div><div class="line">a=rtcp:1 IN IP4 0.0.0.0</div><div class="line">a=candidate:1 1 udp 2013266431 192.168.0.68 42739 typ host generation 0</div><div class="line">a=ice-ufrag:T+0c</div><div class="line">a=ice-pwd:FzV1T/5PiBI78s630cwSb6</div><div class="line">a=fingerprint:sha-256 2D:38:ED:09:73:36:F9:18:A6:CB:BC:ED:FB:C5:60:B3:F1:6C:FC:BD:97:57:AD:A6:38:11:9D:D4:8F:77:D6:C3</div><div class="line">a=setup:active</div><div class="line">a=recvonly</div><div class="line">a=extmap:1 urn:ietf:params:rtp-hdrext:ssrc-audio-level</div><div class="line">a=mid:audio</div><div class="line">a=rtcp-mux</div><div class="line">a=rtpmap:0 PCMU/8000</div><div class="line">a=rtpmap:126 telephone-event/8000</div><div class="line">m=video 1 UDP/TLS/RTP/SAVPF 124 125 96</div><div class="line">c=IN IP4 0.0.0.0</div><div class="line">a=rtcp:1 IN IP4 0.0.0.0</div><div class="line">a=candidate:1 1 udp 2013266431 192.168.0.68 42739 typ host generation 0</div><div class="line">a=ice-ufrag:T+0c</div><div class="line">a=ice-pwd:FzV1T/5PiBI78s630cwSb6</div><div class="line">a=extmap:2 urn:ietf:params:rtp-hdrext:toffset</div><div class="line">a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time</div><div class="line">a=extmap:4 urn:3gpp:video-orientation</div><div class="line">a=extmap:6 http://www.webrtc.org/experiments/rtp-hdrext/playout-delay</div><div class="line">a=fingerprint:sha-256 2D:38:ED:09:73:36:F9:18:A6:CB:BC:ED:FB:C5:60:B3:F1:6C:FC:BD:97:57:AD:A6:38:11:9D:D4:8F:77:D6:C3</div><div class="line">a=setup:active</div><div class="line">a=recvonly</div><div class="line">a=mid:video</div><div class="line">a=rtcp-mux</div><div class="line">a=rtpmap:124 H264/90000</div><div class="line">a=rtcp-fb:124 ccm fir</div><div class="line">a=rtcp-fb:124 nack</div><div class="line">a=rtcp-fb:124 nack pli</div><div class="line">a=rtcp-fb:124 goog-remb</div><div class="line">a=fmtp:124 x-google-max-bitrate=800;x-google-min-bitrate=150;x-google-start-bitrate=300</div><div class="line">a=rtpmap:125 H264/90000</div><div class="line">a=rtcp-fb:125 ccm fir</div><div class="line">a=rtcp-fb:125 nack</div><div class="line">a=rtcp-fb:125 nack pli</div><div class="line">a=rtcp-fb:125 goog-remb</div><div class="line">a=fmtp:125 x-google-max-bitrate=800;x-google-min-bitrate=150;x-google-start-bitrate=300</div><div class="line">a=rtpmap:96 VP8/90000</div><div class="line">a=rtcp-fb:96 ccm fir</div><div class="line">a=rtcp-fb:96 nack</div><div class="line">a=rtcp-fb:96 nack pli</div><div class="line">a=rtcp-fb:96 goog-remb</div></pre></td></tr></table></figure>
<h2 id="2-RFC3264"><a href="#2-RFC3264" class="headerlink" title="2.RFC3264"></a>2.RFC3264</h2><p>An Offer/Answer Model with the Session Description Protocol (SDP)</p>
<h3 id="2-1情态动词"><a href="#2-1情态动词" class="headerlink" title="2.1情态动词"></a>2.1情态动词</h3><p>定义在RFC2119:</p>
<ul>
<li>“MUST”，必须、一定要；</li>
<li>“MUST NOT”，禁止；</li>
<li>“REQUIRED”，需要；</li>
<li>“SHALL”、”SHOULD”，应该；</li>
<li>“SHALL NOT”、”SHOULD NOT”，不应该；</li>
<li>“RECOMMENDED”，推荐；</li>
<li>“MAY”，可以<h3 id="2-2术语"><a href="#2-2术语" class="headerlink" title="2.2术语"></a>2.2术语</h3></li>
<li>媒体流（Media Stream），或称为媒体类型（Media Type），即我们通常所说的音频流、视频流等，所有通信实体要进行媒体交互之前都必须进行媒体注的协商</li>
<li>媒体格式（Media Format），每种媒体流都有不同的编码格式，像音频有G711、G712编码，视频有H261、H264等，像现在所谓的高清视频采用是720P、1070P等。</li>
<li>单一会话（Unitcast Session）</li>
<li>多会话（Multicast Sessions）</li>
<li>单一媒体流（Unitcast Streams）</li>
<li>多媒体流（Multicast Streams）<h3 id="2-3offer-answer"><a href="#2-3offer-answer" class="headerlink" title="2.3offer/answer"></a>2.3offer/answer</h3>rfc3264协议[1]主要概述一个请求/响应模型（offer/answer，以下叙述采用英文），包括请求/响应的实体和不同阶段的操作行为，如初始协商过程和重协商过程，并简单介绍消息中各种参数的含义。具体各个参数的详细说明见rfc2327协议[2]<br><img src="http://images.wodekouwei.com/protocol/webrtc_sdp_3264.png" alt="SDP模型组网图"><h4 id="2-3-1-实体-消息"><a href="#2-3-1-实体-消息" class="headerlink" title="2.3.1.实体,消息"></a>2.3.1.实体,消息</h4>Offer/Answer模型包括两个实体，一个是请求主体Offerer，另外一个是响应实体Answerer，两个实体只是在逻辑上进行区分，在一定条件可以转换。例如，手机A发起媒体协商请求，那么A就是Offerer，反之如果A为接收请求则为Offerer。
Offerer发给Answerer的请求消息称为请求offer，内容包括媒体流类型、各个媒体流使用的编码集，以及将要用于接收媒体流的IP和端口。
Answerer收到offer之后，回复给Offerer的消息称为响应，内容包括要使用的媒体编码，是否接收该媒体流以及告诉Offerer其用于接收媒体流的IP和端口。<h4 id="2-3-2-SDP各个参数简单介绍"><a href="#2-3-2-SDP各个参数简单介绍" class="headerlink" title="2.3.2.SDP各个参数简单介绍"></a>2.3.2.SDP各个参数简单介绍</h4>下面示例摘自3264协议[1]</li>
<li>v=0</li>
<li>o=carol 28908764872 28908764872 IN IP4 100.3.6.6        //会话ID号和版本</li>
<li>s=-                                     //用于传递会话主题</li>
<li>t=0 0                                   //会话时间，一般由其它信令消息控制，因此填0</li>
<li>c=IN IP4 192.0.2.4              //描述本端将用于传输媒体流的IP</li>
<li>m=audio 0 RTP/AVP 0 1 3     //媒体类型 端口号 本端媒体使用的编码标识（Payload）集</li>
<li>a=rtpmap:0 PCMU/8000 //rtpmap映射表，各种编码详细描述参数，包括使用带宽（bandwidth）</li>
<li>a=rtpmap:1 1016/8000</li>
<li>a=rtpmap:3 GSM/8000</li>
<li>a=sendonly     //说明本端媒体流的方向，取值包括sendonly/recvonly/sendrecv/inactive</li>
<li>a=ptime:20                           //说明媒体流打包时长</li>
<li>m=video 0 RTP/AVP 31 34</li>
<li>a=rtpmap:31 H261/90000</li>
<li>a=rtpmap:34 H263/90000<h4 id="2-3-3-实体行为、操作过程"><a href="#2-3-3-实体行为、操作过程" class="headerlink" title="2.3.3.实体行为、操作过程"></a>2.3.3.实体行为、操作过程</h4><h5 id="2-3-3-1-初始协商的Offer请求"><a href="#2-3-3-1-初始协商的Offer请求" class="headerlink" title="2.3.3.1.初始协商的Offer请求"></a>2.3.3.1.初始协商的Offer请求</h5>实体A &lt;-&gt; 实体B，实体首先发起Offer请求，内容如2节所示，对于作何一个媒体流/媒体通道，这时实体A必须：</li>
</ul>
<ol>
<li>如果媒体流方向标为recvonly/sendrecv，即a=recvonly或a=sendrecv，则A必须（MUST）准备好在这个IP和端口上接收实体B发来的媒体流；</li>
<li>如果媒体流方向标为sendonly/inactive，即a=recvonly或a=sendrecv，则A不需要进行准备。<h5 id="2-3-3-1-Answer响应"><a href="#2-3-3-1-Answer响应" class="headerlink" title="2.3.3.1.Answer响应"></a>2.3.3.1.Answer响应</h5>实体B收到A的请求offer后，根据自身支持的媒体类型和编码策略，回复响应。</li>
<li>如果实体B回复的响应中的媒体流数量和顺序必须（MUST）和请求offer一致，以便实体A进行甄别和决策。即m行的数量和顺序必须一致，B不能（MUST NOT）擅自增加或删除媒体流。如果B不支持某个媒体流，可以在对应的端口置0，但不能不带这个m行描述。</li>
<li>对于某种媒体，实体B必须（MUST）从请求offer中选出A支持且自己也支持的该媒体的编码标识集，并且可以（MAY）附带自己支持的其它类型编码。</li>
<li>对于响应消息中各个媒体的方向：<ul>
<li>如果请求某媒体流的方向为sendonly，那么响应中对应媒体的方向必须为recvonly；</li>
<li>如果请求某媒体流的方向为recvonly，那么响应中对应媒体的方向必须为sendonly；</li>
<li>如果请求某媒体流的方向为sendrecv，那么响应中对应媒体的方向可以为sendrecv/sendonly/recvonly/inactive中的一种；</li>
<li>如果请求某媒体流的方向为inactive，那么响应中对应媒体的方向必须为inactive；</li>
</ul>
</li>
<li>响应answer里提供IP和端口，指示Offerer本端期望用于接收媒体流的IP和端口，一旦响应发出之后，Offerer必须（MUST）准备好在这个IP和端口上接收实体A发来的媒体流。</li>
<li>如果请求offer中带了ptime（媒体流打包间隔）的a行或带宽的a行，则响应answer也应该（SHOULD）相应的携带。</li>
<li>实体B Offerer应该（SHOULD）使用实体A比较期望的编码生成媒体流发送。一般来说对于m行，如m=video 0 RTP/AVP 31 34，排充越靠前的编码表示该实体越希望以这个编码作为载体，这里示例31(H261)，34（H263）中H261为A更期望使用的编码类型。同理，当实体A收到响应answer后也是这样理解的。<h5 id="2-3-3-2-实体收到响应后的处理"><a href="#2-3-3-2-实体收到响应后的处理" class="headerlink" title="2.3.3.2.实体收到响应后的处理"></a>2.3.3.2.实体收到响应后的处理</h5>当实体A收到B回复的响应后，可以（MAY）开始发送媒体流，如果媒体流方向为sendonly/sendrecv，</li>
<li>必须（MUST）使用answer列举的媒体类型/编码生成媒体发送；</li>
<li>应该（SHOULD）使用answer中的ptime和bandwidth来打包发送媒体流；</li>
<li>可以（MAY）立即停止监听端口，该端口为offer支持answer不支持的媒体所使用的端口。</li>
</ol>
<h4 id="2-3-4-修改媒体流（会话）"><a href="#2-3-4-修改媒体流（会话）" class="headerlink" title="2.3.4.修改媒体流（会话）"></a>2.3.4.修改媒体流（会话）</h4><p>修改媒体流的offer-answer操作必须基于之前协商的媒体形式（音频、视频等），不能（MUST NOT）对已有媒体流进行删减。</p>
<h5 id="2-3-4-1-删除媒体流"><a href="#2-3-4-1-删除媒体流" class="headerlink" title="2.3.4.1.删除媒体流"></a>2.3.4.1.删除媒体流</h5><p>如果实体认定新的会话不支持之前媒商的某个媒体，新的offer只须对这种媒体所在m行的端口置0，但不能不描述这种媒体，即不带对应m行。当answerer收到响应之后，处理同初始协商一样。</p>
<h5 id="2-3-4-2-增加媒体流"><a href="#2-3-4-2-增加媒体流" class="headerlink" title="2.3.4.2.增加媒体流"></a>2.3.4.2.增加媒体流</h5><p>如果实体打算新增媒体流，在offer里只须加上描述即可或者占用之前端口被置0的媒体流，即用新的媒体描述m行替换旧的。当answerer收到offer请求后，发现有新增媒体描述，或者过于端口被置0的媒体行被新的媒体描述替换，即知道当前为新增媒体流，处理同初始协商。</p>
<h5 id="2-3-4-3-修改媒体流"><a href="#2-3-4-3-修改媒体流" class="headerlink" title="2.3.4.3.修改媒体流"></a>2.3.4.3.修改媒体流</h5><p>修改媒体注主要是针对初始协商结果，如果有变更即进入修改流程处理，可能的变更包括IP地址、端口，媒体格式（编码），媒体类型（音、视频），媒体属性（ptime，bandwidth，媒体流方向变更等）。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/27/webrtc-introduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/27/webrtc-introduce/" itemprop="url">
                  webrtc之入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-27T22:16:53+08:00">
                2017-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webrtc/" itemprop="url" rel="index">
                    <span itemprop="name">webrtc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="webrtc-developers"><a href="#webrtc-developers" class="headerlink" title="webrtc developers"></a><a href="http://io13webrtc.appspot.com/#1" target="_blank" rel="external">webrtc developers</a></h2><h3 id="The-WebRTC-APIs"><a href="#The-WebRTC-APIs" class="headerlink" title="The WebRTC APIs"></a>The WebRTC APIs</h3><h4 id="Three-main-tasks"><a href="#Three-main-tasks" class="headerlink" title="Three main tasks"></a>Three main tasks</h4><ul>
<li>Acquiring audio and video</li>
<li>Communicating audio and video</li>
<li>Communicating arbitrary data</li>
</ul>
<h4 id="Three-main-JavaScript-APIs"><a href="#Three-main-JavaScript-APIs" class="headerlink" title="Three main JavaScript APIs"></a>Three main JavaScript APIs</h4><ul>
<li>MediaStream(aka getUserMedia)</li>
<li>RTCPeerConnection</li>
<li>RTCDataChannel</li>
</ul>
<h3 id="MediaStream"><a href="#MediaStream" class="headerlink" title="MediaStream"></a>MediaStream</h3><p>(Acquiring audio and video)</p>
<h4 id="MediaStream-1"><a href="#MediaStream-1" class="headerlink" title="MediaStream"></a>MediaStream</h4><ul>
<li>Pepresent a stream of audio and/or video</li>
<li>Can contain multiple ‘tracks’</li>
<li>Obtain a MediaStream with navigator.getUserMedia()</li>
</ul>
<h4 id="Constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints</h4><ul>
<li>Controls the contents of the MediaStream</li>
<li>Media type, resolution, frame rate<h3 id="RTCPeerConnection"><a href="#RTCPeerConnection" class="headerlink" title="RTCPeerConnection"></a>RTCPeerConnection</h3>(Audio and video communication between peers)<h4 id="RTCPeerConnection-does-a-lot"><a href="#RTCPeerConnection-does-a-lot" class="headerlink" title="RTCPeerConnection does a lot"></a>RTCPeerConnection does a lot</h4></li>
<li>Signal processing</li>
<li>Codec handling</li>
<li>Peer to peer communication</li>
<li>Security</li>
<li>Bandwidth management<h4 id="WebRTC-architecture"><a href="#WebRTC-architecture" class="headerlink" title="WebRTC architecture"></a>WebRTC architecture</h4><img src="http://images.wodekouwei.com/protocol/webrtc_Architecture.png" alt="image"></li>
</ul>
<h3 id="RTCDataChannel"><a href="#RTCDataChannel" class="headerlink" title="RTCDataChannel"></a>RTCDataChannel</h3><p>(Bidirectional communication of arbitrary data between peers)</p>
<h4 id="RTCDataChannel-1"><a href="#RTCDataChannel-1" class="headerlink" title="RTCDataChannel"></a>RTCDataChannel</h4><ul>
<li>Same API as WebSockets</li>
<li>Ultra-low latency</li>
<li>Unreliable or reliable</li>
<li>Secure</li>
</ul>
<h3 id="Servers-and-Protocols"><a href="#Servers-and-Protocols" class="headerlink" title="Servers and Protocols"></a>Servers and Protocols</h3><p>(Peer to peer — but we need servers :)</p>
<h4 id="Abstract-Signaling"><a href="#Abstract-Signaling" class="headerlink" title="Abstract Signaling"></a>Abstract Signaling</h4><ul>
<li>Need to exchange ‘session description’ objects:<ul>
<li>What formats I support, what I want to send</li>
<li>Network information for peer-to-peer setup</li>
</ul>
</li>
<li>Can use any messaging mechanism</li>
<li>Can use any messaging protocol
<img src="http://images.wodekouwei.com/protocol/webrtc_signaling_dragram.png" alt="image"></li>
</ul>
<h3 id="STUN-and-TRUN"><a href="#STUN-and-TRUN" class="headerlink" title="STUN and TRUN"></a>STUN and TRUN</h3><p>(P2P in the age of firewalls and NATs)</p>
<h4 id="An-ideal-world"><a href="#An-ideal-world" class="headerlink" title="An ideal world"></a>An ideal world</h4><p><img src="http://images.wodekouwei.com/protocol/webrtc_noSTUNorTURN.png" alt="image"></p>
<h4 id="The-real-world"><a href="#The-real-world" class="headerlink" title="The real world"></a>The real world</h4><p><img src="http://images.wodekouwei.com/protocol/webrtc_firewall.png" alt="image"></p>
<h4 id="STUN"><a href="#STUN" class="headerlink" title="STUN"></a>STUN</h4><ul>
<li>Tell me what my public IP address is</li>
<li>Simple server, cheap to run</li>
<li>Data flows peer-to-peer
<img src="http://images.wodekouwei.com/protocol/webrtc_stun.png" alt="image"></li>
</ul>
<h4 id="TURN"><a href="#TURN" class="headerlink" title="TURN"></a>TURN</h4><ul>
<li>Provide a cloud fallback if peer-to-peer communication fails</li>
<li>Data is sent through server, uses server bandwidth</li>
<li>Ensures the call works in almost all environments
<img src="http://images.wodekouwei.com/protocol/webrtc_STUNandTURN.png" alt="image"></li>
</ul>
<h4 id="ICE"><a href="#ICE" class="headerlink" title="ICE"></a>ICE</h4><ul>
<li>ICE: a framework for connecting peers</li>
<li>Tries to find the best path for each call</li>
<li>Vast majority of calls can use STUN (webrtcstats.com):</li>
</ul>
<h4 id="Deploying-STUN-TURN"><a href="#Deploying-STUN-TURN" class="headerlink" title="Deploying STUN/TURN"></a>Deploying STUN/TURN</h4><ul>
<li>stun.l.google.com:19302</li>
<li>WebRTC stunserver, turnserver</li>
<li>rfc5766-turn-server</li>
<li>restund</li>
</ul>
<h3 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h3><h4 id="Security-throughout-WebRTC"><a href="#Security-throughout-WebRTC" class="headerlink" title="Security throughout WebRTC"></a>Security throughout WebRTC</h4><ul>
<li>Mandatory encryption for media and data</li>
<li>Secure UI, explicit opt-in</li>
<li>Sandboxed, no plugins</li>
<li><a href="http://www.ietf.org/proceedings/82/slides/rtcweb-13.pdf" target="_blank" rel="external">WebRTC Security Architecture</a></li>
</ul>
<h3 id="Architectures"><a href="#Architectures" class="headerlink" title="Architectures"></a>Architectures</h3><h4 id="Peer-to-Peer-one-to-one-call"><a href="#Peer-to-Peer-one-to-one-call" class="headerlink" title="Peer to Peer : one-to-one call"></a>Peer to Peer : one-to-one call</h4><p>clientA &lt;——–&gt; clientB</p>
<h4 id="Mesh-small-N-way-call"><a href="#Mesh-small-N-way-call" class="headerlink" title="Mesh: small N-way call"></a>Mesh: small N-way call</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">clientA &lt;-------------&gt; clientB</div><div class="line">  /|\  \               /   /|\</div><div class="line">   |       \    /           |</div><div class="line">   |      /       \         |</div><div class="line">  \|/   /                  \|/</div><div class="line">clientC &lt;--------------&gt; clientD</div></pre></td></tr></table></figure>
<h4 id="Star-medium-N-way-call"><a href="#Star-medium-N-way-call" class="headerlink" title="Star: medium N-way call"></a>Star: medium N-way call</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">clientA &lt;---------&gt; clientB</div><div class="line">clientA &lt;---------&gt; clientC</div><div class="line">clientA &lt;---------&gt; clientD</div></pre></td></tr></table></figure>
<h4 id="MCU-large-N-way-call"><a href="#MCU-large-N-way-call" class="headerlink" title="MCU: large N-way call"></a>MCU: large N-way call</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MCU &lt;--------------&gt;clientA</div><div class="line">MCU &lt;--------------&gt;clientB</div><div class="line">MCU &lt;--------------&gt;clientC</div><div class="line">MCU &lt;--------------&gt;clientD</div><div class="line">MCU &lt;--------------&gt;clientE</div><div class="line">MCU &lt;--------------&gt;clientF</div><div class="line">MCU &lt;--------------&gt;clientG</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/27/webrtc-gclient/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/27/webrtc-gclient/" itemprop="url">
                  webrtc之源码管理工具gclient
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-27T21:33:14+08:00">
                2017-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webrtc/" itemprop="url" rel="index">
                    <span itemprop="name">webrtc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>google的chromium项目是用gclient来管理源码的checkout, update等。 gclient是google专门为这种多源项目编写的脚本，它可以将多个源码管理系统中的代码放在一起管理。甚至包括将Git和svn代码放在一起。</p>
<p>webrtc也是使用gclient管理代码.</p>
<p>gclient的sync，update等命令密切相关的两类文件.gclient和DEPS。</p>
<p>.gclient文件是gclient的控制文件，该文件放在工作目录的最上层(webrtc环境下与src统计目录)。”.gclient”文件是一个Python的脚本，定义了一组”solutions”，格式类似如下
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">solutions = [  </div><div class="line">  &#123; &quot;name&quot;        : &quot;src&quot;,  </div><div class="line">    &quot;url&quot;         : &quot;svn://svnserver/component/trunk/src&quot;,  </div><div class="line">    &quot;custom_deps&quot; : &#123;  </div><div class="line">      # To use the trunk of a component instead of what&apos;s in DEPS:  </div><div class="line">      #&quot;component&quot;: &quot;https://svnserver/component/trunk/&quot;,  </div><div class="line">      # To exclude a component from your working copy:  </div><div class="line">      #&quot;data/really_large_component&quot;: None,  </div><div class="line">    &#125;  </div><div class="line">  &#125;,  </div><div class="line">]</div></pre></td></tr></table></figure></p>
<ul>
<li>name:checkout出源码的名字</li>
<li>url:源码所在的目录,gclient希望checkout出的源码中包括一个DEPS的文件,这个文件包含了必须checkout到工作目录的源码信息;</li>
<li>deps_file:这是一个文件名(不包括路径),指在工程目录中包含依赖列表的文件,该项可选,默认值为”DEPS”</li>
<li><p>custom_deps:这是一个可选的字典对象,会覆盖工程的”DEPS”文件定义的条目.一般它用作本地目录中,那些不用checkout的代码,或者让本地目录从不同位置checkout一个新的代码出来,或者checkout不同的分支,版本等.也可以用于增加在DEPS中不存在的新的项目.如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&quot;custom_deps&quot;: &#123;  </div><div class="line">  &quot;src/content/test/data/layout_tests/LayoutTests&quot;: None,  </div><div class="line">  &quot;src/chrome/tools/test/reference_build/chrome_win&quot;: None,  </div><div class="line">  &quot;src/chrome_frame/tools/test/reference_build/chrome_win&quot;: None,  </div><div class="line">  &quot;src/chrome/tools/test/reference_build/chrome_linux&quot;: None,  </div><div class="line">  &quot;src/chrome/tools/test/reference_build/chrome_mac&quot;: None,  </div><div class="line">  &quot;src/third_party/hunspell_dictionaries&quot;: None,  </div><div class="line">&#125;,</div></pre></td></tr></table></figure>
</li>
<li><p>target_os:这个可选的条目可以指出特殊的平台,根据平台类checkout出不同代码,如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">target_os = [&apos;android&apos;]</div></pre></td></tr></table></figure>
</li>
</ul>
<p>如果target_os_only值为True的话,那么,仅仅checkout出对应的代码,如:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">target_os = [ &quot;ios&quot; ]  </div><div class="line">target_os_only = True</div></pre></td></tr></table></figure></p>
<p>在每个checkout出的工程中，gclient期望发现一个DEPS文件（由deps_file来给定），它定义了工程不同部分都是如何checkout出来。
“DEPS”也是一个python脚本，最简单的，如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">deps = &#123;  </div><div class="line">  &quot;src/outside&quot; : &quot;http://outside-server/trunk@1234&quot;,  </div><div class="line">  &quot;src/component&quot; : &quot;svn://svnserver/component/trunk/src@77829&quot;,  </div><div class="line">  &quot;src/relative&quot; : &quot;/trunk/src@77829&quot;,  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>deps的每个条目都包含一个key-value对，key是被checkout的本地目录，而value就是对应的远程URL。如果路径是以’/‘开头的，那么它是一个相对URL，相对与.gclient中URL地址。</p>
<p>URL通常包含一个版本号，以便锁定源码在特定版本上。当然，这是可选的。如果没有，那么它将获取指定分支上最新的版本。</p>
<p>DEPS还可以包含其他类型的数据，如vars,
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">vars = &#123;</div><div class="line">  &apos;pymox&apos;:</div><div class="line">    &apos;http://pymox.googlecode.com/svn&apos;,</div><div class="line">  &apos;sfntly&apos;:</div><div class="line">    &apos;http://sfntly.googlecode.com/svn&apos;,</div><div class="line">  &apos;eyes-free&apos;:</div><div class="line">    &apos;http://eyes-free.googlecode.com/svn&apos;,</div><div class="line">  &apos;rlz&apos;:</div><div class="line">    &apos;http://rlz.googlecode.com/svn&apos;,</div><div class="line">  &apos;smhasher&apos;:</div><div class="line">    &apos;http://smhasher.googlecode.com/svn&apos;,</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>vars定义了一组变量，在后面，可以通过Var(xxx)来访问。Var(xxx)返回一个字符串，故此，也可以进行操作，如
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">  &apos;src/third_party/cros_dbus_cplusplus/source&apos;:</div><div class="line">  Var(&quot;git.chromium.org&quot;) + &apos;/chromiumos/third_party/dbus-cplusplus.git@5e8f6d9db5c2abfb91d91f751184f25bb5cd0900&apos;,</div><div class="line">&apos;src/third_party/WebKit&apos;:</div><div class="line">  Var(&quot;webkit_trunk&quot;)[:-6] + &apos;/branches/chromium/1548@153044&apos;,</div></pre></td></tr></table></figure></p>
<p>第二个自立，Var(“webkit_trunk”)[:-6]是一个python表达式，表示取得”webkit_trunk”表示的字符串的最后6个
Hooks：DEPS包含可选的内容 hooks，也有重要的作用，它表示在sync, update或者recert后，执行一个hook操作。
如果使用 –nohooks选项（hook默认执行），那么在gclient sync或者其他操作后，不会执行hook。你可以通过gclient runhooks来单独执行； 如果有 gclient sync –force，那么，无论sync是否成功，都会执行hook。
hook在DEPS中的写法，一般是：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">hooks = [</div><div class="line">  &#123; &quot;pattern&quot;: &quot;\\.(gif|jpe?g|pr0n|png)$&quot;,</div><div class="line">    &quot;action&quot;:  [&quot;python&quot;, &quot;image_indexer.py&quot;, &quot;--all&quot;]&#125;,</div><div class="line">  &#123; &quot;pattern&quot;: &quot;.&quot;,</div><div class="line">    &quot;name&quot;: &quot;gyp&quot;,</div><div class="line">    &quot;action&quot;:  [&quot;python&quot;, &quot;src/build/gyp_chromium&quot;]&#125;,</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>hooks包含一组hook，每个hook有几个重要项:</p>
<ul>
<li>pattern 是一个正则表达式，用来匹配工程目录下的文件，一旦匹配成功，action项就会执行</li>
<li>action 描述一个根据特定参数运行的命令行。这个命令在每次gclient时，无论多少文件匹配，至多运行一次。这个命令和.gclient在同一目录下运行。如果第一个参数是”python”，那么，当前的python解释器将被使用。如果包含字符串 “$matching_files”，它将该字符串扩展为匹配出的文件列表。</li>
<li>name 可选，标记出hook所属的组，可以被用来覆盖和重新组织。</li>
</ul>
<p>deps_os： DEPS中定义不同平台依赖关系的项目，如
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">deps_os = &#123;</div><div class="line">  &quot;win&quot;: &#123;</div><div class="line">    &quot;src/chrome/tools/test/reference_build/chrome_win&quot;:</div><div class="line">      &quot;/trunk/deps/reference_builds/chrome_win@197743&quot;,</div><div class="line"></div><div class="line">    &quot;src/third_party/cygwin&quot;:</div><div class="line">      &quot;/trunk/deps/third_party/cygwin@133786&quot;,</div><div class="line"></div><div class="line">.....</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  &quot;ios&quot;: &#123;</div><div class="line">    &quot;src/third_party/GTM&quot;:</div><div class="line">      (Var(&quot;googlecode_url&quot;) % &quot;google-toolbox-for-mac&quot;) + &quot;/trunk@&quot; +</div><div class="line">      Var(&quot;gtm_revision&quot;),</div><div class="line"></div><div class="line">    &quot;src/third_party/nss&quot;:</div><div class="line">      &quot;/trunk/deps/third_party/nss@&quot; + Var(&quot;nss_revision&quot;),</div><div class="line">....</div><div class="line">   &#125;,</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>deps_os指定不同平台的依赖，它可以包含多种平台，和.gclient中的target_os对应。这种对应关系如下：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">DEPS_OS_CHOICES = &#123;</div><div class="line">  &quot;win32&quot;: &quot;win&quot;,</div><div class="line">  &quot;win&quot;: &quot;win&quot;,</div><div class="line">  &quot;cygwin&quot;: &quot;win&quot;,</div><div class="line">  &quot;darwin&quot;: &quot;mac&quot;,</div><div class="line">  &quot;mac&quot;: &quot;mac&quot;,</div><div class="line">  &quot;unix&quot;: &quot;unix&quot;,</div><div class="line">  &quot;linux&quot;: &quot;unix&quot;,</div><div class="line">  &quot;linux2&quot;: &quot;unix&quot;,</div><div class="line">  &quot;linux3&quot;: &quot;unix&quot;,</div><div class="line">  &quot;android&quot;: &quot;android&quot;,</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/27/webrtc-signalling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/27/webrtc-signalling/" itemprop="url">
                  webrtc之信令交互流程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-27T14:47:28+08:00">
                2017-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/webrtc/" itemprop="url" rel="index">
                    <span itemprop="name">webrtc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>无论是使用前端JS的WebRTC API接口，还是在WebRTC源码上构建自己的对聊框架，都需要遵循以下执行流程：
<img src="http://images.wodekouwei.com/protocol/webrtc_signalling.png" alt="image"></p>
<p>上述序列中，WebRTC并不提供Stun服务器和Signal服务器，服务器端需要自己实现。Stun服务器可以用google提供的实现stun协议的测试服务器（stun:stun.l.google.com:19302），Signal服务器则完全需要自己实现了，它需要在ClientA和ClientB之间传送彼此的SDP信息和candidate信息，ClientA和ClientB通过这些信息建立P2P连接来传送音视频数据。 stun/turn、relay服务器的实现在WebRTC源码中都有示例。</p>
<p>上述序列中，标注的场景是ClientA向ClientB发起对聊请求，调用描述如下：</p>
<ol>
<li>ClientA首先创建PeerConnection对象，然后打开本地音视频设备，将音视频数据封装成MediaStream添加到PeerConnection中。</li>
<li>ClientA调用PeerConnection的CreateOffer方法创建一个用于offer的SDP对象，SDP对象中保存当前音视频的相关参数。ClientA通过PeerConnection的SetLocalDescription方法将该SDP对象保存起来，并通过Signal服务器发送给ClientB。</li>
<li>ClientB接收到ClientA发送过的offer SDP对象，通过PeerConnection的SetRemoteDescription方法将其保存起来，并调用PeerConnection的CreateAnswer方法创建一个应答的SDP对象，通过PeerConnection的SetLocalDescription的方法保存该应答SDP对象并将它通过Signal服务器发送给ClientA。</li>
<li>ClientA接收到ClientB发送过来的应答SDP对象，将其通过PeerConnection的SetRemoteDescription方法保存起来。</li>
<li>在SDP信息的offer/answer流程中，ClientA和ClientB已经根据SDP信息创建好相应的音频Channel和视频Channel并开启Candidate数据的收集，Candidate数据可以简单地理解成Client端的IP地址信息（本地IP地址、公网IP地址、Relay服务端分配的地址）。</li>
<li>当ClientA收集到Candidate信息后，PeerConnection会通过OnIceCandidate接口给ClientA发送通知，ClientA将收到的Candidate信息通过Signal服务器发送给ClientB，ClientB通过PeerConnection的AddIceCandidate方法保存起来。同样的操作ClientB对ClientA再来一次。</li>
<li>这样ClientA和ClientB就已经建立了音视频传输的P2P通道，ClientB接收到ClientA传送过来的音视频流，会通过PeerConnection的OnAddStream回调接口返回一个标识ClientA端音视频流的MediaStream对象，在ClientB端渲染出来即可。同样操作也适应ClientB到ClientA的音视频流的传输。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/25/server-git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/25/server-git/" itemprop="url">
                  git服务搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-25T16:36:53+08:00">
                2017-04-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="纯git-server"><a href="#纯git-server" class="headerlink" title="纯git server"></a>纯git server</h3><h4 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h4><p>环境:ubuntu16.0.4</p>
<ol>
<li>安装Git-Core:<code>sudo apt-get install python-setuptools</code></li>
<li>安装openssh-server和openssh-client:<code>sudo apt-get install openssh-server openssh-client</code></li>
<li>安装python tool:<code>sudo apt-get install python-setuptools</code></li>
<li>安装gitosis:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/res0nat0r/gitosis.git</div><div class="line"></div><div class="line">cd gitosis/</div><div class="line"></div><div class="line">sudo python setup.py install</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="添加管理账号"><a href="#添加管理账号" class="headerlink" title="添加管理账号"></a>添加管理账号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sudo adduser \</div><div class="line">    --system \</div><div class="line">    --shell /bin/sh \</div><div class="line">    --gecos &apos;git version control&apos; \</div><div class="line">    --group \</div><div class="line">    --disabled-password \</div><div class="line">    --home /home/git \</div><div class="line">    git</div></pre></td></tr></table></figure>
<p>如果已有git账户,可以替换成gitmanager</p>
<h4 id="创建链接映射"><a href="#创建链接映射" class="headerlink" title="创建链接映射"></a>创建链接映射</h4><p>由于gitosis默认状态下会将仓库放在用户的repositories目录下，例如gitmanager用户的仓库地址默认在
/home/gitmanager/repositories/目录下，这里我们需要创建一个链接映射。让他指向我们前面创建的专门用于存放项目的仓库目录/home/gitrepository。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ln -s /home/gitrepository /home/gitmanager/repositories</div></pre></td></tr></table></figure></p>
<h4 id="初始化管理用户"><a href="#初始化管理用户" class="headerlink" title="初始化管理用户"></a>初始化管理用户</h4><ol>
<li><p>拷贝管理用户公钥到<code>/tmp/</code>下,如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp ~/.ssh/id_rsa.pub gitmanager@192.168.0.68:/tmp/</div></pre></td></tr></table></figure>
</li>
<li><p>使用拷贝来的公钥初始化gitosis:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo -H -u gitmanager gitosis-init &lt; /tmp/id_ras.pub</div><div class="line">sudo chmod 755 /home/gitmanager/repositories/gitosis-admin.git/hooks/post-update</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="配置账号"><a href="#配置账号" class="headerlink" title="配置账号"></a>配置账号</h4><ol>
<li>验证ssh<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh gitmanager@192.168.0.68</div><div class="line">TY allocation request failed on channel 0</div><div class="line">ERROR:gitosis.serve.main:Need SSH_ORIGINAL_COMMAND in environment.</div><div class="line">  Connection to gitserver closed.</div></pre></td></tr></table></figure>
</li>
</ol>
<p>说明 Gitosis 认出了该用户的身份，但由于没有运行任何 Git 命令，所以它切断了连接。</p>
<ol>
<li>克隆gitosis管理仓库:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone gitmanager@192.168.0.68:gitosis-admin.git</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这会得到一个名为 gitosis-admin 的工作目录，主要由两部分组成：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">./gitosis.conf</div><div class="line">./keydir</div></pre></td></tr></table></figure></p>
<p>gitosis.conf 文件是用来设置用户、仓库和权限的控制文件。keydir 目录则是保存所有具有访问权限用户公钥的地方— 每人一个。在 keydir 里的文件名（比如上面的 qingkouwei.pub） 会自动从使用 gitosis-init 脚本导入的公钥尾部的描述中获取该名字。</p>
<p>看一下 gitosis.conf 文件的内容，它应该只包含与刚刚克隆的 gitosis-admin 相关的信息：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[gitosis]</div><div class="line"></div><div class="line">[group gitosis-admin]</div><div class="line">members = qingkouwei</div><div class="line">writable = gitosis-admin</div></pre></td></tr></table></figure></p>
<p>要创建项目demo,在里面加入:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[group demo]</div><div class="line">members = qingkouwei</div><div class="line">writable = demo</div></pre></td></tr></table></figure></p>
<p>要为demo项目添加用户user1:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[group demo]</div><div class="line">members = qingkouwei user1</div><div class="line">writable = demo</div></pre></td></tr></table></figure></p>
<p>并将用户user1的公钥计入到keydir,并且公钥名.pub和members里面的名字对应.
要添加对demo项目只读的用户:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[group demo]</div><div class="line">members = qingkouwei user1</div><div class="line">writable = demo</div><div class="line"></div><div class="line">[group demo]</div><div class="line">members = user2</div><div class="line">readonly = demo</div></pre></td></tr></table></figure></p>
<p>修改完配置文件和keydir,使用git push到gitosis-admin服务器.即可直接<code>git add remote add suervename gitmanager@192.168.0.68:demo.git</code>,然后直接将本地目录推送到demo仓库,不需要再服务器手动创建demo仓库,gitosis会帮忙自动创建.</p>
<h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><ol>
<li><code>ERROR:gitosis.serve.main:Repository read access denied</code>
原因:
gitosis.conf中的members与keydir中的用户名不一致，如gitosis中的members = foo@bar，但keydir中的公密名却叫foo.pub</li>
</ol>
<p>解决方法:
使keydir的名称与gitosis中members所指的名称一致。 改为members = foo 或 公密名称改为foo@bar.pub</p>
<ol>
<li>clone时报does not appear to be a git repository</li>
</ol>
<p>原因:
clone时不能用绝对路径，直接写gitosis-admin.git即可.</p>
<blockquote>
<p>参考:<a href="https://git-scm.com/book/zh/v1/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-Gitosis" target="_blank" rel="external">https://git-scm.com/book/zh/v1/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84-Git-Gitosis</a></p>
</blockquote>
<h3 id="gitlab服务搭建"><a href="#gitlab服务搭建" class="headerlink" title="gitlab服务搭建"></a>gitlab服务搭建</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/22/vmware-network-mode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/22/vmware-network-mode/" itemprop="url">
                  VMware中Bridged,NAT,host-only三种网络连接模式的原理和区别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-22T18:08:51+08:00">
                2017-04-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux管理/" itemprop="url" rel="index">
                    <span itemprop="name">linux管理</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>不同虚拟交换机应用在不同的联网模式Bridged、NAT、host-only、custom四种模式，下面分别介绍其具体分配：</p>
<ul>
<li>VMnet0：这是VMware用于虚拟桥接网络下的虚拟交换机；</li>
<li>VMnet1：这是VMware用于虚拟Host-Only网络下的虚拟交换机；</li>
<li>VMnet8：这是VMware用于虚拟NAT网络下的虚拟交换机；</li>
<li>VMnet2~VMnet7及VMnet9：是VMware用于虚拟自定义custom网络下的虚拟交换机；</li>
<li>VMware Network Adapter VMnet1：这是宿主机用于与Host-Only虚拟网络进行通信的宿主机使用的虚拟网卡；</li>
<li>VMware Network Adapter VMnet8：这是宿主机用于与NAT虚拟网络进行通信的宿主机使用的虚拟网卡；</li>
</ul>
<p>VMware Network Adapter VMnet1与VMware Network Adapter VMnet8可以在宿主机网络连接中看到.</p>
<h3 id="1-Bridged桥接模式"><a href="#1-Bridged桥接模式" class="headerlink" title="1.Bridged桥接模式"></a>1.Bridged桥接模式</h3><p>VMware在桥接模式下，虚拟机使用VMware为该虚拟机分配的虚拟网卡，宿主机使用自身的物理网卡（有线或无线都行），并且默认使用虚拟交换机VMnet0来连接虚拟机的虚拟网卡和宿主机的物理网卡。在此模式下没有局域网动态地址分配DHCP服务器，也没有网络地址转换ＮＡＴ服务器，虚拟交换机没有连接DHCP服务器和ＮＡＴ服务器。宿主机的网口（插网线的那个口）与宿主机物理网卡相连，同时也就和虚拟机的虚拟网卡相连，也就是和虚拟交换机相连，所以虚拟机相当于在宿主机所在局域网内的一个单独的主机，他的行为和宿主机是同等地位的，没有依存关系。所有桥接下的网卡与网卡都是交换模式的，相互可以访问而不干扰。在桥接模式下，虚拟机ip地址需要与主机在同一个网段，如果需要联网，则网关与DNS需要与主机网卡一致原理图如下：
<img src="http://images.wodekouwei.com/net/vmware_netmode_bridged.jpeg" alt="bridged">
配置虚拟机网卡,编辑<code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">DEVICE=eth0</div><div class="line">HWADDR=00:0C:29:DA:E9:99</div><div class="line">TYPE=Ethernet</div><div class="line">UUID=0711466f-ae1f-aa83-825cb3dfb5f7</div><div class="line">ONBOOT=yes</div><div class="line">MM_CONTROLLED=yes</div><div class="line">BOOTPROTO=none</div><div class="line">IPADDR=192.168.31.128 #设置虚拟机ip地址,与主机ip地址在同一网段</div><div class="line">NETMASK=255.255.255.0 #设置子网掩码</div><div class="line">GATEWAY=192.168.31.1#设置虚拟网关,与主机相同</div><div class="line">DNS1=192.168.31.1 #设置虚拟机DNS,与主机相同</div></pre></td></tr></table></figure></p>
<p>执行<code>/etc/init.d/network restart</code>重启虚拟机网卡,ping内网与外网测试.</p>
<h3 id="2-NAT网络地址转换模式："><a href="#2-NAT网络地址转换模式：" class="headerlink" title="2.NAT网络地址转换模式："></a>2.NAT网络地址转换模式：</h3><p><img src="http://images.wodekouwei.com/net/vmware_netmode_nat.png" alt="nat">
注意：红色的方框是nat服务器，nat服务器有两个网卡一个是虚拟内网网卡，一个是宿主机的物理网卡。禁用VmNet8，虚拟机仍然可以上网，ping通主机，但是主机ping不通虚拟机的网卡。在NAT模式中，主机网卡直接与虚拟NAT设备相连，然后虚拟NAT设备与虚拟DHCP服务器一起连接在虚拟交换机VMnet8上，这样就实现了虚拟机联网。那么我们会觉得很奇怪，为什么需要虚拟网卡VMware Network Adapter VMnet8呢？原来我们的VMware Network Adapter VMnet8虚拟网卡主要是为了实现主机与虚拟机之间的通信。弥补了NAT协议中外网不能访问局域网的缺点。
具体配置:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">DEVICE=eth0</div><div class="line">HWADDR=00:0C:29:DA:E9:99</div><div class="line">TYPE=Ethernet</div><div class="line">UUID=0711466f-ae1f-aa83-825cb3dfb5f7</div><div class="line">ONBOOT=yes</div><div class="line">MM_CONTROLLED=yes</div><div class="line">BOOTPROTO=dhcp #动态获取ip地址,如果此处设置为静态,则下面手动配置ip需要在DHCP地址范围内</div><div class="line">#NAT模式也可以设置静态ip,但需要在DHCP地址范围内</div><div class="line">IPADDR=192.168.31.128</div><div class="line">NETMASK=255.255.255.0</div><div class="line">GATEWAY=192.168.31.1</div><div class="line">DNS1=192.168.31.1</div></pre></td></tr></table></figure></p>
<h3 id="3-Host-Only方式"><a href="#3-Host-Only方式" class="headerlink" title="3.Host-Only方式"></a>3.Host-Only方式</h3><p><img src="http://images.wodekouwei.com/net/vmware_netmode_hostonly.png" alt="host-only">
注意：上图中的VmNet8应该为VmNet1。其实跟nat模式的图片是类似的，只是少了nat服务。
所以host-only上不了外网，只能实现主机的VmNet1网卡和虚拟机的虚拟网卡通信。</p>
<h3 id="NAT介绍"><a href="#NAT介绍" class="headerlink" title="NAT介绍"></a>NAT介绍</h3><p>NAT（Network Address Translation，网络地址转换）是1994年提出的。当在专用网内部的一些主机本来已经分配到了本地IP地址（即仅在本专用网内使用的专用地址），但现在又想和因特网上的主机通信（并不需要加密）时，可使用NAT方法。
这种方法需要在专用网连接到因特网的路由器上安装NAT软件。装有NAT软件的路由器叫做NAT路由器，它至少有一个有效的外部全球IP地址。这样，所有使用本地地址的主机在和外界通信时，都要在NAT路由器上将其本地地址转换成全球IP地址，才能和因特网连接。
另外，这种通过使用少量的公有IP 地址代表较多的私有IP 地址的方式，将有助于减缓可用的IP地址空间的枯竭。</p>
<h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><p>NAT不仅能解决了lP地址不足的问题，而且还能够有效地避免来自网络外部的攻击，隐藏并保护网络内部的计算机。</p>
<ol>
<li>宽带分享：这是 NAT 主机的最大功能。</li>
<li>安全防护：NAT 之内的 PC 联机到 Internet 上面时，他所显示的 IP 是 NAT 主机的公共 IP，所以 Client 端的 PC 当然就具有一定程度的安全了，外界在进行 portscan（端口扫描） 的时候，就侦测不到源Client 端的 PC 。</li>
</ol>
<h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4><p>NAT的实现方式有三种，即静态转换Static Nat、动态转换Dynamic Nat和端口多路复用OverLoad。</p>
<ol>
<li>静态转换是指将内部网络的私有IP地址转换为公有IP地址，IP地址对是一对一的，是一成不变的，某个私有IP地址只转换为某个公有IP地址。借助于静态转换，可以实现外部网络对内部网络中某些特定设备（如服务器）的访问。</li>
<li>动态转换是指将内部网络的私有IP地址转换为公用IP地址时，IP地址是不确定的，是随机的，所有被授权访问上Internet的私有IP地址可随机转换为任何指定的合法IP地址。也就是说，只要指定哪些内部地址可以进行转换，以及用哪些合法地址作为外部地址时，就可以进行动态转换。动态转换可以使用多个合法外部地址集。当ISP提供的合法IP地址略少于网络内部的计算机数量时。可以采用动态转换的方式。</li>
<li>端口多路复用（Port address Translation,PAT)是指改变外出数据包的源端口并进行端口转换，即端口地址转换（PAT，Port Address Translation).采用端口多路复用方式。内部网络的所有主机均可共享一个合法外部IP地址实现对Internet的访问，从而可以最大限度地节约IP地址资源。同时，又可隐藏网络内部的所有主机，有效避免来自internet的攻击。因此，目前网络中应用最多的就是端口多路复用方式。</li>
<li>ALG（Application Level Gateway），即应用程序级网关技术：传统的NAT技术只对IP层和传输层头部进行转换处理，但是一些应用层协议，在协议数据报文中包含了地址信息。为了使得这些应用也能透明地完成NAT转换，NAT使用一种称作ALG的技术，它能对这些应用程序在通信时所包含的地址信息也进行相应的NAT转换。例如：对于FTP协议的PORT/PASV命令、DNS协议的 “A” 和 “PTR” queries命令和部分ICMP消息类型等都需要相应的ALG来支持。
如果协议数据报文中不包含地址信息，则很容易利用传统的NAT技术来完成透明的地址转换功能，通常我们使用的如下应用就可以直接利用传统的NAT技术：HTTP、TELNET、FINGER、NTP、NFS、ARCHIE、RLOGIN、RSH、RCP等。</li>
</ol>
<h4 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h4><p>借助于NAT，私有（保留）地址的”内部”网络通过路由器发送数据包时，私有地址被转换成合法的IP地址，一个局域网只需使用少量IP地址（甚至是1个）即可实现私有地址网络内所有计算机与Internet的通信需求。
NAT将自动修改IP报文的源IP地址和目的IP地址，Ip地址校验则在NAT处理过程中自动完成。有些应用程序将源IP地址嵌入到IP报文的数据部分中，所以还需要同时对报文的数据部分进行修改，以匹配IP头中已经修改过的源IP地址。否则，在报文数据部分嵌入IP地址的应用程序就不能正常工作。</p>
<h4 id="NAPT"><a href="#NAPT" class="headerlink" title="NAPT"></a>NAPT</h4><p>NAPT（Network Address Port Translation），即网络端口地址转换，可将多个内部地址映射为一个合法公网地址，但以不同的协议端口号与不同的内部地址相对应，也就是&lt;内部地址+内部端口&gt;与&lt;外部地址+外部端口&gt;之间的转换。NAPT普遍用于接入设备中，它可以将中小型的网络隐藏在一个合法的IP地址后面。NAPT也被称为“多对一”的NAT，或者叫PAT（Port Address Translations，端口地址转换）、地址超载（address overloading）。
NAPT与动态地址NAT不同，它将内部连接映射到外部网络中的一个单独的IP地址上，同时在该地址上加上一个由NAT设备选定的TCP端口号。NAPT算得上是一种较流行的NAT变体，通过转换TCP或UDP协议端口号以及地址来提供并发性。除了一对源和目的IP地址以外，这个表还包括一对源和目的协议端口号，以及NAT盒使用的一个协议端口号。
NAPT的主要优势在于，能够使用一个全球有效IP地址获得通用性。主要缺点在于其通信仅限于TCP或UDP。当所有通信都采用TCP或UDP，NAPT允许一台内部计算机访问多台外部计算机，并允许多台内部主机访问同一台外部计算机，相互之间不会发生冲突。</p>
<h4 id="NAT穿透方法"><a href="#NAT穿透方法" class="headerlink" title="NAT穿透方法"></a>NAT穿透方法</h4><p>目前常用的针对UDP的NAT 穿透（NAT Traversal）方法主要有：STUN、TURN、ICE、uPnP等。其中ICE方式由于其结合了STUN和TURN的特点，所以使用最为广泛。针对TCP的NAT穿透技术目前仍为难点。实用的技术仍然不多。</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>在配置NAT(网络地址转换)之前，首先需要了解内部本地地址和内部全局地址的分配情况。根据不同的需求，执行以下不同的配置任务。</p>
<ul>
<li>内部源地址NAT配置</li>
<li>内部源地址NAPT配置</li>
<li>重叠地址NAT配置</li>
<li>TCP负载均衡</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/22/linux-networkcard/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/22/linux-networkcard/" itemprop="url">
                  linux网卡配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-22T17:18:11+08:00">
                2017-04-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux管理/" itemprop="url" rel="index">
                    <span itemprop="name">linux管理</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>linux网卡可以通过命令和配置文件配置,如果是桌面环境还可以通过图形化界面配置.</p>
<h3 id="1-ifconfig-interfaces-config-命令方式"><a href="#1-ifconfig-interfaces-config-命令方式" class="headerlink" title="1.ifconfig(interfaces config)命令方式"></a>1.ifconfig(interfaces config)命令方式</h3><p>通常需要以root身份登录或使用sudo以便在Linux机器上使用ifconfig工具。依赖于ifconfig命令中使用一些选项属性，ifconfig工具不仅可以被用来简单地获取网络接口配置信息，还可以修改这些配置(<strong>用ifconfig命令配置的网卡信息，在网卡重启后机器重启后，配置就不存在</strong>)。</p>
<h4 id="1-1命令格式"><a href="#1-1命令格式" class="headerlink" title="1.1命令格式"></a>1.1命令格式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ifconfig [网络设备] [参数]</div></pre></td></tr></table></figure>
<h4 id="1-2命令功能"><a href="#1-2命令功能" class="headerlink" title="1.2命令功能"></a>1.2命令功能</h4><p>ifconfig 命令用来查看和配置网络设备。当网络环境发生改变时可通过此命令对网络进行相应的配置。</p>
<h4 id="1-3命令参数"><a href="#1-3命令参数" class="headerlink" title="1.3命令参数"></a>1.3命令参数</h4><ol>
<li>up 启动指定网络设备/网卡。</li>
<li>down 关闭指定网络设备/网卡。该参数可以有效地阻止通过指定接口的IP信息流，如果想永久地关闭一个接口，我们还需要从核心路由表中将该接口的路由信息全部删除。</li>
<li>arp 设置指定网卡是否支持ARP协议。
-promisc 设置是否支持网卡的promiscuous模式，如果选择此参数，网卡将接收网络中发给它所有的数据包
-allmulti 设置是否支持多播模式，如果选择此参数，网卡将接收网络中所有的多播数据包
-a 显示全部接口信息
-s 显示摘要信息（类似于 netstat -i）</li>
<li>add 给指定网卡配置IPv6地址</li>
<li>del 删除指定网卡的IPv6地址</li>
<li>&lt;硬件地址&gt; 配置网卡最大的传输单元</li>
<li>mtu&lt;字节数&gt; 设置网卡的最大传输单元 (bytes)</li>
<li>netmask&lt;子网掩码&gt; 设置网卡的子网掩码。掩码可以是有前缀0x的32位十六进制数，也可以是用点分开的4个十进制数。如果不打算将网络分成子网，可以不管这一选项；如果要使用子网，那么请记住，网络中每一个系统必须有相同子网掩码。</li>
<li>tunel 建立隧道</li>
<li>dstaddr 设定一个远端地址，建立点对点通信</li>
<li>-broadcast&lt;地址&gt; 为指定网卡设置广播协议</li>
<li>-pointtopoint&lt;地址&gt; 为网卡设置点对点通讯协议</li>
<li>multicast 为网卡设置组播标志</li>
<li>address 为网卡设置IPv4地址</li>
<li>txqueuelen&lt;长度&gt; 为网卡设置传输列队的长度</li>
</ol>
<h4 id="1-4使用实例"><a href="#1-4使用实例" class="headerlink" title="1.4使用实例"></a>1.4使用实例</h4><h5 id="1-4-1显示网络设备信息（激活状态的）"><a href="#1-4-1显示网络设备信息（激活状态的）" class="headerlink" title="1.4.1显示网络设备信息（激活状态的）"></a>1.4.1显示网络设备信息（激活状态的）</h5><p><strong>命令</strong>:<code>ifcofig</code>
<strong>输出</strong>:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# ifconfig</div><div class="line">eth0      Link encap:Ethernet  HWaddr 00:50:56:BF:26:20  </div><div class="line">          inet addr:192.168.120.204  Bcast:192.168.120.255  Mask:255.255.255.0</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:8700857 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:31533 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:1000</div><div class="line">          RX bytes:596390239 (568.7 MiB)  TX bytes:2886956 (2.7 MiB)</div><div class="line"></div><div class="line">lo        Link encap:Local Loopback  </div><div class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</div><div class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</div><div class="line">          RX packets:68 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:68 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:2856 (2.7 KiB)  TX bytes:2856 (2.7 KiB)</div></pre></td></tr></table></figure></p>
<p><strong>说明</strong></p>
<ul>
<li>eth0 表示第一块网卡， 其中 HWaddr 表示网卡的物理地址，可以看到目前这个网卡的物理地址(MAC地址）是 00:50:56:BF:26:20</li>
<li>inet addr 用来表示网卡的IP地址，此网卡的 IP地址是 192.168.120.204，广播地址， Bcast:192.168.120.255，掩码地址Mask:255.255.255.0</li>
<li>lo 是表示主机的回坏地址，这个一般是用来测试一个网络程序，但又不想让局域网或外网的用户能够查看，只能在此台主机上运行和查看所用的网络接口。比如把 HTTPD服务器的指定到回坏地址，在浏览器输入 127.0.0.1 就能看到你所架WEB网站了。但只是您能看得到，局域网的其它主机或用户无从知道。</li>
<li>第一行：连接类型：Ethernet（以太网）HWaddr（硬件mac地址）</li>
<li>第二行：网卡的IP地址、子网、掩码</li>
<li>第三行：UP（代表网卡开启状态）RUNNING（代表网卡的网线被接上）MULTICAST（支持组播）MTU:1500（最大传输单元）：1500字节</li>
<li>第四、五行：接收、发送数据包情况统计</li>
<li>第七行：接收、发送数据字节数统计信息。</li>
</ul>
<h5 id="1-4-2启动关闭指定网卡"><a href="#1-4-2启动关闭指定网卡" class="headerlink" title="1.4.2启动关闭指定网卡"></a>1.4.2启动关闭指定网卡</h5><p><strong>命令</strong>：
ifconfig eth0 up
ifconfig eth0 down
<strong>输出</strong>：
<strong>说明</strong>：
ifconfig eth0 up 为启动网卡eth0 ；ifconfig eth0 down 为关闭网卡eth0。ssh登陆linux服务器操作要小心，关闭了就不能开启了，除非你有多网卡。</p>
<h5 id="1-4-3为网卡配置和删除IPv6地址"><a href="#1-4-3为网卡配置和删除IPv6地址" class="headerlink" title="1.4.3为网卡配置和删除IPv6地址"></a>1.4.3为网卡配置和删除IPv6地址</h5><p><strong>命令</strong>：
ifconfig eth0 add 33ffe:3240:800:1005::2/64
ifconfig eth0 del 33ffe:3240:800:1005::2/64
<strong>输出</strong>：
<strong>说明</strong>：
ifconfig eth0 add 33ffe:3240:800:1005::2/64 为网卡eth0配置IPv6地址；
ifconfig eth0 add 33ffe:3240:800:1005::2/64 为网卡eth0删除IPv6地址；
练习的时候，ssh登陆linux服务器操作要小心，关闭了就不能开启了，除非你有多网卡。</p>
<h5 id="1-4-4用ifconfig修改MAC地址"><a href="#1-4-4用ifconfig修改MAC地址" class="headerlink" title="1.4.4用ifconfig修改MAC地址"></a>1.4.4用ifconfig修改MAC地址</h5><p><strong>命令</strong>：
<code>ifconfig eth0 hw ether 00:AA:BB:CC:DD:EE</code>
<strong>输出</strong>：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# ifconfig eth0 down //关闭网卡</div><div class="line">[root@localhost ~]# ifconfig eth0 hw ether 00:AA:BB:CC:DD:EE //修改MAC地址</div><div class="line">[root@localhost ~]# ifconfig eth0 up //启动网卡</div><div class="line">[root@localhost ~]# ifconfig</div><div class="line">eth0      Link encap:Ethernet  HWaddr 00:AA:BB:CC:DD:EE  </div><div class="line">          inet addr:192.168.120.204  Bcast:192.168.120.255  Mask:255.255.255.0</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:8700857 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:31533 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:1000</div><div class="line">          RX bytes:596390239 (568.7 MiB)  TX bytes:2886956 (2.7 MiB)</div><div class="line"></div><div class="line">lo        Link encap:Local Loopback  </div><div class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</div><div class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</div><div class="line">          RX packets:68 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:68 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:2856 (2.7 KiB)  TX bytes:2856 (2.7 KiB)</div><div class="line">[root@localhost ~]# ifconfig eth0 hw ether 00:50:56:BF:26:20 //关闭网卡并修改MAC地址</div><div class="line">[root@localhost ~]# ifconfig eth0 up //启动网卡</div><div class="line">[root@localhost ~]# ifconfig</div><div class="line">eth0      Link encap:Ethernet  HWaddr 00:50:56:BF:26:20  </div><div class="line">          inet addr:192.168.120.204  Bcast:192.168.120.255  Mask:255.255.255.0</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:8700857 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:31533 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:1000</div><div class="line">          RX bytes:596390239 (568.7 MiB)  TX bytes:2886956 (2.7 MiB)</div><div class="line"></div><div class="line">lo        Link encap:Local Loopback  </div><div class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</div><div class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</div><div class="line">          RX packets:68 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:68 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:2856 (2.7 KiB)  TX bytes:2856 (2.7 KiB)</div></pre></td></tr></table></figure></p>
<h5 id="1-4-5配置IP地址"><a href="#1-4-5配置IP地址" class="headerlink" title="1.4.5配置IP地址"></a>1.4.5配置IP地址</h5><p><strong>输出</strong>:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# ifconfig eth0 192.168.120.56</div><div class="line">[root@localhost ~]# ifconfig eth0 192.168.120.56 netmask 255.255.255.0</div><div class="line">[root@localhost ~]# ifconfig eth0 192.168.120.56 netmask 255.255.255.0 broadcast 192.168.120.255</div></pre></td></tr></table></figure></p>
<p><strong>说明</strong>:
ifconfig eth0 192.168.120.56
给eth0网卡配置IP地：192.168.120.56
 ifconfig eth0 192.168.120.56 netmask 255.255.255.0
给eth0网卡配置IP地址：192.168.120.56 ，并加上子掩码：255.255.255.0
ifconfig eth0 192.168.120.56 netmask 255.255.255.0 broadcast 192.168.120.255
/给eth0网卡配置IP地址：192.168.120.56，加上子掩码：255.255.255.0，加上个广播地址： 192.168.120.255</p>
<h5 id="1-4-6启用和关闭ARP协议"><a href="#1-4-6启用和关闭ARP协议" class="headerlink" title="1.4.6启用和关闭ARP协议"></a>1.4.6启用和关闭ARP协议</h5><p><strong>命令</strong>：
ifconfig eth0 arp
ifconfig eth0 -arp
<strong>输出</strong>：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# ifconfig eth0 arp</div><div class="line">[root@localhost ~]# ifconfig eth0 -arp</div></pre></td></tr></table></figure></p>
<p><strong>说明</strong>
ifconfig eth0 arp 开启网卡eth0 的arp协议；
ifconfig eth0 -arp 关闭网卡eth0 的arp协议；</p>
<h5 id="1-4-7-设置最大传输单元"><a href="#1-4-7-设置最大传输单元" class="headerlink" title="1.4.7 设置最大传输单元"></a>1.4.7 设置最大传输单元</h5><p><strong>命令</strong>：
ifconfig eth0 mtu 1500
<strong>输出</strong>：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# ifconfig eth0 mtu 1480</div><div class="line">[root@localhost ~]# ifconfig</div><div class="line">eth0      Link encap:Ethernet  HWaddr 00:50:56:BF:26:1F  </div><div class="line">          inet addr:192.168.120.203  Bcast:192.168.120.255  Mask:255.255.255.0</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1480  Metric:1</div><div class="line">          RX packets:8712395 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:36631 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:1000</div><div class="line">          RX bytes:597062089 (569.4 MiB)  TX bytes:2643973 (2.5 MiB)</div><div class="line"></div><div class="line">lo        Link encap:Local Loopback  </div><div class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</div><div class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</div><div class="line">          RX packets:9973 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:9973 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:518096 (505.9 KiB)  TX bytes:518096 (505.9 KiB)</div><div class="line"></div><div class="line">[root@localhost ~]# ifconfig eth0 mtu 1500</div><div class="line">[root@localhost ~]# ifconfig</div><div class="line">eth0      Link encap:Ethernet  HWaddr 00:50:56:BF:26:1F  </div><div class="line">          inet addr:192.168.120.203  Bcast:192.168.120.255  Mask:255.255.255.0</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:8712548 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:36685 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:1000</div><div class="line">          RX bytes:597072333 (569.4 MiB)  TX bytes:2650581 (2.5 MiB)</div><div class="line"></div><div class="line">lo        Link encap:Local Loopback  </div><div class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</div><div class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</div><div class="line">          RX packets:9973 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:9973 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:518096 (505.9 KiB)  TX bytes:518096 (505.9 KiB)</div><div class="line"></div><div class="line">[root@localhost ~]#</div></pre></td></tr></table></figure></p>
<p>说明:
设置能通过的最大数据包大小为1500bytes</p>
<h3 id="2-配置文件方式"><a href="#2-配置文件方式" class="headerlink" title="2.配置文件方式"></a>2.配置文件方式</h3><p>ubuntu配置文件:<code>/etc/network/interfaces</code>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">auto lo</div><div class="line">iface lo inet loopback</div><div class="line">auto eth0 #配置静态ip</div><div class="line">iface eth0 inet static</div><div class="line">address 192.168.1.100</div><div class="line">netmask 255.255.255.0</div><div class="line">gateway 192.168.1.1</div></pre></td></tr></table></figure></p>
<p>centos配置文件:<code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">DEVICE=eth0(默认)</div><div class="line">HWADDR=00:0C:29:2E:36:16(默认)</div><div class="line">TYPE=Ethernet(默认)</div><div class="line">UUID=XXXXXXX(默认)</div><div class="line">ONBOOT=yes(默认为no,修改为yes意为每次reboot后 ifup eth0)</div><div class="line">MM_CONTROLLED=yes(默认)</div><div class="line">#BOOTPROTO=dhcp(dhcp为自动分配ip地址,我们把他注释了，在下面另外加)</div><div class="line">BOOTPROTO=static(新添加)</div><div class="line">IPV6INIT=no(新添加)</div><div class="line">USERCTL=no(新添加)</div><div class="line">IPADDR=192.168.164.100(新添加)</div><div class="line">NETMASK=255.255.255.0(新添加)</div></pre></td></tr></table></figure></p>
<p>service network restart重启网卡服务</p>
<h3 id="3-图形界面方式"><a href="#3-图形界面方式" class="headerlink" title="3.图形界面方式"></a>3.图形界面方式</h3><h3 id="添加虚拟网卡"><a href="#添加虚拟网卡" class="headerlink" title="添加虚拟网卡"></a>添加虚拟网卡</h3><p>一台服务器需要设置多个ip,但又不想添加多块网卡,那就需要设置虚拟网卡.这里介绍几种方式在linux服务器上添加虚拟网卡.
比如向eth0中添加一块虚拟网卡:</p>
<h4 id="1-快速创建删除虚拟网卡"><a href="#1-快速创建删除虚拟网卡" class="headerlink" title="1.快速创建删除虚拟网卡"></a>1.快速创建删除虚拟网卡</h4><p><code>sudo ifconfig eth0: 192.168.10.10 up</code>
以上的命令就可以在eth0网卡上创建一个叫eth0:0的虚拟网卡,他的地址是:192.168.1.63
如果不想要这个虚拟网卡了,可以使用如下命令删除:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo ifconfig eth0:0 down</div></pre></td></tr></table></figure></p>
<p>重启服务器或者网络后,虚拟网卡就没有了.</p>
<h4 id="2-修改网卡配置文件"><a href="#2-修改网卡配置文件" class="headerlink" title="2.修改网卡配置文件"></a>2.修改网卡配置文件</h4><p>在ubuntu下,网卡的配置文件是<code>/etc/network/interfaces</code>,所以我们修改它:
<code>sudo vim /etc/network/interfaces</code>
在这个文件中增加如下内容并保存:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">auto eth0:0</div><div class="line">iface eth0:0 inet static</div><div class="line">address 192.168.10.10</div><div class="line">netmask 255.255.255.0</div><div class="line">#network 192.168.10.1</div><div class="line">#broadcast 192.168.1.255</div></pre></td></tr></table></figure></p>
<p>保存后,我们需要重启网卡(重新加载配置文件)才会生效,使用如下命令重启:<code>sudo /etc/init.d/networking restart</code>
他的优点是重启服务器或者网卡配置不会丢失。</p>
<h4 id="3-创建tag"><a href="#3-创建tag" class="headerlink" title="3.创建tag"></a>3.创建tag</h4><p>前两种方法都有一个特点，创建的网卡可有不同的ip地址，但是Mac地址相同。无法用来创建虚拟机。
添加虚拟网卡tap
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tunctl -b</div></pre></td></tr></table></figure></p>
<p>其他配置命令:
显示网桥信息:<code>brctl show</code>
添加网桥:<code>brctl addbr virbr0</code>
激活网桥:<code>ip link set virbr0 up</code>
添加虚拟网卡tap:<code>tunctl -b</code>
tap0 ——-&gt; 执行上面使命就会生成一个tap,后缀从0，1，2依次递增<br>激活创建的tap:<code>ip link set tap0 up</code></p>
<h2 id="将tap0虚拟网卡添加到指定网桥上-brctl-addif-br0-tap0"><a href="#将tap0虚拟网卡添加到指定网桥上-brctl-addif-br0-tap0" class="headerlink" title="将tap0虚拟网卡添加到指定网桥上:brctl addif br0 tap0"></a>将tap0虚拟网卡添加到指定网桥上:<code>brctl addif br0 tap0</code></h2><p>给网桥配制ip地址:<code>ifconfig virbr1 169.254.251.4 up</code>
将virbr1网桥上绑定的网卡eth5解除:</p>
<pre><code>brctl delif virb1 eth5
</code></pre><p>给virbr1网桥添加网卡eth6:<code>brctl addif virbr1 eth6</code>   </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/19/issues-android-audio/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/19/issues-android-audio/" itemprop="url">
                  Android声音播放与录制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-19T10:31:45+08:00">
                2017-04-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="AudioTrack"><a href="#AudioTrack" class="headerlink" title="AudioTrack"></a>AudioTrack</h2><h3 id="AudioTrack类说明"><a href="#AudioTrack类说明" class="headerlink" title="AudioTrack类说明:"></a>AudioTrack类说明:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * The AudioTrack class manages and plays a single audio resource for Java applications.</div><div class="line"> * It allows streaming of PCM audio buffers to the audio sink for playback. This is</div><div class="line"> * achieved by &quot;pushing&quot; the data to the AudioTrack object using one of the</div><div class="line"> *  &#123;@link #write(byte[], int, int)&#125;, &#123;@link #write(short[], int, int)&#125;,</div><div class="line"> *  and &#123;@link #write(float[], int, int, int)&#125; methods.</div><div class="line"> *</div><div class="line"> * &lt;p&gt;An AudioTrack instance can operate under two modes: static or streaming.&lt;br&gt;</div><div class="line"> * In Streaming mode, the application writes a continuous stream of data to the AudioTrack, using</div><div class="line"> * one of the &#123;@code write()&#125; methods. These are blocking and return when the data has been</div><div class="line"> * transferred from the Java layer to the native layer and queued for playback. The streaming</div><div class="line"> * mode is most useful when playing blocks of audio data that for instance are:</div><div class="line"> *</div><div class="line"> * &lt;ul&gt;</div><div class="line"> *   &lt;li&gt;too big to fit in memory because of the duration of the sound to play,&lt;/li&gt;</div><div class="line"> *   &lt;li&gt;too big to fit in memory because of the characteristics of the audio data</div><div class="line"> *         (high sampling rate, bits per sample ...)&lt;/li&gt;</div><div class="line"> *   &lt;li&gt;received or generated while previously queued audio is playing.&lt;/li&gt;</div><div class="line"> * &lt;/ul&gt;</div><div class="line"> *</div><div class="line"> * The static mode should be chosen when dealing with short sounds that fit in memory and</div><div class="line"> * that need to be played with the smallest latency possible. The static mode will</div><div class="line"> * therefore be preferred for UI and game sounds that are played often, and with the</div><div class="line"> * smallest overhead possible.</div><div class="line"> *</div><div class="line"> * &lt;p&gt;Upon creation, an AudioTrack object initializes its associated audio buffer.</div><div class="line"> * The size of this buffer, specified during the construction, determines how long an AudioTrack</div><div class="line"> * can play before running out of data.&lt;br&gt;</div><div class="line"> * For an AudioTrack using the static mode, this size is the maximum size of the sound that can</div><div class="line"> * be played from it.&lt;br&gt;</div><div class="line"> * For the streaming mode, data will be written to the audio sink in chunks of</div><div class="line"> * sizes less than or equal to the total buffer size.</div><div class="line"> *</div><div class="line"> * AudioTrack is not final and thus permits subclasses, but such use is not recommended.</div><div class="line"> */</div><div class="line">public class AudioTrack extends PlayerBase</div><div class="line">                        implements AudioRouting&#123;</div><div class="line"></div><div class="line">                        &#125;</div></pre></td></tr></table></figure>
<h3 id="构造方法说明"><a href="#构造方法说明" class="headerlink" title="构造方法说明"></a>构造方法说明</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">//根据采样率，采样精度，单双声道来得到frame的大小。</div><div class="line">int bufsize = AudioTrack.getMinBufferSize(8000,//每秒8K个点　　AudioFormat.CHANNEL_CONFIGURATION_STEREO,//双声道</div><div class="line">AudioFormat.ENCODING_PCM_16BIT);//一个采样点16比特-2个字节</div><div class="line">//注意，按照数字音频的知识，这个算出来的是一秒钟buffer的大小。//创建AudioTrack</div><div class="line">AudioTrack trackplayer = new AudioTrack(AudioManager.STREAM_MUSIC, 8000,　　AudioFormat.CHANNEL_CONFIGURATION_ STEREO,</div><div class="line">　　AudioFormat.ENCODING_PCM_16BIT,</div><div class="line">　　bufsize,</div><div class="line">AudioTrack.MODE_STREAM);//</div><div class="line"> trackplayer.play() ;//开始</div><div class="line"></div><div class="line">trackplayer.write(bytes_pkg, 0, bytes_pkg.length) ;//往track中写数据</div><div class="line"></div><div class="line">….</div><div class="line"></div><div class="line">trackplayer.stop();//停止播放</div><div class="line"></div><div class="line">trackplayer.release();//释放底层资源。</div></pre></td></tr></table></figure>
<h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><h5 id="1-AudioTrack-MODE-STREAM的意思："><a href="#1-AudioTrack-MODE-STREAM的意思：" class="headerlink" title="1. AudioTrack.MODE_STREAM的意思："></a>1. AudioTrack.MODE_STREAM的意思：</h5><p>AudioTrack中有MODE_STATIC和MODE_STREAM两种分类。</p>
<ul>
<li><p>STREAM的意思是由用户在应用程序通过write方式把数据一次一次得写到audiotrack中。这个和我们在socket中发送数据一样，应用层从某个地方获取数据，例如通过编解码得到PCM数据，然后write到audiotrack。这种方式的坏处就是总是在JAVA层和Native层交互，效率损失较大。</p>
</li>
<li><p>而STATIC的意思是一开始创建的时候，就把音频数据放到一个固定的buffer，然后直接传给audiotrack，后续就不用一次次得write了。AudioTrack会自己播放这个buffer中的数据。
这种方法对于铃声等内存占用较小，延时要求较高的声音来说很适用。</p>
</li>
</ul>
<h5 id="2-StreamType"><a href="#2-StreamType" class="headerlink" title="2. StreamType"></a>2. StreamType</h5><p>这个在构造AudioTrack的第一个参数中使用。这个参数和Android中的AudioManager有关系，涉及到手机上的音频管理策略。
Android将系统的声音分为以下几类常见的（定义在AudioManager)：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">/** The audio stream for phone calls */</div><div class="line">public static final int STREAM_VOICE_CALL = AudioSystem.STREAM_VOICE_CALL;</div><div class="line">/** The audio stream for system sounds */</div><div class="line">public static final int STREAM_SYSTEM = AudioSystem.STREAM_SYSTEM;</div><div class="line">/** The audio stream for the phone ring */</div><div class="line">public static final int STREAM_RING = AudioSystem.STREAM_RING;</div><div class="line">/** The audio stream for music playback */</div><div class="line">public static final int STREAM_MUSIC = AudioSystem.STREAM_MUSIC;</div><div class="line">/** The audio stream for alarms */</div><div class="line">public static final int STREAM_ALARM = AudioSystem.STREAM_ALARM;</div><div class="line">/** The audio stream for notifications */</div><div class="line">public static final int STREAM_NOTIFICATION = AudioSystem.STREAM_NOTIFICATION;</div><div class="line">/** @hide The audio stream for phone calls when connected to bluetooth */</div><div class="line">public static final int STREAM_BLUETOOTH_SCO = AudioSystem.STREAM_BLUETOOTH_SCO;</div><div class="line">/** @hide The audio stream for enforced system sounds in certain countries (e.g camera in Japan) */</div><div class="line">public static final int STREAM_SYSTEM_ENFORCED = AudioSystem.STREAM_SYSTEM_ENFORCED;</div><div class="line">/** The audio stream for DTMF Tones */</div><div class="line">public static final int STREAM_DTMF = AudioSystem.STREAM_DTMF;</div><div class="line">/** @hide The audio stream for text to speech (TTS) */</div><div class="line">public static final int STREAM_TTS = AudioSystem.STREAM_TTS;</div></pre></td></tr></table></figure></p>
<p>常用说明:</p>
<ul>
<li>STREAM_ALARM：警告声</li>
<li>STREAM_MUSCI：音乐声，例如music等</li>
<li>STREAM_RING：铃声</li>
<li>STREAM_SYSTEM：系统声音</li>
<li>STREAM_VOCIE_CALL：电话声音</li>
</ul>
<p>为什么要分这么多呢？以前在台式机上开发的时候很少知道有这么多的声音类型，不过仔细思考下，发现这样做是有道理的。例如你在听music的时候接到电话，这个时候music播放肯定会停止，此时你只能听到电话，如果你调节音量的话，这个调节肯定只对电话起作用。当电话打完了，再回到music，你肯定不用再调节音量了。</p>
<p>其实系统将这几种声音的数据分开管理，所以，这个参数对AudioTrack来说，它的含义就是告诉系统，我现在想使用的是哪种类型的声音，这样系统就可以对应管理他们了。</p>
<h2 id="AudioRecord"><a href="#AudioRecord" class="headerlink" title="AudioRecord"></a>AudioRecord</h2><h3 id="AudioRecord说明"><a href="#AudioRecord说明" class="headerlink" title="AudioRecord说明"></a>AudioRecord说明</h3><p>The AudioRecord class manages the audio resources for Java applications to record audio from the audio input hardware of the platform. This is achieved by “pulling” (reading) the data from the AudioRecord object. The application is responsible for polling the AudioRecord object in time using one of the following three methods: <code>read(byte[], int, int)</code>, <code>read(short[], int, int)</code> or <code>read(ByteBuffer, int)</code>. The choice of which method to use will be based on the audio data storage format that is the most convenient for the user of AudioRecord.</p>
<p>Upon creation, an AudioRecord object initializes its associated audio buffer that it will fill with the new audio data. The size of this buffer, specified during the construction, determines how long an AudioRecord can record before “over-running” data that has not been read yet. Data should be read from the audio hardware in chunks of sizes inferior to the total recording buffer size.</p>
<h3 id="audiosource类型"><a href="#audiosource类型" class="headerlink" title="audiosource类型"></a>audiosource类型</h3><p>定义在MediaRecorder中
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">/** Default audio source **/</div><div class="line"> public static final int DEFAULT = 0;</div><div class="line"></div><div class="line"> /** Microphone audio source */</div><div class="line"> public static final int MIC = 1;</div><div class="line"></div><div class="line"> /** Voice call uplink (Tx) audio source */</div><div class="line"> public static final int VOICE_UPLINK = 2;</div><div class="line"></div><div class="line"> /** Voice call downlink (Rx) audio source */</div><div class="line"> public static final int VOICE_DOWNLINK = 3;</div><div class="line"></div><div class="line"> /** Voice call uplink + downlink audio source */</div><div class="line"> public static final int VOICE_CALL = 4;</div><div class="line"></div><div class="line"> /** Microphone audio source with same orientation as camera if available, the main</div><div class="line">  *  device microphone otherwise */</div><div class="line"> public static final int CAMCORDER = 5;</div><div class="line"></div><div class="line"> /** Microphone audio source tuned for voice recognition if available, behaves like</div><div class="line">  *  &#123;@link #DEFAULT&#125; otherwise. */</div><div class="line"> public static final int VOICE_RECOGNITION = 6;</div><div class="line"></div><div class="line"> /** Microphone audio source tuned for voice communications such as VoIP. It</div><div class="line">  *  will for instance take advantage of echo cancellation or automatic gain control</div><div class="line">  *  if available. It otherwise behaves like &#123;@link #DEFAULT&#125; if no voice processing</div><div class="line">  *  is applied.</div><div class="line">  */</div><div class="line"> public static final int VOICE_COMMUNICATION = 7;</div></pre></td></tr></table></figure></p>
<h2 id="AudioManager"><a href="#AudioManager" class="headerlink" title="AudioManager"></a>AudioManager</h2><h3 id="获取系统音量"><a href="#获取系统音量" class="headerlink" title="获取系统音量"></a>获取系统音量</h3><p>代码
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">//初始化AudioManager:</div><div class="line">AudioManager mAudioManager = (AudioManager) getSystemService(Context.AUDIO_SERVICE);</div><div class="line"></div><div class="line">//通话音量</div><div class="line">int max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_VOICE_CALL );</div><div class="line">int current = mAudioManager.getStreamVolume( AudioManager.STREAM_VOICE_CALL );</div><div class="line">Log.d(“VIOCE_CALL”, “max : ” + max + ” current : ” + current);</div><div class="line"></div><div class="line">//系统音量</div><div class="line">max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_SYSTEM );</div><div class="line">current = mAudioManager.getStreamVolume( AudioManager.STREAM_SYSTEM );</div><div class="line">Log.d(“SYSTEM”, “max : ” + max + ” current : ” + current);</div><div class="line"></div><div class="line">//铃声音量</div><div class="line">max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_RING );</div><div class="line">current = mAudioManager.getStreamVolume( AudioManager.STREAM_RING );</div><div class="line">Log.d(“RING”, “max : ” + max + ” current : ” + current);</div><div class="line"></div><div class="line">//音乐音量</div><div class="line"></div><div class="line">max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_MUSIC );</div><div class="line">current = mAudioManager.getStreamVolume( AudioManager.STREAM_MUSIC );</div><div class="line">Log.d(“MUSIC”, “max : ” + max + ” current : ” + current);</div><div class="line"></div><div class="line">//提示声音音量</div><div class="line"></div><div class="line">max = mAudioManager.getStreamMaxVolume( AudioManager.STREAM_ALARM );</div><div class="line">current = mAudioManager.getStreamVolume( AudioManager.STREAM_ALARM );</div><div class="line">Log.d(“ALARM”, “max : ” + max + ” current : ” + current);</div></pre></td></tr></table></figure></p>
<p>ps：
　　游戏过程中只允许调整多媒体音量，而不允许调整通话音量。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setVolumeControlStream(AudioManager.STREAM_MUSIC);</div></pre></td></tr></table></figure></p>
<h3 id="控制音量"><a href="#控制音量" class="headerlink" title="控制音量"></a>控制音量</h3><p>AudioManager提供了设置音量的方法：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public void setStreamVolume(intstreamType,intindex,intflags)</div></pre></td></tr></table></figure></p>
<p>其中streamType有内置的常量，去文档里面就可以看到。
使用示例:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">//音量控制,初始化定义    </div><div class="line">AudioManager mAudioManager = (AudioManager) getSystemService(Context.AUDIO_SERVICE);    </div><div class="line">//最大音量    </div><div class="line">int maxVolume = mAudioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC);    </div><div class="line">//当前音量    </div><div class="line">int currentVolume = mAudioManager.getStreamVolume(AudioManager.STREAM_MUSIC);</div><div class="line"></div><div class="line">//直接控制音量</div><div class="line">if(isSilent)&#123;    </div><div class="line">  mAudioManager.setStreamVolume(AudioManager.STREAM_MUSIC, 0, 0);    </div><div class="line">&#125;else&#123;    </div><div class="line">  mAudioManager.setStreamVolume(AudioManager.STREAM_MUSIC, tempVolume, 0); //tempVolume:音量绝对值    </div><div class="line">&#125;    </div><div class="line"></div><div class="line">//以一步步长控制音量的增减，并弹出系统默认音量控制条：</div><div class="line">//降低音量，调出系统音量控制    </div><div class="line">if(flag == 0)&#123;    </div><div class="line">  mAudioManager.adjustStreamVolume(AudioManager.STREAM_MUSIC,AudioManager.ADJUST_LOWER,    </div><div class="line">                            AudioManager.FX_FOCUS_NAVIGATION_UP);    </div><div class="line">&#125;    </div><div class="line">//增加音量，调出系统音量控制    </div><div class="line">else if(flag == 1)&#123;    </div><div class="line">  mAudioManager.adjustStreamVolume(AudioManager.STREAM_MUSIC,AudioManager.ADJUST_RAISE,    </div><div class="line">                            AudioManager.FX_FOCUS_NAVIGATION_UP);    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>监听按键手动控制音量
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">AudioManager audio = (AudioManager) getSystemService(Service.AUDIO_SERVICE);</div><div class="line"></div><div class="line">@Override</div><div class="line">public boolean onKeyDown(int keyCode, KeyEvent event) &#123;</div><div class="line">    switch (keyCode) &#123;</div><div class="line">    case KeyEvent.KEYCODE_VOLUME_UP:</div><div class="line">        audio.adjustStreamVolume(</div><div class="line">            AudioManager.STREAM_MUSIC,</div><div class="line">            AudioManager.ADJUST_RAISE,</div><div class="line">            AudioManager.FLAG_PLAY_SOUND | AudioManager.FLAG_SHOW_UI);</div><div class="line">        return true;</div><div class="line">    case KeyEvent.KEYCODE_VOLUME_DOWN:</div><div class="line">        audio.adjustStreamVolume(</div><div class="line">            AudioManager.STREAM_MUSIC,</div><div class="line">            AudioManager.ADJUST_LOWER,</div><div class="line">            AudioManager.FLAG_PLAY_SOUND | AudioManager.FLAG_SHOW_UI);</div><div class="line">        return true;</div><div class="line">    default:</div><div class="line">        break;</div><div class="line">    &#125;</div><div class="line">    return super.onKeyDown(keyCode, event);</div></pre></td></tr></table></figure></p>
<h4 id="插入耳机状态仍使用扬声器外放音乐"><a href="#插入耳机状态仍使用扬声器外放音乐" class="headerlink" title="插入耳机状态仍使用扬声器外放音乐"></a>插入耳机状态仍使用扬声器外放音乐</h4><p>插入耳机的时候也可以选择使用扬声器播放音乐，来电铃声就是这么用的。但是只能用MediaPlayer，播放音频文件。
使用AudioTrack.write播放是行不通的(有待验证)。按理说AudioRecord、AudioTrack类相对于MediaRecorder mediaPlayer来说，更加接近底层，应该也行得通的。</p>
<p>插入耳机，选择外放的代码如下(兼容性验证)：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">AudioManager audioManager = (AudioManager) this.getSystemService(Context.AUDIO_SERVICE);  </div><div class="line">audioManager.setMicrophoneMute(false);          </div><div class="line">audioManager.setSpeakerphoneOn(true);//使用扬声器外放，即使已经插入耳机  </div><div class="line">setVolumeControlStream(AudioManager.STREAM_MUSIC);//控制声音的大小  </div><div class="line">audioManager.setMode(AudioManager.STREAM_MUSIC);   </div><div class="line"></div><div class="line">//播放一段声音，查看效果          </div><div class="line">MediaPlayer playerSound = MediaPlayer.create(this, Uri.parse(&quot;file:///system/media/audio/ui/camera_click.ogg&quot;));  </div><div class="line">playerSound.start();</div></pre></td></tr></table></figure></p>
<h3 id="使用STREAM-VOCIE-CALL播放声音与耳机冲突"><a href="#使用STREAM-VOCIE-CALL播放声音与耳机冲突" class="headerlink" title="使用STREAM_VOCIE_CALL播放声音与耳机冲突"></a>使用STREAM_VOCIE_CALL播放声音与耳机冲突</h3><p>使用STREAM_VOCIE_CALL播放声音在某些手机,比如魅蓝等上面会导致声音仍外放,耳机没声音现象.
WebRtc使用STREAM_VOCIE_CALL播放声音,导致某些手机声音低,没法使用音量键调节,插入耳机声音仍外放等问题.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/16/latex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/16/latex/" itemprop="url">
                  MarkDown中嵌入LaTex
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-16T17:17:15+08:00">
                2017-04-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index">
                    <span itemprop="name">工具</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MarkDown中使用标识符<code>$$</code>和<code>$$$$</code>即可引入LaTeX语法,前者使用时不换行,即在所使用位置使用LaTeX的格式,后者会换行后居中</p>
<h3 id="部分希腊字母"><a href="#部分希腊字母" class="headerlink" title="部分希腊字母"></a>部分希腊字母</h3><table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\alpha</td>
<td>α</td>
<td></td>
<td>A</td>
<td>A</td>
</tr>
<tr>
<td>\beta</td>
<td>β</td>
<td></td>
<td>B</td>
<td>B</td>
</tr>
<tr>
<td>\gamma</td>
<td>γ</td>
<td></td>
<td>\Gamma \varGamma</td>
<td>Γ  Γ</td>
</tr>
<tr>
<td>delta</td>
<td>δ</td>
<td></td>
<td>\Delta \varDelta</td>
<td>Δ  Δ</td>
</tr>
<tr>
<td>\epsilon</td>
<td>ϵ</td>
<td></td>
<td>E</td>
<td>E</td>
</tr>
<tr>
<td>\eta</td>
<td>η</td>
<td></td>
<td>H</td>
<td>H</td>
</tr>
<tr>
<td>\theta</td>
<td>θ</td>
<td></td>
<td>\Theta \varTheta</td>
<td>Θ  Θ</td>
</tr>
<tr>
<td>\kappa</td>
<td>κ</td>
<td></td>
<td>K</td>
<td>K</td>
</tr>
<tr>
<td>\lambda</td>
<td>λ</td>
<td></td>
<td>\Lambda \varLambda</td>
<td>Λ  Λ</td>
</tr>
<tr>
<td>\mu</td>
<td>μ</td>
<td></td>
<td>M</td>
<td>M</td>
</tr>
<tr>
<td>\nu</td>
<td>ν</td>
<td></td>
<td>N</td>
<td>N</td>
</tr>
<tr>
<td>\pi</td>
<td>π</td>
<td></td>
<td>\Pi \varPi</td>
<td>Π  Π</td>
</tr>
<tr>
<td>\rho</td>
<td>ρ</td>
<td></td>
<td>P</td>
<td>P</td>
</tr>
<tr>
<td>\sigma</td>
<td>σ</td>
<td></td>
<td>\Sigma \varSigma</td>
<td>Σ  Σ</td>
</tr>
<tr>
<td>\tau</td>
<td>τ</td>
<td></td>
<td>T</td>
<td>T</td>
</tr>
<tr>
<td>\phi \varphi</td>
<td>ϕ  φ</td>
<td></td>
<td>\Phi \varPhi</td>
<td>Φ  Φ</td>
</tr>
<tr>
<td>\omega</td>
<td>ω</td>
<td></td>
<td>\Omega \varOmega</td>
<td>Ω  Ω</td>
</tr>
</tbody>
</table>
<p>全部24个字母:</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>大写</th>
<th>Tex</th>
<th>小写</th>
<th>Tex</th>
</tr>
</thead>
<tbody>
<tr>
<td>alpha</td>
<td>A</td>
<td>A</td>
<td>α</td>
<td>\alpha</td>
</tr>
<tr>
<td>beta</td>
<td>B</td>
<td>B</td>
<td>β\</td>
<td>beta</td>
</tr>
<tr>
<td>gamma</td>
<td>Γ</td>
<td>\Gamma</td>
<td>γ</td>
<td>\gamma</td>
</tr>
<tr>
<td>delta</td>
<td>Δ</td>
<td>\Delta</td>
<td>δ</td>
<td>\delta</td>
</tr>
<tr>
<td>epsilon</td>
<td>E</td>
<td>E</td>
<td>ϵ</td>
<td>\epsilon</td>
</tr>
<tr>
<td>zeta</td>
<td>Z</td>
<td>Z</td>
<td>ζ</td>
<td>\zeta</td>
</tr>
<tr>
<td>eta</td>
<td>H</td>
<td>H</td>
<td>η</td>
<td>\eta</td>
</tr>
<tr>
<td>theta</td>
<td>Θ</td>
<td>\Theta</td>
<td>θ</td>
<td>\theta</td>
</tr>
<tr>
<td>iota</td>
<td>I</td>
<td>I</td>
<td>ι</td>
<td>\iota</td>
</tr>
<tr>
<td>kappa</td>
<td>K</td>
<td>K</td>
<td>κ</td>
<td>\kappa</td>
</tr>
<tr>
<td>lambda</td>
<td>Λ</td>
<td>\Lambda</td>
<td>λ</td>
<td>\lambda</td>
</tr>
<tr>
<td>mu</td>
<td>M</td>
<td>M</td>
<td>μ</td>
<td>\mu</td>
</tr>
<tr>
<td>nu</td>
<td>N</td>
<td>N</td>
<td>ν</td>
<td>\nu</td>
</tr>
<tr>
<td>xi</td>
<td>Ξ</td>
<td>\Xi</td>
<td>ξ</td>
<td>\xi</td>
</tr>
<tr>
<td>omicron</td>
<td>O</td>
<td>O</td>
<td>ο</td>
<td>\omicron</td>
</tr>
<tr>
<td>pi</td>
<td>Π</td>
<td>\Pi</td>
<td>π</td>
<td>\pi</td>
</tr>
<tr>
<td>rho</td>
<td>P</td>
<td>P</td>
<td>ρ</td>
<td>\rho</td>
</tr>
<tr>
<td>sigma</td>
<td>Σ</td>
<td>\Sigma</td>
<td>σ</td>
<td>\sigma</td>
</tr>
<tr>
<td>tau</td>
<td>T</td>
<td>T</td>
<td>τ</td>
<td>\tau</td>
</tr>
<tr>
<td>upsilon</td>
<td>Υ</td>
<td>\Upsilon</td>
<td>υ</td>
<td>\upsilon</td>
</tr>
<tr>
<td>phi</td>
<td>Φ</td>
<td>\Phi</td>
<td>ϕ</td>
<td>\phi</td>
</tr>
<tr>
<td>chi</td>
<td>X</td>
<td>X</td>
<td>χ</td>
<td>\chi</td>
</tr>
<tr>
<td>psi</td>
<td>Ψ</td>
<td>\Psi</td>
<td>ψ</td>
<td>\psi</td>
</tr>
<tr>
<td>omega</td>
<td>Ω</td>
<td>\Omega</td>
<td>ω</td>
<td>\omega</td>
</tr>
</tbody>
</table>
<h3 id="部分运算符"><a href="#部分运算符" class="headerlink" title="部分运算符"></a>部分运算符</h3><table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\pm</td>
<td>±</td>
<td></td>
<td>\mp</td>
<td>∓</td>
</tr>
<tr>
<td>\times</td>
<td>×</td>
<td></td>
<td>\div</td>
<td>÷</td>
</tr>
<tr>
<td>\circ</td>
<td>∘</td>
<td></td>
<td>\bullet</td>
<td>∙</td>
</tr>
<tr>
<td>\cdot</td>
<td>⋅</td>
<td></td>
<td>\cup</td>
<td>∪</td>
</tr>
<tr>
<td>\cap</td>
<td>∩</td>
<td></td>
<td>\subset</td>
<td>⊂</td>
</tr>
<tr>
<td>\supset</td>
<td>⊃</td>
<td></td>
<td>\subseteq</td>
<td>⊆</td>
</tr>
<tr>
<td>\supseteq</td>
<td>⊇</td>
<td></td>
<td>\leq</td>
<td>≤</td>
</tr>
<tr>
<td>\geq</td>
<td>≥</td>
<td></td>
<td>\propto</td>
<td>∝</td>
</tr>
</tbody>
</table>
<h3 id="其他符号"><a href="#其他符号" class="headerlink" title="其他符号"></a>其他符号</h3><table>
<thead>
<tr>
<th>命令</th>
<th>显示</th>
<th></th>
<th>命令</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>\cdotp</td>
<td>⋅</td>
<td></td>
<td>\cdots</td>
<td>⋯</td>
</tr>
<tr>
<td>\ddots</td>
<td>⋱</td>
<td></td>
<td>\infty</td>
<td>∞</td>
</tr>
<tr>
<td>\partial</td>
<td>∂</td>
<td></td>
<td>\bot</td>
<td>⊥</td>
</tr>
<tr>
<td>\hat{a}</td>
<td>â</td>
<td></td>
<td>\tilde{a}</td>
<td>ã</td>
</tr>
<tr>
<td>\bar{a}</td>
<td>a¯</td>
<td></td>
<td>\vec{a}</td>
<td>a⃗</td>
</tr>
<tr>
<td>\dot{a}</td>
<td>a˙</td>
<td></td>
<td>\sqrt{a}</td>
<td>a‾‾√</td>
</tr>
<tr>
<td>\sqrt[3]{2}</td>
<td>a‾‾√3</td>
<td></td>
<td>a^{3}</td>
<td>a3</td>
</tr>
<tr>
<td>\frac{1}{a}</td>
<td>1a</td>
<td></td>
<td>\lim_{x \to 0}</td>
<td>lima→0</td>
</tr>
</tbody>
</table>
<h3 id="集合关系符号"><a href="#集合关系符号" class="headerlink" title="集合关系符号"></a>集合关系符号</h3><table>
<thead>
<tr>
<th>说明</th>
<th>命令</th>
</tr>
</thead>
<tbody>
<tr>
<td>集合的大括号</td>
<td>{ …   }\</td>
</tr>
<tr>
<td>集合中的竖线$\mid$</td>
<td>\mid</td>
</tr>
<tr>
<td>属于</td>
<td>\in</td>
</tr>
<tr>
<td>不属于</td>
<td>\not\in</td>
</tr>
<tr>
<td>A包含于B</td>
<td>A\subset B</td>
</tr>
<tr>
<td>A真包含于B</td>
<td>A\subsetneqq B</td>
</tr>
<tr>
<td>A包含B</td>
<td>A\supset B</td>
</tr>
<tr>
<td>A真包含B</td>
<td>A\supsetneqq B</td>
</tr>
<tr>
<td>A不包含于B</td>
<td>A\not\subset B</td>
</tr>
<tr>
<td>A交B</td>
<td>A\cap B</td>
</tr>
<tr>
<td>A并B</td>
<td>A\cup B</td>
</tr>
<tr>
<td>A的闭包</td>
<td>\overline{A}</td>
</tr>
<tr>
<td>A减去B</td>
<td>A\setminus B</td>
</tr>
<tr>
<td>实数集合</td>
<td>\mathbb{R}</td>
</tr>
<tr>
<td>空集</td>
<td>\emptyset</td>
</tr>
</tbody>
</table>
<blockquote>
<p>表格中竖线用<code>&amp;#124;</code></p>
</blockquote>
<h3 id="括号总结"><a href="#括号总结" class="headerlink" title="括号总结"></a>括号总结</h3><table>
<thead>
<tr>
<th>功能</th>
<th>语法</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>不好看</td>
<td><code>( \frac{1}{2} )</code></td>
<td>$(\frac{1}{2})$</td>
</tr>
<tr>
<td>好一点</td>
<td><code>\left( \frac{1}{2} \right)</code></td>
<td>$\left ( \frac{1}{2} \right )$</td>
</tr>
</tbody>
</table>
<p>可以使用<code>\left</code>和<code>\right</code>来显示不同的括号：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>语法</th>
<th>显示</th>
</tr>
</thead>
<tbody>
<tr>
<td>圆括号，小括号</td>
<td><code>\left( \frac{a}{b} \right)</code></td>
<td>$\left( \frac{a}{b} \right)$</td>
</tr>
<tr>
<td>方括号，中括号</td>
<td>\left[ \frac{a}{b} \right]</td>
<td>$\left[ \frac{a}{b} \right]$</td>
</tr>
<tr>
<td>花括号，大括号</td>
<td><code>\left\{ \frac{a}{b} \right\}</code></td>
<td>$    \left{ \frac{a}{b} \right}$</td>
</tr>
<tr>
<td>角括号</td>
<td><code>\left \langle \frac{a}{b} \right \rangle</code></td>
<td>$\left\langle \frac{a}{b} \right \rangle$</td>
</tr>
<tr>
<td>单竖线，绝对值</td>
<td>\left 竖线 \frac{a}{b} \right 竖线</td>
<td></td>
</tr>
<tr>
<td>双竖线，范</td>
<td>\left \ 竖线 \frac{a}{b} \right \ 竖线</td>
<td></td>
</tr>
<tr>
<td>取整函数</td>
<td><code>（Floor function）    \left \lfloor \frac{a}{b} \right \rfloor</code></td>
<td>$    \left \lfloor \frac{a}{b} \right \rfloor$</td>
</tr>
<tr>
<td>取顶函数</td>
<td><code>（Ceiling function)    \left \lceil \frac{c}{d} \right \rceil</code></td>
<td>$    \left \lceil \frac{c}{d} \right \rceil$</td>
</tr>
<tr>
<td>斜线与反斜线</td>
<td><code>\left / \frac{a}{b} \right \backslash</code></td>
<td>$    \left / \frac{a}{b} \right \backslash$</td>
</tr>
<tr>
<td>上下箭头</td>
<td><code>\left \uparrow \frac{a}{b} \right \downarrow</code> <code>\left \Uparrow \frac{a}{b} \right \Downarrow</code> <code>\left \updownarrow \frac{a}{b} \right \Updownarrow</code></td>
<td>$\left \uparrow \frac{a}{b} \right \downarrow$ $\left \Uparrow \frac{a}{b} \right \Downarrow$ $\left \updownarrow \frac{a}{b} \right \Updownarrow$</td>
</tr>
<tr>
<td>混合括号</td>
<td><code>\left [ 0,1 \right )</code> <code>\left \langle \psi )</code></td>
<td>$\left [ 0,1 \right )$ $ \left \langle \psi \right)$</td>
</tr>
<tr>
<td>单左括号</td>
<td><code>\left \{ \frac{a}{b} \right .</code></td>
<td>$\left { \frac{a}{b} \right .$</td>
</tr>
<tr>
<td>单右括号</td>
<td><code>\left . \frac{a}{b} \right \}</code></td>
<td>$\left . \frac{a}{b} \right }$</td>
</tr>
</tbody>
</table>
<p>备注：
可以使用<code>\big, \Big, \bigg, \Bigg</code>控制括号的大小，比如代码<code>\Bigg ( \bigg [ \Big \{ \big \langle \left | \| \frac{a}{b} \| \right | \big \rangle \Big \} \bigg ] \Bigg )</code>显示</p>
<p>$$\Bigg ( \bigg [ \Big { \big \langle \left | | x | \right | \big \rangle \Big } \bigg ] \Bigg )$$</p>
<h2 id="矩阵"><a href="#矩阵" class="headerlink" title="矩阵"></a>矩阵</h2><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>使用<code>$$\begin{matrix}…\end{matrix}$$</code>这样的形式来表示矩阵，在<code>\begin与\end</code>之间加入矩阵中的元素即可。矩阵的行之间使用<code>\\</code>分隔，列之间使用&amp;分隔。
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$$</div><div class="line">        \begin&#123;matrix&#125;</div><div class="line">        1 &amp; x &amp; x^2 \\</div><div class="line">        1 &amp; y &amp; y^2 \\</div><div class="line">        1 &amp; z &amp; z^2 \\</div><div class="line">        \end&#123;matrix&#125;</div><div class="line">$$</div></pre></td></tr></table></figure></p>
<p>$$
        \begin{matrix}
        1 &amp; x &amp; x^2 \
        1 &amp; y &amp; y^2 \
        1 &amp; z &amp; z^2 \
        \end{matrix}
$$</p>
<h3 id="加括号"><a href="#加括号" class="headerlink" title="加括号"></a>加括号</h3><p>如果要对矩阵加括号，可以像上文中提到的一样，使用<code>\left与\right</code>配合表示括号符号。也可以使用特殊的matrix。即替换<code>\begin{matrix}…\end{matrix}</code>中的matrix为pmatrix，bmatrix，Bmatrix，vmatrix,Vmatrix.</p>
<h3 id="省略元素"><a href="#省略元素" class="headerlink" title="省略元素"></a>省略元素</h3><p>可以使用<code>\cdots ⋯
 \ddots ⋱
 \vdots ⋮</code>
来省略矩阵中的元素</p>
<h3 id="增广矩阵"><a href="#增广矩阵" class="headerlink" title="增广矩阵"></a>增广矩阵</h3><p>增广矩阵需要使用前面的array来实现
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$$ \left[</div><div class="line">      \begin&#123;array&#125;&#123;cc|c&#125;</div><div class="line">        1&amp;2&amp;3\\</div><div class="line">        4&amp;5&amp;6</div><div class="line">      \end&#123;array&#125;</div><div class="line">    \right]</div><div class="line">$$</div></pre></td></tr></table></figure></p>
<p>$$ \left[
      \begin{array}{cc|c}
        1&amp;2&amp;3\
        4&amp;5&amp;6
      \end{array}
    \right]
$$</p>
<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><p>使用<code>$$\begin{array}{列样式}…\end{array}$$</code>这样的形式来创建表格，列样式可以是clr表示居中，左，右对齐，还可以使用|表示一条竖线。表格中 各行使用<code>\\</code>分隔，各列使用&amp;分隔。使用<code>\hline</code>在本行前加入一条直线。 例如，
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$$</div><div class="line">\begin&#123;array&#125;&#123;c|lcr&#125;</div><div class="line">n &amp; \text&#123;Left&#125; &amp; \text&#123;Center&#125; &amp; \text&#123;Right&#125; \\</div><div class="line">\hline</div><div class="line">1 &amp; 0.24 &amp; 1 &amp; 125 \\</div><div class="line">2 &amp; -1 &amp; 189 &amp; -8 \\</div><div class="line">3 &amp; -20 &amp; 2000 &amp; 1+10i \\</div><div class="line">\end&#123;array&#125;</div><div class="line">$$</div></pre></td></tr></table></figure></p>
<h2 id="上标与下标"><a href="#上标与下标" class="headerlink" title="上标与下标"></a>上标与下标</h2><p>上标和下标分别使用<code>^与_</code>，例如<code>x_i^2</code>：$x_i^2$
。默认情况下，上下标符号仅仅对下一个组起作用。一个组即单个字符或者使用{..}包裹起来的内容。也就是说，如果使用<code>10^10</code>，会得到$10^10$
，而<code>10^{10}</code>才是$10^{10}$
。同时，大括号还能消除二义性，如<code>x^5^6</code>将得到一个错误，必须使用大括号来界定<code>^</code>的结合性，如<code>{x^5}^6</code>：${x^5}^6$
 或者 <code>x^{5^6}</code>：$x^{5^6}$
。</p>
<h2 id="对齐的公式"><a href="#对齐的公式" class="headerlink" title="对齐的公式"></a>对齐的公式</h2><h2 id="分类表达式"><a href="#分类表达式" class="headerlink" title="分类表达式"></a>分类表达式</h2><p>定义函数的时候经常需要分情况给出表达式，可使用<code>\begin{cases}…\end{cases}</code>。其中，使用<code>\</code>来分类，使用&amp;指示需要对齐的位置。如：</p>
<h2 id="多重积分"><a href="#多重积分" class="headerlink" title="多重积分"></a>多重积分</h2><h2 id="连分数"><a href="#连分数" class="headerlink" title="连分数"></a>连分数</h2><h2 id="方程组"><a href="#方程组" class="headerlink" title="方程组"></a>方程组</h2><h2 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h2><h2 id="公式标记与引用"><a href="#公式标记与引用" class="headerlink" title="公式标记与引用"></a>公式标记与引用</h2><h2 id="求和与积分"><a href="#求和与积分" class="headerlink" title="求和与积分"></a>求和与积分</h2><h2 id="分式与根式"><a href="#分式与根式" class="headerlink" title="分式与根式"></a>分式与根式</h2><h2 id="特殊函数与符号"><a href="#特殊函数与符号" class="headerlink" title="特殊函数与符号"></a>特殊函数与符号</h2><h2 id="空间"><a href="#空间" class="headerlink" title="空间"></a>空间</h2><h2 id="顶部符号"><a href="#顶部符号" class="headerlink" title="顶部符号"></a>顶部符号</h2><blockquote>
<p>参考
<a href="http://mlworks.cn/posts/introduction-to-mathjax-and-latex-expression/" target="_blank" rel="external">http://mlworks.cn/posts/introduction-to-mathjax-and-latex-expression/</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://wodekouwei.com/2017/04/13/am-function-and-limitaion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="轻口味">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老司机种菜">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/13/am-function-and-limitaion/" itemprop="url">
                  高数1.函数与极限
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-13T22:34:04+08:00">
                2017-04-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/高数/" itemprop="url" rel="index">
                    <span itemprop="name">高数</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-映射与函数"><a href="#1-映射与函数" class="headerlink" title="1.映射与函数"></a>1.映射与函数</h2><h3 id="1-1-集合"><a href="#1-1-集合" class="headerlink" title="1.1 集合"></a>1.1 集合</h3><h4 id="1-1-1-集合的概念"><a href="#1-1-1-集合的概念" class="headerlink" title="1.1.1 集合的概念"></a>1.1.1 集合的概念</h4><p>集合(集)是指具有某种特定性质的事物的总体,组成这个集合的事物成为该集合的元素(简称元)</p>
<p>表示:用大写拉丁字母A,B,C…表示集合,小写拉丁字母表示集合的元素</p>
<p>分类:</p>
<ul>
<li>有限集</li>
<li>无限集</li>
</ul>
<p>表示数集的字母的右上角标<code>*</code>表示该数集内排除0的集,标上<code>+</code>来表示数集内排除0和负数的集</p>
<p>常用表示</p>
<ol>
<li>N={0, 1, 2, 3…};全体非负整数即自然数的集合</li>
<li>N<sup>+</sup>={1,2,3,…n,….};全体正整数的集合</li>
<li>Z={…,-n,…-3, -2,-1, 0, 1, 2, 3,…,n…};全体整数的集合</li>
<li>$Q=\lbrace \frac{p}{q}|p \in Z,q \in N^{+} \rbrace$;全体有理数集</li>
</ol>
<p>全体实数记做R,R<sup>*</sup>为排除0的实数集,R<sup>+</sup>为全体正实数集.</p>
<p>子集概念:</p>
<ul>
<li>子集</li>
<li>真子集</li>
<li>集合相等:互为子集</li>
<li>空集 $\emptyset$<h4 id="1-1-2-集合的运算"><a href="#1-1-2-集合的运算" class="headerlink" title="1.1.2 集合的运算"></a>1.1.2 集合的运算</h4></li>
</ul>
<h4 id="1-1-3-区间和领域"><a href="#1-1-3-区间和领域" class="headerlink" title="1.1.3 区间和领域"></a>1.1.3 区间和领域</h4>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://images.wodekouwei.com/avatar/winnle_the_pooh.jpg"
               alt="轻口味" />
          <p class="site-author-name" itemprop="name">轻口味</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">18</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/qingkouwei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/LightTaste" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/turnpp/" target="_blank" title="豆瓣">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  豆瓣
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/shen-jun-wei-9/" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://github.com/ossrs/srs" title="SRS" target="_blank">SRS</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">轻口味</span>
</div>

<div>
<a href="http://www.miitbeian.gov.cn/">京ICP备17018543号</a>

        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      本站访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人次
    </span>
  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "bb46b146831e4e34808d09cd94c85f50",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

</body>
</html>
